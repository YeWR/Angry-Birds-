require=function c(r,s,a){function d(e,t){if(!s[e]){if(!r[e]){var i="function"==typeof require&&require;if(!t&&i)return i(e,!0);if(l)return l(e,!0);var o=new Error("Cannot find module '"+e+"'");throw o.code="MODULE_NOT_FOUND",o}var n=s[e]={exports:{}};r[e][0].call(n.exports,function(t){return d(r[e][1][t]||t)},n,n.exports,c,r,s,a)}return s[e].exports}for(var l="function"==typeof require&&require,t=0;t<a.length;t++)d(a[t]);return d}({BirdBoom:[function(t,e,i){"use strict";cc._RF.push(e,"a2fbbvOCtpJOL74mjfPS++F","BirdBoom");var p=t("../utils/common"),o=t("BirdObject");cc.Class({extends:o,properties:{},onLoad:function(){this.init("bird_boom"),this.boomRadius=150,this.boomVelocityMax=this.emitVelocityMax,this.boomEffectMax=this.blood_max/1.5,this.fragmentType="FragmentBird"},onSkill:function(t){var l=this,h=(0,p.getWorldLocation)(this.node);this._getAllTools().forEach(function(t){var e=l._getlMinDistance_Tool(t,h);if(e<=l.boomRadius){var i=1-e/l.boomRadius,o=l.boomEffectMax*i,n=l._getToolSubclass(t);if(n.onAttack(o,"bird_boom"),n&&n.blood){var c=(0,p.getWorldLocation)(t).sub(h),r=t.getComponent(cc.RigidBody).getMass(),s=l.boomVelocityMax*i/r,a=s*c.x/e,d=s*c.y/e;n.setVelocity(a,d)}}}),this.setVelocity(0,0),this.node.setContentSize(0,0),this.setGravity(0),this._playAnimation(),this._onDeath(),this._onPlayAudio("boom")},_playAnimation:function(){this.getComponent(cc.Animation).play()},_getAllTools:function(){var t=(0,p.getCanvas)(this.node);return(0,p.getAllBranches)(t).filter(function(t){if(-1!==t._name.indexOf("tool"))return t})},_getlMinDistance_Tool:function(t,e){var i=t._name;if(-1!==i.indexOf("circle")){var o=(0,p.getWorldLocation)(t),n=t.getComponent(cc.PhysicsCircleCollider).radius;return(0,p.getMinDistance_P_C)(e,o,n)}if(-1!==i.indexOf("triangle")){var c=t.getBoundingBoxToWorld(),r=new cc.Vec2(c.x,c.y),s=new cc.Vec2(c.x+c.width/2,c.y+c.height),a=new cc.Vec2(c.x+c.width,c.y);return(0,p.getMinDistance_P_Poly)(e,r,s,a)}var d=t.getBoundingBoxToWorld(),l=new cc.Vec2(d.x,d.y),h=new cc.Vec2(d.x+d.width,d.y),u=new cc.Vec2(d.x+d.width,d.y+d.height),m=new cc.Vec2(d.x,d.y+d.height);return(0,p.getMinDistance_P_Poly)(e,l,h,u,m)},_getToolSubclass:function(t){var e=t._name;return-1!==e.indexOf("ice")?t.getComponent("Ice"):-1!==e.indexOf("pig")?t.getComponent("Pig"):-1!==e.indexOf("stone")?t.getComponent("Stone"):-1!==e.indexOf("wood")?t.getComponent("Wood"):-1!==e.indexOf("shelf")?t.getComponent("Shelf"):null},start:function(){}}),cc._RF.pop()},{"../utils/common":"common",BirdObject:"BirdObject"}],BirdFly:[function(t,e,i){"use strict";cc._RF.push(e,"e426fUBSXtM6qhf4OJIo6P0","BirdFly");var u=t("../utils/common"),o=t("BirdObject");cc.Class({extends:o,properties:{},onLoad:function(){this.init("bird_fly"),this.fragmentType="FragmentBird"},onSkill:function(t){if(!this.crashFlag&&t){var e=t.getLocationX(),i=t.getLocationY(),o=this.node.parent.parent.getChildByName("camera").getComponent("cameraController"),n=o.node.getPosition().sub(o.initPosition),c=(0,u.getWorldLocation)(this.node),r=e-(c=c.sub(n)).x,s=i-c.y,a=Math.hypot(r,s),d=.65*this.emitVelocityMax*r/a,l=.65*this.emitVelocityMax*s/a,h=180*Math.atan2(l,d)/Math.PI;this.node.setRotation(h),this.setVelocity(d,l)}},start:function(){}}),cc._RF.pop()},{"../utils/common":"common",BirdObject:"BirdObject"}],BirdObject:[function(t,e,i){"use strict";cc._RF.push(e,"cef18tefHJAMI39RGfiqct4","BirdObject");var m=t("../utils/common");cc.Class({extends:cc.Component,properties:{valid:!0,accel:0,blood_max:0,blood:0,armor:0,fragmentPrefab:{default:null,type:cc.Prefab},crashAudio:{url:cc.AudioClip,default:null},boomAudio:{url:cc.AudioClip,default:null},springAudio:{url:cc.AudioClip,default:null},emitRadiusMax:0,emitRadiusMin:0,emitVelocityMax:0,duration:0},init:function(t){this.imageId=0,this.ready=0,this.setGravity(1),this.setScreenRectangle(),this.crashFlag=!1,this.skillFlag=!0,this.spriteImage="resources/textures/birds/",this.imageId=0,this.type=t},readyEmit:function(t){this.ready=1,this.setVelocity(0,0),this.setGravity(0),this.emitStartPosition=(0,m.getWorldLocation)(this.node.parent),this.spring=t,this.spring.active=!0;var e=this.spring.getComponent(cc.RopeJoint);e.maxLength=this.emitRadiusMax;var i=this.node.getComponent(cc.RigidBody);e.connectedBody=i,this.node.setPosition(0,0);cc.moveTo(1,0,0);this.graphicsSpring=this.spring.addComponent(cc.Graphics);var o=new cc.Vec2(0,0);this.ropeLeftLocation=new cc.Vec2(o.x-12,o.y-2),this.ropeRightLocation=new cc.Vec2(o.x+8,o.y),this._drawRope(this.graphicsSpring),this.node.parent.on("touchmove",this._touchmoveEvent.bind(this)),this.node.parent.once("touchend",this._emitEvent.bind(this)),this.node.parent.once("touchcancel",this._emitEvent.bind(this))},_touchmoveEvent:function(t){if(1===this.ready){var e=t.getLocation(),i=this.node.parent,o=(0,m.getWorldLocation)(i),n=i.getContentSize(),c=(0,m.changeRectangle)(o,n),r=t.touch.getDelta();if(!m.isOutOfBorder.apply(void 0,[e].concat(function(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return Array.from(t)}(c)))&&r.x<20&&r.y<20){this._onStopAudio(),this._onPlayAudio("spring");var s=this.node.getPosition();s.x+=r.x,s.y+=r.y,this.node.setPosition(s)}t.stopPropagation()}},_emitEvent:function(t){if(1===this.ready){var e=this._locationTransform(this.emitStartPosition);this.ready=-1,this.node.parent.off("touchmove",this._touchmoveEvent.bind(this)),this.spring.getComponent(cc.RopeJoint)&&this.spring.getComponent(cc.RopeJoint).destroy(),this.spring.active=!1,this.emit(e,this),this.graphicsOrbit=this.node.parent.getComponent(cc.Graphics),this.graphicsOrbit?this.graphicsOrbit.clear():this.graphicsOrbit=this.node.parent.addComponent(cc.Graphics),this._skillBind(),t.stopPropagation()}},_skillEvent:function(t){this.skillFlag&&(this.onSkill(t),this._skillClear())},_onDeath:function(){this.node&&(this.blood=0,this.setFragment(),this._skillClear(),this.node.setContentSize(0,0),this._onPlayAudio("crash"),this.scheduleOnce(function(){this.node.destroy()},this.duration/3))},_skillBind:function(){var t=this.node.parent.parent;t&&t.once("touchstart",this._skillEvent.bind(this))},_skillClear:function(){this.skillFlag=!1},_drawRope:function(t){t.clear();var e=(0,m.getWorldLocation)(this.node.getComponent(cc.RigidBody).node),i=(0,m.getWorldLocation)(this.spring),o=e.sub(i),n=new cc.Vec2(o.x-10,o.y),c=new cc.Vec2(o.x+10,o.y);t.strokeColor=cc.Color.BLACK,t.lineWidth=2,t.moveTo(this.ropeLeftLocation.x,this.ropeLeftLocation.y),t.lineTo(n.x,n.y),t.stroke(),t.lineWidth=2,t.moveTo(this.ropeRightLocation.x,this.ropeRightLocation.y),t.lineTo(c.x,c.y),t.stroke()},_drawCircle:function(t){var e=(0,m.getWorldLocation)(this.node.getComponent(cc.RigidBody).node),i=(0,m.getWorldLocation)(this.node.parent),o=e.sub(i),n=this.node.parent.getContentSize(),c=new cc.Vec2(n.width/2,n.height/2);c=c.add(o);var r=cc.Color.YELLOW;t.strokeColor=r,this.orbitRadius||(this.orbitRadius=0),this.orbitRadius=this.orbitRadius%16+1;var s=this.orbitRadius/4;s===Math.floor(s)&&(t.circle(c.x,c.y,s),t.fill(),t.stroke())},_locationTransform:function(t){t.x,t.y;return t.sub((0,m.getWorldLocation)(this.node))},emit:function(t){var e=this.node.getComponent(cc.RigidBody);e.gravityScale=1,e.fixedRotation=!1;var i=Math.hypot(t.x,t.y),o=i*this.emitVelocityMax/this.emitRadiusMax,n=t.x*o/i,c=t.y*o/i;this.setVelocity(n,c)},setScreenRectangle:function(){var t=this.node.parent.parent,e=t.getContentSize(),i=(0,m.getWorldLocation)(t);this.screen=(0,m.changeRectangle)(i,e)},setRigidActive:function(t){this.node.getComponent(cc.RigidBody).active=t},setRestitution:function(t){this.node.getComponent(cc.PhysicsCollider).restitution=t},setVelocity:function(t,e){this.node.getComponent(cc.RigidBody).linearVelocity=new cc.Vec2(t,e)},setGravity:function(t){this.node.getComponent(cc.RigidBody).gravityScale=t},setFragment:function(){if(this.fragmentPrefab)for(var t=(0,m.getWorldLocation)(this.node),e=Math.floor(4*Math.random())+3,i=0;i<e;++i){var o=Math.floor(3*Math.random());3<=o&&(o=2);var n=cc.instantiate(this.fragmentPrefab),c=this.node.parent,r=(0,m.getWorldLocation)(c),s=t.sub(r),a=s.x+this.node.getContentSize().width*(Math.random()-.5),d=s.y+this.node.getContentSize().height*(Math.random()-.5);c.addChild(n),n.setPosition(a,d);var l=n.getComponent(this.fragmentType),h=l.velocityMax*(Math.random()-.5),u=l.velocityMax*(Math.random()-.5);l.setVelocity(h,u),l.init(o)}},onPostSolve:function(t,e,i){this.node.getComponent(cc.RigidBody).linearDamping=this.accel,this.crashFlag||-1!==this.ready||(this.crashFlag=!0,this.scheduleOnce(function(){this._skillEvent(),this._onDeath()},this.duration));var o=180/Math.PI*this.node.rotation,n=(0,m.getEffect)(e,i,o);if(0!==n){var c=this.node.getComponent(cc.Sprite);this.onAttack(n),this.blood&&(0<this.blood&&this.blood<=this.blood_max/3&&2!==this.imageId?(this._onPlayAudio("crash"),this.setFragment(),this.imageId=2,(0,m.spriteUpdate)(c,this.spriteImage+this.type+"_"+this.imageId+".png")):this.blood>this.blood_max/3&&this.blood<=this.blood_max/3*2&&1!==this.imageId&&(this._onPlayAudio("crash"),this.setFragment(),this.imageId=1,(0,m.spriteUpdate)(c,this.spriteImage+this.type+"_"+this.imageId+".png")))}},onAttack:function(t){this.blood<=0||(this.blood-=t/this.armor,this.blood<=0&&(this.blood=0,this.skillFlag&&this._skillEvent(),this._onDeath()))},_onPlayAudio:function(t){"crash"===t&&this.crashAudio?this.currentAudio=cc.audioEngine.play(this.crashAudio,!1,1):"boom"===t&&this.boomAudio?this.currentAudio=cc.audioEngine.play(this.boomAudio,!1,.5):"spring"===t&&this.spring&&(this.currentAudio=cc.audioEngine.play(this.springAudio,!1,1))},_onStopAudio:function(){cc.audioEngine.stop(this.currentAudio)},update:function(t){if(this.graphicsSpring&&(1===this.ready&&this.spring&&this.spring.active?this._drawRope(this.graphicsSpring):this.graphicsSpring.clear()),this.graphicsOrbit&&(-1!==this.ready||this.crashFlag||this._drawCircle(this.graphicsOrbit)),-1===this.ready&&this.blood){var e=(0,m.getWorldLocation)(this.node),i=this.screen;(0,m.isOutOfBorder)(e,i[0]+5,i[1]-5,i[2]+5,i[3]-5)&&this._onDeath()}}}),cc._RF.pop()},{"../utils/common":"common"}],BirdSwell:[function(t,e,i){"use strict";cc._RF.push(e,"e07b2iDW6NKsIiQdb1q+3ht","BirdSwell");var c=t("../utils/common"),o=t("BirdObject");cc.Class({extends:o,properties:{},onLoad:function(){this.init("bird_swell"),this.fragmentType="FragmentBird"},onSkill:function(t){var e=this.node.addComponent(cc.PhysicsCircleCollider),i=this.node.getContentSize(),o=e.offset,n=e.radius;this.blood_max*=Math.pow(3,3),this.blood*=Math.pow(3,3),this.node.setContentSize(3*i.width,3*i.height),e.radius=3*n,e.offset=new cc.Vec2(3*o.x,3*o.y),this.type="bird_swell_big",(this.imageId=0,c.spriteUpdate)(this.node.getComponent(cc.Sprite),this.spriteImage+this.type+"_"+this.imageId+".png")}}),cc._RF.pop()},{"../utils/common":"common",BirdObject:"BirdObject"}],Bird:[function(t,e,i){"use strict";cc._RF.push(e,"19310rFw2hJ2Kn4C3HZhprh","Bird");var o=t("BirdObject");cc.Class({extends:o,properties:{},onLoad:function(){this.init("bird"),this.fragmentType="FragmentBird"},onSkill:function(t){},start:function(){}}),cc._RF.pop()},{BirdObject:"BirdObject"}],FragmentBird:[function(t,e,i){"use strict";cc._RF.push(e,"a0d75t83m9Lbq+1lnh/3ZVk","FragmentBird");var o=t("FragmentObject");cc.Class({extends:o,properties:{},onLoad:function(){this.spriteImage="resources/textures/fragments/"}}),cc._RF.pop()},{FragmentObject:"FragmentObject"}],FragmentIce:[function(t,e,i){"use strict";cc._RF.push(e,"df008DQCPBIF6IL5sNoMRx2","FragmentIce");var o=t("FragmentObject");cc.Class({extends:o,properties:{},onLoad:function(){this.spriteImage="resources/textures/fragments/"}}),cc._RF.pop()},{FragmentObject:"FragmentObject"}],FragmentObject:[function(t,e,i){"use strict";cc._RF.push(e,"ad94fuLKW1P+ZZsL7ky1y3Y","FragmentObject");var o=t("../utils/common");cc.Class({extends:cc.Component,properties:{type:"",duration:0,velocityMax:100},init:function(t){(0,o.spriteUpdate)(this.node.getComponent(cc.Sprite),this.spriteImage+this.type+"_"+t+".png"),this.scheduleOnce(function(){this._onDeath()},this.duration)},setVelocity:function(t,e){this.node.getComponent(cc.RigidBody).linearVelocity=new cc.Vec2(t,e)},_onDeath:function(){this.node.destroy()}}),cc._RF.pop()},{"../utils/common":"common"}],FragmentStone:[function(t,e,i){"use strict";cc._RF.push(e,"adc758UO71DRJLuIqd3PBEY","FragmentStone");var o=t("FragmentObject");cc.Class({extends:o,properties:{},onLoad:function(){this.spriteImage="resources/textures/fragments/"}}),cc._RF.pop()},{FragmentObject:"FragmentObject"}],FragmentWood:[function(t,e,i){"use strict";cc._RF.push(e,"df1b6euebxPa7r2swH7xwoL","FragmentWood");var o=t("FragmentObject");cc.Class({extends:o,properties:{},onLoad:function(){this.spriteImage="resources/textures/fragments/"},start:function(){}}),cc._RF.pop()},{FragmentObject:"FragmentObject"}],GameClearance:[function(t,e,i){"use strict";cc._RF.push(e,"0a90cKrB6VGob94bfRxOwew","GameClearance"),cc.Class({extends:cc.Component,properties:{},onLoad:function(){this._addCongratulations(2),this.scheduleOnce(function(){cc.director.loadScene("start")},3)},_addCongratulations:function(t){var e=new cc.Node;this.node.addChild(e),e.addComponent(cc.Label).string="没想到真有人能通关。233，太强啦。";var i=new cc.Vec2(0,200);e.setPosition(i);var o=e.getPosition(),n=cc.moveTo(t,o.x,o.y-400),c=cc.fadeTo(t,0);e.runAction(n),e.runAction(c)},start:function(){}}),cc._RF.pop()},{}],GameHelp:[function(t,e,i){"use strict";cc._RF.push(e,"45effzMBS1LlJO7SvrNO0oc","GameHelp"),cc.Class({extends:cc.Component,properties:{},onLoad:function(){},onBackGame:function(){cc.director.loadScene("start")},onIntroGame:function(){cc.director.loadScene("introduction")},start:function(){}}),cc._RF.pop()},{}],GameIntro:[function(t,e,i){"use strict";cc._RF.push(e,"4f8a6wCXfpGQ58VgGpS1v7Y","GameIntro"),cc.Class({extends:cc.Component,properties:{btn_back:{default:null,type:cc.Node}},onLoad:function(){},onBackGame:function(){cc.director.loadScene("help")},start:function(){}}),cc._RF.pop()},{}],GameMenu:[function(t,e,i){"use strict";cc._RF.push(e,"5202814naZL/popuUJU0IPc","GameMenu"),cc.Class({extends:cc.Component,properties:{level_prefab:{default:null,type:cc.Prefab},level_clock_prefab:{default:null,type:cc.Prefab}},onLoad:function(){var t=JSON.parse(cc.sys.localStorage.getItem("player_resources"));this.number_levels=t.number_levels,this.highest_level=t.highest_level,this.stars=t.stars,this.onLevelLayout()},onLevelLayout:function(){for(var t=this.stars,e=0;e<this.number_levels;++e){var i=null;if(e<this.highest_level){var o=0;e<t.length&&(o=Number(t[e])),(i=cc.instantiate(this.level_prefab)).getComponent("Level").init(e+1,o)}else i=cc.instantiate(this.level_clock_prefab);var n=200*parseInt(e%4)-300,c=200-200*parseInt(e/4);i.setPosition(cc.p(n,c)),this.node.addChild(i)}}}),cc._RF.pop()},{}],GameStart:[function(t,e,i){"use strict";cc._RF.push(e,"b2a001U3dNAdogkvXAt49gB","GameStart"),cc.Class({extends:cc.Component,properties:{btn_start:{default:null,type:cc.Node},btn_help:{default:null,type:cc.Node},bgmAudio:{url:cc.AudioClip,default:null}},onLoad:function(){this.btn_start.active=!1,this._addWaiting(),this._addResources(),this._onPlayAudio()},_addWaiting:function(){var t=new cc.Node;this.node.addChild(t);var e=(this.waitingLabel=t).addComponent(cc.Label);t.color=new cc.color(0,0,0,255),e.string="loading...",t.setPosition(0,-150)},_addResources:function(){if(cc.sys.localStorage.getItem("player_resources"))return this.waitingLabel.active=!1,void(this.btn_start.active=!0);this._initData(this)},onStartGame:function(){cc.director.loadScene("menu")},onHelp:function(){this._stopPlayAudio(),cc.director.loadScene("help")},_onPlayAudio:function(){this.bgmAudio&&(this.current=cc.audioEngine.play(this.bgmAudio,!0,.3))},_stopPlayAudio:function(){cc.audioEngine.stop(this.current)},_initData:function(i){var t=cc.url.raw("resources/json/init_data.json");cc.loader.load(t,function(t,e){i.resources=e,cc.sys.localStorage.setItem("player_resources",JSON.stringify(i.resources)),i.waitingLabel.active=!1,i.btn_start.active=!0})}}),cc._RF.pop()},{}],Ice:[function(t,e,i){"use strict";cc._RF.push(e,"327cdizN8pBupzS8i6Q7LEy","Ice");var o=t("ToolObject");cc.Class({extends:o,properties:{},onLoad:function(){this.spriteImage="resources/textures/tools/ices/",this.imageId=0,this.fragmentType="FragmentIce",this.score=this.blood_max}}),cc._RF.pop()},{ToolObject:"ToolObject"}],Level:[function(t,e,i){"use strict";cc._RF.push(e,"1ba3cNNmW1P052VN7+FpKyK","Level");var o=t("./utils/common");cc.Class({extends:cc.Component,properties:{},init:function(t,e){this.level_id=t,this.star=e,this._addLevelLable(t),this._addStarSprite(e)},_addLevelLable:function(t){var e=new cc.Node;e.addComponent(cc.Label),e.getComponent(cc.Label).string=t,this.node.addChild(e),e.setPosition(0,-5),this.node.on("touchstart",this._eventChooseScene,this)},_addStarSprite:function(t){var e=this.node.getChildByName("star").getComponent(cc.Sprite),i="resources/textures/stars/star_"+t+".png";(0,o.spriteUpdate)(e,i)},_eventChooseScene:function(){var t="level_"+this.level_id;cc.director.loadScene(t)}}),cc._RF.pop()},{"./utils/common":"common"}],Pig:[function(t,e,i){"use strict";cc._RF.push(e,"fafe0dtI1BL4KufEPymX4Qp","Pig");var o=t("ToolObject");cc.Class({extends:o,properties:{},onLoad:function(){this.spriteImage="resources/textures/pigs/",this.imageId=0,this.score=1e4}}),cc._RF.pop()},{ToolObject:"ToolObject"}],Shelf:[function(t,e,i){"use strict";cc._RF.push(e,"c6c01z9U7hK577U9cVRCLSY","Shelf");var o=t("ToolObject");cc.Class({extends:o,properties:{},onLoad:function(){this.spriteImage="resources/textures/tools/shelfs/",this.imageId=0,this.fragmentType="FragmentWood",this.score=5e3}}),cc._RF.pop()},{ToolObject:"ToolObject"}],Stone:[function(t,e,i){"use strict";cc._RF.push(e,"e3ad1iPlhZNLoEpVBiOQN0q","Stone");var o=t("ToolObject");cc.Class({extends:o,properties:{},onLoad:function(){this.spriteImage="resources/textures/tools/stones/",this.imageId=0,this.fragmentType="FragmentStone",this.score=10*this.blood_max}}),cc._RF.pop()},{ToolObject:"ToolObject"}],ToolObject:[function(t,e,i){"use strict";cc._RF.push(e,"4da25URRehEhbWfkmTw9xbJ","ToolObject");var m=t("../utils/common");cc.Class({extends:cc.Component,properties:{blood_max:0,blood:0,armor:0,crisp:0,fragmentPrefab:{default:null,type:cc.Prefab},deathAudio:{url:cc.AudioClip,default:null},type:""},onPostSolve:function(t,e,i){var o=180/Math.PI*this.node.rotation,n=(0,m.getEffect)(e,i,o);if(0!==n){var c=i.node.name,r=this.node.getComponent(cc.Sprite);this.onAttack(n,c),this.blood&&(0<this.blood&&this.blood<=this.blood_max/3&&2!==this.imageId?(this.imageId=2,(0,m.spriteUpdate)(r,this.spriteImage+this.type+"_"+this.imageId+".png")):this.blood>this.blood_max/3&&this.blood<=2*this.blood_max/3&&1!==this.imageId&&(this.imageId=1,(0,m.spriteUpdate)(r,this.spriteImage+this.type+"_"+this.imageId+".png")))}},setVelocity:function(t,e){this.node.getComponent(cc.RigidBody).linearVelocity=new cc.Vec2(t,e)},setFragment:function(){if(this.fragmentPrefab)for(var t=(0,m.getWorldLocation)(this.node),e=Math.floor(4*Math.random())+3,i=0;i<e;++i){var o=Math.floor(3*Math.random());3<=o&&(o=2);var n=cc.instantiate(this.fragmentPrefab),c=this.node.parent,r=(0,m.getWorldLocation)(c),s=t.sub(r),a=s.x+this.node.getContentSize().width*(Math.random()-.5),d=s.y+this.node.getContentSize().height*(Math.random()-.5);c.addChild(n),n.setPosition(a,d);var l=n.getComponent(this.fragmentType),h=l.velocityMax*(Math.random()-.5),u=l.velocityMax*(Math.random()-.5);l.setVelocity(h,u),l.init(o)}},onAttack:function(t,e){this.blood<=0||(null!==e&&-1!==e.indexOf("bird")?this.blood-=t*this.crisp:this.blood-=t/this.armor,this.blood<=0&&(this.blood=0,this._onDeath()))},_onDeath:function(){if(this.node){this.blood=0,this.setFragment(),this.node.setContentSize(0,0),this.getComponent(cc.Sprite).spriteFrame=new cc.SpriteFrame,this._onPlayAudio();if(this.score)(0,m.scoreAnimation)(this.node,this.score,1),(0,m.getGameController)(this.node).addScore(this.score);this.scheduleOnce(function(){this.node.destroy()},1)}},_onPlayAudio:function(){this.deathAudio&&(this.currentAudio=cc.audioEngine.play(this.deathAudio,!1,1))},_onStopAudio:function(){cc.audioEngine.stop(this.currentAudio)}}),cc._RF.pop()},{"../utils/common":"common"}],Wood:[function(t,e,i){"use strict";cc._RF.push(e,"0c5c9iF+B9JZqXJxrxICdXZ","Wood");var o=t("ToolObject");cc.Class({extends:o,properties:{},onLoad:function(){this.spriteImage="resources/textures/tools/woods/",this.imageId=0,this.fragmentType="FragmentWood",this.score=this.blood_max}}),cc._RF.pop()},{ToolObject:"ToolObject"}],cameraController:[function(t,e,i){"use strict";cc._RF.push(e,"2263cuBIRhChIGnb/taN/dM","cameraController");var a=t("../utils/common");cc.Class({extends:cc.Component,properties:{},onLoad:function(){this.active=!1,this.initPosition=this.node.getPosition(),this.setScreenRectangle()},bindCenter:function(t){this.active=!0,this.getComponent(cc.Camera).zoomRatio=1,this.center=t,this.node.setPosition(this.initPosition.x,this.initPosition.y),this.previousCenterPosition=(0,a.getWorldLocation)(this.center.node)},setStartScreen:function(){var t=cc.moveTo(1,0,0);this.node.runAction(t)},setScreenRectangle:function(){var t=this.node.parent,e=t.getContentSize(),i=(0,a.getWorldLocation)(t);this.screen=(0,a.changeRectangle)(i,e);var o=t.parent,n=o.getPosition(),c=o.getContentSize(),r=(0,a.changeRectangle)(n,c),s=new cc.Vec2(this.screen[1]-r[1],this.screen[3]-r[3]);this.cameraMinPos=n,this.cameraMaxPos=n.add(s)},moveCamera:function(t){var e=(0,a.getWorldLocation)(this.node),i=this.node.getPosition();e.x+t.x>this.cameraMinPos.x&&e.x+t.x<this.cameraMaxPos.x&&(i.x+=t.x),e.y+t.y>this.cameraMinPos.y&&e.y+t.y<this.cameraMaxPos.y&&(i.y+=t.y),this.node.setPosition(i.x,i.y)},start:function(){},update:function(t){if(this.active){var e=this.center,i=this.getComponent(cc.Camera);if(e&&e.node&&i&&-1===e.ready){var o=(0,a.getWorldLocation)(e.node),n=this.previousCenterPosition,c=(this.previousCenterPosition=o).sub(n);this.moveCamera(c)}}else{var r=this.getComponent(cc.Camera).zoomRatio,s=this.node.parent.parent.getContentSize();Math.max(s.width/(this.screen[1]-this.screen[0]),s.height/(this.screen[3]-this.screen[2]))+.01<=(r-=.0025)&&(this.getComponent(cc.Camera).zoomRatio=r)}}}),cc._RF.pop()},{"../utils/common":"common"}],common:[function(t,e,i){"use strict";function h(t,e){var i=new cc.SpriteFrame;i.setTexture(cc.url.raw(e)),t.spriteFrame=i}function o(t){var i=new Array;return function e(t){t&&t.getChildren().forEach(function(t){i.push(t),e(t)})}(t),i}function n(t){for(var e=t;e.parent;)e=e.parent;return e}function r(t,e,i){var o=0,n=i.x-e.x,c=i.y-e.y,r=-((e.x-t.x)*n+(e.y-t.y)*c)/(n*n+c*c),s=r*n+e.x,a=r*c+e.y;if(a>=Math.min(e.y,i.y)&&a<=Math.max(e.y,i.y)&&s>=Math.min(e.x,i.x)&&s<=Math.max(e.x,i.x))o=Math.hypot(s-t.x,a-t.y);else{var d=Math.hypot(e.x-t.x,e.y-t.y),l=Math.hypot(i.x-t.x,i.y-t.y);o=d<l?d:l}return o}cc._RF.push(e,"0f5fdkRnChCGozgAmtK/3md","common"),Object.defineProperty(i,"__esModule",{value:!0}),i.getGameController=function(t){return n(t).getChildren()[0].getComponent("gameController")},i.spriteUpdate=h,i.scoreAnimation=function(t,e,i){if(!e)return;var o=new cc.Node;if(t.parent.addChild(o),1e4===e||5e3===e){var n=o.addComponent(cc.Sprite),c="resources/textures/scores/score_"+e+".png";h(n,c)}else{var r=o.addComponent(cc.Label);r.font="resources/textures/font/mikado_outline_shadow.fnt",r.string=e}var s=t.getPosition();o.setPosition(s);var a=o.getPosition(),d=cc.moveTo(i,a.x,a.y+150),l=cc.fadeTo(i,0);o.runAction(d),o.runAction(l)},i.getEffect=function(t,e,i){var o=t.getComponent(cc.RigidBody),n=e.getComponent(cc.RigidBody),c=o.linearVelocity,r=n.linearVelocity,s=o.getMass(),a=n.getMass(),d=r.sub(c),l=Math.abs(d.x*Math.sin(i)+d.y*Math.cos(i))/8;0===a&&(a=s);return.5*a*l*l},i.getWorldLocation=function(t){return t.parent.convertToWorldSpaceAR(t)},i.getAllBranches=o,i.getCanvas=n,i.getMinDistance_P_Line=r,i.getMinDistance_P_C=function(t,e,i){var o=Math.hypot(t.x-e.x,t.y-e.y);return o-=i,o=Math.max(o,0)},i.getMinDistance_P_Poly=function(t){for(var e=arguments.length,i=Array(1<e?e-1:0),o=1;o<e;o++)i[o-1]=arguments[o];for(var n=r(t,i[i.length-1],i[0]),c=0;c<i.length-1;++c)n=Math.min(n,r(t,i[c],i[c+1]));return n},i.isOutOfBorder=function(t,e,i,o,n){if(t.x<e||t.x>i||t.y<o||t.y>n)return!0;return!1},i.changeRectangle=function(t,e){var i=[];return i[0]=t.x-e.width/2,i[1]=t.x+e.width/2,i[2]=t.y-e.height/2,i[3]=t.y+e.height/2,i},i.getAllToolsPosition=function(t){var e=o(t);e.forEach(function(t){if(t){var e=t._name;e.indexOf("bird")||e.indexOf("tool")}})},cc._RF.pop()},{}],gameController:[function(t,e,i){"use strict";cc._RF.push(e,"ed42bhWaEdGjYPkoiSe6qtV","gameController");var l=t("../utils/common");cc.Class({extends:cc.Component,properties:{size:cc.size(0,0),level:0,birdPrefab:{default:null,type:cc.Prefab},birdBoomPrefab:{default:null,type:cc.Prefab},birdFlyPrefab:{default:null,type:cc.Prefab},birdSwellPrefab:{default:null,type:cc.Prefab},woodLongPrefab:{default:null,type:cc.Prefab},woodShortPrefab:{default:null,type:cc.Prefab},woodCirclePrefab:{default:null,type:cc.Prefab},stoneLongPrefab:{default:null,type:cc.Prefab},stoneTrianglePrefab:{default:null,type:cc.Prefab},stoneCirclePrefab:{default:null,type:cc.Prefab},icePrefab:{default:null,type:cc.Prefab},pigPrefab:{default:null,type:cc.Prefab},selectorPrefab:{default:null,type:cc.Prefab},menuPrefab:{default:null,type:cc.Prefab},nextPrefab:{default:null,type:cc.Prefab},restartPrefab:{default:null,type:cc.Prefab},victoryAudio:{url:cc.AudioClip,default:null},failAudio:{url:cc.AudioClip,default:null},spring:{default:null,type:cc.Node}},onLoad:function(){cc.director.getPhysicsManager().enabled=!0,cc.director.getPhysicsManager().gravity=cc.v2(0,-500),this.readyCamera=!1,this.gameOver=!1,this.score=0,this.curBird=null,this._addResources()},start:function(){},_controlGame:function(e){e.schedule(function(){var t=e._levelNext(e);e.gameOver||(!e._emitNext(e)||null!==e.curBird&&-1!==e.curBird.ready||(e._cameraMoveBind(),e.scheduleOnce(function(){e.curBird=e._emitBird(e)},.5)),0!==t&&e._gameOver(t,e))},8)},_addResources:function(){var i=this,t="resources/json/level_"+i.level+".json",e=cc.url.raw(t);cc.loader.load(e,function(t,e){i.resources=e,i._addPlayerRes(i),i._addScene(i),i._addBirds(i),i._addCamera(i),i._controlGame(i),i.ready=!0})},_addPlayerRes:function(t){var e=JSON.parse(cc.sys.localStorage.getItem("player_resources")),i=e.stars,o=e.highest_scores;t.highest_level=e.highest_level,t.number_levels=e.number_levels,t.stars=i,t.star=0,t.highest_score=0,t.level<=i.length&&(t.star=i[t.level-1]),t.level<=o.length&&(t.highest_score=o[t.level-1])},_addScene:function(t){var e=t.node.getChildByName("score");e.color=new cc.color(0,0,0,255);var i=e.getComponent(cc.Label);i.string="Score: "+t.score,t.scoreLabel=i;var o=t.node.getChildByName("score_highest");o.color=new cc.color(255,0,0,255),o.getComponent(cc.Label).string="Highest Score: "+t.highest_score;var n=t.node.getChildByName("level");n.color=new cc.color(0,0,0,255),n.getComponent(cc.Label).string="Level: "+t.level},_addBirds:function(n){n.birds=new Array;var t=n.resources.birds,c=n.node.getChildByName("bg").getChildByName("emitPlace"),r=0;t.forEach(function(t){var e=t.split("bird")[1],i="Bird"+e,o=void 0;""===e?o=cc.instantiate(n.birdPrefab):"Boom"===e?o=cc.instantiate(n.birdBoomPrefab):"Fly"===e?o=cc.instantiate(n.birdFlyPrefab):"Swell"===e&&(o=cc.instantiate(n.birdSwellPrefab)),n.birds.push(o.getComponent(i)),c.addChild(o),r+=-40,o.setPosition(r,0)})},_addCamera:function(t){var e=t.node.getChildByName("bg");t.camera=e.getChildByName("camera").getComponent("cameraController"),t.camera.setStartScreen()},_addSelector:function(t,i){var e=cc.instantiate(i.selectorPrefab);i.node.addChild(e);var o=cc.instantiate(i.menuPrefab);e.addChild(o),o.on("touchstart",function(){cc.director.loadScene("menu")},i);var n=cc.instantiate(i.restartPrefab);e.addChild(n),n.on("touchstart",function(){var t="level_"+i.level;cc.director.loadScene(t)},i),e.getChildByName("scores").getComponent(cc.Label).string="Score: "+i.score;var c=i._birdsEmitNumber(),r=Math.max(0,4-c);r=Math.min(3,r);var s=e.getChildByName("star").getComponent(cc.Sprite),a="resources/textures/stars/star_"+r+".png";if((0,l.spriteUpdate)(s,a),-1!==t&&i._conditionNext(i)){if(1===t){var d=cc.instantiate(i.nextPrefab);e.addChild(d),d.on("touchstart",function(){var t=i.level+1,e="";e=i.highest_level>=t?"level_"+t:"clearance",cc.director.loadScene(e)},i),o.setPosition(-100,-95),n.setPosition(0,-93),d.setPosition(100,-95)}}else o.setPosition(-70,-95),n.setPosition(70,-95);return e},addScore:function(t){this.score+=t,this.scoreLabel.string="Score: "+this.score},_emitBird:function(t){t.spring.getComponent(cc.RopeJoint)||t.spring.addComponent(cc.RopeJoint),t.birds.forEach(function(t){t&&(0===t.ready&&t.setRigidActive(!1))});var e=t.birds.shift();return t.birds.push(e),e&&(e.setRigidActive(!0),e.setRestitution(.4),e.readyEmit(t.spring)),this.camera.bindCenter(e),e},_allStatic:function(t){var o=!0;return t.forEach(function(t){var e=t.getComponent(cc.RigidBody);if(e){var i=e.linearVelocity;(Math.abs(.5<i.x)||Math.abs(.5<i.y))&&(o=!1)}}),o},_birdsEmitNumber:function(){var e=0;return this.birds.forEach(function(t){-1===t.ready&&(e+=1)}),e},_emitNext:function(t){return-1!==t.birds[0].ready},_levelNext:function(t){var i=1,e=(0,l.getAllBranches)(t.node);if(e.forEach(function(t){var e=t.name;1===i&&-1!==e.indexOf("pig")&&(i=0)}),0===i){var o=t._birdsEmitNumber();t._allStatic(e)&&o===t.birds.length&&(i=-1)}return i},_gameOver:function(t,e){e.gameOver=!0,e.birds.forEach(function(t){if(t&&-1!==t.ready){(0,l.scoreAnimation)(t.node,1e4,1),e.addScore(1e4)}}),e.highest_score=Math.max(e.highest_score,e.score);var i=e.star,o=e._birdsEmitNumber(),n=Math.max(0,4-o);n=Math.min(3,n),e.star=Math.max(i,n);var c=e.level+1;1===t&&e._conditionNext(e)?(e._onPlayAudio("victory"),c>e.highest_level&&(e.number_levels>=c?e.highest_level=c:console.log("You are so great! No more levels for you! ~0.0~"))):(e._onPlayAudio("fail"),-1===t&&(e.star=Math.max(e.star-1,0))),e._changePlayerRes(e),e._addSelector(t,e)},_changePlayerRes:function(t){var e=JSON.parse(cc.sys.localStorage.getItem("player_resources"));e.stars[t.level-1]=t.star,e.highest_scores[t.level-1]=t.highest_score,e.highest_level=t.highest_level,cc.sys.localStorage.setItem("player_resources",JSON.stringify(e))},_conditionNext:function(t){if(t.level===t.number_levels)return 2<=t.star;if(t.level===t.number_levels-1){if(t.star&&3===t.star){for(var e=0,i=3*(t.level-1)-2,o=0;o<t.level-1;++o)e+=t.stars[o];return i<=e}return!1}return t.level>=t.number_levels/2?!!(t.star&&2<=t.star):!!(t.star&&1<=t.star)},_cameraMoveBind:function(){this.readyCamera||(this.node.getChildByName("bg").on("touchmove",this._cameraEvent.bind(this)),this.readyCamera=!0)},_cameraEvent:function(t){var e=t.touch.getDelta();e.x=-e.x,e.y=-e.y,this.camera.moveCamera(e)},_onPlayAudio:function(t){"victory"===t&&this.victoryAudio?this.currentAudio=cc.audioEngine.play(this.victoryAudio,!1,.8):"fail"===t&&this.failAudio&&(this.currentAudio=cc.audioEngine.play(this.failAudio,!1,.8))}}),cc._RF.pop()},{"../utils/common":"common"}]},{},["GameClearance","GameHelp","GameIntro","GameMenu","GameStart","Level","Bird","BirdBoom","BirdFly","BirdObject","BirdSwell","FragmentBird","FragmentIce","FragmentObject","FragmentStone","FragmentWood","Ice","Pig","Shelf","Stone","ToolObject","Wood","cameraController","common","gameController"]);
(function(t,e,i){function n(i,s){var o=e[i];if(!o){var a=t[i];if(!a){var c="function"==typeof require&&require;if(!s&&c)return c(i,!0);if(r)return r(i,!0);var h=new Error("Cannot find module '"+i+"'");throw h.code="MODULE_NOT_FOUND",h}var l={};o=e[i]={exports:l},a[0]((function(t){return n(a[1][t]||t)}),o,l)}return o.exports}for(var r="function"==typeof require&&require,s=0;s<i.length;s++)n(i[s])})({1:[(function(t,e,i){}),{}],2:[(function(t,e,i){function n(){cc._engineLoaded=!0,console.log(cc.ENGINE_VERSION),o&&o()}function r(){window.removeEventListener("load",r,!1),n()}cc._LogInfos=cc._LogInfos||{};window.CocosEngine=cc.ENGINE_VERSION="1.9.3",cc._renderContext=null,cc._supportRender=!1,cc._canvas=null,cc.container=null,cc._gameDiv=null,t("./cocos2d/core/utils"),t("./cocos2d/core/platform/CCSys");var s=!1,o=null;cc._engineLoaded=!1,cc.initEngine=function(t,e){if(s){var i=o;o=function(){i&&i(),e&&e()}}else o=e,!cc.game.config&&t?cc.game.config=t:cc.game.config||cc.game._loadConfig(),(function(t){var e=cc.game.CONFIG_KEY,i=parseInt(t[e.renderMode])||0;(isNaN(i)||i>2||i<0)&&(t[e.renderMode]=0),cc._renderType=cc.game.RENDER_TYPE_CANVAS,cc._supportRender=!1,0===i?cc.sys.capabilities.opengl?(cc._renderType=cc.game.RENDER_TYPE_WEBGL,cc._supportRender=!0):cc.sys.capabilities.canvas&&(cc._renderType=cc.game.RENDER_TYPE_CANVAS,cc._supportRender=!0):1===i&&cc.sys.capabilities.canvas?(cc._renderType=cc.game.RENDER_TYPE_CANVAS,cc._supportRender=!0):2===i&&cc.sys.capabilities.opengl&&(cc._renderType=cc.game.RENDER_TYPE_WEBGL,cc._supportRender=!0)})(t=cc.game.config),document.body?n():window.addEventListener("load",r,!1),s=!0}}),{"./cocos2d/core/platform/CCSys":165,"./cocos2d/core/utils":205}],3:[(function(t,e,i){function n(t,e){return function(i){"use strict";if(1!==arguments.length){var n="";2===arguments.length?n="Arguments: "+arguments[1]:arguments.length>2&&(n="Arguments: "+cc.js.shiftArguments.apply(null,arguments).join(", ")),t(e+" "+i+", please go to "+o+"#"+i+" to see details. "+n)}else t(e+" "+i+", please go to "+o+"#"+i+" to see details.")}}var r,s=t("./cocos2d/core/platform/CCEnum");cc.DebugMode=s({NONE:0,INFO:1,WARN:2,ERROR:3,INFO_FOR_WEB_PAGE:4,WARN_FOR_WEB_PAGE:5,ERROR_FOR_WEB_PAGE:6}),cc._initDebugSetting=function(t){if(cc.log=cc.logID=cc.warn=cc.warnID=cc.error=cc.errorID=cc.assert=cc.assertID=function(){},t!==cc.DebugMode.NONE){t>cc.DebugMode.ERROR?(function(){function e(t){if(cc._canvas){if(!r){var e=document.createElement("Div");e.setAttribute("id","logInfoDiv"),e.setAttribute("width","200"),e.setAttribute("height",cc._canvas.height);var i=e.style;i.zIndex="99999",i.position="absolute",i.top=i.left="0",(r=document.createElement("textarea")).setAttribute("rows","20"),r.setAttribute("cols","30"),r.setAttribute("disabled","true");var n=r.style;n.backgroundColor="transparent",n.borderBottom="1px solid #cccccc",n.borderTopWidth=n.borderLeftWidth=n.borderRightWidth="0px",n.borderTopStyle=n.borderLeftStyle=n.borderRightStyle="none",n.padding="0px",n.margin=0,e.appendChild(r),cc._canvas.parentNode.appendChild(e)}r.value=r.value+t+"\r\n",r.scrollTop=r.scrollHeight}}cc.error=function(){e("ERROR :  "+cc.js.formatStr.apply(null,arguments))},cc.assert=function(t,i){"use strict";!t&&i&&e("ASSERT: "+(i=cc.js.formatStr.apply(null,cc.js.shiftArguments.apply(null,arguments))))},t!==cc.DebugMode.ERROR_FOR_WEB_PAGE&&(cc.warn=function(){e("WARN :  "+cc.js.formatStr.apply(null,arguments))}),t===cc.DebugMode.INFO_FOR_WEB_PAGE&&(cc.log=cc.info=function(){e(cc.js.formatStr.apply(null,arguments))})})():console&&console.log.apply&&(console.error||(console.error=console.log),console.warn||(console.warn=console.log),console.error.bind?cc.error=console.error.bind(console):cc.error=function(){return console.error.apply(console,arguments)},cc.assert=function(t,e){if(!t)throw e&&(e=cc.js.formatStr.apply(null,cc.js.shiftArguments.apply(null,arguments))),new Error(e)}),t!==cc.DebugMode.ERROR&&(console.warn.bind?cc.warn=console.warn.bind(console):cc.warn=function(){return console.warn.apply(console,arguments)}),t===cc.DebugMode.INFO&&(console.log.bind?cc.log=console.log.bind(console):cc.log=function(){return console.log.apply(console,arguments)},cc.info=function(){(console.info||console.log).apply(console,arguments)}),cc.warnID=n(cc.warn,"Warning"),cc.errorID=n(cc.error,"Error"),cc.logID=n(cc.log,"Log");var e=n((function(){for(var t=[!1],e=0;e<arguments.length;++e)t.push(arguments[e]);cc.assert.apply(null,t)}),"Assert");cc.assertID=function(t){"use strict";t||e.apply(null,cc.js.shiftArguments.apply(null,arguments))}}},cc._throw=function(t){var e=t.stack;e?cc.error(e):cc.error(t)};var o="https://github.com/cocos-creator/engine/blob/master/EngineErrorMap.md"}),{"./cocos2d/core/platform/CCEnum":158}],4:[(function(t,e,i){}),{}],5:[(function(t,e,i){cc.Action=cc._Class.extend({ctor:function(){this.originalTarget=null,this.target=null,this.tag=cc.Action.TAG_INVALID},clone:function(){var t=new cc.Action;return t.originalTarget=null,t.target=null,t.tag=this.tag,t},isDone:function(){return!0},startWithTarget:function(t){this.originalTarget=t,this.target=t},stop:function(){this.target=null},step:function(t){cc.logID(1006)},update:function(t){cc.logID(1007)},getTarget:function(){return this.target},setTarget:function(t){this.target=t},getOriginalTarget:function(){return this.originalTarget},setOriginalTarget:function(t){this.originalTarget=t},getTag:function(){return this.tag},setTag:function(t){this.tag=t},retain:function(){},release:function(){}}),cc.Action.TAG_INVALID=-1,cc.FiniteTimeAction=cc.Action.extend({_duration:0,ctor:function(){cc.Action.prototype.ctor.call(this),this._duration=0},getDuration:function(){return this._duration*(this._timesForRepeat||1)},setDuration:function(t){this._duration=t},reverse:function(){return cc.logID(1008),null},clone:function(){return new cc.FiniteTimeAction}}),cc.Speed=cc.Action.extend({_speed:0,_innerAction:null,ctor:function(t,e){cc.Action.prototype.ctor.call(this),this._speed=0,this._innerAction=null,t&&this.initWithAction(t,e)},getSpeed:function(){return this._speed},setSpeed:function(t){this._speed=t},initWithAction:function(t,e){if(!t)throw new Error("cc.Speed.initWithAction(): action must be non nil");return this._innerAction=t,this._speed=e,!0},clone:function(){var t=new cc.Speed;return t.initWithAction(this._innerAction.clone(),this._speed),t},startWithTarget:function(t){cc.Action.prototype.startWithTarget.call(this,t),this._innerAction.startWithTarget(t)},stop:function(){this._innerAction.stop(),cc.Action.prototype.stop.call(this)},step:function(t){this._innerAction.step(t*this._speed)},isDone:function(){return this._innerAction.isDone()},reverse:function(){return new cc.Speed(this._innerAction.reverse(),this._speed)},setInnerAction:function(t){this._innerAction!==t&&(this._innerAction=t)},getInnerAction:function(){return this._innerAction}}),cc.speed=function(t,e){return new cc.Speed(t,e)},cc.Follow=cc.Action.extend({_followedNode:null,_boundarySet:!1,_boundaryFullyCovered:!1,_halfScreenSize:null,_fullScreenSize:null,_worldRect:null,leftBoundary:0,rightBoundary:0,topBoundary:0,bottomBoundary:0,ctor:function(t,e){cc.Action.prototype.ctor.call(this),this._followedNode=null,this._boundarySet=!1,this._boundaryFullyCovered=!1,this._halfScreenSize=null,this._fullScreenSize=null,this.leftBoundary=0,this.rightBoundary=0,this.topBoundary=0,this.bottomBoundary=0,this._worldRect=cc.rect(0,0,0,0),t&&(e?this.initWithTarget(t,e):this.initWithTarget(t))},clone:function(){var t=new cc.Follow,e=this._worldRect,i=new cc.Rect(e.x,e.y,e.width,e.height);return t.initWithTarget(this._followedNode,i),t},isBoundarySet:function(){return this._boundarySet},setBoudarySet:function(t){this._boundarySet=t},initWithTarget:function(t,e){if(!t)throw new Error("cc.Follow.initWithAction(): followedNode must be non nil");e=e||cc.rect(0,0,0,0),this._followedNode=t,this._worldRect=e,this._boundarySet=!cc._rectEqualToZero(e),this._boundaryFullyCovered=!1;var i=cc.director.getWinSize();return this._fullScreenSize=cc.p(i.width,i.height),this._halfScreenSize=cc.pMult(this._fullScreenSize,.5),this._boundarySet&&(this.leftBoundary=-(e.x+e.width-this._fullScreenSize.x),this.rightBoundary=-e.x,this.topBoundary=-e.y,this.bottomBoundary=-(e.y+e.height-this._fullScreenSize.y),this.rightBoundary<this.leftBoundary&&(this.rightBoundary=this.leftBoundary=(this.leftBoundary+this.rightBoundary)/2),this.topBoundary<this.bottomBoundary&&(this.topBoundary=this.bottomBoundary=(this.topBoundary+this.bottomBoundary)/2),this.topBoundary===this.bottomBoundary&&this.leftBoundary===this.rightBoundary&&(this._boundaryFullyCovered=!0)),!0},step:function(t){var e=this.target.convertToWorldSpaceAR(cc.Vec2.ZERO),i=this._followedNode.convertToWorldSpaceAR(cc.Vec2.ZERO),n=cc.pSub(e,i),r=this.target.parent.convertToNodeSpaceAR(cc.pAdd(n,this._halfScreenSize));if(this._boundarySet){if(this._boundaryFullyCovered)return;this.target.setPosition(cc.clampf(r.x,this.leftBoundary,this.rightBoundary),cc.clampf(r.y,this.bottomBoundary,this.topBoundary))}else this.target.setPosition(r.x,r.y)},isDone:function(){return!this._followedNode.isRunning()},stop:function(){this.target=null,cc.Action.prototype.stop.call(this)}}),cc.follow=function(t,e){return new cc.Follow(t,e)}}),{}],6:[(function(t,e,i){function n(t){for(var e=[],i=t.length-1;i>=0;i--)e.push(cc.p(t[i].x,t[i].y));return e}function r(t){for(var e=[],i=0;i<t.length;i++)e.push(cc.p(t[i].x,t[i].y));return e}cc.cardinalSplineAt=function(t,e,i,n,r,s){var o=s*s,a=o*s,c=(1-r)/2,h=c*(2*o-a-s),l=c*(-a+o)+(2*a-3*o+1),_=c*(a-2*o+s)+(-2*a+3*o),u=c*(a-o),d=t.x*h+e.x*l+i.x*_+n.x*u,m=t.y*h+e.y*l+i.y*_+n.y*u;return cc.p(d,m)},cc.getControlPointAt=function(t,e){return t[Math.min(t.length-1,Math.max(e,0))]},cc.CardinalSplineTo=cc.ActionInterval.extend({_points:null,_deltaT:0,_tension:0,_previousPosition:null,_accumulatedDiff:null,ctor:function(t,e,i){cc.ActionInterval.prototype.ctor.call(this),this._points=[],void 0!==i&&this.initWithDuration(t,e,i)},initWithDuration:function(t,e,i){if(!e||0===e.length)throw new Error("Invalid configuration. It must at least have one control point");return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this.setPoints(e),this._tension=i,!0)},clone:function(){var t=new cc.CardinalSplineTo;return t.initWithDuration(this._duration,r(this._points),this._tension),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._deltaT=1/(this._points.length-1),this._previousPosition=cc.p(this.target.getPositionX(),this.target.getPositionY()),this._accumulatedDiff=cc.p(0,0)},update:function(t){t=this._computeEaseTime(t);var e,i,n=this._points;if(1===t)e=n.length-1,i=1;else{var r=this._deltaT;i=(t-r*(e=0|t/r))/r}var s=cc.cardinalSplineAt(cc.getControlPointAt(n,e-1),cc.getControlPointAt(n,e-0),cc.getControlPointAt(n,e+1),cc.getControlPointAt(n,e+2),this._tension,i);if(cc.macro.ENABLE_STACKABLE_ACTIONS){var o,a;if(o=this.target.getPositionX()-this._previousPosition.x,a=this.target.getPositionY()-this._previousPosition.y,0!==o||0!==a){var c=this._accumulatedDiff;o=c.x+o,a=c.y+a,c.x=o,c.y=a,s.x+=o,s.y+=a}}this.updatePosition(s)},reverse:function(){var t=n(this._points);return cc.cardinalSplineTo(this._duration,t,this._tension)},updatePosition:function(t){this.target.setPosition(t),this._previousPosition=t},getPoints:function(){return this._points},setPoints:function(t){this._points=t}}),cc.cardinalSplineTo=function(t,e,i){return new cc.CardinalSplineTo(t,e,i)},cc.CardinalSplineBy=cc.CardinalSplineTo.extend({_startPosition:null,ctor:function(t,e,i){cc.CardinalSplineTo.prototype.ctor.call(this),this._startPosition=cc.p(0,0),void 0!==i&&this.initWithDuration(t,e,i)},startWithTarget:function(t){cc.CardinalSplineTo.prototype.startWithTarget.call(this,t),this._startPosition.x=t.getPositionX(),this._startPosition.y=t.getPositionY()},reverse:function(){for(var t,e=this._points.slice(),i=e[0],r=1;r<e.length;++r)t=e[r],e[r]=cc.pSub(t,i),i=t;var s=n(e);i=s[s.length-1],s.pop(),i.x=-i.x,i.y=-i.y,s.unshift(i);for(r=1;r<s.length;++r)(t=s[r]).x=-t.x,t.y=-t.y,t.x+=i.x,t.y+=i.y,s[r]=t,i=t;return cc.cardinalSplineBy(this._duration,s,this._tension)},updatePosition:function(t){var e=this._startPosition,i=t.x+e.x,n=t.y+e.y;this._previousPosition.x=i,this._previousPosition.y=n,this.target.setPosition(i,n)},clone:function(){var t=new cc.CardinalSplineBy;return t.initWithDuration(this._duration,r(this._points),this._tension),t}}),cc.cardinalSplineBy=function(t,e,i){return new cc.CardinalSplineBy(t,e,i)},cc.CatmullRomTo=cc.CardinalSplineTo.extend({ctor:function(t,e){e&&this.initWithDuration(t,e)},initWithDuration:function(t,e){return cc.CardinalSplineTo.prototype.initWithDuration.call(this,t,e,.5)},clone:function(){var t=new cc.CatmullRomTo;return t.initWithDuration(this._duration,r(this._points)),t}}),cc.catmullRomTo=function(t,e){return new cc.CatmullRomTo(t,e)},cc.CatmullRomBy=cc.CardinalSplineBy.extend({ctor:function(t,e){cc.CardinalSplineBy.prototype.ctor.call(this),e&&this.initWithDuration(t,e)},initWithDuration:function(t,e){return cc.CardinalSplineTo.prototype.initWithDuration.call(this,t,e,.5)},clone:function(){var t=new cc.CatmullRomBy;return t.initWithDuration(this._duration,r(this._points)),t}}),cc.catmullRomBy=function(t,e){return new cc.CatmullRomBy(t,e)}}),{}],7:[(function(t,e,i){cc.ActionEase=cc.ActionInterval.extend({_inner:null,ctor:function(t){cc.ActionInterval.prototype.ctor.call(this),t&&this.initWithAction(t)},initWithAction:function(t){if(!t)throw new Error("cc.ActionEase.initWithAction(): action must be non nil");return!!this.initWithDuration(t.getDuration())&&(this._inner=t,!0)},clone:function(){var t=new cc.ActionEase;return t.initWithAction(this._inner.clone()),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._inner.startWithTarget(this.target)},stop:function(){this._inner.stop(),cc.ActionInterval.prototype.stop.call(this)},update:function(t){this._inner.update(t)},reverse:function(){return new cc.ActionEase(this._inner.reverse())},getInnerAction:function(){return this._inner}}),cc.actionEase=function(t){return new cc.ActionEase(t)},cc.EaseRateAction=cc.ActionEase.extend({_rate:0,ctor:function(t,e){cc.ActionEase.prototype.ctor.call(this),void 0!==e&&this.initWithAction(t,e)},setRate:function(t){this._rate=t},getRate:function(){return this._rate},initWithAction:function(t,e){return!!cc.ActionEase.prototype.initWithAction.call(this,t)&&(this._rate=e,!0)},clone:function(){var t=new cc.EaseRateAction;return t.initWithAction(this._inner.clone(),this._rate),t},reverse:function(){return new cc.EaseRateAction(this._inner.reverse(),1/this._rate)}}),cc.easeRateAction=function(t,e){return new cc.EaseRateAction(t,e)},cc.EaseIn=cc.EaseRateAction.extend({update:function(t){this._inner.update(Math.pow(t,this._rate))},reverse:function(){return new cc.EaseIn(this._inner.reverse(),1/this._rate)},clone:function(){var t=new cc.EaseIn;return t.initWithAction(this._inner.clone(),this._rate),t}}),cc.easeIn=function(t){return{_rate:t,easing:function(t){return Math.pow(t,this._rate)},reverse:function(){return cc.easeIn(1/this._rate)}}},cc.EaseOut=cc.EaseRateAction.extend({update:function(t){this._inner.update(Math.pow(t,1/this._rate))},reverse:function(){return new cc.EaseOut(this._inner.reverse(),1/this._rate)},clone:function(){var t=new cc.EaseOut;return t.initWithAction(this._inner.clone(),this._rate),t}}),cc.easeOut=function(t){return{_rate:t,easing:function(t){return Math.pow(t,1/this._rate)},reverse:function(){return cc.easeOut(1/this._rate)}}},cc.EaseInOut=cc.EaseRateAction.extend({update:function(t){(t*=2)<1?this._inner.update(.5*Math.pow(t,this._rate)):this._inner.update(1-.5*Math.pow(2-t,this._rate))},clone:function(){var t=new cc.EaseInOut;return t.initWithAction(this._inner.clone(),this._rate),t},reverse:function(){return new cc.EaseInOut(this._inner.reverse(),this._rate)}}),cc.easeInOut=function(t){return{_rate:t,easing:function(t){return(t*=2)<1?.5*Math.pow(t,this._rate):1-.5*Math.pow(2-t,this._rate)},reverse:function(){return cc.easeInOut(this._rate)}}},cc.EaseExponentialIn=cc.ActionEase.extend({update:function(t){this._inner.update(0===t?0:Math.pow(2,10*(t-1)))},reverse:function(){return new cc.EaseExponentialOut(this._inner.reverse())},clone:function(){var t=new cc.EaseExponentialIn;return t.initWithAction(this._inner.clone()),t}}),cc._easeExponentialInObj={easing:function(t){return 0===t?0:Math.pow(2,10*(t-1))},reverse:function(){return cc._easeExponentialOutObj}},cc.easeExponentialIn=function(){return cc._easeExponentialInObj},cc.EaseExponentialOut=cc.ActionEase.extend({update:function(t){this._inner.update(1===t?1:1-Math.pow(2,-10*t))},reverse:function(){return new cc.EaseExponentialIn(this._inner.reverse())},clone:function(){var t=new cc.EaseExponentialOut;return t.initWithAction(this._inner.clone()),t}}),cc._easeExponentialOutObj={easing:function(t){return 1===t?1:1-Math.pow(2,-10*t)},reverse:function(){return cc._easeExponentialInObj}},cc.easeExponentialOut=function(){return cc._easeExponentialOutObj},cc.EaseExponentialInOut=cc.ActionEase.extend({update:function(t){1!==t&&0!==t&&(t=(t*=2)<1?.5*Math.pow(2,10*(t-1)):.5*(2-Math.pow(2,-10*(t-1)))),this._inner.update(t)},reverse:function(){return new cc.EaseExponentialInOut(this._inner.reverse())},clone:function(){var t=new cc.EaseExponentialInOut;return t.initWithAction(this._inner.clone()),t}}),cc._easeExponentialInOutObj={easing:function(t){return 1!==t&&0!==t?(t*=2)<1?.5*Math.pow(2,10*(t-1)):.5*(2-Math.pow(2,-10*(t-1))):t},reverse:function(){return cc._easeExponentialInOutObj}},cc.easeExponentialInOut=function(){return cc._easeExponentialInOutObj},cc.EaseSineIn=cc.ActionEase.extend({update:function(t){t=0===t||1===t?t:-1*Math.cos(t*Math.PI/2)+1,this._inner.update(t)},reverse:function(){return new cc.EaseSineOut(this._inner.reverse())},clone:function(){var t=new cc.EaseSineIn;return t.initWithAction(this._inner.clone()),t}}),cc._easeSineInObj={easing:function(t){return 0===t||1===t?t:-1*Math.cos(t*Math.PI/2)+1},reverse:function(){return cc._easeSineOutObj}},cc.easeSineIn=function(){return cc._easeSineInObj},cc.EaseSineOut=cc.ActionEase.extend({update:function(t){t=0===t||1===t?t:Math.sin(t*Math.PI/2),this._inner.update(t)},reverse:function(){return new cc.EaseSineIn(this._inner.reverse())},clone:function(){var t=new cc.EaseSineOut;return t.initWithAction(this._inner.clone()),t}}),cc._easeSineOutObj={easing:function(t){return 0===t||1===t?t:Math.sin(t*Math.PI/2)},reverse:function(){return cc._easeSineInObj}},cc.easeSineOut=function(){return cc._easeSineOutObj},cc.EaseSineInOut=cc.ActionEase.extend({update:function(t){t=0===t||1===t?t:-.5*(Math.cos(Math.PI*t)-1),this._inner.update(t)},clone:function(){var t=new cc.EaseSineInOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseSineInOut(this._inner.reverse())}}),cc._easeSineInOutObj={easing:function(t){return 0===t||1===t?t:-.5*(Math.cos(Math.PI*t)-1)},reverse:function(){return cc._easeSineInOutObj}},cc.easeSineInOut=function(){return cc._easeSineInOutObj},cc.EaseElastic=cc.ActionEase.extend({_period:.3,ctor:function(t,e){cc.ActionEase.prototype.ctor.call(this),t&&this.initWithAction(t,e)},getPeriod:function(){return this._period},setPeriod:function(t){this._period=t},initWithAction:function(t,e){return cc.ActionEase.prototype.initWithAction.call(this,t),this._period=null==e?.3:e,!0},reverse:function(){return cc.logID(1009),null},clone:function(){var t=new cc.EaseElastic;return t.initWithAction(this._inner.clone(),this._period),t}}),cc.EaseElasticIn=cc.EaseElastic.extend({update:function(t){var e=0;if(0===t||1===t)e=t;else{var i=this._period/4;t-=1,e=-Math.pow(2,10*t)*Math.sin((t-i)*Math.PI*2/this._period)}this._inner.update(e)},reverse:function(){return new cc.EaseElasticOut(this._inner.reverse(),this._period)},clone:function(){var t=new cc.EaseElasticIn;return t.initWithAction(this._inner.clone(),this._period),t}}),cc._easeElasticInObj={easing:function(t){return 0===t||1===t?t:(t-=1,-Math.pow(2,10*t)*Math.sin((t-.075)*Math.PI*2/.3))},reverse:function(){return cc._easeElasticOutObj}},cc.easeElasticIn=function(t){return t&&.3!==t?{_period:t,easing:function(t){return 0===t||1===t?t:(t-=1,-Math.pow(2,10*t)*Math.sin((t-this._period/4)*Math.PI*2/this._period))},reverse:function(){return cc.easeElasticOut(this._period)}}:cc._easeElasticInObj},cc.EaseElasticOut=cc.EaseElastic.extend({update:function(t){var e=0;if(0===t||1===t)e=t;else{var i=this._period/4;e=Math.pow(2,-10*t)*Math.sin((t-i)*Math.PI*2/this._period)+1}this._inner.update(e)},reverse:function(){return new cc.EaseElasticIn(this._inner.reverse(),this._period)},clone:function(){var t=new cc.EaseElasticOut;return t.initWithAction(this._inner.clone(),this._period),t}}),cc._easeElasticOutObj={easing:function(t){return 0===t||1===t?t:Math.pow(2,-10*t)*Math.sin((t-.075)*Math.PI*2/.3)+1},reverse:function(){return cc._easeElasticInObj}},cc.easeElasticOut=function(t){return t&&.3!==t?{_period:t,easing:function(t){return 0===t||1===t?t:Math.pow(2,-10*t)*Math.sin((t-this._period/4)*Math.PI*2/this._period)+1},reverse:function(){return cc.easeElasticIn(this._period)}}:cc._easeElasticOutObj},cc.EaseElasticInOut=cc.EaseElastic.extend({update:function(t){var e=0,i=this._period;if(0===t||1===t)e=t;else{t*=2,i||(i=this._period=.3*1.5);var n=i/4;e=(t-=1)<0?-.5*Math.pow(2,10*t)*Math.sin((t-n)*Math.PI*2/i):Math.pow(2,-10*t)*Math.sin((t-n)*Math.PI*2/i)*.5+1}this._inner.update(e)},reverse:function(){return new cc.EaseElasticInOut(this._inner.reverse(),this._period)},clone:function(){var t=new cc.EaseElasticInOut;return t.initWithAction(this._inner.clone(),this._period),t}}),cc.easeElasticInOut=function(t){return t=t||.3,{_period:t,easing:function(t){var e=0,i=this._period;if(0===t||1===t)e=t;else{t*=2,i||(i=this._period=.3*1.5);var n=i/4;e=(t-=1)<0?-.5*Math.pow(2,10*t)*Math.sin((t-n)*Math.PI*2/i):Math.pow(2,-10*t)*Math.sin((t-n)*Math.PI*2/i)*.5+1}return e},reverse:function(){return cc.easeElasticInOut(this._period)}}},cc.EaseBounce=cc.ActionEase.extend({bounceTime:function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},clone:function(){var t=new cc.EaseBounce;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseBounce(this._inner.reverse())}}),cc.EaseBounceIn=cc.EaseBounce.extend({update:function(t){var e=1-this.bounceTime(1-t);this._inner.update(e)},reverse:function(){return new cc.EaseBounceOut(this._inner.reverse())},clone:function(){var t=new cc.EaseBounceIn;return t.initWithAction(this._inner.clone()),t}}),cc._bounceTime=function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},cc._easeBounceInObj={easing:function(t){return 1-cc._bounceTime(1-t)},reverse:function(){return cc._easeBounceOutObj}},cc.easeBounceIn=function(){return cc._easeBounceInObj},cc.EaseBounceOut=cc.EaseBounce.extend({update:function(t){var e=this.bounceTime(t);this._inner.update(e)},reverse:function(){return new cc.EaseBounceIn(this._inner.reverse())},clone:function(){var t=new cc.EaseBounceOut;return t.initWithAction(this._inner.clone()),t}}),cc._easeBounceOutObj={easing:function(t){return cc._bounceTime(t)},reverse:function(){return cc._easeBounceInObj}},cc.easeBounceOut=function(){return cc._easeBounceOutObj},cc.EaseBounceInOut=cc.EaseBounce.extend({update:function(t){var e=0;t<.5?(t*=2,e=.5*(1-this.bounceTime(1-t))):e=.5*this.bounceTime(2*t-1)+.5,this._inner.update(e)},clone:function(){var t=new cc.EaseBounceInOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseBounceInOut(this._inner.reverse())}}),cc._easeBounceInOutObj={easing:function(t){var e;return t<.5?(t*=2,e=.5*(1-cc._bounceTime(1-t))):e=.5*cc._bounceTime(2*t-1)+.5,e},reverse:function(){return cc._easeBounceInOutObj}},cc.easeBounceInOut=function(){return cc._easeBounceInOutObj},cc.EaseBackIn=cc.ActionEase.extend({update:function(t){t=0===t||1===t?t:t*t*(2.70158*t-1.70158),this._inner.update(t)},reverse:function(){return new cc.EaseBackOut(this._inner.reverse())},clone:function(){var t=new cc.EaseBackIn;return t.initWithAction(this._inner.clone()),t}}),cc._easeBackInObj={easing:function(t){return 0===t||1===t?t:t*t*(2.70158*t-1.70158)},reverse:function(){return cc._easeBackOutObj}},cc.easeBackIn=function(){return cc._easeBackInObj},cc.EaseBackOut=cc.ActionEase.extend({update:function(t){t-=1,this._inner.update(t*t*(2.70158*t+1.70158)+1)},reverse:function(){return new cc.EaseBackIn(this._inner.reverse())},clone:function(){var t=new cc.EaseBackOut;return t.initWithAction(this._inner.clone()),t}}),cc._easeBackOutObj={easing:function(t){return(t-=1)*t*(2.70158*t+1.70158)+1},reverse:function(){return cc._easeBackInObj}},cc.easeBackOut=function(){return cc._easeBackOutObj},cc.EaseBackInOut=cc.ActionEase.extend({update:function(t){(t*=2)<1?this._inner.update(t*t*(3.5949095*t-2.5949095)/2):(t-=2,this._inner.update(t*t*(3.5949095*t+2.5949095)/2+1))},clone:function(){var t=new cc.EaseBackInOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseBackInOut(this._inner.reverse())}}),cc._easeBackInOutObj={easing:function(t){return(t*=2)<1?t*t*(3.5949095*t-2.5949095)/2:(t-=2)*t*(3.5949095*t+2.5949095)/2+1},reverse:function(){return cc._easeBackInOutObj}},cc.easeBackInOut=function(){return cc._easeBackInOutObj},cc.EaseBezierAction=cc.ActionEase.extend({_p0:null,_p1:null,_p2:null,_p3:null,ctor:function(t){cc.ActionEase.prototype.ctor.call(this,t)},_updateTime:function(t,e,i,n,r){return Math.pow(1-r,3)*t+3*r*Math.pow(1-r,2)*e+3*Math.pow(r,2)*(1-r)*i+Math.pow(r,3)*n},update:function(t){var e=this._updateTime(this._p0,this._p1,this._p2,this._p3,t);this._inner.update(e)},clone:function(){var t=new cc.EaseBezierAction;return t.initWithAction(this._inner.clone()),t.setBezierParamer(this._p0,this._p1,this._p2,this._p3),t},reverse:function(){var t=new cc.EaseBezierAction(this._inner.reverse());return t.setBezierParamer(this._p3,this._p2,this._p1,this._p0),t},setBezierParamer:function(t,e,i,n){this._p0=t||0,this._p1=e||0,this._p2=i||0,this._p3=n||0}}),cc.easeBezierAction=function(t,e,i,n){return{easing:function(r){return cc.EaseBezierAction.prototype._updateTime(t,e,i,n,r)},reverse:function(){return cc.easeBezierAction(n,i,e,t)}}},cc.EaseQuadraticActionIn=cc.ActionEase.extend({_updateTime:function(t){return Math.pow(t,2)},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseQuadraticActionIn;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseQuadraticActionIn(this._inner.reverse())}}),cc._easeQuadraticActionIn={easing:cc.EaseQuadraticActionIn.prototype._updateTime,reverse:function(){return cc._easeQuadraticActionIn}},cc.easeQuadraticActionIn=function(){return cc._easeQuadraticActionIn},cc.EaseQuadraticActionOut=cc.ActionEase.extend({_updateTime:function(t){return-t*(t-2)},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseQuadraticActionOut;return t.initWithAction(),t},reverse:function(){return new cc.EaseQuadraticActionOut(this._inner.reverse())}}),cc._easeQuadraticActionOut={easing:cc.EaseQuadraticActionOut.prototype._updateTime,reverse:function(){return cc._easeQuadraticActionOut}},cc.easeQuadraticActionOut=function(){return cc._easeQuadraticActionOut},cc.EaseQuadraticActionInOut=cc.ActionEase.extend({_updateTime:function(t){return t*=2,t<1?t*t*.5:-.5*(--t*(t-2)-1)},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseQuadraticActionInOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseQuadraticActionInOut(this._inner.reverse())}}),cc._easeQuadraticActionInOut={easing:cc.EaseQuadraticActionInOut.prototype._updateTime,reverse:function(){return cc._easeQuadraticActionInOut}},cc.easeQuadraticActionInOut=function(){return cc._easeQuadraticActionInOut},cc.EaseQuarticActionIn=cc.ActionEase.extend({_updateTime:function(t){return t*t*t*t},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseQuarticActionIn;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseQuarticActionIn(this._inner.reverse())}}),cc._easeQuarticActionIn={easing:cc.EaseQuarticActionIn.prototype._updateTime,reverse:function(){return cc._easeQuarticActionIn}},cc.easeQuarticActionIn=function(){return cc._easeQuarticActionIn},cc.EaseQuarticActionOut=cc.ActionEase.extend({_updateTime:function(t){return-((t-=1)*t*t*t-1)},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseQuarticActionOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseQuarticActionOut(this._inner.reverse())}}),cc._easeQuarticActionOut={easing:cc.EaseQuarticActionOut.prototype._updateTime,reverse:function(){return cc._easeQuarticActionOut}},cc.easeQuarticActionOut=function(){return cc._easeQuarticActionOut},cc.EaseQuarticActionInOut=cc.ActionEase.extend({_updateTime:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseQuarticActionInOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseQuarticActionInOut(this._inner.reverse())}}),cc._easeQuarticActionInOut={easing:cc.EaseQuarticActionInOut.prototype._updateTime,reverse:function(){return cc._easeQuarticActionInOut}},cc.easeQuarticActionInOut=function(){return cc._easeQuarticActionInOut},cc.EaseQuinticActionIn=cc.ActionEase.extend({_updateTime:function(t){return t*t*t*t*t},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseQuinticActionIn;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseQuinticActionIn(this._inner.reverse())}}),cc._easeQuinticActionIn={easing:cc.EaseQuinticActionIn.prototype._updateTime,reverse:function(){return cc._easeQuinticActionIn}},cc.easeQuinticActionIn=function(){return cc._easeQuinticActionIn},cc.EaseQuinticActionOut=cc.ActionEase.extend({_updateTime:function(t){return(t-=1)*t*t*t*t+1},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseQuinticActionOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseQuinticActionOut(this._inner.reverse())}}),cc._easeQuinticActionOut={easing:cc.EaseQuinticActionOut.prototype._updateTime,reverse:function(){return cc._easeQuinticActionOut}},cc.easeQuinticActionOut=function(){return cc._easeQuinticActionOut},cc.EaseQuinticActionInOut=cc.ActionEase.extend({_updateTime:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseQuinticActionInOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseQuinticActionInOut(this._inner.reverse())}}),cc._easeQuinticActionInOut={easing:cc.EaseQuinticActionInOut.prototype._updateTime,reverse:function(){return cc._easeQuinticActionInOut}},cc.easeQuinticActionInOut=function(){return cc._easeQuinticActionInOut},cc.EaseCircleActionIn=cc.ActionEase.extend({_updateTime:function(t){return-1*(Math.sqrt(1-t*t)-1)},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseCircleActionIn;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseCircleActionIn(this._inner.reverse())}}),cc._easeCircleActionIn={easing:cc.EaseCircleActionIn.prototype._updateTime,reverse:function(){return cc._easeCircleActionIn}},cc.easeCircleActionIn=function(){return cc._easeCircleActionIn},cc.EaseCircleActionOut=cc.ActionEase.extend({_updateTime:function(t){return t-=1,Math.sqrt(1-t*t)},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseCircleActionOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseCircleActionOut(this._inner.reverse())}}),cc._easeCircleActionOut={easing:cc.EaseCircleActionOut.prototype._updateTime,reverse:function(){return cc._easeCircleActionOut}},cc.easeCircleActionOut=function(){return cc._easeCircleActionOut},cc.EaseCircleActionInOut=cc.ActionEase.extend({_updateTime:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):(t-=2,.5*(Math.sqrt(1-t*t)+1))},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseCircleActionInOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseCircleActionInOut(this._inner.reverse())}}),cc._easeCircleActionInOut={easing:cc.EaseCircleActionInOut.prototype._updateTime,reverse:function(){return cc._easeCircleActionInOut}},cc.easeCircleActionInOut=function(){return cc._easeCircleActionInOut},cc.EaseCubicActionIn=cc.ActionEase.extend({_updateTime:function(t){return t*t*t},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseCubicActionIn;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseCubicActionIn(this._inner.reverse())}}),cc._easeCubicActionIn={easing:cc.EaseCubicActionIn.prototype._updateTime,reverse:function(){return cc._easeCubicActionIn}},cc.easeCubicActionIn=function(){return cc._easeCubicActionIn},cc.EaseCubicActionOut=cc.ActionEase.extend({_updateTime:function(t){return(t-=1)*t*t+1},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseCubicActionOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseCubicActionOut(this._inner.reverse())}}),cc._easeCubicActionOut={easing:cc.EaseCubicActionOut.prototype._updateTime,reverse:function(){return cc._easeCubicActionOut}},cc.easeCubicActionOut=function(){return cc._easeCubicActionOut},cc.EaseCubicActionInOut=cc.ActionEase.extend({_updateTime:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)},update:function(t){this._inner.update(this._updateTime(t))},clone:function(){var t=new cc.EaseCubicActionInOut;return t.initWithAction(this._inner.clone()),t},reverse:function(){return new cc.EaseCubicActionInOut(this._inner.reverse())}}),cc._easeCubicActionInOut={easing:cc.EaseCubicActionInOut.prototype._updateTime,reverse:function(){return cc._easeCubicActionInOut}},cc.easeCubicActionInOut=function(){return cc._easeCubicActionInOut}}),{}],8:[(function(t,e,i){cc.ActionInstant=cc.FiniteTimeAction.extend({isDone:function(){return!0},step:function(t){this.update(1)},update:function(t){},reverse:function(){return this.clone()},clone:function(){return new cc.ActionInstant}}),cc.Show=cc.ActionInstant.extend({update:function(t){for(var e=this.target.getComponentsInChildren(cc._SGComponent),i=0;i<e.length;++i){e[i].enabled=!0}},reverse:function(){return new cc.Hide},clone:function(){return new cc.Show}}),cc.show=function(){return new cc.Show},cc.Hide=cc.ActionInstant.extend({update:function(t){for(var e=this.target.getComponentsInChildren(cc._SGComponent),i=0;i<e.length;++i){e[i].enabled=!1}},reverse:function(){return new cc.Show},clone:function(){return new cc.Hide}}),cc.hide=function(){return new cc.Hide},cc.ToggleVisibility=cc.ActionInstant.extend({update:function(t){for(var e=this.target.getComponentsInChildren(cc._SGComponent),i=0;i<e.length;++i){var n=e[i];n.enabled=!n.enabled}},reverse:function(){return new cc.ToggleVisibility},clone:function(){return new cc.ToggleVisibility}}),cc.toggleVisibility=function(){return new cc.ToggleVisibility},cc.RemoveSelf=cc.ActionInstant.extend({_isNeedCleanUp:!0,ctor:function(t){cc.FiniteTimeAction.prototype.ctor.call(this),void 0!==t&&this.init(t)},update:function(t){this.target.removeFromParent(this._isNeedCleanUp)},init:function(t){return this._isNeedCleanUp=t,!0},reverse:function(){return new cc.RemoveSelf(this._isNeedCleanUp)},clone:function(){return new cc.RemoveSelf(this._isNeedCleanUp)}}),cc.removeSelf=function(t){return new cc.RemoveSelf(t)},cc.FlipX=cc.ActionInstant.extend({_flippedX:!1,ctor:function(t){cc.FiniteTimeAction.prototype.ctor.call(this),this._flippedX=!1,void 0!==t&&this.initWithFlipX(t)},initWithFlipX:function(t){return this._flippedX=t,!0},update:function(t){this.target.scaleX=Math.abs(this.target.scaleX)*(this._flippedX?-1:1)},reverse:function(){return new cc.FlipX(!this._flippedX)},clone:function(){var t=new cc.FlipX;return t.initWithFlipX(this._flippedX),t}}),cc.flipX=function(t){return new cc.FlipX(t)},cc.FlipY=cc.ActionInstant.extend({_flippedY:!1,ctor:function(t){cc.FiniteTimeAction.prototype.ctor.call(this),this._flippedY=!1,void 0!==t&&this.initWithFlipY(t)},initWithFlipY:function(t){return this._flippedY=t,!0},update:function(t){this.target.scaleY=Math.abs(this.target.scaleY)*(this._flippedY?-1:1)},reverse:function(){return new cc.FlipY(!this._flippedY)},clone:function(){var t=new cc.FlipY;return t.initWithFlipY(this._flippedY),t}}),cc.flipY=function(t){return new cc.FlipY(t)},cc.Place=cc.ActionInstant.extend({_x:0,_y:0,ctor:function(t,e){cc.FiniteTimeAction.prototype.ctor.call(this),this._x=0,this._y=0,void 0!==t&&(void 0!==t.x&&(e=t.y,t=t.x),this.initWithPosition(t,e))},initWithPosition:function(t,e){return this._x=t,this._y=e,!0},update:function(t){this.target.setPosition(this._x,this._y)},clone:function(){var t=new cc.Place;return t.initWithPosition(this._x,this._y),t}}),cc.place=function(t,e){return new cc.Place(t,e)},cc.CallFunc=cc.ActionInstant.extend({_selectorTarget:null,_function:null,_data:null,ctor:function(t,e,i){cc.FiniteTimeAction.prototype.ctor.call(this),this.initWithFunction(t,e,i)},initWithFunction:function(t,e,i){return t&&(this._function=t),e&&(this._selectorTarget=e),void 0!==i&&(this._data=i),!0},execute:function(){this._function&&this._function.call(this._selectorTarget,this.target,this._data)},update:function(t){this.execute()},getTargetCallback:function(){return this._selectorTarget},setTargetCallback:function(t){t!==this._selectorTarget&&(this._selectorTarget&&(this._selectorTarget=null),this._selectorTarget=t)},clone:function(){var t=new cc.CallFunc;return t.initWithFunction(this._function,this._selectorTarget,this._data),t}}),cc.callFunc=function(t,e,i){return new cc.CallFunc(t,e,i)}}),{}],9:[(function(t,e,i){cc.ActionInterval=cc.FiniteTimeAction.extend({_elapsed:0,_firstTick:!1,_easeList:null,_timesForRepeat:1,_repeatForever:!1,_repeatMethod:!1,_speed:1,_speedMethod:!1,ctor:function(t){this._speed=1,this._timesForRepeat=1,this._repeatForever=!1,this.MAX_VALUE=2,this._repeatMethod=!1,this._speedMethod=!1,cc.FiniteTimeAction.prototype.ctor.call(this),void 0!==t&&this.initWithDuration(t)},getElapsed:function(){return this._elapsed},initWithDuration:function(t){return this._duration=0===t?cc.macro.FLT_EPSILON:t,this._elapsed=0,this._firstTick=!0,!0},isDone:function(){return this._elapsed>=this._duration},_cloneDecoration:function(t){t._repeatForever=this._repeatForever,t._speed=this._speed,t._timesForRepeat=this._timesForRepeat,t._easeList=this._easeList,t._speedMethod=this._speedMethod,t._repeatMethod=this._repeatMethod},_reverseEaseList:function(t){if(this._easeList){t._easeList=[];for(var e=0;e<this._easeList.length;e++)t._easeList.push(this._easeList[e].reverse())}},clone:function(){var t=new cc.ActionInterval(this._duration);return this._cloneDecoration(t),t},easing:function(t){this._easeList?this._easeList.length=0:this._easeList=[];for(var e=0;e<arguments.length;e++)this._easeList.push(arguments[e]);return this},_computeEaseTime:function(t){var e=this._easeList;if(!e||0===e.length)return t;for(var i=0,n=e.length;i<n;i++)t=e[i].easing(t);return t},step:function(t){this._firstTick?(this._firstTick=!1,this._elapsed=0):this._elapsed+=t;var e=this._elapsed/(this._duration>1.192092896e-7?this._duration:1.192092896e-7);e=1>e?e:1,this.update(e>0?e:0),this._repeatMethod&&this._timesForRepeat>1&&this.isDone()&&(this._repeatForever||this._timesForRepeat--,this.startWithTarget(this.target),this.step(this._elapsed-this._duration))},startWithTarget:function(t){cc.Action.prototype.startWithTarget.call(this,t),this._elapsed=0,this._firstTick=!0},reverse:function(){return cc.logID(1010),null},setAmplitudeRate:function(t){cc.logID(1011)},getAmplitudeRate:function(){return cc.logID(1012),0},speed:function(t){return t<=0?(cc.logID(1013),this):(this._speedMethod=!0,this._speed*=t,this)},getSpeed:function(){return this._speed},setSpeed:function(t){return this._speed=t,this},repeat:function(t){return t=Math.round(t),isNaN(t)||t<1?(cc.logID(1014),this):(this._repeatMethod=!0,this._timesForRepeat*=t,this)},repeatForever:function(){return this._repeatMethod=!0,this._timesForRepeat=this.MAX_VALUE,this._repeatForever=!0,this}}),cc.actionInterval=function(t){return new cc.ActionInterval(t)},cc.Sequence=cc.ActionInterval.extend({_actions:null,_split:null,_last:0,_reversed:!1,ctor:function(t){cc.ActionInterval.prototype.ctor.call(this),this._actions=[];var e=t instanceof Array?t:arguments;if(1!==e.length){var i=e.length-1;if(i>=0&&null==e[i]&&cc.logID(1015),i>=0){for(var n,r=e[0],s=1;s<i;s++)e[s]&&(n=r,r=cc.Sequence._actionOneTwo(n,e[s]));this.initWithTwoActions(r,e[i])}}else cc.errorID(1019)},initWithTwoActions:function(t,e){if(!t||!e)throw new Error("cc.Sequence.initWithTwoActions(): arguments must all be non nil");var i=t._duration,n=e._duration,r=(i*=t._repeatMethod?t._timesForRepeat:1)+(n*=e._repeatMethod?e._timesForRepeat:1);return this.initWithDuration(r),this._actions[0]=t,this._actions[1]=e,!0},clone:function(){var t=new cc.Sequence;return this._cloneDecoration(t),t.initWithTwoActions(this._actions[0].clone(),this._actions[1].clone()),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._split=this._actions[0]._duration/this._duration,this._split*=this._actions[0]._repeatMethod?this._actions[0]._timesForRepeat:1,this._last=-1},stop:function(){-1!==this._last&&this._actions[this._last].stop(),cc.Action.prototype.stop.call(this)},update:function(t){var e,i,n=0,r=this._split,s=this._actions,o=this._last;(t=this._computeEaseTime(t))<r?(e=0!==r?t/r:1,0===n&&1===o&&this._reversed&&(s[1].update(0),s[1].stop())):(n=1,e=1===r?1:(t-r)/(1-r),-1===o&&(s[0].startWithTarget(this.target),s[0].update(1),s[0].stop()),0===o&&(s[0].update(1),s[0].stop())),i=s[n],o===n&&i.isDone()||(o!==n&&i.startWithTarget(this.target),e*=i._timesForRepeat,i.update(e>1?e%1:e),this._last=n)},reverse:function(){var t=cc.Sequence._actionOneTwo(this._actions[1].reverse(),this._actions[0].reverse());return this._cloneDecoration(t),this._reverseEaseList(t),t._reversed=!0,t}}),cc.sequence=function(t){var e=t instanceof Array?t:arguments;if(1===e.length)return cc.errorID(1019),null;var i=e.length-1;i>=0&&null==e[i]&&cc.logID(1015);var n=null;if(i>=0){n=e[0];for(var r=1;r<=i;r++)e[r]&&(n=cc.Sequence._actionOneTwo(n,e[r]))}return n},cc.Sequence._actionOneTwo=function(t,e){var i=new cc.Sequence;return i.initWithTwoActions(t,e),i},cc.Repeat=cc.ActionInterval.extend({_times:0,_total:0,_nextDt:0,_actionInstant:!1,_innerAction:null,ctor:function(t,e){cc.ActionInterval.prototype.ctor.call(this),void 0!==e&&this.initWithAction(t,e)},initWithAction:function(t,e){var i=t._duration*e;return!!this.initWithDuration(i)&&(this._times=e,this._innerAction=t,t instanceof cc.ActionInstant&&(this._actionInstant=!0,this._times-=1),this._total=0,!0)},clone:function(){var t=new cc.Repeat;return this._cloneDecoration(t),t.initWithAction(this._innerAction.clone(),this._times),t},startWithTarget:function(t){this._total=0,this._nextDt=this._innerAction._duration/this._duration,cc.ActionInterval.prototype.startWithTarget.call(this,t),this._innerAction.startWithTarget(t)},stop:function(){this._innerAction.stop(),cc.Action.prototype.stop.call(this)},update:function(t){t=this._computeEaseTime(t);var e=this._innerAction,i=this._duration,n=this._times,r=this._nextDt;if(t>=r){for(;t>r&&this._total<n;)e.update(1),this._total++,e.stop(),e.startWithTarget(this.target),r+=e._duration/i,this._nextDt=r;t>=1&&this._total<n&&(e.update(1),this._total++),this._actionInstant||(this._total===n?e.stop():e.update(t-(r-e._duration/i)))}else e.update(t*n%1)},isDone:function(){return this._total===this._times},reverse:function(){var t=new cc.Repeat(this._innerAction.reverse(),this._times);return this._cloneDecoration(t),this._reverseEaseList(t),t},setInnerAction:function(t){this._innerAction!==t&&(this._innerAction=t)},getInnerAction:function(){return this._innerAction}}),cc.repeat=function(t,e){return new cc.Repeat(t,e)},cc.RepeatForever=cc.ActionInterval.extend({_innerAction:null,ctor:function(t){cc.ActionInterval.prototype.ctor.call(this),this._innerAction=null,t&&this.initWithAction(t)},initWithAction:function(t){if(!t)throw new Error("cc.RepeatForever.initWithAction(): action must be non null");return this._innerAction=t,!0},clone:function(){var t=new cc.RepeatForever;return this._cloneDecoration(t),t.initWithAction(this._innerAction.clone()),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._innerAction.startWithTarget(t)},step:function(t){var e=this._innerAction;e.step(t),e.isDone()&&(e.startWithTarget(this.target),e.step(e.getElapsed()-e._duration))},isDone:function(){return!1},reverse:function(){var t=new cc.RepeatForever(this._innerAction.reverse());return this._cloneDecoration(t),this._reverseEaseList(t),t},setInnerAction:function(t){this._innerAction!==t&&(this._innerAction=t)},getInnerAction:function(){return this._innerAction}}),cc.repeatForever=function(t){return new cc.RepeatForever(t)},cc.Spawn=cc.ActionInterval.extend({_one:null,_two:null,ctor:function(t){cc.ActionInterval.prototype.ctor.call(this),this._one=null,this._two=null;var e=t instanceof Array?t:arguments;if(1!==e.length){var i=e.length-1;if(i>=0&&null==e[i]&&cc.logID(1015),i>=0){for(var n,r=e[0],s=1;s<i;s++)e[s]&&(n=r,r=cc.Spawn._actionOneTwo(n,e[s]));this.initWithTwoActions(r,e[i])}}else cc.errorID(1020)},initWithTwoActions:function(t,e){if(!t||!e)throw new Error("cc.Spawn.initWithTwoActions(): arguments must all be non null");var i=!1,n=t._duration,r=e._duration;return this.initWithDuration(Math.max(n,r))&&(this._one=t,this._two=e,n>r?this._two=cc.Sequence._actionOneTwo(e,cc.delayTime(n-r)):n<r&&(this._one=cc.Sequence._actionOneTwo(t,cc.delayTime(r-n))),i=!0),i},clone:function(){var t=new cc.Spawn;return this._cloneDecoration(t),t.initWithTwoActions(this._one.clone(),this._two.clone()),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._one.startWithTarget(t),this._two.startWithTarget(t)},stop:function(){this._one.stop(),this._two.stop(),cc.Action.prototype.stop.call(this)},update:function(t){t=this._computeEaseTime(t),this._one&&this._one.update(t),this._two&&this._two.update(t)},reverse:function(){var t=cc.Spawn._actionOneTwo(this._one.reverse(),this._two.reverse());return this._cloneDecoration(t),this._reverseEaseList(t),t}}),cc.spawn=function(t){var e=t instanceof Array?t:arguments;if(1===e.length)return cc.errorID(1020),null;e.length>0&&null==e[e.length-1]&&cc.logID(1015);for(var i=e[0],n=1;n<e.length;n++)null!=e[n]&&(i=cc.Spawn._actionOneTwo(i,e[n]));return i},cc.Spawn._actionOneTwo=function(t,e){var i=new cc.Spawn;return i.initWithTwoActions(t,e),i},cc.RotateTo=cc.ActionInterval.extend({_dstAngleX:0,_startAngleX:0,_diffAngleX:0,_dstAngleY:0,_startAngleY:0,_diffAngleY:0,ctor:function(t,e,i){cc.ActionInterval.prototype.ctor.call(this),void 0!==e&&this.initWithDuration(t,e,i)},initWithDuration:function(t,e,i){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this._dstAngleX=e||0,this._dstAngleY=void 0!==i?i:this._dstAngleX,!0)},clone:function(){var t=new cc.RotateTo;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._dstAngleX,this._dstAngleY),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t);var e=t.rotationX%360,i=this._dstAngleX-e;i>180&&(i-=360),i<-180&&(i+=360),this._startAngleX=e,this._diffAngleX=i,this._startAngleY=t.rotationY%360;var n=this._dstAngleY-this._startAngleY;n>180&&(n-=360),n<-180&&(n+=360),this._diffAngleY=n},reverse:function(){cc.logID(1016)},update:function(t){t=this._computeEaseTime(t),this.target&&(this.target.rotationX=this._startAngleX+this._diffAngleX*t,this.target.rotationY=this._startAngleY+this._diffAngleY*t)}}),cc.rotateTo=function(t,e,i){return new cc.RotateTo(t,e,i)},cc.RotateBy=cc.ActionInterval.extend({_angleX:0,_startAngleX:0,_angleY:0,_startAngleY:0,ctor:function(t,e,i){cc.ActionInterval.prototype.ctor.call(this),void 0!==e&&this.initWithDuration(t,e,i)},initWithDuration:function(t,e,i){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this._angleX=e||0,this._angleY=void 0!==i?i:this._angleX,!0)},clone:function(){var t=new cc.RotateBy;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._angleX,this._angleY),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._startAngleX=t.rotationX,this._startAngleY=t.rotationY},update:function(t){t=this._computeEaseTime(t),this.target&&(this.target.rotationX=this._startAngleX+this._angleX*t,this.target.rotationY=this._startAngleY+this._angleY*t)},reverse:function(){var t=new cc.RotateBy(this._duration,-this._angleX,-this._angleY);return this._cloneDecoration(t),this._reverseEaseList(t),t}}),cc.rotateBy=function(t,e,i){return new cc.RotateBy(t,e,i)},cc.MoveBy=cc.ActionInterval.extend({_positionDelta:null,_startPosition:null,_previousPosition:null,ctor:function(t,e,i){cc.ActionInterval.prototype.ctor.call(this),this._positionDelta=cc.p(0,0),this._startPosition=cc.p(0,0),this._previousPosition=cc.p(0,0),void 0!==e&&this.initWithDuration(t,e,i)},initWithDuration:function(t,e,i){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(void 0!==e.x&&(i=e.y,e=e.x),this._positionDelta.x=e,this._positionDelta.y=i,!0)},clone:function(){var t=new cc.MoveBy;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._positionDelta),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t);var e=t.getPositionX(),i=t.getPositionY();this._previousPosition.x=e,this._previousPosition.y=i,this._startPosition.x=e,this._startPosition.y=i},update:function(t){if(t=this._computeEaseTime(t),this.target){var e=this._positionDelta.x*t,i=this._positionDelta.y*t,n=this._startPosition;if(cc.macro.ENABLE_STACKABLE_ACTIONS){var r=this.target.getPositionX(),s=this.target.getPositionY(),o=this._previousPosition;n.x=n.x+r-o.x,n.y=n.y+s-o.y,e+=n.x,i+=n.y,o.x=e,o.y=i,this.target.setPosition(e,i)}else this.target.setPosition(n.x+e,n.y+i)}},reverse:function(){var t=new cc.MoveBy(this._duration,cc.p(-this._positionDelta.x,-this._positionDelta.y));return this._cloneDecoration(t),this._reverseEaseList(t),t}}),cc.moveBy=function(t,e,i){return new cc.MoveBy(t,e,i)},cc.MoveTo=cc.MoveBy.extend({_endPosition:null,ctor:function(t,e,i){cc.MoveBy.prototype.ctor.call(this),this._endPosition=cc.p(0,0),void 0!==e&&this.initWithDuration(t,e,i)},initWithDuration:function(t,e,i){return!!cc.MoveBy.prototype.initWithDuration.call(this,t,e,i)&&(void 0!==e.x&&(i=e.y,e=e.x),this._endPosition.x=e,this._endPosition.y=i,!0)},clone:function(){var t=new cc.MoveTo;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._endPosition),t},startWithTarget:function(t){cc.MoveBy.prototype.startWithTarget.call(this,t),this._positionDelta.x=this._endPosition.x-t.getPositionX(),this._positionDelta.y=this._endPosition.y-t.getPositionY()}}),cc.moveTo=function(t,e,i){return new cc.MoveTo(t,e,i)},cc.SkewTo=cc.ActionInterval.extend({_skewX:0,_skewY:0,_startSkewX:0,_startSkewY:0,_endSkewX:0,_endSkewY:0,_deltaX:0,_deltaY:0,ctor:function(t,e,i){cc.ActionInterval.prototype.ctor.call(this),void 0!==i&&this.initWithDuration(t,e,i)},initWithDuration:function(t,e,i){var n=!1;return cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this._endSkewX=e,this._endSkewY=i,n=!0),n},clone:function(){var t=new cc.SkewTo;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._endSkewX,this._endSkewY),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._startSkewX=t.skewX%180,this._deltaX=this._endSkewX-this._startSkewX,this._deltaX>180&&(this._deltaX-=360),this._deltaX<-180&&(this._deltaX+=360),this._startSkewY=t.skewY%360,this._deltaY=this._endSkewY-this._startSkewY,this._deltaY>180&&(this._deltaY-=360),this._deltaY<-180&&(this._deltaY+=360)},update:function(t){t=this._computeEaseTime(t),this.target.skewX=this._startSkewX+this._deltaX*t,this.target.skewY=this._startSkewY+this._deltaY*t}}),cc.skewTo=function(t,e,i){return new cc.SkewTo(t,e,i)},cc.SkewBy=cc.SkewTo.extend({ctor:function(t,e,i){cc.SkewTo.prototype.ctor.call(this),void 0!==i&&this.initWithDuration(t,e,i)},initWithDuration:function(t,e,i){var n=!1;return cc.SkewTo.prototype.initWithDuration.call(this,t,e,i)&&(this._skewX=e,this._skewY=i,n=!0),n},clone:function(){var t=new cc.SkewBy;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._skewX,this._skewY),t},startWithTarget:function(t){cc.SkewTo.prototype.startWithTarget.call(this,t),this._deltaX=this._skewX,this._deltaY=this._skewY,this._endSkewX=this._startSkewX+this._deltaX,this._endSkewY=this._startSkewY+this._deltaY},reverse:function(){var t=new cc.SkewBy(this._duration,-this._skewX,-this._skewY);return this._cloneDecoration(t),this._reverseEaseList(t),t}}),cc.skewBy=function(t,e,i){return new cc.SkewBy(t,e,i)},cc.JumpBy=cc.ActionInterval.extend({_startPosition:null,_delta:null,_height:0,_jumps:0,_previousPosition:null,ctor:function(t,e,i,n,r){cc.ActionInterval.prototype.ctor.call(this),this._startPosition=cc.p(0,0),this._previousPosition=cc.p(0,0),this._delta=cc.p(0,0),void 0!==n&&this.initWithDuration(t,e,i,n,r)},initWithDuration:function(t,e,i,n,r){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(void 0===r&&(r=n,n=i,i=e.y,e=e.x),this._delta.x=e,this._delta.y=i,this._height=n,this._jumps=r,!0)},clone:function(){var t=new cc.JumpBy;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._delta,this._height,this._jumps),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t);var e=t.getPositionX(),i=t.getPositionY();this._previousPosition.x=e,this._previousPosition.y=i,this._startPosition.x=e,this._startPosition.y=i},update:function(t){if(t=this._computeEaseTime(t),this.target){var e=t*this._jumps%1,i=4*this._height*e*(1-e);i+=this._delta.y*t;var n=this._delta.x*t,r=this._startPosition;if(cc.macro.ENABLE_STACKABLE_ACTIONS){var s=this.target.getPositionX(),o=this.target.getPositionY(),a=this._previousPosition;r.x=r.x+s-a.x,r.y=r.y+o-a.y,n+=r.x,i+=r.y,a.x=n,a.y=i,this.target.setPosition(n,i)}else this.target.setPosition(r.x+n,r.y+i)}},reverse:function(){var t=new cc.JumpBy(this._duration,cc.p(-this._delta.x,-this._delta.y),this._height,this._jumps);return this._cloneDecoration(t),this._reverseEaseList(t),t}}),cc.jumpBy=function(t,e,i,n,r){return new cc.JumpBy(t,e,i,n,r)},cc.JumpTo=cc.JumpBy.extend({_endPosition:null,ctor:function(t,e,i,n,r){cc.JumpBy.prototype.ctor.call(this),this._endPosition=cc.p(0,0),void 0!==n&&this.initWithDuration(t,e,i,n,r)},initWithDuration:function(t,e,i,n,r){return!!cc.JumpBy.prototype.initWithDuration.call(this,t,e,i,n,r)&&(void 0===r&&(i=e.y,e=e.x),this._endPosition.x=e,this._endPosition.y=i,!0)},startWithTarget:function(t){cc.JumpBy.prototype.startWithTarget.call(this,t),this._delta.x=this._endPosition.x-this._startPosition.x,this._delta.y=this._endPosition.y-this._startPosition.y},clone:function(){var t=new cc.JumpTo;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._endPosition,this._height,this._jumps),t}}),cc.jumpTo=function(t,e,i,n,r){return new cc.JumpTo(t,e,i,n,r)},cc.bezierAt=function(t,e,i,n,r){return Math.pow(1-r,3)*t+3*r*Math.pow(1-r,2)*e+3*Math.pow(r,2)*(1-r)*i+Math.pow(r,3)*n},cc.BezierBy=cc.ActionInterval.extend({_config:null,_startPosition:null,_previousPosition:null,ctor:function(t,e){cc.ActionInterval.prototype.ctor.call(this),this._config=[],this._startPosition=cc.p(0,0),this._previousPosition=cc.p(0,0),e&&this.initWithDuration(t,e)},initWithDuration:function(t,e){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this._config=e,!0)},clone:function(){var t=new cc.BezierBy;this._cloneDecoration(t);for(var e=[],i=0;i<this._config.length;i++){var n=this._config[i];e.push(cc.p(n.x,n.y))}return t.initWithDuration(this._duration,e),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t);var e=t.getPositionX(),i=t.getPositionY();this._previousPosition.x=e,this._previousPosition.y=i,this._startPosition.x=e,this._startPosition.y=i},update:function(t){if(t=this._computeEaseTime(t),this.target){var e=this._config,i=e[0].x,n=e[1].x,r=e[2].x,s=e[0].y,o=e[1].y,a=e[2].y,c=cc.bezierAt(0,i,n,r,t),h=cc.bezierAt(0,s,o,a,t),l=this._startPosition;if(cc.macro.ENABLE_STACKABLE_ACTIONS){var _=this.target.getPositionX(),u=this.target.getPositionY(),d=this._previousPosition;l.x=l.x+_-d.x,l.y=l.y+u-d.y,c+=l.x,h+=l.y,d.x=c,d.y=h,this.target.setPosition(c,h)}else this.target.setPosition(l.x+c,l.y+h)}},reverse:function(){var t=this._config,e=[cc.pAdd(t[1],cc.pNeg(t[2])),cc.pAdd(t[0],cc.pNeg(t[2])),cc.pNeg(t[2])],i=new cc.BezierBy(this._duration,e);return this._cloneDecoration(i),this._reverseEaseList(i),i}}),cc.bezierBy=function(t,e){return new cc.BezierBy(t,e)},cc.BezierTo=cc.BezierBy.extend({_toConfig:null,ctor:function(t,e){cc.BezierBy.prototype.ctor.call(this),this._toConfig=[],e&&this.initWithDuration(t,e)},initWithDuration:function(t,e){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this._toConfig=e,!0)},clone:function(){var t=new cc.BezierTo;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._toConfig),t},startWithTarget:function(t){cc.BezierBy.prototype.startWithTarget.call(this,t);var e=this._startPosition,i=this._toConfig,n=this._config;n[0]=cc.pSub(i[0],e),n[1]=cc.pSub(i[1],e),n[2]=cc.pSub(i[2],e)}}),cc.bezierTo=function(t,e){return new cc.BezierTo(t,e)},cc.ScaleTo=cc.ActionInterval.extend({_scaleX:1,_scaleY:1,_startScaleX:1,_startScaleY:1,_endScaleX:0,_endScaleY:0,_deltaX:0,_deltaY:0,ctor:function(t,e,i){cc.ActionInterval.prototype.ctor.call(this),void 0!==e&&this.initWithDuration(t,e,i)},initWithDuration:function(t,e,i){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this._endScaleX=e,this._endScaleY=null!=i?i:e,!0)},clone:function(){var t=new cc.ScaleTo;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._endScaleX,this._endScaleY),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._startScaleX=t.scaleX,this._startScaleY=t.scaleY,this._deltaX=this._endScaleX-this._startScaleX,this._deltaY=this._endScaleY-this._startScaleY},update:function(t){t=this._computeEaseTime(t),this.target&&(this.target.scaleX=this._startScaleX+this._deltaX*t,this.target.scaleY=this._startScaleY+this._deltaY*t)}}),cc.scaleTo=function(t,e,i){return new cc.ScaleTo(t,e,i)},cc.ScaleBy=cc.ScaleTo.extend({startWithTarget:function(t){cc.ScaleTo.prototype.startWithTarget.call(this,t),this._deltaX=this._startScaleX*this._endScaleX-this._startScaleX,this._deltaY=this._startScaleY*this._endScaleY-this._startScaleY},reverse:function(){var t=new cc.ScaleBy(this._duration,1/this._endScaleX,1/this._endScaleY);return this._cloneDecoration(t),this._reverseEaseList(t),t},clone:function(){var t=new cc.ScaleBy;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._endScaleX,this._endScaleY),t}}),cc.scaleBy=function(t,e,i){return new cc.ScaleBy(t,e,i)},cc.Blink=cc.ActionInterval.extend({_times:0,_originalState:!1,ctor:function(t,e){cc.ActionInterval.prototype.ctor.call(this),void 0!==e&&this.initWithDuration(t,e)},initWithDuration:function(t,e){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this._times=e,!0)},clone:function(){var t=new cc.Blink;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._times),t},update:function(t){if(t=this._computeEaseTime(t),this.target&&!this.isDone()){var e=1/this._times,i=t%e;this.target.opacity=i>e/2?255:0}},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._originalState=t.opacity},stop:function(){this.target.opacity=this._originalState,cc.ActionInterval.prototype.stop.call(this)},reverse:function(){var t=new cc.Blink(this._duration,this._times);return this._cloneDecoration(t),this._reverseEaseList(t),t}}),cc.blink=function(t,e){return new cc.Blink(t,e)},cc.FadeTo=cc.ActionInterval.extend({_toOpacity:0,_fromOpacity:0,ctor:function(t,e){cc.ActionInterval.prototype.ctor.call(this),void 0!==e&&this.initWithDuration(t,e)},initWithDuration:function(t,e){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this._toOpacity=e,!0)},clone:function(){var t=new cc.FadeTo;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._toOpacity),t},update:function(t){t=this._computeEaseTime(t);var e=void 0!==this._fromOpacity?this._fromOpacity:255;this.target.opacity=e+(this._toOpacity-e)*t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._fromOpacity=t.opacity}}),cc.fadeTo=function(t,e){return new cc.FadeTo(t,e)},cc.FadeIn=cc.FadeTo.extend({_reverseAction:null,ctor:function(t){cc.FadeTo.prototype.ctor.call(this),null==t&&(t=0),this.initWithDuration(t,255)},reverse:function(){var t=new cc.FadeOut;return t.initWithDuration(this._duration,0),this._cloneDecoration(t),this._reverseEaseList(t),t},clone:function(){var t=new cc.FadeIn;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._toOpacity),t},startWithTarget:function(t){this._reverseAction&&(this._toOpacity=this._reverseAction._fromOpacity),cc.FadeTo.prototype.startWithTarget.call(this,t)}}),cc.fadeIn=function(t){return new cc.FadeIn(t)},cc.FadeOut=cc.FadeTo.extend({ctor:function(t){cc.FadeTo.prototype.ctor.call(this),null==t&&(t=0),this.initWithDuration(t,0)},reverse:function(){var t=new cc.FadeIn;return t._reverseAction=this,t.initWithDuration(this._duration,255),this._cloneDecoration(t),this._reverseEaseList(t),t},clone:function(){var t=new cc.FadeOut;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._toOpacity),t}}),cc.fadeOut=function(t){return new cc.FadeOut(t)},cc.TintTo=cc.ActionInterval.extend({_to:null,_from:null,ctor:function(t,e,i,n){cc.ActionInterval.prototype.ctor.call(this),this._to=cc.color(0,0,0),this._from=cc.color(0,0,0),e instanceof cc.Color&&(n=e.b,i=e.g,e=e.r),void 0!==n&&this.initWithDuration(t,e,i,n)},initWithDuration:function(t,e,i,n){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this._to=cc.color(e,i,n),!0)},clone:function(){var t=new cc.TintTo;this._cloneDecoration(t);var e=this._to;return t.initWithDuration(this._duration,e.r,e.g,e.b),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._from=this.target.color},update:function(t){t=this._computeEaseTime(t);var e=this._from,i=this._to;e&&this.target.setColor(cc.color(e.r+(i.r-e.r)*t,e.g+(i.g-e.g)*t,e.b+(i.b-e.b)*t))}}),cc.tintTo=function(t,e,i,n){return new cc.TintTo(t,e,i,n)},cc.TintBy=cc.ActionInterval.extend({_deltaR:0,_deltaG:0,_deltaB:0,_fromR:0,_fromG:0,_fromB:0,ctor:function(t,e,i,n){cc.ActionInterval.prototype.ctor.call(this),void 0!==n&&this.initWithDuration(t,e,i,n)},initWithDuration:function(t,e,i,n){return!!cc.ActionInterval.prototype.initWithDuration.call(this,t)&&(this._deltaR=e,this._deltaG=i,this._deltaB=n,!0)},clone:function(){var t=new cc.TintBy;return this._cloneDecoration(t),t.initWithDuration(this._duration,this._deltaR,this._deltaG,this._deltaB),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t);var e=t.color;this._fromR=e.r,this._fromG=e.g,this._fromB=e.b},update:function(t){t=this._computeEaseTime(t),this.target.color=cc.color(this._fromR+this._deltaR*t,this._fromG+this._deltaG*t,this._fromB+this._deltaB*t)},reverse:function(){var t=new cc.TintBy(this._duration,-this._deltaR,-this._deltaG,-this._deltaB);return this._cloneDecoration(t),this._reverseEaseList(t),t}}),cc.tintBy=function(t,e,i,n){return new cc.TintBy(t,e,i,n)},cc.DelayTime=cc.ActionInterval.extend({update:function(t){},reverse:function(){var t=new cc.DelayTime(this._duration);return this._cloneDecoration(t),this._reverseEaseList(t),t},clone:function(){var t=new cc.DelayTime;return this._cloneDecoration(t),t.initWithDuration(this._duration),t}}),cc.delayTime=function(t){return new cc.DelayTime(t)},cc.ReverseTime=cc.ActionInterval.extend({_other:null,ctor:function(t){cc.ActionInterval.prototype.ctor.call(this),this._other=null,t&&this.initWithAction(t)},initWithAction:function(t){if(!t)throw new Error("cc.ReverseTime.initWithAction(): action must be non null");if(t===this._other)throw new Error("cc.ReverseTime.initWithAction(): the action was already passed in.");return!!cc.ActionInterval.prototype.initWithDuration.call(this,t._duration)&&(this._other=t,!0)},clone:function(){var t=new cc.ReverseTime;return this._cloneDecoration(t),t.initWithAction(this._other.clone()),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._other.startWithTarget(t)},update:function(t){t=this._computeEaseTime(t),this._other&&this._other.update(1-t)},reverse:function(){return this._other.clone()},stop:function(){this._other.stop(),cc.Action.prototype.stop.call(this)}}),cc.reverseTime=function(t){return new cc.ReverseTime(t)},cc.Animate=cc.ActionInterval.extend({_animation:null,_nextFrame:0,_origFrame:null,_executedLoops:0,_splitTimes:null,_currFrameIndex:0,ctor:function(t){cc.ActionInterval.prototype.ctor.call(this),this._splitTimes=[],t&&this.initWithAnimation(t)},getAnimation:function(){return this._animation},setAnimation:function(t){this._animation=t},getCurrentFrameIndex:function(){return this._currFrameIndex},initWithAnimation:function(t){if(!t)throw new Error("cc.Animate.initWithAnimation(): animation must be non-NULL");var e=t.getDuration();if(this.initWithDuration(e*t.getLoops())){this._nextFrame=0,this.setAnimation(t),this._origFrame=null,this._executedLoops=0;var i=this._splitTimes;i.length=0;var n=0,r=e/t.getTotalDelayUnits(),s=t.getFrames();cc.js.array.verifyType(s,cc.AnimationFrame);for(var o=0;o<s.length;o++){var a=n*r/e;n+=s[o].getDelayUnits(),i.push(a)}return!0}return!1},clone:function(){var t=new cc.Animate;return this._cloneDecoration(t),t.initWithAnimation(this._animation.clone()),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._animation.getRestoreOriginalFrame()&&(this._origFrame=t.getSpriteFrame()),this._nextFrame=0,this._executedLoops=0},update:function(t){if((t=this._computeEaseTime(t))<1){(0|(t*=this._animation.getLoops()))>this._executedLoops&&(this._nextFrame=0,this._executedLoops++),t%=1}for(var e=this._animation.getFrames(),i=e.length,n=this._splitTimes,r=this._nextFrame;r<i&&n[r]<=t;r++)_currFrameIndex=r,this.target.setSpriteFrame(e[_currFrameIndex].getSpriteFrame()),this._nextFrame=r+1},reverse:function(){var t=this._animation,e=t.getFrames(),i=[];if(cc.js.array.verifyType(e,cc.AnimationFrame),e.length>0)for(var n=e.length-1;n>=0;n--){var r=e[n];if(!r)break;i.push(r.clone())}var s=new cc.SpriteFrameAnimation(i,t.getDelayPerUnit(),t.getLoops());s.setRestoreOriginalFrame(t.getRestoreOriginalFrame());var o=new cc.Animate(s);return this._cloneDecoration(o),this._reverseEaseList(o),o},stop:function(){this._animation.getRestoreOriginalFrame()&&this.target&&this.target.setSpriteFrame(this._origFrame),cc.Action.prototype.stop.call(this)}}),cc.animate=function(t){return new cc.Animate(t)},cc.TargetedAction=cc.ActionInterval.extend({_action:null,_forcedTarget:null,ctor:function(t,e){cc.ActionInterval.prototype.ctor.call(this),e&&this.initWithTarget(t,e)},initWithTarget:function(t,e){return!!this.initWithDuration(e._duration)&&(this._forcedTarget=t,this._action=e,!0)},clone:function(){var t=new cc.TargetedAction;return this._cloneDecoration(t),t.initWithTarget(this._forcedTarget,this._action.clone()),t},startWithTarget:function(t){cc.ActionInterval.prototype.startWithTarget.call(this,t),this._action.startWithTarget(this._forcedTarget)},stop:function(){this._action.stop()},update:function(t){t=this._computeEaseTime(t),this._action.update(t)},getForcedTarget:function(){return this._forcedTarget},setForcedTarget:function(t){this._forcedTarget!==t&&(this._forcedTarget=t)}}),cc.targetedAction=function(t,e){return new cc.TargetedAction(t,e)}}),{}],10:[(function(t,e,i){cc.ActionManager=cc._Class.extend({_elementPool:[],_searchElementByTarget:function(t,e){for(var i=0;i<t.length;i++)if(e===t[i].target)return t[i];return null},ctor:function(){this._hashTargets={},this._arrayTargets=[],this._currentTarget=null},_getElement:function(t,e){var i=this._elementPool.pop();return i||(i=new function(){this.actions=[],this.target=null,this.actionIndex=0,this.currentAction=null,this.paused=!1,this.lock=!1}),i.target=t,i.paused=!!e,i},_putElement:function(t){t.actions.length=0,t.actionIndex=0,t.currentAction=null,t.paused=!1,t.target=null,t.lock=!1,this._elementPool.push(t)},addAction:function(t,e,i){if(!t)throw new Error("cc.ActionManager.addAction(): action must be non-null");if(!e)throw new Error("cc.ActionManager.addAction(): action must be non-null");var n=this._hashTargets[e.__instanceId];n?n.actions||(n.actions=[]):(n=this._getElement(e,i),this._hashTargets[e.__instanceId]=n,this._arrayTargets.push(n)),n.actions.push(t),t.startWithTarget(e)},removeAllActions:function(){for(var t=this._arrayTargets,e=0;e<t.length;e++){var i=t[e];i&&this.removeAllActionsFromTarget(i.target,!0)}},removeAllActionsFromTarget:function(t,e){if(null!=t){var i=this._hashTargets[t.__instanceId];i&&(i.actions.length=0,this._deleteHashElement(i))}},removeAction:function(t){if(null!=t){var e=t.getOriginalTarget(),i=this._hashTargets[e.__instanceId];if(i){for(var n=0;n<i.actions.length;n++)if(i.actions[n]===t){i.actions.splice(n,1),i.actionIndex>=n&&i.actionIndex--;break}}else cc.logID(1001)}},removeActionByTag:function(t,e){t===cc.Action.TAG_INVALID&&cc.logID(1002),cc.assertID(e,1003);var i=this._hashTargets[e.__instanceId];if(i)for(var n=i.actions.length,r=0;r<n;++r){var s=i.actions[r];if(s&&s.getTag()===t&&s.getOriginalTarget()===e){this._removeActionAtIndex(r,i);break}}},getActionByTag:function(t,e){t===cc.Action.TAG_INVALID&&cc.logID(1004);var i=this._hashTargets[e.__instanceId];if(i){if(null!=i.actions)for(var n=0;n<i.actions.length;++n){var r=i.actions[n];if(r&&r.getTag()===t)return r}cc.logID(1005,t)}return null},getNumberOfRunningActionsInTarget:function(t){var e=this._hashTargets[t.__instanceId];return e&&e.actions?e.actions.length:0},pauseTarget:function(t){var e=this._hashTargets[t.__instanceId];e&&(e.paused=!0)},resumeTarget:function(t){var e=this._hashTargets[t.__instanceId];e&&(e.paused=!1)},pauseAllRunningActions:function(){for(var t=[],e=this._arrayTargets,i=0;i<e.length;i++){var n=e[i];n&&!n.paused&&(n.paused=!0,t.push(n.target))}return t},resumeTargets:function(t){if(t)for(var e=0;e<t.length;e++)t[e]&&this.resumeTarget(t[e])},pauseTargets:function(t){if(t)for(var e=0;e<t.length;e++)t[e]&&this.pauseTarget(t[e])},purgeSharedManager:function(){cc.director.getScheduler().unscheduleUpdate(this)},_removeActionAtIndex:function(t,e){e.actions[t];e.actions.splice(t,1),e.actionIndex>=t&&e.actionIndex--,0===e.actions.length&&this._deleteHashElement(e)},_deleteHashElement:function(t){var e=!1;if(t&&!t.lock&&this._hashTargets[t.target.__instanceId]){delete this._hashTargets[t.target.__instanceId];for(var i=this._arrayTargets,n=0,r=i.length;n<r;n++)if(i[n]===t){i.splice(n,1);break}this._putElement(t),e=!0}return e},update:function(t){for(var e,i=this._arrayTargets,n=0;n<i.length;n++){if(this._currentTarget=i[n],!(e=this._currentTarget).paused&&e.actions){for(e.lock=!0,e.actionIndex=0;e.actionIndex<e.actions.length;e.actionIndex++)if(e.currentAction=e.actions[e.actionIndex],e.currentAction){if(e.currentAction.step(t*(e.currentAction._speedMethod?e.currentAction._speed:1)),e.currentAction&&e.currentAction.isDone()){e.currentAction.stop();var r=e.currentAction;e.currentAction=null,this.removeAction(r)}e.currentAction=null}e.lock=!1}0===e.actions.length&&this._deleteHashElement(e)&&n--}}})}),{}],11:[(function(t,e,i){t("./CCActionManager"),t("./CCAction"),t("./CCActionInterval"),t("./CCActionInstant"),t("./CCActionEase"),t("./CCActionCatmullRom")}),{"./CCAction":5,"./CCActionCatmullRom":6,"./CCActionEase":7,"./CCActionInstant":8,"./CCActionInterval":9,"./CCActionManager":10}],12:[(function(t,e,i){function n(t,e){o.call(this),this.target=t,this.animation=e,this._anims=new s.array.MutableForwardIterator([])}function r(t,e){function i(t){if(!Array.isArray(t))return!1;for(var e=0,i=t.length;e<i;e++){var n=t[e];if(!Array.isArray(n)||6!==n.length)return!1}return!0}function n(t,n,r){var o=t instanceof cc.Node&&"position"===n,l=[],_=new a;_.target=t;var u,m=n.indexOf(".");-1!==m?t[u=n.slice(0,m)]:u=n,_.prop=u,_.subProps=(function(t){var e=t.split(".");return e.shift(),e.length>0?e:null})(n);for(var f=0,p=r.length;f<p;f++){var g=r[f],v=g.frame/e.duration;if(_.ratios.push(v),o){var y=g.motionPath;y&&!i(y)&&(cc.errorID(3904,t.name,n,f),y=null),l.push(y)}var x=g.value;_.values.push(x);var C=g.curve;if(C){if("string"==typeof C){_.types.push(C);continue}if(Array.isArray(C)){C[0]===C[1]&&C[2]===C[3]?_.types.push(a.Linear):_.types.push(a.Bezier(C));continue}}_.types.push(a.Linear)}o&&h(l,_,s.duration,s.sample);for(var A,T,b=_.ratios,w=!0,S=1,E=b.length;S<E;S++)if(A=b[S]-b[S-1],1===S)T=A;else if(Math.abs(A-T)>1e-6){w=!1;break}return _._findFrameIndex=w?c:d,_}function r(t,e){var i=e.props,r=e.comps;if(i)for(var s in i){var a=n(t,s,i[s]);o.push(a)}if(r)for(var c in r){var h=t.getComponent(c);if(h){var l=r[c];for(var s in l){a=n(h,s,l[s]);o.push(a)}}}}var s=e.clip,o=e.curves;o.length=0,e.duration=s.duration,e.speed=s.speed,e.wrapMode=s.wrapMode,e.frameRate=s.sample,(e.wrapMode&u.Loop)===u.Loop?e.repeatCount=1/0:e.repeatCount=1;var m=s.curveData,f=m.paths;r(t,m);for(var p in f){var g=cc.find(p,t);if(g){r(g,f[p])}}var v=s.events;if(v)for(var y,x=0,C=v.length;x<C;x++){y||((y=new l).target=t,o.push(y));var A,T=v[x],b=T.frame/e.duration,w=d(y.ratios,b);w>=0?A=y.events[w]:(A=new _,y.ratios.push(b),y.events.push(A)),A.add(T.func,T.params)}}var s=cc.js,o=t("./playable"),a=t("./animation-curves").DynamicAnimCurve,c=t("./animation-curves").quickFindIndex,h=t("./motion-path-helper").sampleMotionPaths,l=t("./animation-curves").EventAnimCurve,_=t("./animation-curves").EventInfo,u=t("./types").WrapModeMask,d=t("../core/utils/binary-search").binarySearchEpsilon;s.extend(n,o);var m=n.prototype;m.playState=function(t,e){t.clip&&(t.curveLoaded||r(this.target,t),t.animator=this,t.play(),"number"==typeof e&&t.setTime(e),this.play())},m.stopStatesExcept=function(t){var e=this._anims,i=e.array;for(e.i=0;e.i<i.length;++e.i){var n=i[e.i];n!==t&&this.stopState(n)}},m.addAnimation=function(t){-1===this._anims.array.indexOf(t)&&this._anims.push(t),t._setListeners(this.animation)},m.removeAnimation=function(t){var e=this._anims.array.indexOf(t);e>=0?(this._anims.fastRemoveAt(e),0===this._anims.array.length&&this.stop()):cc.errorID(3908),t.animator=null},m.sample=function(){var t=this._anims,e=t.array;for(t.i=0;t.i<e.length;++t.i){e[t.i].sample()}},m.stopState=function(t){t&&t.stop()},m.pauseState=function(t){t&&t.pause()},m.resumeState=function(t){t&&t.resume(),this.isPaused&&this.resume()},m.setStateTime=function(t,e){if(void 0!==e)t&&(t.setTime(e),t.sample());else{e=t;for(var i=this._anims.array,n=0;n<i.length;++n){var r=i[n];r.setTime(e),r.sample()}}},m.onStop=function(){var t=this._anims,e=t.array;for(t.i=0;t.i<e.length;++t.i){e[t.i].stop()}},m.onPause=function(){for(var t=this._anims.array,e=0;e<t.length;++e){var i=t[e];i.pause(),i.animator=null}},m.onResume=function(){for(var t=this._anims.array,e=0;e<t.length;++e){var i=t[e];i.animator=this,i.resume()}},m._reloadClip=function(t){r(this.target,t)},e.exports=n}),{"../core/utils/binary-search":202,"./animation-curves":14,"./motion-path-helper":20,"./playable":21,"./types":22}],13:[(function(t,e,i){var n=cc.Class({name:"cc.AnimationClip",extends:cc.Asset,properties:{_duration:{default:0,type:"Float"},duration:{get:function(){return this._duration}},sample:{default:60},speed:{default:1},wrapMode:{default:cc.WrapMode.Normal},curveData:{default:{},visible:!1},events:{default:[],visible:!1}},statics:{createWithSpriteFrames:function(t,e){if(!Array.isArray(t))return cc.errorID(3905),null;var i=new n;i.sample=e||i.sample,i._duration=t.length/i.sample;for(var r=[],s=1/i.sample,o=0,a=t.length;o<a;o++)r[o]={frame:o*s,value:t[o]};return i.curveData={comps:{"cc.Sprite":{spriteFrame:r}}},i}}});cc.AnimationClip=e.exports=n}),{}],14:[(function(t,e,i){function n(t,e){if("string"==typeof e){var i=cc.Easing[e];i?t=i(t):cc.errorID(3906,e)}else Array.isArray(e)&&(t=r(e,t));return t}var r=t("./bezier").bezierByTime,s=t("../core/utils/binary-search").binarySearchEpsilon,o=t("./types").WrapModeMask,a=t("./types").WrappedInfo,c=cc.Class({name:"cc.AnimCurve",sample:function(t,e,i){},onTimeChangedManually:void 0}),h=cc.Class({name:"cc.DynamicAnimCurve",extends:c,properties:{target:null,prop:"",values:[],ratios:[],types:[],subProps:null},_findFrameIndex:s,sample:function(t,e,i){var r=this.values,s=this.ratios,o=s.length;if(0!==o){var a,c=this._findFrameIndex(s,e);if(c<0)if((c=~c)<=0)a=r[0];else if(c>=o)a=r[o-1];else{var h=r[c-1],l="number"==typeof h,_=h&&h.lerp;if(l||_){var u=s[c-1],d=s[c],m=this.types[c-1],f=(e-u)/(d-u);m&&(f=n(f,m));var p=r[c];l?a=h+(p-h)*f:_&&(a=h.lerp(p,f))}else a=h}else a=r[c];var g=this.subProps;if(g){for(var v=this.target[this.prop],y=v,x=0;x<g.length-1;x++){var C=g[x];if(!y)return;y=y[C]}var A=g[g.length-1];if(!y)return;y[A]=a,a=v}this.target[this.prop]=a}}});h.Linear=null,h.Bezier=function(t){return t};var l=function(){this.events=[]};l.prototype.add=function(t,e){this.events.push({func:t||"",params:e||[]})};var _=cc.Class({name:"cc.EventAnimCurve",extends:c,properties:{target:null,ratios:[],events:[],_wrappedInfo:{default:function(){return new a}},_lastWrappedInfo:null,_ignoreIndex:NaN},_wrapIterations:function(t){return t-(0|t)==0&&(t-=1),0|t},sample:function(t,e,i){var n=this.ratios.length,r=i.getWrappedInfo(i.time,this._wrappedInfo),c=r.direction,h=s(this.ratios,r.ratio);if(h<0&&(h=~h-1,c<0&&(h+=1)),this._ignoreIndex!==h&&(this._ignoreIndex=NaN),r.frameIndex=h,!this._lastWrappedInfo)return this._fireEvent(h),void(this._lastWrappedInfo=new a(r));var l=i.wrapMode,_=this._wrapIterations(r.iterations),u=this._lastWrappedInfo,d=this._wrapIterations(u.iterations),m=u.frameIndex,f=u.direction,p=-1!==d&&_!==d;if(m===h&&p&&1===n)this._fireEvent(0);else if(m!==h||p){c=f;do{if(m!==h){if(-1===c&&0===m&&h>0?((l&o.PingPong)===o.PingPong?c*=-1:m=n,d++):1===c&&m===n-1&&h<n-1&&((l&o.PingPong)===o.PingPong?c*=-1:m=-1,d++),m===h)break;if(d>_)break}m+=c,cc.director.getAnimationManager().pushDelayEvent(this,"_fireEvent",[m])}while(m!==h&&m>-1&&m<n)}this._lastWrappedInfo.set(r)},_fireEvent:function(t){if(!(t<0||t>=this.events.length||this._ignoreIndex===t)){var e=this.events[t].events;if(this.target.isValid)for(var i=this.target._components,n=0;n<e.length;n++)for(var r=e[n],s=r.func,o=0;o<i.length;o++){var a=i[o],c=a[s];c&&c.apply(a,r.params)}}},onTimeChangedManually:function(t,e){this._lastWrappedInfo=null,this._ignoreIndex=NaN;var i=e.getWrappedInfo(t,this._wrappedInfo),n=i.direction,r=s(this.ratios,i.ratio);r<0&&(r=~r-1,n<0&&(r+=1),this._ignoreIndex=r)}});e.exports={AnimCurve:c,DynamicAnimCurve:h,EventAnimCurve:_,EventInfo:l,computeRatioByType:n,quickFindIndex:function(t,e){var i=t.length-1;if(0===i)return 0;var n=t[0];if(e<n)return 0;var r=t[i];if(e>r)return i;var s=(e=(e-n)/(r-n))/(1/i),o=0|s;return s-o<1e-6?o:~(o+1)}}}),{"../core/utils/binary-search":202,"./bezier":17,"./types":22}],15:[(function(t,e,n){var r=cc.js,s=cc.Class({ctor:function(){this.__instanceId=cc.ClassManager.getNewInstanceId(),this._anims=new r.array.MutableForwardIterator([]),this._delayEvents=[]},update:function(t){var e=this._anims,n=e.array;for(e.i=0;e.i<n.length;++e.i){var r=n[e.i];r._isPlaying&&!r._isPaused&&r.update(t)}var s=this._delayEvents;for(i=0,l=s.length;i<l;i++){var o=s[i];o.target[o.func].apply(o.target,o.args)}s.length=0},destruct:function(){},addAnimation:function(t){-1===this._anims.array.indexOf(t)&&this._anims.push(t)},removeAnimation:function(t){var e=this._anims.array.indexOf(t);e>=0?this._anims.fastRemoveAt(e):cc.errorID(3907)},pushDelayEvent:function(t,e,i){this._delayEvents.push({target:t,func:e,args:i})}});cc.AnimationManager=e.exports=s}),{}],16:[(function(t,e,i){function n(t,e){a.call(this),cc.EventTarget.call(this),this._currentFramePlayed=!1,this._delay=0,this._delayTime=0,this._wrappedInfo=new h,this._lastWrappedInfo=null,this._process=r,this._clip=t,this._name=e||t&&t.name,this.animator=null,this.curves=[],this.delay=0,this.repeatCount=1,this.duration=1,this.speed=1,this.wrapMode=l.Normal,this.time=0,this._emit=this.emit,this.emit=function(){for(var t=new Array(arguments.length),e=0,i=t.length;e<i;e++)t[e]=arguments[e];cc.director.getAnimationManager().pushDelayEvent(this,"_emit",t)}}function r(){var t=this.sample(),e=this._hasListenerCache;if(e&&e.lastframe){var i;i=this._lastWrappedInfo?this._lastWrappedInfo:this._lastWrappedInfo=new h(t),this.repeatCount>1&&(0|t.iterations)>(0|i.iterations)&&this.emit("lastframe",this),i.set(t)}t.stopped&&(this.stop(),this.emit("finished",this))}function s(){var t=this.time,e=this.duration;t>e?0===(t%=e)&&(t=e):t<0&&0!==(t%=e)&&(t+=e);for(var i=t/e,n=this.curves,r=0,s=n.length;r<s;r++){n[r].sample(t,i,this)}var o=this._hasListenerCache;o&&o.lastframe&&(void 0===this._lastIterations&&(this._lastIterations=i),(this.time>0&&this._lastIterations>i||this.time<0&&this._lastIterations<i)&&this.emit("lastframe",this),this._lastIterations=i)}var o=cc.js,a=t("./playable"),c=t("./types"),h=c.WrappedInfo,l=c.WrapMode,_=c.WrapModeMask;o.extend(n,a);var u=n.prototype;cc.js.mixin(u,cc.EventTarget.prototype),u._setListeners=function(t){this._capturingListeners=t?t._capturingListeners:null,this._bubblingListeners=t?t._bubblingListeners:null,this._hasListenerCache=t?t._hasListenerCache:null},u.onPlay=function(){this.setTime(0),this._delayTime=this._delay,cc.director.getAnimationManager().addAnimation(this),this.animator&&this.animator.addAnimation(this),this.emit("play",this)},u.onStop=function(){this.isPaused||cc.director.getAnimationManager().removeAnimation(this),this.animator&&this.animator.removeAnimation(this),this.emit("stop",this)},u.onResume=function(){cc.director.getAnimationManager().addAnimation(this),this.emit("resume",this)},u.onPause=function(){cc.director.getAnimationManager().removeAnimation(this),this.emit("pause",this)},u.setTime=function(t){this._currentFramePlayed=!1,this.time=t||0;for(var e=this.curves,i=0,n=e.length;i<n;i++){var r=e[i];r.onTimeChangedManually&&r.onTimeChangedManually(t,this)}},u.update=function(t){this._delayTime>0&&(this._delayTime-=t,this._delayTime>0)||(this._currentFramePlayed?this.time+=t*this.speed:this._currentFramePlayed=!0,this._process())},u._needRevers=function(t){var e=this.wrapMode,i=!1;if((e&_.PingPong)===_.PingPong){t-(0|t)==0&&t>0&&(t-=1);1&t&&(i=!i)}return(e&_.Reverse)===_.Reverse&&(i=!i),i},u.getWrappedInfo=function(t,e){e=e||new h;var i=!1,n=this.duration,r=this.repeatCount,s=t>0?t/n:-t/n;if(s>=r){s=r,i=!0;var o=r-(0|r);0===o&&(o=1),t=o*n*(t>0?1:-1)}if(t>n){var a=t%n;t=0===a?n:a}else t<0&&0!==(t%=n)&&(t+=n);var c=!1,l=this._wrapMode&_.ShouldWrap;l&&(c=this._needRevers(s));var u=c?-1:1;return this.speed<0&&(u*=-1),l&&c&&(t=n-t),e.ratio=t/n,e.time=t,e.direction=u,e.stopped=i,e.iterations=s,e},u.sample=function(){for(var t=this.getWrappedInfo(this.time,this._wrappedInfo),e=this.curves,i=0,n=e.length;i<n;i++){e[i].sample(t.time,t.ratio,this)}return t},o.get(u,"clip",(function(){return this._clip})),o.get(u,"name",(function(){return this._name})),o.obsolete(u,"AnimationState.length","duration"),o.getset(u,"curveLoaded",(function(){return this.curves.length>0}),(function(){this.curves.length=0})),o.getset(u,"wrapMode",(function(){return this._wrapMode}),(function(t){this._wrapMode=t,this.time=0,t&_.Loop?this.repeatCount=1/0:this.repeatCount=1})),o.getset(u,"repeatCount",(function(){return this._repeatCount}),(function(t){this._repeatCount=t;var e=this._wrapMode&_.ShouldWrap,i=(this.wrapMode&_.Reverse)===_.Reverse;this._process=t!==1/0||e||i?r:s})),o.getset(u,"delay",(function(){return this._delay}),(function(t){this._delayTime=this._delay=t})),cc.AnimationState=e.exports=n}),{"./playable":21,"./types":22}],17:[(function(t,e,i){function n(t,e,i,n,r){var s=1-r;return t*s*s*s+3*e*s*s*r+3*i*s*r*r+n*r*r*r}function r(t){return t<0?-Math.pow(-t,1/3):Math.pow(t,1/3)}function s(t,e){var i=(function(t,e){var i,n,s,_,u,d=e-0,m=e-t[0],f=3*d,p=3*m,g=3*(e-t[2]),v=1/(-d+p-g+(e-1)),y=(f-6*m+g)*v,x=y*(1/3),C=(-f+p)*v,A=1/3*(3*C-y*y),T=A*(1/3),b=(2*y*y*y-9*y*C+d*v*27)/27,w=b/2,S=w*w+T*T*T;if(S<0){var E=1/3*-A,I=l(E*E*E),R=-b/(2*I),P=a(R<-1?-1:R>1?1:R),B=2*r(I);return s=B*o(P*(1/3))-x,_=B*o((P+h)*(1/3))-x,u=B*o((P+2*h)*(1/3))-x,0<=s&&s<=1?0<=_&&_<=1?0<=u&&u<=1?c(s,_,u):c(s,_):0<=u&&u<=1?c(s,u):s:0<=_&&_<=1?0<=u&&u<=1?c(_,u):_:u}if(0===S)return i=w<0?r(-w):-r(w),s=2*i-x,_=-i-x,0<=s&&s<=1?0<=_&&_<=1?c(s,_):s:_;var L=l(S);return i=r(-w+L),n=r(w+L),s=i-n-x})(t,e),n=1-i;return 0*n*n*n+3*t[1]*i*n*n+3*t[3]*i*i*n+1*i*i*i}var o=Math.cos,a=Math.acos,c=Math.max,h=2*Math.PI,l=Math.sqrt;e.exports={bezier:n,bezierByTime:s}}),{}],18:[(function(t,e,i){function n(t,e){return function(i){return i<.5?e(2*i)/2:t(2*i-1)/2+.5}}var r={constant:function(){return 0},linear:function(t){return t},quadIn:function(t){return t*t},quadOut:function(t){return t*(2-t)},quadInOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)},cubicIn:function(t){return t*t*t},cubicOut:function(t){return--t*t*t+1},cubicInOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)},quartIn:function(t){return t*t*t*t},quartOut:function(t){return 1- --t*t*t*t},quartInOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)},quintIn:function(t){return t*t*t*t*t},quintOut:function(t){return--t*t*t*t*t+1},quintInOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)},sineIn:function(t){return 1-Math.cos(t*Math.PI/2)},sineOut:function(t){return Math.sin(t*Math.PI/2)},sineInOut:function(t){return.5*(1-Math.cos(Math.PI*t))},expoIn:function(t){return 0===t?0:Math.pow(1024,t-1)},expoOut:function(t){return 1===t?1:1-Math.pow(2,-10*t)},expoInOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))},circIn:function(t){return 1-Math.sqrt(1-t*t)},circOut:function(t){return Math.sqrt(1- --t*t)},circInOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)},elasticIn:function(t){var e,i=.1;return 0===t?0:1===t?1:(!i||i<1?(i=1,e=.1):e=.4*Math.asin(1/i)/(2*Math.PI),-i*Math.pow(2,10*(t-=1))*Math.sin((t-e)*(2*Math.PI)/.4))},elasticOut:function(t){var e,i=.1;return 0===t?0:1===t?1:(!i||i<1?(i=1,e=.1):e=.4*Math.asin(1/i)/(2*Math.PI),i*Math.pow(2,-10*t)*Math.sin((t-e)*(2*Math.PI)/.4)+1)},elasticInOut:function(t){var e,i=.1;return 0===t?0:1===t?1:(!i||i<1?(i=1,e=.1):e=.4*Math.asin(1/i)/(2*Math.PI),(t*=2)<1?i*Math.pow(2,10*(t-=1))*Math.sin((t-e)*(2*Math.PI)/.4)*-.5:i*Math.pow(2,-10*(t-=1))*Math.sin((t-e)*(2*Math.PI)/.4)*.5+1)},backIn:function(t){return t*t*(2.70158*t-1.70158)},backOut:function(t){return--t*t*(2.70158*t+1.70158)+1},backInOut:function(t){return(t*=2)<1?t*t*(3.5949095*t-2.5949095)*.5:.5*((t-=2)*t*(3.5949095*t+2.5949095)+2)},bounceOut:function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},smooth:function(t){return t<=0?0:t>=1?1:t*t*(3-2*t)},fade:function(t){return t<=0?0:t>=1?1:t*t*t*(t*(6*t-15)+10)}};r.quadOutIn=n(r.quadIn,r.quadOut),r.cubicOutIn=n(r.cubicIn,r.cubicOut),r.quartOutIn=n(r.quartIn,r.quartOut),r.quintOutIn=n(r.quintIn,r.quintOut),r.sineOutIn=n(r.sineIn,r.sineOut),r.expoOutIn=n(r.expoIn,r.expoOut),r.circOutIn=n(r.circIn,r.circOut),r.backOutIn=n(r.backIn,r.backOut),r.backOutIn=n(r.backIn,r.backOut),r.bounceIn=function(t){return 1-r.bounceOut(1-t)},r.bounceInOut=function(t){return t<.5?.5*r.bounceIn(2*t):.5*r.bounceOut(2*t-1)+.5},r.bounceOutIn=n(r.bounceIn,r.bounceOut),cc.Easing=e.exports=r}),{}],19:[(function(t,e,i){t("./bezier"),t("./easing"),t("./types"),t("./motion-path-helper"),t("./animation-curves"),t("./animation-clip"),t("./animation-manager"),t("./animation-state"),t("./animation-animator")}),{"./animation-animator":12,"./animation-clip":13,"./animation-curves":14,"./animation-manager":15,"./animation-state":16,"./bezier":17,"./easing":18,"./motion-path-helper":20,"./types":22}],20:[(function(t,e,i){function n(t){this.points=t||[],this.beziers=[],this.ratios=[],this.progresses=[],this.length=0,this.computeBeziers()}function r(){this.start=l(),this.end=l(),this.startCtrlPoint=l(),this.endCtrlPoint=l()}function s(t,e,i,r){function s(t){return t instanceof cc.Vec2?{in:t,pos:t,out:t}:Array.isArray(t)&&6===t.length?{in:l(t[2],t[3]),pos:l(t[0],t[1]),out:l(t[4],t[5])}:{in:cc.Vec2.ZERO,pos:cc.Vec2.ZERO,out:cc.Vec2.ZERO}}function c(t,e,i){m.push(t),f.push(e),p.push(i)}var _=e.values;if(0!==t.length&&0!==_.length)if(1!==(_=_.map((function(t){return l(t[0],t[1])}))).length){for(var u=e.types,d=e.ratios,m=e.values=[],f=e.types=[],p=e.ratios=[],g=0,v=o.Linear,y=0,x=t.length;y<x-1;y++){var C,A=t[y],T=d[y],b=d[y+1]-T,w=_[y],S=_[y+1],E=u[y],I=[],R=g/b,P=1/(b*i*r);if(A&&A.length>0){var B=[];B.push(s(w));for(var L=0,O=A.length;L<O;L++){var D=s(A[L]);B.push(D)}B.push(s(S));var N=new n(B);N.computeBeziers();for(var M=N.progresses;1-R>1e-6;){var F,z,G,V;if((C=a(C=R,E))<0)V=(0-C)*(z=N.beziers[0]).getLength(),G=z.start.sub(z.endCtrlPoint).normalize(),F=z.start.add(G.mul(V));else if(C>1)V=(C-1)*(z=N.beziers[N.beziers.length-1]).getLength(),G=z.end.sub(z.startCtrlPoint).normalize(),F=z.end.add(G.mul(V));else{var k=h(M,C);k<0&&(k=~k),C-=k>0?M[k-1]:0,C/=N.ratios[k],F=N.beziers[k].getPointAt(C)}I.push(F),R+=P}}else for(;1-R>1e-6;)C=a(C=R,E),I.push(w.lerp(S,C)),R+=P;v="constant"===E?E:o.Linear;for(L=0,O=I.length;L<O;L++){var W=T+g+P*L*b;c(I[L],v,W)}g=Math.abs(R-1)>1e-6?(R-1)*b:0}d[d.length-1]!==p[p.length-1]&&c(_[_.length-1],v,d[d.length-1])}else e.values=_}var o=t("./animation-curves").DynamicAnimCurve,a=t("./animation-curves").computeRatioByType,c=t("./bezier").bezier,h=t("../core/utils/binary-search").binarySearchEpsilon,l=cc.v2;n.prototype.computeBeziers=function(){this.beziers.length=0,this.ratios.length=0,this.progresses.length=0,this.length=0;for(var t,e=1;e<this.points.length;e++){var i=this.points[e-1],n=this.points[e];(t=new r).start=i.pos,t.startCtrlPoint=i.out,t.end=n.pos,t.endCtrlPoint=n.in,this.beziers.push(t),this.length+=t.getLength()}var s=0;for(e=0;e<this.beziers.length;e++)t=this.beziers[e],this.ratios[e]=t.getLength()/this.length,this.progresses[e]=s+=this.ratios[e];return this.beziers},r.prototype.getPointAt=function(t){var e=this.getUtoTmapping(t);return this.getPoint(e)},r.prototype.getPoint=function(t){var e=c(this.start.x,this.startCtrlPoint.x,this.endCtrlPoint.x,this.end.x,t),i=c(this.start.y,this.startCtrlPoint.y,this.endCtrlPoint.y,this.end.y,t);return new l(e,i)},r.prototype.getLength=function(){var t=this.getLengths();return t[t.length-1]},r.prototype.getLengths=function(t){if(t||(t=this.__arcLengthDivisions?this.__arcLengthDivisions:200),this.cacheArcLengths&&this.cacheArcLengths.length===t+1)return this.cacheArcLengths;var e,i,n=[],r=this.getPoint(0),s=0;for(n.push(0),i=1;i<=t;i++)e=this.getPoint(i/t),s+=cc.pDistance(e,r),n.push(s),r=e;return this.cacheArcLengths=n,n},r.prototype.getUtoTmapping=function(t,e){var i,n=this.getLengths(),r=0,s=n.length;i=e||t*n[s-1];for(var o,a=0,c=s-1;a<=c;)if(r=Math.floor(a+(c-a)/2),(o=n[r]-i)<0)a=r+1;else{if(!(o>0)){c=r;break}c=r-1}if(r=c,n[r]===i){return r/(s-1)}var h=n[r];return(r+(i-h)/(n[r+1]-h))/(s-1)},e.exports={sampleMotionPaths:s,Curve:n,Bezier:r}}),{"../core/utils/binary-search":202,"./animation-curves":14,"./bezier":17}],21:[(function(t,e,i){function n(){this._isPlaying=!1,this._isPaused=!1,this._stepOnce=!1}var r=cc.js,s=n.prototype;r.get(s,"isPlaying",(function(){return this._isPlaying}),!0),r.get(s,"isPaused",(function(){return this._isPaused}),!0);var o=function(){};s.onPlay=o,s.onPause=o,s.onResume=o,s.onStop=o,s.onError=o,s.play=function(){this._isPlaying?this._isPaused?(this._isPaused=!1,this.onResume()):this.onError("already-playing"):(this._isPlaying=!0,this.onPlay())},s.stop=function(){this._isPlaying&&(this._isPlaying=!1,this.onStop(),this._isPaused=!1)},s.pause=function(){this._isPlaying&&!this._isPaused&&(this._isPaused=!0,this.onPause())},s.resume=function(){this._isPlaying&&this._isPaused&&(this._isPaused=!1,this.onResume())},s.step=function(){this.pause(),this._stepOnce=!0,this._isPlaying||this.play()},e.exports=n}),{}],22:[(function(t,e,i){function n(t){t?this.set(t):(this.ratio=0,this.time=0,this.direction=1,this.stopped=!0,this.iterations=0,this.frameIndex=void 0)}cc.js;var r={Loop:2,ShouldWrap:4,PingPong:22,Reverse:36},s=cc.Enum({Default:0,Normal:1,Reverse:r.Reverse,Loop:r.Loop,LoopReverse:r.Loop|r.Reverse,PingPong:r.PingPong,PingPongReverse:r.PingPong|r.Reverse});cc.WrapMode=s,n.prototype.set=function(t){this.ratio=t.ratio,this.time=t.time,this.direction=t.direction,this.stopped=t.stopped,this.iterations=t.iterations,this.frameIndex=t.frameIndex},e.exports={WrapModeMask:r,WrapMode:s,WrappedInfo:n}}),{}],23:[(function(t,e,i){var n=t("../core/event/event-target"),r=t("../core/platform/CCSys"),s=!1,o=[],a=function(t){n.call(this),this._src=t,this._audioType=a.Type.UNKNOWN,this._element=null,this._eventList={},this._state=a.State.INITIALZING,this._loaded=!1,this._onended=function(){this.emit("ended")}.bind(this)};cc.js.extend(a,n),a.Type={DOM:"AUDIO",WEBAUDIO:"WEBAUDIO",NATIVE:"NATIVE",UNKNOWN:"UNKNOWN"},a.State={ERROR:-1,INITIALZING:0,PLAYING:1,PAUSED:2},(function(t){t.preload=function(){var t=this._src,e=this;if(!t)return this._src="",this._audioType=a.Type.UNKNOWN,this._element=null,this._state=a.State.INITIALZING,void(this._loaded=!1);if(!this._element){var i=cc.loader.getItem(t);if(i||(i=cc.loader.getItem(t+"?useDom=1")),!i||!i.complete)return cc.loader.load(t,(function(i){if(!i){var n=cc.loader.getItem(t);e.mount(n.element||n.buffer),e.emit("load")}}));e.mount(i.element||i.buffer),e.emit("load")}},t._bindEnded=function(t){t=t||this._onended,this._audioType===a.Type.DOM?this._element.addEventListener("ended",t):this._element.onended=t},t._unbindEnded=function(){this._audioType===a.Type.DOM?this._element.removeEventListener("ended",this._onended):this._element.onended=null},t.mount=function(t){t instanceof HTMLElement?(this._element=document.createElement("audio"),this._element.src=t.src,this._audioType=a.Type.DOM):(this._element=new c(t,this),this._audioType=a.Type.WEBAUDIO),this._state=a.State.INITIALZING,this._loaded=!0},t.play=function(){this._element&&(this._bindEnded(),this._element.play(),this.emit("play"),this._state=a.State.PLAYING,s||(s=!0,cc.game.canvas.addEventListener("touchstart",(function(){for(var t;t=o.pop();)t.audio.play(t.offset)}))))},t.destroy=function(){this._element&&this._element.destroy()},t.pause=function(){this._element&&(this._unbindEnded(),this._element.pause(),this.emit("pause"),this._state=a.State.PAUSED)},t.resume=function(){this._element&&this._state!==a.State.PLAYING&&(this._bindEnded(),this._element.play(),this.emit("resume"),this._state=a.State.PLAYING)},t.stop=function(){if(this._element){try{this._element.currentTime=0}catch(t){}this._element.pause();for(var t=0;t<o.length;t++)if(o[t].instance===this){o.splice(t,1);break}this._unbindEnded(),this.emit("stop"),this._state=a.State.PAUSED}},t.setLoop=function(t){this._element&&(this._element.loop=t)},t.getLoop=function(){return this._element&&this._element.loop},t.setVolume=function(t){this._element&&(this._element.volume=t)},t.getVolume=function(){return this._element?this._element.volume:1},t.setCurrentTime=function(t){if(this._element){this._unbindEnded();try{this._element.currentTime=t}catch(n){var e=this._element;if(e.addEventListener){var i=function(){e.removeEventListener("loadedmetadata",i),e.currentTime=t};e.addEventListener("loadedmetadata",i)}}}},t.getCurrentTime=function(){return this._element?this._element.currentTime:0},t.getDuration=function(){return this._element?this._element.duration:0},t.getState=function(){var t=this._element;return a.State.PLAYING===this._state&&t.paused&&(this._state=a.State.PAUSED),this._state},t.__defineGetter__("src",(function(){return this._src})),t.__defineSetter__("src",(function(t){return this._src=t})),t.__defineGetter__("paused",(function(){return!this._element||this._element.paused}))})(a.prototype);var c=function(t,e){this._audio=e,this._context=r.__audioSupport.context,this._buffer=t,this._gainObj=this._context.createGain(),this._volume=1,this._gainObj.gain.setTargetAtTime?this._gainObj.gain.setTargetAtTime(this._volume,this._context.currentTime,.01):this._gainObj.gain.value=1,this._gainObj.connect(this._context.destination),this._loop=!1,this._startTime=-1,this._currentSource=null,this.playedLength=0,this._currextTimer=null,this._endCallback=function(){this.onended&&this.onended(this)}.bind(this)};(function(t){t.play=function(t){this._currentSource&&!this.paused&&(this._currentSource.onended=null,this._currentSource.stop(0),this.playedLength=0);var e=this._context.createBufferSource();e.buffer=this._buffer,e.connect(this._gainObj),e.loop=this._loop,this._startTime=this._context.currentTime,(t=t||this.playedLength)&&(this._startTime-=t);var i,n=this._buffer.duration,r=t;if(this._loop?e.start?e.start(0,r):e.notoGrainOn?e.noteGrainOn(0,r):e.noteOn(0,r):(i=n-t,e.start?e.start(0,r,i):e.notoGrainOn?e.noteGrainOn(0,r,i):e.noteOn(0,r,i)),this._currentSource=e,e.onended=this._endCallback,(!e.context.state||"suspended"===e.context.state)&&0===this._context.currentTime){clearTimeout(this._currextTimer),this._currextTimer=setTimeout((function(){0}),10)}},t.pause=function(){if(clearTimeout(this._currextTimer),!this.paused){this.playedLength=this._context.currentTime-this._startTime,this.playedLength%=this._buffer.duration;var t=this._currentSource;this._currentSource=null,this._startTime=-1,t&&t.stop(0)}},t.__defineGetter__("paused",(function(){return(!this._currentSource||!this._currentSource.loop)&&(-1===this._startTime||this._context.currentTime-this._startTime>this._buffer.duration)})),t.__defineGetter__("loop",(function(){return this._loop})),t.__defineSetter__("loop",(function(t){return this._currentSource&&(this._currentSource.loop=t),this._loop=t})),t.__defineGetter__("volume",(function(){return this._volume})),t.__defineSetter__("volume",(function(t){return this._volume=t,this._gainObj.gain.setTargetAtTime?this._gainObj.gain.setTargetAtTime(this._volume,this._context.currentTime,.01):this._volume.gain.value=t,r.os===r.OS_IOS&&!this.paused&&this._currentSource&&(this._currentSource.onended=null,this.pause(),this.play()),t})),t.__defineGetter__("currentTime",(function(){return this.paused?this.playedLength:(this.playedLength=this._context.currentTime-this._startTime,this.playedLength%=this._buffer.duration,this.playedLength)})),t.__defineSetter__("currentTime",(function(t){return this.paused?this.playedLength=t:(this.pause(),this.playedLength=t,this.play()),t})),t.__defineGetter__("duration",(function(){return this._buffer.duration}))})(c.prototype),e.exports=cc.Audio=a}),{"../core/event/event-target":92,"../core/platform/CCSys":165}],24:[(function(t,e,i){var n=t("./CCAudio"),r=0,s={},o={},a=function(t){return s[t]},c={AudioState:n.State,_maxWebAudioSize:2097152,_maxAudioInstance:24,_id2audio:s,play:function(t,e,i){var a=(function(t){var e=r++,i=o[t];i||(i=o[t]=[]);var a;if(c._maxAudioInstance<=i.length){var h=i.shift(),l=s[h];l.stop(),l.destroy()}var _=function(){var t=this.instanceId;delete s[t];var e=i.indexOf(t);cc.js.array.fastRemoveAt(i,e)};return(a=new n(t)).on("ended",_),a.on("stop",_),s[e]=a,a.instanceId=e,i.push(e),a})(t),h=function(){a.setLoop(e||!1),("number"!=typeof i||isNaN(i))&&(i=1),a.setVolume(i),a.play()};return a.__callback=h,a.on("load",h),a.preload(),a.instanceId},setLoop:function(t,e){var i=a(t);i&&i.setLoop&&i.setLoop(e)},isLoop:function(t){var e=a(t);return!(!e||!e.isLoop)&&e.isLoop()},setVolume:function(t,e){var i=a(t);i&&(i._loaded||i.once("load",(function(){i.setVolume&&i.setVolume(e)})),i.setVolume&&i.setVolume(e))},getVolume:function(t){var e=a(t);return e&&e.getVolume?e.getVolume():1},setCurrentTime:function(t,e){var i=a(t);return!!i&&(i._loaded?(i.setCurrentTime&&i.setCurrentTime(e),!0):(i.once("load",(function(){i.setCurrentTime&&i.setCurrentTime(e)})),!0))},getCurrentTime:function(t){var e=a(t);return e&&e.getCurrentTime?e.getCurrentTime():0},getDuration:function(t){var e=a(t);return e&&e.getDuration?e.getDuration():0},getState:function(t){var e=a(t);return e&&e.getState?e.getState():this.AudioState.ERROR},setFinishCallback:function(t,e){var i=a(t);i&&(i.off("ended",i._finishCallback),i._finishCallback=e,i.on("ended",i._finishCallback))},pause:function(t){var e=a(t);return!(!e||!e.pause)&&(e.pause(),!0)},_pauseIDCache:[],pauseAll:function(){for(var t in s){var e=s[t];e.getState()===n.State.PLAYING&&(this._pauseIDCache.push(t),e.pause())}},resume:function(t){var e=a(t);if(!e||!e.resume)return!1;e.resume()},resumeAll:function(){for(;this._pauseIDCache.length>0;){var t=this._pauseIDCache.pop(),e=a(t);e&&e.resume&&e.resume()}},stop:function(t){var e=a(t);return!(!e||!e.stop)&&(e.off("load",e.__callback),e.stop(),e.destroy(),!0)},stopAll:function(){for(var t in s){var e=s[t];e&&e.stop&&(e.stop(),e.destroy(),e.off("load",e.__callback))}},setMaxAudioInstance:function(t){return this._maxAudioInstance=t},getMaxAudioInstance:function(){return this._maxAudioInstance},uncache:function(t){var e=o[t];if(e)for(;e.length>0;){var i=e.pop(),n=s[i];n&&(n.stop(),n.destroy(),delete s[i])}},uncacheAll:function(){this.stopAll();for(var t in s){var e=s[t];e&&e.destroy()}s={},o={}},getProfile:function(t){},preload:function(t,e){cc.loader.load(t,e&&function(t){t||e()})},setMaxWebAudioSize:function(t){this._maxWebAudioSize=1024*t},_breakCache:null,_break:function(){this._breakCache=[];for(var t in s){var e=s[t];e.getState()===n.State.PLAYING&&(this._breakCache.push(t),e.pause())}},_restore:function(){if(this._breakCache){for(;this._breakCache.length>0;){var t=this._breakCache.pop(),e=a(t);e&&e.resume&&e.resume()}this._breakCache=null}}};e.exports=cc.audioEngine=c;var h=t("./deprecated");h.removed(c),h.deprecated(c)}),{"./CCAudio":23,"./deprecated":25}],25:[(function(t,e,i){var n=cc.js;i.removed=function(t){function e(){cc.errorID(1403)}n.getset(t,"willPlayMusic",e,e)},i.deprecated=function(t){var e=-1,i=1,r=1,s=[];n.get(t,"playMusic",(function(){return function(n,r){return t.stop(e),e=t.play(n,r,i),n,r,e}})),n.get(t,"stopMusic",(function(){return function(){return t.stop(e),e}})),n.get(t,"pauseMusic",(function(){return function(){return t.pause(e),e}})),n.get(t,"resumeMusic",(function(){return function(){return t.resume(e),e}})),n.get(t,"rewindMusic",(function(){return function(){return t.setCurrentTime(e,0),e}})),n.get(t,"getMusicVolume",(function(){return function(){return i}})),n.get(t,"setMusicVolume",(function(){return function(n){return i=n,t.setVolume(e,i),i}})),n.get(t,"isMusicPlaying",(function(){return function(){return t.getState(e)===t.AudioState.PLAYING}})),n.get(t,"playEffect",(function(){return function(e,i,n){return t.play(e,i||!1,void 0===n?r:n)}})),n.get(t,"setEffectsVolume",(function(i){return function(i){r=i;var n=t._id2audio;for(var s in n)s!==e&&t.setVolume(s,i)}})),n.get(t,"getEffectsVolume",(function(){return function(){return r}})),n.get(t,"pauseEffect",(function(){return function(e){return t.pause(e)}})),n.get(t,"pauseAllEffects",(function(){return function(){s.length=0;var i=t._id2audio;for(var n in i)if(n!==e){var r=i[n];r.getState()===t.AudioState.PLAYING&&(s.push(n),r.pause())}}})),n.get(t,"resumeEffect",(function(){return function(e){t.resume(e)}})),n.get(t,"resumeAllEffects",(function(){return function(){for(var e=t._id2audio;s.length>0;){var i=e[s.pop()];i&&i.resume&&i.resume()}}})),n.get(t,"stopEffect",(function(){return function(e){return t.stop(e)}})),n.get(t,"stopAllEffects",(function(){return function(){var i=t._id2audio;for(var n in i)if(n!==e){var r=i[n];r.getState()===t.AudioState.PLAYING&&r.stop()}}})),n.get(t,"unloadEffect",(function(){return function(e){return t.stop(e)}})),n.get(t,"end",(function(){return function(){return t.stopAll()}}))}}),{}],26:[(function(t,e,i){cc.ClippingNode=_ccsg.Node.extend({inverted:!1,_alphaThreshold:0,_stencil:null,_className:"ClippingNode",_originStencilProgram:null,ctor:function(t){t=t||null,_ccsg.Node.prototype.ctor.call(this),this._stencil=t,t&&(this._originStencilProgram=t.getShaderProgram()),this.alphaThreshold=1,this.inverted=!1,this._renderCmd.initStencilBits()},onEnter:function(){_ccsg.Node.prototype.onEnter.call(this),this._stencil&&this._stencil.performRecursive(_ccsg.Node.performType.onEnter)},onEnterTransitionDidFinish:function(){_ccsg.Node.prototype.onEnterTransitionDidFinish.call(this),this._stencil&&this._stencil.performRecursive(_ccsg.Node.performType.onEnterTransitionDidFinish)},onExitTransitionDidStart:function(){this._stencil&&this._stencil.performRecursive(_ccsg.Node.performType.onExitTransitionDidStart),_ccsg.Node.prototype.onExitTransitionDidStart.call(this)},onExit:function(){this._stencil&&this._stencil.performRecursive(_ccsg.Node.performType.onExit),_ccsg.Node.prototype.onExit.call(this)},visit:function(t){this._renderCmd.clippingVisit(t&&t._renderCmd)},_visitChildren:function(){this._reorderChildDirty&&this.sortAllChildren();for(var t,e=this._children,i=0,n=e.length;i<n;i++)(t=e[i])&&t._visible&&t.visit(this);this._renderCmd._dirtyFlag=0},getAlphaThreshold:function(){return this._alphaThreshold},setAlphaThreshold:function(t){1===t&&t!==this._alphaThreshold&&this._renderCmd.resetProgramByStencil(),this._alphaThreshold=t},isInverted:function(){return this.inverted},setInverted:function(t){this.inverted=t},getStencil:function(){return this._stencil},setStencil:function(t){this._stencil!==t&&(t&&(this._originStencilProgram=t.getShaderProgram()),this._renderCmd.setStencil(t))},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_CANVAS?new cc.ClippingNode.CanvasRenderCmd(this):new cc.ClippingNode.WebGLRenderCmd(this)}}),cc.ClippingNode.stencilBits=-1;var n=cc.ClippingNode.prototype;cc.defineGetterSetter(n,"stencil",n.getStencil,n.setStencil),cc.defineGetterSetter(n,"alphaThreshold",n.getAlphaThreshold,n.setAlphaThreshold)}),{}],27:[(function(t,e,i){t("../shape-nodes/CCDrawNode"),cc.ClippingNode.CanvasRenderCmd=function(t){this._rootCtor(t),this._needDraw=!1,this._rendererClipCmd=new cc.CustomRenderCmd(this,this._drawStencilCommand),this._rendererRestoreCmd=new cc.CustomRenderCmd(this,this._restoreCmdCallback)};var n=cc.ClippingNode.CanvasRenderCmd.prototype=Object.create(_ccsg.Node.CanvasRenderCmd.prototype);n.constructor=cc.ClippingNode.CanvasRenderCmd,n.resetProgramByStencil=function(){},n.initStencilBits=function(){},n.setStencil=function(t){null!=t&&(this._node._stencil=t,t instanceof cc.DrawNode||cc.errorID(6300))},n._restoreCmdCallback=function(t){(t||cc._renderContext).restore()},n._drawStencilCommand=function(t,e,i){var n=t||cc._renderContext,r=n.getContext();n.save(),r.beginPath(),n.setTransform(this._worldTransform,e,i);for(var s=this._node._stencil._buffer,o=0;o<s.length;++o){var a=s[o].verts;if(!(a.length<3)){r.moveTo(a[0].x,-a[0].y);for(var c=1;c<a.length;++c)r.lineTo(a[c].x,-a[c].y)}}r.clip()},n.clippingVisit=function(t){var e=this._node;if(t=t||this.getParentRenderCmd(),this._propagateFlagsDown(t),e._visible){t&&(this._curLevel=t._curLevel+1),this._syncStatus(t),e._stencil&&cc.renderer.pushRenderCommand(this._rendererClipCmd);var i,n=e._children,r=n.length;if(r>0)for(e.sortAllChildren(),i=0;i<r;i++)n[i].visit(e);e._stencil&&cc.renderer.pushRenderCommand(this._rendererRestoreCmd),this._dirtyFlag=0}}}),{"../shape-nodes/CCDrawNode":241}],28:[(function(t,e,i){function n(t,e){t.shaderProgram=e;var i=t.children;if(i)for(var r=0;r<i.length;r++)n(i[r],e)}t("../core/CCDrawingPrimitives");var r={stencilEnabled:!1,depthWriteMask:!0};cc.ClippingNode.WebGLRenderCmd=function(t){this._rootCtor(t),this._needDraw=!1,this._beforeVisitCmd=new cc.CustomRenderCmd(this,this._onBeforeVisit),this._afterDrawStencilCmd=new cc.CustomRenderCmd(this,this._onAfterDrawStencil),this._afterVisitCmd=new cc.CustomRenderCmd(this,this._onAfterVisit),this._previousState=null,this._state={stencilEnabled:!0,stencilWriteMask:0,depthWriteMask:!1,stencilFunc:0,stencilRef:0,stencilValueMask:0}};var s=cc.ClippingNode.WebGLRenderCmd.prototype=Object.create(_ccsg.Node.WebGLRenderCmd.prototype);s.constructor=cc.ClippingNode.WebGLRenderCmd,cc.ClippingNode.WebGLRenderCmd._init_once=null,cc.ClippingNode.WebGLRenderCmd._visit_once=null,cc.ClippingNode.WebGLRenderCmd._layer=-1,s.initStencilBits=function(){cc.ClippingNode.WebGLRenderCmd._init_once=!0,cc.ClippingNode.WebGLRenderCmd._init_once&&(cc.ClippingNode.stencilBits=cc._renderContext.getParameter(cc._renderContext.STENCIL_BITS),cc.ClippingNode.stencilBits<=0&&cc.logID(6301),cc.ClippingNode.WebGLRenderCmd._init_once=!1)},s.transform=function(t,e){var i=this._node;this.originTransform(t,e),i._stencil&&(i._stencil._renderCmd.transform(this,!0),i._stencil._dirtyFlag&=~_ccsg.Node._dirtyFlags.transformDirty)},s.clippingVisit=function(t){var e=this._node;if(t=t||this.getParentRenderCmd(),this.visit(t),cc.ClippingNode.stencilBits<1)e._visitChildren();else if(e._stencil&&e._stencil.visible){if(cc.ClippingNode.WebGLRenderCmd._layer+1===cc.ClippingNode.stencilBits)return cc.ClippingNode.WebGLRenderCmd._visit_once=!0,cc.ClippingNode.WebGLRenderCmd._visit_once&&(cc.logID(6302,cc.ClippingNode.stencilBits),cc.ClippingNode.WebGLRenderCmd._visit_once=!1),void e._visitChildren();cc.renderer.pushRenderCommand(this._beforeVisitCmd),e._stencil.visit(e),cc.renderer.pushRenderCommand(this._afterDrawStencilCmd);var i=e._children;if(i&&i.length>0){var n=i.length;e.sortAllChildren();for(var r=0;r<n;r++)i[r].visit(e)}cc.renderer.pushRenderCommand(this._afterVisitCmd),this._dirtyFlag=0}else e.inverted&&e._visitChildren()},s.setStencil=function(t){var e=this._node;e._stencil&&(e._stencil._parent=null),e._stencil=t,e._stencil&&(e._stencil._parent=e)},s._drawFullScreenQuadClearStencil=function(){var t=cc.math.projection_matrix_stack;t.push(),t.top.identity();var e=cc.math.modelview_matrix_stack;e.push(),e.top.identity(),cc._drawingUtil.drawSolidRect(cc.p(-1,-1),cc.p(1,1),cc.color(255,255,255,255)),t.pop(),e.pop()},s.resetProgramByStencil=function(){var t=this._node;if(t._stencil){var e=t._originStencilProgram;n(t._stencil,e)}},s._onBeforeVisit=function(t){var e=t||cc._renderContext,i=this._node;cc.ClippingNode.WebGLRenderCmd._layer++;var s=1<<cc.ClippingNode.WebGLRenderCmd._layer,o=s|s-1;if(this._previousState=r,e.enable(e.STENCIL_TEST),e.stencilMask(s),e.depthMask(!1),e.stencilFunc(e.NEVER,s,s),e.stencilOp(this._node.inverted?e.REPLACE:e.ZERO,e.KEEP,e.KEEP),this._drawFullScreenQuadClearStencil(),e.stencilFunc(e.NEVER,s,s),e.stencilOp(this._node.inverted?e.ZERO:e.REPLACE,e.KEEP,e.KEEP),i.alphaThreshold<1){var a=cc.shaderCache.programForKey(cc.macro.SHADER_POSITION_TEXTURECOLORALPHATEST);cc.gl.useProgram(a.getProgram()),a.setUniformLocationWith1f(cc.macro.UNIFORM_ALPHA_TEST_VALUE_S,i.alphaThreshold),a.setUniformLocationWithMatrix4fv(cc.macro.UNIFORM_MVMATRIX_S,cc.renderer.mat4Identity.mat),n(i._stencil,a)}this._state.stencilWriteMask=s,this._state.stencilRef=this._state.stencilValueMask=o,this._state.stencilFunc=e.NEVER,r=this._state},s._onAfterDrawStencil=function(t){var e=t||cc._renderContext;e.depthMask(this._previousState.depthWriteMask),e.stencilFunc(e.EQUAL,this._state.stencilRef,this._state.stencilValueMask),e.stencilOp(e.KEEP,e.KEEP,e.KEEP),this._state.stencilFunc=e.EQUAL},s._onAfterVisit=function(t){var e=t||cc._renderContext,i=this._previousState;i.stencilEnabled?(e.stencilFunc(i.stencilFunc,i.stencilRef,i.stencilValueMask),e.stencilOp(e.KEEP,e.KEEP,e.KEEP),e.stencilMask(i.stencilWriteMask)):e.disable(e.STENCIL_TEST),r=this._previousState,this._previousState=null,cc.ClippingNode.WebGLRenderCmd._layer--}}),{"../core/CCDrawingPrimitives":33}],29:[(function(t,e,i){cc.configuration={ERROR:0,STRING:1,INT:2,DOUBLE:3,BOOLEAN:4,_maxTextureSize:0,_maxModelviewStackDepth:0,_supportsPVRTC:!1,_supportsNPOT:!1,_supportsBGRA8888:!1,_supportsDiscardFramebuffer:!1,_supportsShareableVAO:!1,_maxSamplesAllowed:0,_maxTextureUnits:0,_GlExtensions:"",_valueDict:{},_inited:!1,_init:function(){var t=this._valueDict;t["cocos2d.x.version"]=cc.ENGINE_VERSION,t["cocos2d.x.compiled_with_profiler"]=!1,t["cocos2d.x.compiled_with_gl_state_cache"]=cc.macro.ENABLE_GL_STATE_CACHE,this._inited=!0},getMaxTextureSize:function(){return this._maxTextureSize},getMaxModelviewStackDepth:function(){return this._maxModelviewStackDepth},getMaxTextureUnits:function(){return this._maxTextureUnits},supportsNPOT:function(){return this._supportsNPOT},supportsPVRTC:function(){return this._supportsPVRTC},supportsETC:function(){return!1},supportsS3TC:function(){return!1},supportsATITC:function(){return!1},supportsBGRA8888:function(){return this._supportsBGRA8888},supportsDiscardFramebuffer:function(){return this._supportsDiscardFramebuffer},supportsShareableVAO:function(){return this._supportsShareableVAO},checkForGLExtension:function(t){return this._GlExtensions.indexOf(t)>-1},getValue:function(t,e){this._inited||this._init();var i=this._valueDict;return i[t]?i[t]:e},setValue:function(t,e){this._valueDict[t]=e},gatherGPUInfo:function(){if(cc._renderType!==cc.game.RENDER_TYPE_CANVAS){this._inited||this._init();var t=cc._renderContext,e=this._valueDict;e["gl.vendor"]=t.getParameter(t.VENDOR),e["gl.renderer"]=t.getParameter(t.RENDERER),e["gl.version"]=t.getParameter(t.VERSION),this._GlExtensions="";for(var i=t.getSupportedExtensions(),n=0;n<i.length;n++)this._GlExtensions+=i[n]+" ";this._maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),e["gl.max_texture_size"]=this._maxTextureSize,this._maxTextureUnits=t.getParameter(t.MAX_COMBINED_TEXTURE_IMAGE_UNITS),e["gl.max_texture_units"]=this._maxTextureUnits,this._supportsPVRTC=this.checkForGLExtension("GL_IMG_texture_compression_pvrtc"),e["gl.supports_PVRTC"]=this._supportsPVRTC,this._supportsNPOT=!0,e["gl.supports_NPOT"]=this._supportsNPOT,this._supportsBGRA8888=this.checkForGLExtension("GL_IMG_texture_format_BGRA888"),e["gl.supports_BGRA8888"]=this._supportsBGRA8888,this._supportsDiscardFramebuffer=this.checkForGLExtension("GL_EXT_discard_framebuffer"),e["gl.supports_discard_framebuffer"]=this._supportsDiscardFramebuffer,this._supportsShareableVAO=this.checkForGLExtension("vertex_array_object"),e["gl.supports_vertex_array_object"]=this._supportsShareableVAO,cc.checkGLErrorDebug()}},loadConfigFile:function(t){this._inited||this._init();var e=cc.loader.getRes(t);if(!e)throw new Error("Please load the resource first : "+t);cc.assertID(e,1101,t);var i=e.data;if(i)for(var n in i)this._valueDict[n]=i[n];else cc.logID(1100,t)}}}),{}],30:[(function(t,e,i){var n=t("./event/event-target"),r=t("./platform/_CCClass"),s=t("./load-pipeline/auto-release-utils"),o=t("./component-scheduler"),a=t("./node-activator"),c=t("./event/event-listeners"),h=t("./event-manager");cc.g_NumberOfDraws=0,cc.Director=r.extend({ctor:function(){var t=this;n.call(t),t._landscape=!1,t._nextDeltaTimeZero=!1,t._paused=!1,t._purgeDirectorInNextLoop=!1,t._sendCleanupToScene=!1,t._animationInterval=0,t._oldAnimationInterval=0,t._projection=0,t._projectionDelegate=null,t._contentScaleFactor=1,t._winSizeInPoints=null,t._openGLView=null,t._scenesStack=null,t._nextScene=null,t._loadingScene="",t._runningScene=null,t._scene=null,t._totalFrames=0,t._lastUpdate=Date.now(),t._deltaTime=0,t._dirtyRegion=null,t._scheduler=null,t._compScheduler=null,t._nodeActivator=null,t._actionManager=null,cc.game.on(cc.game.EVENT_SHOW,(function(){t._lastUpdate=Date.now()}))},init:function(){return this._oldAnimationInterval=this._animationInterval=1/cc.defaultFPS,this._scenesStack=[],this._projection=cc.Director.PROJECTION_DEFAULT,this._projectionDelegate=null,this._totalFrames=0,this._lastUpdate=Date.now(),this._paused=!1,this._purgeDirectorInNextLoop=!1,this._winSizeInPoints=cc.size(0,0),this._openGLView=null,this._contentScaleFactor=1,this._scheduler=new cc.Scheduler,cc.ActionManager?(this._actionManager=new cc.ActionManager,this._scheduler.scheduleUpdate(this._actionManager,cc.Scheduler.PRIORITY_SYSTEM,!1)):this._actionManager=null,this.sharedInit(),!0},sharedInit:function(){this._compScheduler=new o,this._nodeActivator=new a,cc.AnimationManager?(this._animationManager=new cc.AnimationManager,this._scheduler.scheduleUpdate(this._animationManager,cc.Scheduler.PRIORITY_SYSTEM,!1)):this._animationManager=null,cc.CollisionManager?(this._collisionManager=new cc.CollisionManager,this._scheduler.scheduleUpdate(this._collisionManager,cc.Scheduler.PRIORITY_SYSTEM,!1)):this._collisionManager=null,cc.PhysicsManager?(this._physicsManager=new cc.PhysicsManager,this._scheduler.scheduleUpdate(this._physicsManager,cc.Scheduler.PRIORITY_SYSTEM,!1)):this._physicsManager=null,cc._widgetManager&&cc._widgetManager.init(this),cc.loader.init(this)},calculateDeltaTime:function(){var t=Date.now();this._nextDeltaTimeZero?(this._deltaTime=0,this._nextDeltaTimeZero=!1):(this._deltaTime=(t-this._lastUpdate)/1e3,cc.game.config[cc.game.CONFIG_KEY.debugMode]>0&&this._deltaTime>1&&(this._deltaTime=1/60)),this._lastUpdate=t},convertToGL:function(t){var e=cc.game.container,i=cc.view,n=e.getBoundingClientRect(),r=n.left+window.pageXOffset-e.clientLeft,s=n.top+window.pageYOffset-e.clientTop,o=i._devicePixelRatio*(t.x-r),a=i._devicePixelRatio*(s+n.height-t.y);return i._isRotated?{x:i._viewPortRect.width-a,y:o}:{x:o,y:a}},convertToUI:function(t){var e=cc.game.container,i=cc.view,n=e.getBoundingClientRect(),r=n.left+window.pageXOffset-e.clientLeft,s=n.top+window.pageYOffset-e.clientTop,o={x:0,y:0};return i._isRotated?(o.x=r+t.y/i._devicePixelRatio,o.y=s+n.height-(i._viewPortRect.width-t.x)/i._devicePixelRatio):(o.x=r+t.x*i._devicePixelRatio,o.y=s+n.height-t.y*i._devicePixelRatio),o},_visitScene:function(){if(this._runningScene){var t=cc.renderer;t.childrenOrderDirty?(t.clearRenderCommands(),cc.renderer.assignedZ=0,this._runningScene._renderCmd._curLevel=0,this._runningScene.visit(),t.resetFlag()):t.transformDirty()&&t.transform()}},end:function(){this._purgeDirectorInNextLoop=!0},getContentScaleFactor:function(){return this._contentScaleFactor},getWinSize:function(){return cc.size(this._winSizeInPoints)},getWinSizeInPixels:function(){return cc.size(this._winSizeInPoints.width*this._contentScaleFactor,this._winSizeInPoints.height*this._contentScaleFactor)},getVisibleSize:null,getVisibleOrigin:null,getZEye:null,pause:function(){this._paused||(this._oldAnimationInterval=this._animationInterval,this.setAnimationInterval(.25),this._paused=!0)},popScene:function(){cc.assertID(this._runningScene,1204),this._scenesStack.pop();var t=this._scenesStack.length;0===t?this.end():(this._sendCleanupToScene=!0,this._nextScene=this._scenesStack[t-1])},purgeCachedData:function(){cc.textureCache._clear(),cc.loader.releaseAll()},purgeDirector:function(){this.getScheduler().unscheduleAll(),this._compScheduler.unscheduleAll(),this._nodeActivator.reset(),h&&h.setEnabled(!1),this._runningScene&&(this._runningScene.performRecursive(_ccsg.Node.performType.onExitTransitionDidStart),this._runningScene.performRecursive(_ccsg.Node.performType.onExit),this._runningScene.performRecursive(_ccsg.Node.performType.cleanup),cc.renderer.clearRenderCommands()),this._runningScene=null,this._nextScene=null,this._scenesStack.length=0,this.stopAnimation(),this.purgeCachedData()},reset:function(){this.purgeDirector(),h&&h.setEnabled(!0),this._actionManager&&this._scheduler.scheduleUpdate(this._actionManager,cc.Scheduler.PRIORITY_SYSTEM,!1),this._animationManager&&this._scheduler.scheduleUpdate(this._animationManager,cc.Scheduler.PRIORITY_SYSTEM,!1),this._collisionManager&&this._scheduler.scheduleUpdate(this._collisionManager,cc.Scheduler.PRIORITY_SYSTEM,!1),this._physicsManager&&this._scheduler.scheduleUpdate(this._physicsManager,cc.Scheduler.PRIORITY_SYSTEM,!1),this.startAnimation()},pushScene:function(t){cc.assertID(t,1205),this._sendCleanupToScene=!1,this._scenesStack.push(t),this._nextScene=t},runSceneImmediate:function(t,e,i){t instanceof cc.Scene&&t._load();for(var n=cc.game,r=Object.keys(n._persistRootNodes).map((function(t){return n._persistRootNodes[t]})),o=0;o<r.length;o++){var a=r[o];n._ignoreRemovePersistNode=a,a.parent=null,n._ignoreRemovePersistNode=null}var c=this._scene,h=c&&c.autoReleaseAssets&&c.dependAssets;s.autoRelease(h,t.dependAssets,r),cc.isValid(c)&&c.destroy(),this._scene=null,cc.Object._deferredDestroy(),e&&e(),this.emit(cc.Director.EVENT_BEFORE_SCENE_LAUNCH,t);var l=t;if(t instanceof cc.Scene){this._scene=t,l=t._sgNode;for(var _=0;_<r.length;_++){var u=r[_],d=t.getChildByUuid(u.uuid);if(d){var m=d.getSiblingIndex();d._destroyImmediate(),t.insertChild(u,m)}else u.parent=t}t._activate()}if(this._runningScene){var f=this._scenesStack.length;this._scenesStack[Math.max(f-1,0)]=l,this._sendCleanupToScene=!0,this._nextScene=l}else this.pushScene(l),this.startAnimation();this._nextScene&&this.setNextScene(),i&&i(null,t),this.emit(cc.Director.EVENT_AFTER_SCENE_LAUNCH,t)},runScene:function(t,e,i){cc.assertID(t,1205),t instanceof cc.Scene&&t._load(),this.once(cc.Director.EVENT_AFTER_UPDATE,(function(){this.runSceneImmediate(t,e,i)}))},_getSceneUuid:function(t){var e=cc.game._sceneInfos;if("string"==typeof t){t.endsWith(".fire")||(t+=".fire"),"/"===t[0]||t.startsWith("db://assets/")||(t="/"+t);for(var i=0;i<e.length;i++){var n=e[i];if(n.url.endsWith(t))return n}}else if("number"==typeof t){if(0<=t&&t<e.length)return e[t];cc.errorID(1206,t)}else cc.errorID(1207,t);return null},loadScene:function(t,e,i){if(this._loadingScene)return cc.errorID(1208,t,this._loadingScene),!1;var n=this._getSceneUuid(t);if(n){var r=n.uuid;this.emit(cc.Director.EVENT_BEFORE_SCENE_LOADING,t),this._loadingScene=t;return this._loadSceneByUuid(r,e,i),!0}return cc.errorID(1209,t),!1},preloadScene:function(t,e){var i=this._getSceneUuid(t);if(i)this.emit(cc.Director.EVENT_BEFORE_SCENE_LOADING,t),cc.loader.load({uuid:i.uuid,type:"uuid"},(function(i,n){i&&cc.errorID(1210,t,i.message),e&&e(i,n)}));else{var n='Can not preload the scene "'+t+'" because it is not in the build settings.';e(new Error(n)),cc.error("preloadScene: "+n)}},_loadSceneByUuid:function(t,e,i,n){console.time("LoadScene "+t),cc.AssetLibrary.loadAsset(t,(function(n,r){console.timeEnd("LoadScene "+t);var s=cc.director;if(s._loadingScene="",n)n="Failed to load scene: "+n,cc.error(n);else{if(r instanceof cc.SceneAsset){var o=r.scene;return o._id=r._uuid,o._name=r._name,void s.runSceneImmediate(o,i,e)}n="The asset "+t+" is not a scene",cc.error(n)}e&&e(n)}))},resume:function(){this._paused&&(this.setAnimationInterval(this._oldAnimationInterval),this._lastUpdate=Date.now(),this._lastUpdate||cc.logID(1200),this._paused=!1,this._deltaTime=0)},setContentScaleFactor:function(t){t!==this._contentScaleFactor&&(this._contentScaleFactor=t)},setDepthTest:null,setClearColor:null,setDefaultValues:function(){},setNextDeltaTimeZero:function(t){this._nextDeltaTimeZero=t},setNextScene:function(){var t=!1,e=!1;if(cc.TransitionScene&&(t=!!this._runningScene&&this._runningScene instanceof cc.TransitionScene,e=!!this._nextScene&&this._nextScene instanceof cc.TransitionScene),!e){var i=this._runningScene;i&&(i.performRecursive(_ccsg.Node.performType.onExitTransitionDidStart),i.performRecursive(_ccsg.Node.performType.onExit)),this._sendCleanupToScene&&i&&i.performRecursive(_ccsg.Node.performType.cleanup)}this._runningScene=this._nextScene,cc.renderer.childrenOrderDirty=!0,this._nextScene=null,t||null===this._runningScene||(this._runningScene.performRecursive(_ccsg.Node.performType.onEnter),this._runningScene.performRecursive(_ccsg.Node.performType.onEnterTransitionDidFinish))},getDelegate:function(){return this._projectionDelegate},setDelegate:function(t){this._projectionDelegate=t},setOpenGLView:null,setProjection:null,setViewport:null,getOpenGLView:null,getProjection:null,setAlphaBlending:null,isSendCleanupToScene:function(){return this._sendCleanupToScene},getRunningScene:function(){return this._runningScene},getScene:function(){return this._scene},getAnimationInterval:function(){return this._animationInterval},isDisplayStats:function(){return!!cc.profiler&&cc.profiler.isShowingStats()},setDisplayStats:function(t){cc.profiler&&(t?cc.profiler.showStats():cc.profiler.hideStats(),cc.game.config[cc.game.CONFIG_KEY.showFPS]=!!t)},isNextDeltaTimeZero:function(){return this._nextDeltaTimeZero},isPaused:function(){return this._paused},getTotalFrames:function(){return this._totalFrames},popToRootScene:function(){this.popToSceneStackLevel(1)},popToSceneStackLevel:function(t){cc.assertID(this._runningScene,1203);var e=this._scenesStack,i=e.length;if(0!==i){if(!(t>i)){for(;i>t;){var n=e.pop();n.running&&(n.performRecursive(_ccsg.Node.performType.onExitTransitionDidStart),n.performRecursive(_ccsg.Node.performType.onExit)),n.performRecursive(_ccsg.Node.performType.cleanup),i--}this._nextScene=e[e.length-1],this._sendCleanupToScene=!0}}else this.end()},getScheduler:function(){return this._scheduler},setScheduler:function(t){this._scheduler!==t&&(this._scheduler=t)},getActionManager:function(){return this._actionManager},setActionManager:function(t){this._actionManager!==t&&(this._actionManager&&this._scheduler.unscheduleUpdate(this._actionManager),this._actionManager=t,this._scheduler.scheduleUpdate(this._actionManager,cc.Scheduler.PRIORITY_SYSTEM,!1))},getAnimationManager:function(){return this._animationManager},getCollisionManager:function(){return this._collisionManager},getPhysicsManager:function(){return this._physicsManager},getDeltaTime:function(){return this._deltaTime}}),cc.js.addon(cc.Director.prototype,n.prototype),cc.Director.EVENT_PROJECTION_CHANGED="director_projection_changed",cc.Director.EVENT_BEFORE_SCENE_LOADING="director_before_scene_loading",cc.Director.EVENT_BEFORE_SCENE_LAUNCH="director_before_scene_launch",cc.Director.EVENT_AFTER_SCENE_LAUNCH="director_after_scene_launch",cc.Director.EVENT_BEFORE_UPDATE="director_before_update",cc.Director.EVENT_AFTER_UPDATE="director_after_update",cc.Director.EVENT_BEFORE_VISIT="director_before_visit",cc.Director.EVENT_AFTER_VISIT="director_after_visit",cc.Director.EVENT_AFTER_DRAW="director_after_draw",cc.DisplayLinkDirector=cc.Director.extend({invalid:!1,startAnimation:function(){this._nextDeltaTimeZero=!0,this.invalid=!1},mainLoop:function(){this._purgeDirectorInNextLoop?(this._purgeDirectorInNextLoop=!1,this.purgeDirector()):this.invalid||(this.calculateDeltaTime(),this._paused||(this.emit(cc.Director.EVENT_BEFORE_UPDATE),this._compScheduler.startPhase(),this._compScheduler.updatePhase(this._deltaTime),this._scheduler.update(this._deltaTime),this._compScheduler.lateUpdatePhase(this._deltaTime),this.emit(cc.Director.EVENT_AFTER_UPDATE),cc.Object._deferredDestroy()),this._nextScene&&this.setNextScene(),this.emit(cc.Director.EVENT_BEFORE_VISIT),this._visitScene(),this.emit(cc.Director.EVENT_AFTER_VISIT),cc.g_NumberOfDraws=0,cc.renderer.clear(),cc.renderer.rendering(cc._renderContext),this._totalFrames++,this.emit(cc.Director.EVENT_AFTER_DRAW),h.frameUpdateListeners())},stopAnimation:function(){this.invalid=!0},setAnimationInterval:function(t){this._animationInterval=t,this.invalid||(this.stopAnimation(),this.startAnimation())},__fastOn:function(t,e,i){var n=this._bubblingListeners;n||(n=this._bubblingListeners=new c),n.add(t,e,i),this._addEventFlag(t,n,!1)},__fastOff:function(t,e,i){var n=this._bubblingListeners;n&&(n.remove(t,e,i),this._purgeEventFlag(t,n,!1))}}),cc.Director.sharedDirector=null,cc.Director.firstUseDirector=!0,cc.Director._getInstance=function(){return cc.Director.firstUseDirector&&(cc.Director.firstUseDirector=!1,cc.Director.sharedDirector=new cc.DisplayLinkDirector,cc.Director.sharedDirector.init()),cc.Director.sharedDirector},cc.defaultFPS=60,cc.Director.PROJECTION_2D=0,cc.Director.PROJECTION_3D=1,cc.Director.PROJECTION_CUSTOM=3,cc.Director.PROJECTION_DEFAULT=cc.Director.PROJECTION_2D}),{"./component-scheduler":66,"./event-manager":90,"./event/event-listeners":91,"./event/event-target":92,"./load-pipeline/auto-release-utils":114,"./node-activator":127,"./platform/_CCClass":168}],31:[(function(t,e,i){t("./CCDirector"),t("./CCGame");var n=t("./event-manager");cc.game.once(cc.game.EVENT_RENDERER_INITED,(function(){if(cc._renderType===cc.game.RENDER_TYPE_CANVAS){var t=cc.Director.prototype;t.getProjection=function(t){return this._projection},t.setProjection=function(t){this._projection=t,this.emit(cc.Director.EVENT_PROJECTION_CHANGED,this)},t.setDepthTest=function(){},t.setClearColor=function(t){cc.renderer._clearColor=t,cc.renderer._clearFillStyle="rgb("+t.r+","+t.g+","+t.b+")"},t.setOpenGLView=function(t){this._winSizeInPoints.width=cc._canvas.width,this._winSizeInPoints.height=cc._canvas.height,this._openGLView=t||cc.view,n&&n.setEnabled(!0)},t.getVisibleSize=function(){return this.getWinSize()},t.getVisibleOrigin=function(){return cc.p(0,0)}}}))}),{"./CCDirector":30,"./CCGame":36,"./event-manager":90}],32:[(function(t,e,i){t("./CCDirector"),t("./CCGame"),t("../kazmath");var n=t("./event-manager"),r=cc.math;cc.game.once(cc.game.EVENT_RENDERER_INITED,(function(){if(cc._renderType===cc.game.RENDER_TYPE_WEBGL){cc.DirectorDelegate=cc._Class.extend({updateProjection:function(){}});var t=cc.Director.prototype,e=function(t){if(t&&t._renderCmd){t._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty);var i,n=t._children;for(i=0;i<n.length;i++)e(n[i])}};cc.Director._getInstance().on(cc.Director.EVENT_PROJECTION_CHANGED,(function(){for(var t=cc.director._scenesStack,i=0;i<t.length;i++)e(t[i])})),t.setProjection=function(t){var e=this._winSizeInPoints;this.setViewport();var i=this._openGLView,n=i._viewPortRect.x/i._scaleX,s=i._viewPortRect.y/i._scaleY;switch(t){case cc.Director.PROJECTION_2D:r.glMatrixMode(r.KM_GL_PROJECTION),r.glLoadIdentity();var o=r.Matrix4.createOrthographicProjection(0,e.width,0,e.height,-1024,1024);r.glMultMatrix(o),r.glMatrixMode(r.KM_GL_MODELVIEW),r.glLoadIdentity();break;case cc.Director.PROJECTION_3D:var a=this.getZEye(),c=new r.Matrix4,h=new r.Matrix4;r.glMatrixMode(r.KM_GL_PROJECTION),r.glLoadIdentity(),c=r.Matrix4.createPerspectiveProjection(60,e.width/e.height,.1,2*a),r.glMultMatrix(c);var l=new r.Vec3(-n+e.width/2,-s+e.height/2,a),_=new r.Vec3(-n+e.width/2,-s+e.height/2,0),u=new r.Vec3(0,1,0);h.lookAt(l,_,u),r.glMultMatrix(h),r.glMatrixMode(r.KM_GL_MODELVIEW),r.glLoadIdentity();break;case cc.Director.PROJECTION_CUSTOM:this._projectionDelegate&&this._projectionDelegate.updateProjection();break;default:cc.logID(1201)}this._projection=t,this.emit(cc.Director.EVENT_PROJECTION_CHANGED,this),cc.gl.setProjectionMatrixDirty(),cc.renderer.childrenOrderDirty=!0},t.setDepthTest=function(t){cc.renderer.setDepthTest(t)},t.setClearColor=function(t){var e=cc.renderer._clearColor;e.r=t.r/255,e.g=t.g/255,e.b=t.b/255,e.a=t.a/255},t.setOpenGLView=function(t){this._winSizeInPoints.width=cc._canvas.width,this._winSizeInPoints.height=cc._canvas.height,this._openGLView=t||cc.view;cc.configuration.gatherGPUInfo(),this.setGLDefaultValues(),n&&n.setEnabled(!0)},t.getVisibleSize=function(){return this._openGLView.getVisibleSize()},t.getVisibleOrigin=function(){return this._openGLView.getVisibleOrigin()},t.getZEye=function(){return this._winSizeInPoints.height/1.1566},t.setViewport=function(){var t=this._openGLView;if(t){var e=this._winSizeInPoints;t.setViewPortInPoints(-t._viewPortRect.x/t._scaleX,-t._viewPortRect.y/t._scaleY,e.width,e.height)}},t.getOpenGLView=function(){return this._openGLView},t.getProjection=function(){return this._projection},t.setAlphaBlending=function(t){t?cc.gl.blendFunc(cc.macro.BLEND_SRC,cc.macro.BLEND_DST):cc.gl.blendFunc(cc.macro.ONE,cc.macro.ZERO)},t.setGLDefaultValues=function(){this.setAlphaBlending(!0),this.setProjection(this._projection),cc._renderContext.clearColor(0,0,0,0)}}}))}),{"../kazmath":226,"./CCDirector":30,"./CCGame":36,"./event-manager":90}],33:[(function(t,e,i){var n=t("./CCGame");cc._drawingUtil=null,n.once(n.EVENT_RENDERER_INITED,(function(){cc._renderType===n.RENDER_TYPE_WEBGL?cc._drawingUtil=new(t("./CCDrawingPrimitivesWebGL"))(cc._renderContext):cc._drawingUtil=new(t("./CCDrawingPrimitivesCanvas"))(cc._renderContext)}))}),{"./CCDrawingPrimitivesCanvas":34,"./CCDrawingPrimitivesWebGL":35,"./CCGame":36}],34:[(function(t,e,i){var n=cc._Class.extend({_cacheArray:[],ctor:function(t){this._renderContext=t},drawPoint:function(t,e){e||(e=1);var i=cc.view.getScaleX(),n=cc.view.getScaleY(),r=cc.p(t.x*i,t.y*n),s=this._renderContext.getContext();s.beginPath(),s.arc(r.x,-r.y,e*i,0,2*Math.PI,!1),s.closePath(),s.fill()},drawPoints:function(t,e,i){if(null!=t){i||(i=1);var n=this._renderContext.getContext(),r=cc.view.getScaleX(),s=cc.view.getScaleY();n.beginPath();for(var o=0,a=t.length;o<a;o++)n.arc(t[o].x*r,-t[o].y*s,i*r,0,2*Math.PI,!1);n.closePath(),n.fill()}},drawLine:function(t,e){var i=this._renderContext.getContext(),n=cc.view.getScaleX(),r=cc.view.getScaleY();i.beginPath(),i.moveTo(t.x*n,-t.y*r),i.lineTo(e.x*n,-e.y*r),i.closePath(),i.stroke()},drawRect:function(t,e){this.drawLine(cc.p(t.x,t.y),cc.p(e.x,t.y)),this.drawLine(cc.p(e.x,t.y),cc.p(e.x,e.y)),this.drawLine(cc.p(e.x,e.y),cc.p(t.x,e.y)),this.drawLine(cc.p(t.x,e.y),cc.p(t.x,t.y))},drawSolidRect:function(t,e,i){var n=[t,cc.p(e.x,t.y),e,cc.p(t.x,e.y)];this.drawSolidPoly(n,4,i)},drawPoly:function(t,e,i,n){if(n=n||!1,null!=t){if(t.length<3)throw new Error("Polygon's point must greater than 2");var r=t[0],s=this._renderContext.getContext(),o=cc.view.getScaleX(),a=cc.view.getScaleY();s.beginPath(),s.moveTo(r.x*o,-r.y*a);for(var c=1,h=t.length;c<h;c++)s.lineTo(t[c].x*o,-t[c].y*a);i&&s.closePath(),n?s.fill():s.stroke()}},drawSolidPoly:function(t,e,i){this.setDrawColor(i.r,i.g,i.b,i.a),this.drawPoly(t,e,!0,!0)},drawCircle:function(t,e,i,n,r){r=r||!1;var s=this._renderContext.getContext(),o=cc.view.getScaleX(),a=cc.view.getScaleY();s.beginPath();var c=i-2*Math.PI;s.arc(0|t.x*o,0|-t.y*a,e*o,-i,-c,!1),r&&s.lineTo(0|t.x*o,0|-t.y*a),s.stroke()},drawQuadBezier:function(t,e,i,n){var r=this._cacheArray;r.length=0;for(var s=0,o=0;o<n;o++){var a=Math.pow(1-s,2)*t.x+2*(1-s)*s*e.x+s*s*i.x,c=Math.pow(1-s,2)*t.y+2*(1-s)*s*e.y+s*s*i.y;r.push(cc.p(a,c)),s+=1/n}r.push(cc.p(i.x,i.y)),this.drawPoly(r,n+1,!1,!1)},drawCubicBezier:function(t,e,i,n,r){var s=this._cacheArray;s.length=0;for(var o=0,a=0;a<r;a++){var c=Math.pow(1-o,3)*t.x+3*Math.pow(1-o,2)*o*e.x+3*(1-o)*o*o*i.x+o*o*o*n.x,h=Math.pow(1-o,3)*t.y+3*Math.pow(1-o,2)*o*e.y+3*(1-o)*o*o*i.y+o*o*o*n.y;s.push(cc.p(c,h)),o+=1/r}s.push(cc.p(n.x,n.y)),this.drawPoly(s,r+1,!1,!1)},drawCatmullRom:function(t,e){this.drawCardinalSpline(t,.5,e)},drawCardinalSpline:function(t,e,i){cc._renderContext.setStrokeStyle("rgba(255,255,255,1)");var n=this._cacheArray;n.length=0;for(var r,s,o=1/t.length,a=0;a<i+1;a++){var c=a/i;1===c?(r=t.length-1,s=1):s=(c-o*(r=0|c/o))/o;var h=cc.cardinalSplineAt(cc.getControlPointAt(t,r-1),cc.getControlPointAt(t,r-0),cc.getControlPointAt(t,r+1),cc.getControlPointAt(t,r+2),e,s);n.push(h)}this.drawPoly(n,i+1,!1,!1)},drawImage:function(t,e,i,n,r){var s=arguments.length,o=this._renderContext.getContext();switch(s){case 2:var a=t.height;o.drawImage(t,e.x,-(e.y+a));break;case 3:o.drawImage(t,e.x,-(e.y+i.height),i.width,i.height);break;case 5:o.drawImage(t,e.x,e.y,i.width,i.height,n.x,-(n.y+r.height),r.width,r.height);break;default:throw new Error("Argument must be non-nil")}},drawStar:function(t,e,i){var n=t||this._renderContext,r=n.getContext();e*=cc.view.getScaleX();var s="rgba("+(0|i.r)+","+(0|i.g)+","+(0|i.b);n.setFillStyle(s+",1)");var o=e/10;r.beginPath(),r.moveTo(-e,e),r.lineTo(0,o),r.lineTo(e,e),r.lineTo(o,0),r.lineTo(e,-e),r.lineTo(0,-o),r.lineTo(-e,-e),r.lineTo(-o,0),r.lineTo(-e,e),r.closePath(),r.fill();var a=r.createRadialGradient(0,0,o,0,0,e);a.addColorStop(0,s+", 1)"),a.addColorStop(.3,s+", 0.8)"),a.addColorStop(1,s+", 0.0)"),n.setFillStyle(a),r.beginPath();var c=cc.macro.PI2;r.arc(0,0,e-o,0,c,!1),r.closePath(),r.fill()},drawColorBall:function(t,e,i){var n=t||this._renderContext,r=n.getContext();e*=cc.view.getScaleX();var s="rgba("+(0|i.r)+","+(0|i.g)+","+(0|i.b),o=e/10,a=r.createRadialGradient(0,0,o,0,0,e);a.addColorStop(0,s+", 1)"),a.addColorStop(.3,s+", 0.8)"),a.addColorStop(.6,s+", 0.4)"),a.addColorStop(1,s+", 0.0)"),n.setFillStyle(a),r.beginPath();var c=cc.macro.PI2;r.arc(0,0,e,0,c,!1),r.closePath(),r.fill()},fillText:function(t,e,i){this._renderContext.getContext().fillText(t,e,-i)},setDrawColor:function(t,e,i,n){this._renderContext.setFillStyle("rgba("+t+","+e+","+i+","+n/255+")"),this._renderContext.setStrokeStyle("rgba("+t+","+e+","+i+","+n/255+")")},setPointSize:function(t){},setLineWidth:function(t){this._renderContext.getContext().lineWidth=t*cc.view.getScaleX()}});e.exports=n}),{}],35:[(function(t,e,i){var n=cc.macro,r=cc._Class.extend({_initialized:!1,_shader:null,_colorLocation:"u_color",_pointSizeLocation:"u_pointSize",_pointSize:-1,ctor:function(t){this._renderContext=t,this._colorArray=new Float32Array([1,1,1,1])},lazy_init:function(){this._initialized||(this._shader=cc.shaderCache.programForKey(n.SHADER_POSITION_UCOLOR),this._shader._addUniformLocation(this._colorLocation),this._shader._addUniformLocation(this._pointSizeLocation),this._initialized=!0)},drawInit:function(){this._initialized=!1},drawPoint:function(t){this.lazy_init();var e=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),e.enableVertexAttribArray(n.VERTEX_ATTRIB_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray),this._shader.setUniformLocationWith1f(this._pointSizeLocation,this._pointSize);var i=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,i),e.bufferData(e.ARRAY_BUFFER,new Float32Array([t.x,t.y]),e.STATIC_DRAW),e.vertexAttribPointer(n.VERTEX_ATTRIB_POSITION,2,e.FLOAT,!1,0,0),e.drawArrays(e.POINTS,0,1),e.deleteBuffer(i),cc.incrementGLDraws(1)},drawPoints:function(t,e){if(t&&0!==t.length){this.lazy_init();var i=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),i.enableVertexAttribArray(n.VERTEX_ATTRIB_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray),this._shader.setUniformLocationWith1f(this._pointSizeLocation,this._pointSize);var r=i.createBuffer();i.bindBuffer(i.ARRAY_BUFFER,r),i.bufferData(i.ARRAY_BUFFER,this._pointsToTypeArray(t),i.STATIC_DRAW),i.vertexAttribPointer(n.VERTEX_ATTRIB_POSITION,2,i.FLOAT,!1,0,0),i.drawArrays(i.POINTS,0,t.length),i.deleteBuffer(r),cc.incrementGLDraws(1)}},_pointsToTypeArray:function(t){for(var e=new Float32Array(2*t.length),i=0;i<t.length;i++)e[2*i]=t[i].x,e[2*i+1]=t[i].y;return e},drawLine:function(t,e){this.lazy_init();var i=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),i.enableVertexAttribArray(n.VERTEX_ATTRIB_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray);var r=i.createBuffer();i.bindBuffer(i.ARRAY_BUFFER,r),i.bufferData(i.ARRAY_BUFFER,this._pointsToTypeArray([t,e]),i.STATIC_DRAW),i.vertexAttribPointer(n.VERTEX_ATTRIB_POSITION,2,i.FLOAT,!1,0,0),i.drawArrays(i.LINES,0,2),i.deleteBuffer(r),cc.incrementGLDraws(1)},drawRect:function(t,e){this.drawLine(cc.p(t.x,t.y),cc.p(e.x,t.y)),this.drawLine(cc.p(e.x,t.y),cc.p(e.x,e.y)),this.drawLine(cc.p(e.x,e.y),cc.p(t.x,e.y)),this.drawLine(cc.p(t.x,e.y),cc.p(t.x,t.y))},drawSolidRect:function(t,e,i){var n=[t,cc.p(e.x,t.y),e,cc.p(t.x,e.y)];this.drawSolidPoly(n,4,i)},drawPoly:function(t,e,i){this.lazy_init();var r=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),r.enableVertexAttribArray(n.VERTEX_ATTRIB_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray);var s=r.createBuffer();r.bindBuffer(r.ARRAY_BUFFER,s),r.bufferData(r.ARRAY_BUFFER,this._pointsToTypeArray(t),r.STATIC_DRAW),r.vertexAttribPointer(n.VERTEX_ATTRIB_POSITION,2,r.FLOAT,!1,0,0),i?r.drawArrays(r.LINE_LOOP,0,t.length):r.drawArrays(r.LINE_STRIP,0,t.length),r.deleteBuffer(s),cc.incrementGLDraws(1)},drawSolidPoly:function(t,e,i){this.lazy_init(),i&&this.setDrawColor(i.r,i.g,i.b,i.a);var r=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),r.enableVertexAttribArray(n.VERTEX_ATTRIB_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray);var s=r.createBuffer();r.bindBuffer(r.ARRAY_BUFFER,s),r.bufferData(r.ARRAY_BUFFER,this._pointsToTypeArray(t),r.STATIC_DRAW),r.vertexAttribPointer(n.VERTEX_ATTRIB_POSITION,2,r.FLOAT,!1,0,0),r.drawArrays(r.TRIANGLE_FAN,0,t.length),r.deleteBuffer(s),cc.incrementGLDraws(1)},drawCircle:function(t,e,i,r,s){this.lazy_init();var o=1;s&&o++;var a=2*Math.PI/r,c=new Float32Array(2*(r+2));if(c){for(var h=0;h<=r;h++){var l=h*a,_=e*Math.cos(l+i)+t.x,u=e*Math.sin(l+i)+t.y;c[2*h]=_,c[2*h+1]=u}c[2*(r+1)]=t.x,c[2*(r+1)+1]=t.y;var d=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),d.enableVertexAttribArray(n.VERTEX_ATTRIB_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray);var m=d.createBuffer();d.bindBuffer(d.ARRAY_BUFFER,m),d.bufferData(d.ARRAY_BUFFER,c,d.STATIC_DRAW),d.vertexAttribPointer(n.VERTEX_ATTRIB_POSITION,2,d.FLOAT,!1,0,0),d.drawArrays(d.LINE_STRIP,0,r+o),d.deleteBuffer(m),cc.incrementGLDraws(1)}},drawQuadBezier:function(t,e,i,r){this.lazy_init();for(var s=new Float32Array(2*(r+1)),o=0,a=0;a<r;a++)s[2*a]=Math.pow(1-o,2)*t.x+2*(1-o)*o*e.x+o*o*i.x,s[2*a+1]=Math.pow(1-o,2)*t.y+2*(1-o)*o*e.y+o*o*i.y,o+=1/r;s[2*r]=i.x,s[2*r+1]=i.y;var c=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),c.enableVertexAttribArray(n.VERTEX_ATTRIB_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray);var h=c.createBuffer();c.bindBuffer(c.ARRAY_BUFFER,h),c.bufferData(c.ARRAY_BUFFER,s,c.STATIC_DRAW),c.vertexAttribPointer(n.VERTEX_ATTRIB_POSITION,2,c.FLOAT,!1,0,0),c.drawArrays(c.LINE_STRIP,0,r+1),c.deleteBuffer(h),cc.incrementGLDraws(1)},drawCubicBezier:function(t,e,i,r,s){this.lazy_init();for(var o=new Float32Array(2*(s+1)),a=0,c=0;c<s;c++)o[2*c]=Math.pow(1-a,3)*t.x+3*Math.pow(1-a,2)*a*e.x+3*(1-a)*a*a*i.x+a*a*a*r.x,o[2*c+1]=Math.pow(1-a,3)*t.y+3*Math.pow(1-a,2)*a*e.y+3*(1-a)*a*a*i.y+a*a*a*r.y,a+=1/s;o[2*s]=r.x,o[2*s+1]=r.y;var h=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),h.enableVertexAttribArray(n.VERTEX_ATTRIB_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray);var l=h.createBuffer();h.bindBuffer(h.ARRAY_BUFFER,l),h.bufferData(h.ARRAY_BUFFER,o,h.STATIC_DRAW),h.vertexAttribPointer(n.VERTEX_ATTRIB_POSITION,2,h.FLOAT,!1,0,0),h.drawArrays(h.LINE_STRIP,0,s+1),h.deleteBuffer(l),cc.incrementGLDraws(1)},drawCatmullRom:function(t,e){this.drawCardinalSpline(t,.5,e)},drawCardinalSpline:function(t,e,i){this.lazy_init();for(var r,s,o=new Float32Array(2*(i+1)),a=1/t.length,c=0;c<i+1;c++){var h=c/i;1===h?(r=t.length-1,s=1):s=(h-a*(r=0|h/a))/a;var l=cc.cardinalSplineAt(cc.getControlPointAt(t,r-1),cc.getControlPointAt(t,r),cc.getControlPointAt(t,r+1),cc.getControlPointAt(t,r+2),e,s);o[2*c]=l.x,o[2*c+1]=l.y}var _=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),_.enableVertexAttribArray(n.VERTEX_ATTRIB_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray);var u=_.createBuffer();_.bindBuffer(_.ARRAY_BUFFER,u),_.bufferData(_.ARRAY_BUFFER,o,_.STATIC_DRAW),_.vertexAttribPointer(n.VERTEX_ATTRIB_POSITION,2,_.FLOAT,!1,0,0),_.drawArrays(_.LINE_STRIP,0,i+1),_.deleteBuffer(u),cc.incrementGLDraws(1)},setDrawColor:function(t,e,i,n){this._colorArray[0]=t/255,this._colorArray[1]=e/255,this._colorArray[2]=i/255,this._colorArray[3]=n/255},setPointSize:function(t){this._pointSize=t},setLineWidth:function(t){this._renderContext.lineWidth&&this._renderContext.lineWidth(t)}});e.exports=r}),{}],36:[(function(t,e,i){var n,r=t("./event/event-target");n=t("./platform/CCView"),t("../audio/CCAudioEngine");var s=t("./platform/CCInputManager"),o={EVENT_HIDE:"game_on_hide",EVENT_SHOW:"game_on_show",EVENT_GAME_INITED:"game_inited",EVENT_RENDERER_INITED:"renderer_inited",RENDER_TYPE_CANVAS:0,RENDER_TYPE_WEBGL:1,RENDER_TYPE_OPENGL:2,_persistRootNodes:{},_ignoreRemovePersistNode:null,CONFIG_KEY:{width:"width",height:"height",debugMode:"debugMode",exposeClassName:"exposeClassName",showFPS:"showFPS",frameRate:"frameRate",id:"id",renderMode:"renderMode",registerSystemEvent:"registerSystemEvent",jsList:"jsList",scenes:"scenes"},_paused:!0,_configLoaded:!1,_isCloning:!1,_prepareCalled:!1,_prepared:!1,_rendererInitialized:!1,_renderContext:null,_intervalId:null,_lastTime:null,_frameTime:null,_sceneInfos:[],frame:null,container:null,canvas:null,config:null,onStart:null,setFrameRate:function(t){this.config[this.CONFIG_KEY.frameRate]=t,this._intervalId&&window.cancelAnimFrame(this._intervalId),this._intervalId=0,this._paused=!0,this._setAnimFrame(),this._runMainLoop()},step:function(){cc.director.mainLoop()},pause:function(){this._paused||(this._paused=!0,cc.audioEngine&&cc.audioEngine._break(),this._intervalId&&window.cancelAnimFrame(this._intervalId),this._intervalId=0)},resume:function(){this._paused&&(this._paused=!1,cc.audioEngine&&cc.audioEngine._restore(),this._runMainLoop())},isPaused:function(){return this._paused},restart:function(){cc.director.once(cc.Director.EVENT_AFTER_DRAW,(function(){for(var t in o._persistRootNodes)o.removePersistRootNode(o._persistRootNodes[t]);cc.director.getScene().destroy(),cc.Object._deferredDestroy(),cc.director.purgeDirector(),cc.audioEngine&&cc.audioEngine.uncacheAll(),cc.director.reset(),o.onStart()}))},end:function(){close()},prepare:function(t){var e=this,i=e.config,r=e.CONFIG_KEY;if(this._configLoaded){if(this._prepared)t&&t();else if(!this._prepareCalled)if(cc._engineLoaded){this._prepareCalled=!0,this._initRenderer(i[r.width],i[r.height]),cc.view=n?n._getInstance():null,cc.director=cc.Director._getInstance(),cc.director.setOpenGLView&&cc.director.setOpenGLView(cc.view),cc.winSize=cc.director.getWinSize(),this._initEvents(),this._setAnimFrame(),this._runMainLoop();var s=i[r.jsList];s&&s.length>0?cc.loader.load(s,(function(i){if(i)throw new Error(JSON.stringify(i));e._prepared=!0,t&&t(),e.emit(e.EVENT_GAME_INITED)})):(t&&t(),e.emit(e.EVENT_GAME_INITED))}else cc.initEngine(this.config,(function(){e.prepare(t)}))}else this._loadConfig((function(){e.prepare(t)}))},run:function(t,e){"function"==typeof t?o.onStart=t:(t&&(o.config=t),"function"==typeof e&&(o.onStart=e)),this.prepare(o.onStart&&o.onStart.bind(o))},addPersistRootNode:function(t){if(cc.Node.isNode(t)&&t.uuid){var e=t.uuid;if(!this._persistRootNodes[e]){var i=cc.director._scene;if(cc.isValid(i)){if(t.parent){if(!(t.parent instanceof cc.Scene))return void cc.warnID(3801);if(t.parent!==i)return void cc.warnID(3802)}else t.parent=i;this._persistRootNodes[e]=t,t._persistNode=!0}}}else cc.warnID(3800)},removePersistRootNode:function(t){if(t!==this._ignoreRemovePersistNode){var e=t.uuid||"";t===this._persistRootNodes[e]&&(delete this._persistRootNodes[e],t._persistNode=!1)}},isPersistRootNode:function(t){return t._persistNode},_setAnimFrame:function(){this._lastTime=new Date;var t=o.config[o.CONFIG_KEY.frameRate];this._frameTime=1e3/t,60!==t&&30!==t?(window.requestAnimFrame=this._stTime,window.cancelAnimFrame=this._ctTime):(window.requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||this._stTime,window.cancelAnimFrame=window.cancelAnimationFrame||window.cancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.webkitCancelRequestAnimationFrame||window.msCancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.oCancelAnimationFrame||this._ctTime)},_stTime:function(t){var e=(new Date).getTime(),i=Math.max(0,o._frameTime-(e-o._lastTime)),n=window.setTimeout((function(){t()}),i);return o._lastTime=e+i,n},_ctTime:function(t){window.clearTimeout(t)},_runMainLoop:function(){var t,e=this,i=e.config,n=e.CONFIG_KEY,r=cc.director,s=!0,o=i[n.frameRate];r.setDisplayStats(i[n.showFPS]),t=function(){if(!e._paused){if(e._intervalId=window.requestAnimFrame(t),30===o&&(s=!s))return;r.mainLoop()}},e._intervalId=window.requestAnimFrame(t),e._paused=!1},_loadConfig:function(t){if(this.config)return this._initConfig(this.config),void(t&&t());if(document.ccConfig)return this._initConfig(document.ccConfig),void(t&&t());var e=this;cc.loader.load("project.json",(function(i,n){i&&cc.logID(3818),e._initConfig(n||{}),t&&t()}))},_initConfig:function(t){var e=this.CONFIG_KEY;"number"!=typeof t[e.debugMode]&&(t[e.debugMode]=0),t[e.exposeClassName]=!!t[e.exposeClassName],"number"!=typeof t[e.frameRate]&&(t[e.frameRate]=60),"number"!=typeof t[e.renderMode]&&(t[e.renderMode]=0),"boolean"!=typeof t[e.registerSystemEvent]&&(t[e.registerSystemEvent]=!0),t[e.showFPS]=!(e.showFPS in t)||!!t[e.showFPS],this._sceneInfos=t[e.scenes]||[],this.collisionMatrix=t.collisionMatrix||[],this.groupList=t.groupList||[],cc._initDebugSetting(t[e.debugMode]),this.config=t,this._configLoaded=!0},_initRenderer:function(t,e){if(!this._rendererInitialized){if(!cc._supportRender)throw new Error("The renderer doesn't support the renderMode "+this.config[this.CONFIG_KEY.renderMode]);var i,n,r=this.config[o.CONFIG_KEY.id],s=window,a=cc.sys.platform===cc.sys.WECHAT_GAME,c=cc.sys.platform===cc.sys.QQ_PLAY;if(a)this.container=cc.container=n=document.createElement("DIV"),this.frame=n.parentNode===document.body?document.documentElement:n.parentNode,i=cc.sys.browserType===cc.sys.BROWSER_TYPE_WECHAT_GAME_SUB?wx.getSharedCanvas():canvas,this.canvas=cc._canvas=i;else if(c)this.container=cc.container=document.createElement("DIV"),this.frame=document.documentElement,this.canvas=cc._canvas=i=canvas;else{var h=r instanceof HTMLElement?r:document.querySelector(r)||document.querySelector("#"+r);"CANVAS"===h.tagName?(t=t||h.width,e=e||h.height,this.canvas=cc._canvas=i=h,this.container=cc.container=n=document.createElement("DIV"),i.parentNode&&i.parentNode.insertBefore(n,i)):("DIV"!==h.tagName&&cc.warnID(3819),t=t||h.clientWidth,e=e||h.clientHeight,this.canvas=cc._canvas=i=document.createElement("CANVAS"),this.container=cc.container=n=document.createElement("DIV"),h.appendChild(n)),n.setAttribute("id","Cocos2dGameContainer"),n.appendChild(i),this.frame=n.parentNode===document.body?document.documentElement:n.parentNode;(function(t,e){(" "+t.className+" ").indexOf(" "+e+" ")>-1||(t.className&&(t.className+=" "),t.className+=e)})(i,"gameCanvas"),i.setAttribute("width",t||480),i.setAttribute("height",e||320),i.setAttribute("tabindex",99)}if(cc._renderType===o.RENDER_TYPE_WEBGL){var l={stencil:!0,antialias:cc.macro.ENABLE_WEBGL_ANTIALIAS,alpha:cc.macro.ENABLE_TRANSPARENT_CANVAS};a&&(l.preserveDrawingBuffer=!0),this._renderContext=cc._renderContext=cc.webglContext=cc.create3DContext(i,l)}this._renderContext?(cc.renderer=cc.rendererWebGL,s.gl=this._renderContext,cc.renderer.init()):(cc._renderType=o.RENDER_TYPE_CANVAS,cc.renderer=cc.rendererCanvas,cc.renderer.init(),this._renderContext=cc._renderContext=new cc.CanvasContextWrapper(i.getContext("2d"))),cc._gameDiv=n,o.canvas.oncontextmenu=function(){if(!cc._isContextMenuEnable)return!1},this.emit(this.EVENT_RENDERER_INITED,!0),this._rendererInitialized=!0}},_initEvents:function(){function t(){r||(r=!0,o.emit(o.EVENT_HIDE,o))}function e(){r&&(r=!1,o.emit(o.EVENT_SHOW,o))}var i,n=window;this.config[this.CONFIG_KEY.registerSystemEvent]&&s.registerSystemEvent(this.canvas),void 0!==document.hidden?i="hidden":void 0!==document.mozHidden?i="mozHidden":void 0!==document.msHidden?i="msHidden":void 0!==document.webkitHidden&&(i="webkitHidden");var r=!1;if(i)for(var a=["visibilitychange","mozvisibilitychange","msvisibilitychange","webkitvisibilitychange","qbrowserVisibilityChange"],c=0;c<a.length;c++)document.addEventListener(a[c],(function(n){var r=document[i];(r=r||n.hidden)?t():e()}),!1);else n.addEventListener("blur",t,!1),n.addEventListener("focus",e,!1);navigator.userAgent.indexOf("MicroMessenger")>-1&&(n.onfocus=e),cc.sys.browserType!==cc.sys.BROWSER_TYPE_WECHAT_GAME_SUB&&(wx.onShow&&wx.onShow(e),wx.onHide&&wx.onHide(t)),"onpageshow"in window&&"onpagehide"in window&&(n.addEventListener("pagehide",t,!1),n.addEventListener("pageshow",e,!1)),this.on(o.EVENT_HIDE,(function(){o.pause()})),this.on(o.EVENT_SHOW,(function(){o.resume()}))}};r.call(o),cc.js.addon(o,r.prototype),cc.game=e.exports=o}),{"../audio/CCAudioEngine":24,"./event/event-target":92,"./platform/BKInputManager":154,"./platform/CCInputManager":160,"./platform/CCView":166}],37:[(function(t,e,i){"use strict";function n(t){var e=cc.Mask;if(e)for(var i=0,n=t;n&&cc.Node.isNode(n);n=n._parent,++i)if(n.getComponent(e))return{index:i,node:n};return null}var r=t("./utils/prefab-helper"),s=t("./utils/scene-graph-helper"),o=t("./event-manager"),a=cc.Object.Flags,c=a.Destroying,h="position-changed",l="size-changed",_="anchor-changed",u="rotation-changed",d="scale-changed",m=t("./utils/misc"),f=(t("./event/event"),!!cc.ActionManager),p=function(){},g=cc.Enum({TOUCH_START:"touchstart",TOUCH_MOVE:"touchmove",TOUCH_END:"touchend",TOUCH_CANCEL:"touchcancel",MOUSE_DOWN:"mousedown",MOUSE_MOVE:"mousemove",MOUSE_ENTER:"mouseenter",MOUSE_LEAVE:"mouseleave",MOUSE_UP:"mouseup",MOUSE_WHEEL:"mousewheel"}),v=[g.TOUCH_START,g.TOUCH_MOVE,g.TOUCH_END,g.TOUCH_CANCEL],y=[g.MOUSE_DOWN,g.MOUSE_ENTER,g.MOUSE_MOVE,g.MOUSE_LEAVE,g.MOUSE_UP,g.MOUSE_WHEEL],x=null,C=function(t,e){var i=t.getLocation(),n=this.owner;return!!n._hitTest(i,this)&&(e.type=g.TOUCH_START,e.touch=t,e.bubbles=!0,n.dispatchEvent(e),!0)},A=function(t,e){var i=this.owner;e.type=g.TOUCH_MOVE,e.touch=t,e.bubbles=!0,i.dispatchEvent(e)},T=function(t,e){var i=t.getLocation(),n=this.owner;n._hitTest(i,this)?e.type=g.TOUCH_END:e.type=g.TOUCH_CANCEL,e.touch=t,e.bubbles=!0,n.dispatchEvent(e)},b=function(t,e){t.getLocation();var i=this.owner;e.type=g.TOUCH_CANCEL,e.touch=t,e.bubbles=!0,i.dispatchEvent(e)},w=function(t){var e=t.getLocation(),i=this.owner;i._hitTest(e,this)&&(t.type=g.MOUSE_DOWN,t.bubbles=!0,i.dispatchEvent(t),t.stopPropagation())},S=function(t){var e=t.getLocation(),i=this.owner,n=i._hitTest(e,this);if(n)this._previousIn||(x&&(t.type=g.MOUSE_LEAVE,x.dispatchEvent(t),x._mouseListener._previousIn=!1),x=this.owner,t.type=g.MOUSE_ENTER,i.dispatchEvent(t),this._previousIn=!0),t.type=g.MOUSE_MOVE,t.bubbles=!0,i.dispatchEvent(t);else{if(!this._previousIn)return;t.type=g.MOUSE_LEAVE,i.dispatchEvent(t),this._previousIn=!1,x=null}t.stopPropagation()},E=function(t){var e=t.getLocation(),i=this.owner;i._hitTest(e,this)&&(t.type=g.MOUSE_UP,t.bubbles=!0,i.dispatchEvent(t),t.stopPropagation())},I=function(t){var e=t.getLocation(),i=this.owner;i._hitTest(e,this)&&(t.type=g.MOUSE_WHEEL,t.bubbles=!0,i.dispatchEvent(t),t.stopPropagation())},R=cc.Class({name:"cc.Node",extends:t("./utils/base-node"),properties:{_opacity:255,_color:cc.Color.WHITE,_cascadeOpacityEnabled:!0,_anchorPoint:cc.p(.5,.5),_contentSize:cc.size(0,0),_rotationX:0,_rotationY:0,_scaleX:1,_scaleY:1,_position:cc.p(0,0),_skewX:0,_skewY:0,_localZOrder:0,_globalZOrder:0,_opacityModifyRGB:!1,groupIndex:{default:0,type:cc.Integer},group:{get:function(){return cc.game.groupList[this.groupIndex]||""},set:function(t){this.groupIndex=cc.game.groupList.indexOf(t),this.emit("group-changed")}},x:{get:function(){return this._position.x},set:function(t){var e=this._position;if(t!==e.x){e.x=t,this._sgNode.setPositionX(t);var i=this._hasListenerCache;i&&i[h]&&this.emit(h)}}},y:{get:function(){return this._position.y},set:function(t){var e=this._position;if(t!==e.y){e.y=t,this._sgNode.setPositionY(t);var i=this._hasListenerCache;i&&i[h]&&this.emit(h)}}},rotation:{get:function(){return this._rotationX!==this._rotationY&&cc.logID(1602),this._rotationX},set:function(t){if(this._rotationX!==t||this._rotationY!==t){this._rotationX=this._rotationY=t,this._sgNode.rotation=t;var e=this._hasListenerCache;e&&e[u]&&this.emit(u)}}},rotationX:{get:function(){return this._rotationX},set:function(t){if(this._rotationX!==t){this._rotationX=t,this._sgNode.rotationX=t;var e=this._hasListenerCache;e&&e[u]&&this.emit(u)}}},rotationY:{get:function(){return this._rotationY},set:function(t){if(this._rotationY!==t){this._rotationY=t,this._sgNode.rotationY=t;var e=this._hasListenerCache;e&&e[u]&&this.emit(u)}}},scaleX:{get:function(){return this._scaleX},set:function(t){if(this._scaleX!==t){this._scaleX=t,this._sgNode.scaleX=t;var e=this._hasListenerCache;e&&e[d]&&this.emit(d)}}},scaleY:{get:function(){return this._scaleY},set:function(t){if(this._scaleY!==t){this._scaleY=t,this._sgNode.scaleY=t;var e=this._hasListenerCache;e&&e[d]&&this.emit(d)}}},skewX:{get:function(){return this._skewX},set:function(t){this._skewX=t,this._sgNode.skewX=t}},skewY:{get:function(){return this._skewY},set:function(t){this._skewY=t,this._sgNode.skewY=t}},opacity:{get:function(){return this._opacity},set:function(t){if(this._opacity!==t&&(this._opacity=t,this._sgNode.setOpacity(t),!this._cascadeOpacityEnabled)){var e=this._sizeProvider;e instanceof _ccsg.Node&&e!==this._sgNode&&e.setOpacity(t)}},range:[0,255]},cascadeOpacity:{get:function(){return this._cascadeOpacityEnabled},set:function(t){if(this._cascadeOpacityEnabled!==t){this._cascadeOpacityEnabled=t,this._sgNode.cascadeOpacity=t;var e=t?255:this._opacity,i=this._sizeProvider;i instanceof _ccsg.Node&&i.setOpacity(e)}}},color:{get:function(){return this._color.clone()},set:function(t){this._color.equals(t)||(this._color.fromColor(t),this._sizeProvider instanceof _ccsg.Node&&this._sizeProvider.setColor(t))}},anchorX:{get:function(){return this._anchorPoint.x},set:function(t){var e=this._anchorPoint;if(e.x!==t){e.x=t;var i=this._sizeProvider;i instanceof _ccsg.Node&&i.setAnchorPoint(e),this.emit(_)}}},anchorY:{get:function(){return this._anchorPoint.y},set:function(t){var e=this._anchorPoint;if(e.y!==t){e.y=t;var i=this._sizeProvider;i instanceof _ccsg.Node&&i.setAnchorPoint(e),this.emit(_)}}},width:{get:function(){if(this._sizeProvider){var t=this._sizeProvider._getWidth();return this._contentSize.width=t,t}return this._contentSize.width},set:function(t){if(t!==this._contentSize.width){var e=this._sizeProvider;e&&e.setContentSize(t,e._getHeight());this._contentSize.width=t,this.emit(l)}}},height:{get:function(){if(this._sizeProvider){var t=this._sizeProvider._getHeight();return this._contentSize.height=t,t}return this._contentSize.height},set:function(t){if(t!==this._contentSize.height){var e=this._sizeProvider;e&&e.setContentSize(e._getWidth(),t);this._contentSize.height=t,this.emit(l)}}},zIndex:{get:function(){return this._localZOrder},set:function(t){this._localZOrder!==t&&(this._localZOrder=t,this._sgNode.zIndex=t,this._parent&&(function(t){t._parent._delaySort(),o._setDirtyForNode(t)})(this))}}},ctor:function(t){var e=this._sgNode=new _ccsg.Node;cc.game._isCloning||(e.cascadeOpacity=!0),this._sizeProvider=null,this._reorderChildDirty=!1,this._widget=null,this._touchListener=null,this._mouseListener=null},statics:{isNode:function(t){return t instanceof R&&(t.constructor===R||!(t instanceof cc.Scene))}},_onSetParent:function(t){var e=this._sgNode;e.parent&&e.parent.removeChild(e,!1),t&&(t._sgNode.addChild(e),t._delaySort())},_onSiblingIndexChanged:function(t){var e=this._parent,i=e._children,n=0,r=i.length;for(0;n<r;n++)i[n]._sgNode._arrivalOrder=n,o._setDirtyForNode(i[n]);cc.renderer.childrenOrderDirty=!0,e._sgNode._reorderChildDirty=!0,e._delaySort()},_onPreDestroy:function(){var t=this._onPreDestroyBase();f&&cc.director.getActionManager().removeAllActionsFromTarget(this),x===this&&(x=null),this._reorderChildDirty&&cc.director.__fastOff(cc.Director.EVENT_AFTER_UPDATE,this.sortAllChildren,this),o.removeListeners(this),t||this._removeSgNode()},_onPostActivated:function(t){var e=f?cc.director.getActionManager():null;if(t)if(e&&e.resumeTarget(this),o.resumeTarget(this),this._touchListener){var i=this._touchListener.mask=n(this);this._mouseListener&&(this._mouseListener.mask=i)}else this._mouseListener&&(this._mouseListener.mask=n(this));else e&&e.pauseTarget(this),o.pauseTarget(this)},_onHierarchyChanged:function(t){this._onHierarchyChangedBase(t),cc._widgetManager._nodesOrderDirty=!0},_onBatchCreated:function(){var t=this._prefab;t&&t.sync&&!t._synced&&t.root===this&&r.syncWithPrefab(this),this._updateDummySgNode(),this._parent&&this._parent._sgNode.addChild(this._sgNode),this._activeInHierarchy||(f&&cc.director.getActionManager().pauseTarget(this),o.pauseTarget(this));for(var e=this._children,i=0,n=e.length;i<n;i++)e[i]._onBatchCreated()},on:function(t,e,i,r){var s=!1;return-1!==v.indexOf(t)?this._touchListener||(this._touchListener=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0,owner:this,mask:n(this),onTouchBegan:C,onTouchMoved:A,onTouchEnded:T,onTouchCancelled:b}),o.addListener(this._touchListener,this),s=!0):-1!==y.indexOf(t)&&(this._mouseListener||(this._mouseListener=cc.EventListener.create({event:cc.EventListener.MOUSE,_previousIn:!1,owner:this,mask:n(this),onMouseDown:w,onMouseMove:S,onMouseUp:E,onMouseScroll:I}),o.addListener(this._mouseListener,this),s=!0)),s&&!this._activeInHierarchy&&cc.director.getScheduler().schedule((function(){this._activeInHierarchy||o.pauseTarget(this)}),this,0,0,0,!1),this._EventTargetOn(t,e,i,r)},off:function(t,e,i,n){this._EventTargetOff(t,e,i,n),-1!==v.indexOf(t)?this._checkTouchListeners():-1!==y.indexOf(t)&&this._checkMouseListeners()},targetOff:function(t){this._EventTargetTargetOff(t),this._checkTouchListeners(),this._checkMouseListeners()},pauseSystemEvents:function(t){o.pauseTarget(this,t)},resumeSystemEvents:function(t){o.resumeTarget(this,t)},_checkTouchListeners:function(){if(!(this._objFlags&c)&&this._touchListener){var t=0;if(this._bubblingListeners)for(;t<v.length;++t)if(this._bubblingListeners.has(v[t]))return;if(this._capturingListeners)for(;t<v.length;++t)if(this._capturingListeners.has(v[t]))return;o.removeListener(this._touchListener),this._touchListener=null}},_checkMouseListeners:function(){if(!(this._objFlags&c)&&this._mouseListener){var t=0;if(this._bubblingListeners)for(;t<y.length;++t)if(this._bubblingListeners.has(y[t]))return;if(this._capturingListeners)for(;t<y.length;++t)if(this._capturingListeners.has(y[t]))return;x===this&&(x=null),o.removeListener(this._mouseListener),this._mouseListener=null}},_hitTest:function(t,e){var i=this.width,n=this.height,r=t,s=cc.Camera;s&&s.main&&s.main.containsNode(this)&&(r=s.main.getCameraToWorldPoint(r));var o=cc.affineTransformInvertIn(this._sgNode.getNodeToWorldTransform());(r=cc.pointApplyAffineTransform(r,o)).x+=this._anchorPoint.x*i,r.y+=this._anchorPoint.y*n;var a=r.x,c=i-r.x,h=r.y,l=n-r.y;if(a>=0&&c>=0&&l>=0&&h>=0){if(e&&e.mask){for(var _=e.mask,u=this,d=0;u&&d<_.index;++d,u=u.parent);if(u===_.node){var m=u.getComponent(cc.Mask);return!m||!m.enabledInHierarchy||m._hitTest(t)}return e.mask=null,!0}return!0}return!1},_getCapturingTargets:function(t,e){for(var i=this.parent;i;)i.hasEventListener(t,!0)&&e.push(i),i=i.parent},_getBubblingTargets:function(t,e){for(var i=this.parent;i;)i.hasEventListener(t)&&e.push(i),i=i.parent},isRunning:function(){return this._activeInHierarchy},runAction:f?function(t){if(this.active)return cc.assertID(t,1618),cc.macro.ENABLE_GC_FOR_NATIVE_OBJECTS||this._retainAction(t),cc.director.getActionManager().addAction(t,this,!1),t}:p,pauseAllActions:f?function(){cc.director.getActionManager().pauseTarget(this)}:p,resumeAllActions:f?function(){cc.director.getActionManager().resumeTarget(this)}:p,stopAllActions:f?function(){cc.director.getActionManager().removeAllActionsFromTarget(this)}:p,stopAction:f?function(t){cc.director.getActionManager().removeAction(t)}:p,stopActionByTag:f?function(t){t!==cc.Action.TAG_INVALID?cc.director.getActionManager().removeActionByTag(t,this):cc.logID(1612)}:p,getActionByTag:f?function(t){return t===cc.Action.TAG_INVALID?(cc.logID(1613),null):cc.director.getActionManager().getActionByTag(t,this)}:function(){return null},getNumberOfRunningActions:f?function(){return cc.director.getActionManager().getNumberOfRunningActionsInTarget(this)}:function(){return 0},_retainAction:function(t){0},_releaseAllActions:function(){},setTag:function(t){this._tag=t,this._sgNode.tag=t},getPosition:function(){return new cc.Vec2(this._position)},setPosition:function(t,e){var i;void 0===e?(i=t.x,e=t.y):i=t;var n=this._position;if(n.x!==i||n.y!==e){n.x=i,n.y=e,this._sgNode.setPosition(i,e);var r=this._hasListenerCache;r&&r[h]&&this.emit(h)}},getScale:function(){return this._scaleX!==this._scaleY&&cc.logID(1603),this._scaleX},setScale:function(t,e){if("object"==typeof t?(e=t.y,t=t.x):e=e||0===e?e:t,this._scaleX!==t||this._scaleY!==e){this._scaleX=t,this._scaleY=e,this._sgNode.setScale(t,e);var i=this._hasListenerCache;i&&i[d]&&this.emit(d)}},getContentSize:function(t){if(this._sizeProvider&&!t){var e=this._sizeProvider.getContentSize();return this._contentSize=e,cc.size(e)}return cc.size(this._contentSize)},setContentSize:function(t,e){var i=this._contentSize;if(void 0===e){if(t.width===i.width&&t.height===i.height)return;0,i.width=t.width,i.height=t.height}else{if(t===i.width&&e===i.height)return;0,i.width=t,i.height=e}this._sizeProvider&&this._sizeProvider.setContentSize(i),this.emit(l)},setOpacityModifyRGB:function(t){if(this._opacityModifyRGB!==t){this._opacityModifyRGB=t,this._sgNode.setOpacityModifyRGB(t);var e=this._sizeProvider;e instanceof _ccsg.Node&&e!==this._sgNode&&e.setOpacityModifyRGB(t)}},isOpacityModifyRGB:function(){return this._opacityModifyRGB},setGlobalZOrder:function(t){this._globalZOrder=t,this._sgNode.setGlobalZOrder(t)},getGlobalZOrder:function(){return this._globalZOrder=this._sgNode.getGlobalZOrder(),this._globalZOrder},getAnchorPoint:function(){return cc.p(this._anchorPoint)},setAnchorPoint:function(t,e){var i=this._anchorPoint;if(void 0===e){if(t.x===i.x&&t.y===i.y)return;i.x=t.x,i.y=t.y}else{if(t===i.x&&e===i.y)return;i.x=t,i.y=e}var n=this._sizeProvider;n instanceof _ccsg.Node&&n.setAnchorPoint(i),this.emit(_)},getAnchorPointInPoints:function(){return this._sgNode.getAnchorPointInPoints()},getDisplayedOpacity:function(){return this._sgNode.getDisplayedOpacity()},_updateDisplayedOpacity:function(t){this._sgNode.updateDisplayedOpacity(t)},getDisplayedColor:function(){return this._sgNode.getDisplayedColor()},getNodeToParentTransformAR:function(){var t=this.getContentSize(),e=this._sgNode.getNodeToParentTransform();if(!this._isSgTransformArToMe(t)){var i=this._anchorPoint.x*t.width,n=this._anchorPoint.y*t.height,r=cc.affineTransformMake(1,0,0,1,i,n);e=cc.affineTransformConcatIn(r,e)}return e},getBoundingBox:function(){var t=this.getContentSize(),e=cc.rect(0,0,t.width,t.height);return cc._rectApplyAffineTransformIn(e,this.getNodeToParentTransform())},getBoundingBoxToWorld:function(){var t;return this.parent&&(t=this.parent.getNodeToWorldTransformAR()),this._getBoundingBoxTo(t)},_getBoundingBoxTo:function(t){var e=this.getContentSize(),i=e.width,n=e.height,r=cc.rect(-this._anchorPoint.x*i,-this._anchorPoint.y*n,i,n),s=cc.affineTransformConcat(this.getNodeToParentTransformAR(),t);if(cc._rectApplyAffineTransformIn(r,s),!this._children)return r;for(var o=this._children,a=0;a<o.length;a++){var c=o[a];if(c&&c.active){var h=c._getBoundingBoxTo(s);h&&(r=cc.rectUnion(r,h))}}return r},getNodeToParentTransform:function(){var t=this.getContentSize(),e=this._sgNode.getNodeToParentTransform();if(this._isSgTransformArToMe(t)){var i=-this._anchorPoint.x*t.width,n=-this._anchorPoint.y*t.height,r=cc.affineTransformMake(1,0,0,1,i,n);e=cc.affineTransformConcatIn(r,e)}return e},getNodeToWorldTransform:function(){var t=this.getContentSize();cc._renderType===cc.game.RENDER_TYPE_CANVAS&&cc.director._visitScene();var e=this._sgNode.getNodeToWorldTransform();if(this._isSgTransformArToMe(t)){var i=-this._anchorPoint.x*t.width,n=-this._anchorPoint.y*t.height,r=cc.affineTransformMake(1,0,0,1,i,n);e=cc.affineTransformConcatIn(r,e)}return e},getNodeToWorldTransformAR:function(){var t=this.getContentSize();cc._renderType===cc.game.RENDER_TYPE_CANVAS&&cc.director._visitScene();var e=this._sgNode.getNodeToWorldTransform();if(!this._isSgTransformArToMe(t)){var i=this._anchorPoint.x*t.width,n=this._anchorPoint.y*t.height,r=cc.affineTransformMake(1,0,0,1,i,n);e=cc.affineTransformConcatIn(r,e)}return e},getParentToNodeTransform:function(){return this._sgNode.getParentToNodeTransform()},getWorldToNodeTransform:function(){return cc._renderType===cc.game.RENDER_TYPE_CANVAS&&cc.director._visitScene(),this._sgNode.getWorldToNodeTransform()},_isSgTransformArToMe:function(t){var e=this._sgNode.getContentSize();return 0===e.width&&0===e.height&&(0!==t.width||0!==t.height)||!!this._sgNode.isIgnoreAnchorPointForPosition()},convertToNodeSpace:function(t){cc._renderType===cc.game.RENDER_TYPE_CANVAS&&cc.director._visitScene();var e=this._sgNode.convertToNodeSpace(t);return cc.pAdd(e,cc.p(this._anchorPoint.x*this._contentSize.width,this._anchorPoint.y*this._contentSize.height))},convertToWorldSpace:function(t){cc._renderType===cc.game.RENDER_TYPE_CANVAS&&cc.director._visitScene();var e=t.x-this._anchorPoint.x*this._contentSize.width,i=t.y-this._anchorPoint.y*this._contentSize.height;return cc.v2(this._sgNode.convertToWorldSpace(cc.v2(e,i)))},convertToNodeSpaceAR:function(t){return cc._renderType===cc.game.RENDER_TYPE_CANVAS&&cc.director._visitScene(),this._sgNode.isIgnoreAnchorPointForPosition()?cc.v2(this._sgNode.convertToNodeSpace(t)):this._sgNode.convertToNodeSpaceAR(t)},convertToWorldSpaceAR:function(t){return cc._renderType===cc.game.RENDER_TYPE_CANVAS&&cc.director._visitScene(),this._sgNode.isIgnoreAnchorPointForPosition()?cc.v2(this._sgNode.convertToWorldSpace(t)):cc.v2(this._sgNode.convertToWorldSpaceAR(t))},convertTouchToNodeSpace:function(t){return this.convertToNodeSpace(t.getLocation())},convertTouchToNodeSpaceAR:function(t){return this.convertToNodeSpaceAR(t.getLocation())},setNodeDirty:function(){this._sgNode.setNodeDirty()},addChild:function(t,e,i){e=void 0===e?t._localZOrder:e;var n,r=!1;void 0===i?(i=void 0,n=t._name):cc.js.isString(i)?(n=i,i=void 0):cc.js.isNumber(i)&&(r=!0,n=""),cc.assertID(t,1606),cc.assertID(null===t._parent,1605),t.parent=this,t.zIndex=e,r?t.setTag(i):t.setName(n)},cleanup:function(){f&&cc.director.getActionManager().removeAllActionsFromTarget(this),o.removeListeners(this);var t,e,i=this._children.length;for(t=0;t<i;++t)(e=this._children[t])&&e.cleanup()},sortAllChildren:function(){if(this._reorderChildDirty){this._reorderChildDirty=!1;var t=this._children;if(t.length>1){var e,i,n,r=t.length;for(e=1;e<r;e++){for(n=t[e],i=e-1;i>=0;){if(n._localZOrder<t[i]._localZOrder)t[i+1]=t[i];else{if(!(n._localZOrder===t[i]._localZOrder&&n._sgNode._arrivalOrder<t[i]._sgNode._arrivalOrder))break;t[i+1]=t[i]}i--}t[i+1]=n}this.emit("child-reorder")}cc.director.__fastOff(cc.Director.EVENT_AFTER_UPDATE,this.sortAllChildren,this)}},_delaySort:function(){this._reorderChildDirty||(this._reorderChildDirty=!0,cc.director.__fastOn(cc.Director.EVENT_AFTER_UPDATE,this.sortAllChildren,this))},_updateDummySgNode:function(){var t=this._sgNode;t.setPosition(this._position),t.setRotationX(this._rotationX),t.setRotationY(this._rotationY),t.setScale(this._scaleX,this._scaleY),t.setSkewX(this._skewX),t.setSkewY(this._skewY);var e=t._arrivalOrder;t.setLocalZOrder(this._localZOrder),t._arrivalOrder=e,t.setGlobalZOrder(this._globalZOrder),t.setOpacity(this._opacity),t.setOpacityModifyRGB(this._opacityModifyRGB),t.setCascadeOpacityEnabled(this._cascadeOpacityEnabled),t.setTag(this._tag)},_updateSgNode:function(){this._updateDummySgNode();var t=this._sgNode;t.setAnchorPoint(this._anchorPoint),t.setVisible(this._active),t.setColor(this._color);var e=f?cc.director.getActionManager():null;this._activeInHierarchy?(e&&e.resumeTarget(this),o.resumeTarget(this)):(e&&e.pauseTarget(this),o.pauseTarget(this))},_removeSgNode:s.removeSgNode,onRestore:!1});m.propertyDefine(R,["parent","tag","skewX","skewY","position","rotation","rotationX","rotationY","scale","scaleX","scaleY","opacity","color"],{x:["getPositionX","setPositionX"],y:["getPositionY","setPositionY"],zIndex:["getLocalZOrder","setLocalZOrder"],opacityModifyRGB:["isOpacityModifyRGB","setOpacityModifyRGB"],cascadeOpacity:["isCascadeOpacityEnabled","setCascadeOpacityEnabled"]}),R.EventType=g,cc.Node=e.exports=R}),{"./event-manager":90,"./event/event":93,"./utils/base-node":201,"./utils/misc":206,"./utils/prefab-helper":208,"./utils/scene-graph-helper":209}],38:[(function(t,e,i){cc.Scene=cc.Class({name:"cc.Scene",extends:t("./CCNode"),properties:{autoReleaseAssets:{default:void 0,type:cc.Boolean}},ctor:function(){var t=this._sgNode=new _ccsg.Scene;t.setAnchorPoint(0,0),this._anchorPoint.x=0,this._anchorPoint.y=0,this._activeInHierarchy=!1,this._inited=!cc.game._isCloning,this.dependAssets=null},destroy:function(){this._super(),this._activeInHierarchy=!1},_onHierarchyChanged:function(){},_instantiate:null,_load:function(){this._inited||(this._onBatchCreated(),this._inited=!0)},_activate:function(t){t=!1!==t,cc.director._nodeActivator.activateNode(this,t)}}),e.exports=cc.Scene}),{"./CCNode":37}],39:[(function(t,e,i){function n(){this._lock=!1,this._scheduler=null,this._elapsed=-1,this._runForever=!1,this._useDelay=!1,this._timesExecuted=0,this._repeat=0,this._delay=0,this._interval=0,this._target=null,this._callback=null}var r=function(t,e,i,n,r,s,o){this.prev=t,this.next=e,this.callback=i,this.target=n,this.priority=r,this.paused=s,this.markedForDeletion=o,this.isUpdate=!i},s=[];r.get=function(t,e,i,n,o,a,c){var h=s.pop();return h?(h.prev=t,h.next=e,h.callback=i,h.target=n,h.priority=o,h.paused=a,h.markedForDeletion=c,h.isUpdate=!i):h=new r(t,e,i,n,o,a,c),h},r.put=function(t){s.length<20&&(t.prev=t.next=t.callback=t.target=null,s.push(t))};var o=function(t,e,i,n){this.list=t,this.entry=e,this.target=i,this.callback=n},a=[];o.get=function(t,e,i,n){var r=a.pop();return r?(r.list=t,r.entry=e,r.target=i,r.callback=n):r=new o(t,e,i,n),r},o.put=function(t){a.length<20&&(t.list=t.entry=t.target=t.callback=null,a.push(t))};var c=function(t,e,i,n,r,s){this.timers=t,this.target=e,this.timerIndex=i,this.currentTimer=n,this.currentTimerSalvaged=r,this.paused=s},h=[];c.get=function(t,e,i,n,r,s){var o=h.pop();return o?(o.timers=t,o.target=e,o.timerIndex=i,o.currentTimer=n,o.currentTimerSalvaged=r,o.paused=s):o=new c(t,e,i,n,r,s),o},c.put=function(t){h.length<20&&(t.timers=t.target=t.currentTimer=null,h.push(t))};var l=n.prototype;l.initWithCallback=function(t,e,i,n,r,s){return this._lock=!1,this._scheduler=t,this._target=i,this._callback=e,this._elapsed=-1,this._interval=n,this._delay=s,this._useDelay=this._delay>0,this._repeat=r,this._runForever=this._repeat===cc.macro.REPEAT_FOREVER,!0},l.getInterval=function(){return this._interval},l.setInterval=function(t){this._interval=t},l.update=function(t){-1===this._elapsed?(this._elapsed=0,this._timesExecuted=0):(this._elapsed+=t,this._runForever&&!this._useDelay?this._elapsed>=this._interval&&(this.trigger(),this._elapsed=0):(this._useDelay?this._elapsed>=this._delay&&(this.trigger(),this._elapsed-=this._delay,this._timesExecuted+=1,this._useDelay=!1):this._elapsed>=this._interval&&(this.trigger(),this._elapsed=0,this._timesExecuted+=1),this._callback&&!this._runForever&&this._timesExecuted>this._repeat&&this.cancel()))},l.getCallback=function(){return this._callback},l.trigger=function(){this._target&&this._callback&&(this._lock=!0,this._callback.call(this._target,this._elapsed),this._lock=!1)},l.cancel=function(){this._scheduler.unschedule(this._callback,this._target)};var _=[];n.get=function(){return _.pop()||new n},n.put=function(t){_.length<20&&!t._lock&&(t._scheduler=t._target=t._callback=null,_.push(t))};var u=function(t){return t.__instanceId||t.uuid};cc.Scheduler=cc._Class.extend({ctor:function(){this._timeScale=1,this._updatesNegList=[],this._updates0List=[],this._updatesPosList=[],this._hashForUpdates={},this._hashForTimers={},this._currentTarget=null,this._currentTargetSalvaged=!1,this._updateHashLocked=!1,this._arrayForTimers=[]},_removeHashElement:function(t){delete this._hashForTimers[u(t.target)];for(var e=this._arrayForTimers,i=0,n=e.length;i<n;i++)if(e[i]===t){e.splice(i,1);break}c.put(t)},_removeUpdateFromHash:function(t){var e=u(t.target),i=this._hashForUpdates[e];if(i){for(var n=i.list,s=i.entry,a=0,c=n.length;a<c;a++)if(n[a]===s){n.splice(a,1);break}delete this._hashForUpdates[e],r.put(s),o.put(i)}},_priorityIn:function(t,e,i){for(var n=0;n<t.length;n++)if(i<t[n].priority)return void t.splice(n,0,e);t.push(e)},_appendIn:function(t,e){t.push(e)},setTimeScale:function(t){this._timeScale=t},getTimeScale:function(){return this._timeScale},update:function(t){this._updateHashLocked=!0,1!==this._timeScale&&(t*=this._timeScale);var e,i,n,r;for(e=0,n=(i=this._updatesNegList).length;e<n;e++)(r=i[e]).paused||r.markedForDeletion||(r.isUpdate?r.target.update(t):r.callback.call(r.target,t));for(e=0,n=(i=this._updates0List).length;e<n;e++)(r=i[e]).paused||r.markedForDeletion||(r.isUpdate?r.target.update(t):r.callback.call(r.target,t));for(e=0,n=(i=this._updatesPosList).length;e<n;e++)(r=i[e]).paused||r.markedForDeletion||(r.isUpdate?r.target.update(t):r.callback.call(r.target,t));var s,o=this._arrayForTimers;for(e=0;e<o.length;e++){if(s=o[e],this._currentTarget=s,this._currentTargetSalvaged=!1,!s.paused)for(s.timerIndex=0;s.timerIndex<s.timers.length;++s.timerIndex)s.currentTimer=s.timers[s.timerIndex],s.currentTimerSalvaged=!1,s.currentTimer.update(t),s.currentTimer=null;this._currentTargetSalvaged&&0===this._currentTarget.timers.length&&(this._removeHashElement(this._currentTarget),--e)}for(e=0,i=this._updatesNegList;e<i.length;)(r=i[e]).markedForDeletion?this._removeUpdateFromHash(r):e++;for(e=0,i=this._updates0List;e<i.length;)(r=i[e]).markedForDeletion?this._removeUpdateFromHash(r):e++;for(e=0,i=this._updatesPosList;e<i.length;)(r=i[e]).markedForDeletion?this._removeUpdateFromHash(r):e++;this._updateHashLocked=!1,this._currentTarget=null},scheduleCallbackForTarget:function(t,e,i,n,r,s){this.schedule(e,t,i,n,r,s)},schedule:function(t,e,i,r,s,o){"use strict";if("function"!=typeof t){var a=t;t=e,e=a}4!==arguments.length&&5!==arguments.length||(o=!!r,r=cc.macro.REPEAT_FOREVER,s=0),cc.assertID(e,1502);var h=u(e);cc.assertID(h,1510);var l=this._hashForTimers[h];l?l.paused!==o&&cc.warnID(1511):(l=c.get(null,e,0,null,null,o),this._arrayForTimers.push(l),this._hashForTimers[h]=l);var _,d;if(null==l.timers)l.timers=[];else for(d=0;d<l.timers.length;++d)if((_=l.timers[d])&&t===_._callback)return cc.logID(1507,_.getInterval(),i),void(_._interval=i);(_=n.get()).initWithCallback(this,t,e,i,r,s),l.timers.push(_),this._currentTarget===l&&this._currentTargetSalvaged&&(this._currentTargetSalvaged=!1)},scheduleUpdate:function(t,e,i,n){var s=u(t);cc.assertID(s,1510);var a=this._hashForUpdates[s];if(a&&a.entry){if(a.entry.priority===e)return a.entry.markedForDeletion=!1,void(a.entry.paused=i);if(this._updateHashLocked)return cc.logID(1506),a.entry.markedForDeletion=!1,void(a.entry.paused=i);this.unscheduleUpdate(t)}n&&cc.warnID(1512);var c,h=r.get(null,null,n,t,e,i,!1);0===e?(c=this._updates0List,this._appendIn(c,h)):(c=e<0?this._updatesNegList:this._updatesPosList,this._priorityIn(c,h,e)),this._hashForUpdates[s]=o.get(c,h,t,null)},unschedule:function(t,e){if(e&&t){var i=u(e);cc.assertID(i,1510);var r=this._hashForTimers[i];if(r)for(var s=r.timers,o=0,a=s.length;o<a;o++){var c=s[o];if(t===c._callback)return c!==r.currentTimer||r.currentTimerSalvaged||(r.currentTimerSalvaged=!0),s.splice(o,1),n.put(c),r.timerIndex>=o&&r.timerIndex--,void(0===s.length&&(this._currentTarget===r?this._currentTargetSalvaged=!0:this._removeHashElement(r)))}}},unscheduleUpdate:function(t){if(t){var e=u(t);cc.assertID(e,1510);var i=this._hashForUpdates[e];i&&(this._updateHashLocked?i.entry.markedForDeletion=!0:this._removeUpdateFromHash(i.entry))}},unscheduleAllForTarget:function(t){if(t){var e=u(t);cc.assertID(e,1510);var i=this._hashForTimers[e];if(i){var r=i.timers;r.indexOf(i.currentTimer)>-1&&!i.currentTimerSalvaged&&(i.currentTimerSalvaged=!0);for(var s=0,o=r.length;s<o;s++)n.put(r[s]);r.length=0,this._currentTarget===i?this._currentTargetSalvaged=!0:this._removeHashElement(i)}this.unscheduleUpdate(t)}},unscheduleAll:function(){this.unscheduleAllWithMinPriority(cc.Scheduler.PRIORITY_SYSTEM)},unscheduleAllWithMinPriority:function(t){var e,i,n=this._arrayForTimers;for(e=n.length-1;e>=0;e--)i=n[e],this.unscheduleAllForTarget(i.target);var r,s=0;if(t<0)for(e=0;e<this._updatesNegList.length;)s=this._updatesNegList.length,(r=this._updatesNegList[e])&&r.priority>=t&&this.unscheduleUpdate(r.target),s==this._updatesNegList.length&&e++;if(t<=0)for(e=0;e<this._updates0List.length;)s=this._updates0List.length,(r=this._updates0List[e])&&this.unscheduleUpdate(r.target),s==this._updates0List.length&&e++;for(e=0;e<this._updatesPosList.length;)s=this._updatesPosList.length,(r=this._updatesPosList[e])&&r.priority>=t&&this.unscheduleUpdate(r.target),s==this._updatesPosList.length&&e++},isScheduled:function(t,e){cc.assertID(t,1508),cc.assertID(e,1509);var i=u(e);cc.assertID(i,1510);var n=this._hashForTimers[i];if(!n)return!1;if(null==n.timers)return!1;for(var r=n.timers,s=0;s<r.length;++s){if(t===r[s]._callback)return!0}return!1},pauseAllTargets:function(){return this.pauseAllTargetsWithMinPriority(cc.Scheduler.PRIORITY_SYSTEM)},pauseAllTargetsWithMinPriority:function(t){var e,i,n,r=[],s=this._arrayForTimers;for(i=0,n=s.length;i<n;i++)(e=s[i])&&(e.paused=!0,r.push(e.target));var o;if(t<0)for(i=0;i<this._updatesNegList.length;i++)(o=this._updatesNegList[i])&&o.priority>=t&&(o.paused=!0,r.push(o.target));if(t<=0)for(i=0;i<this._updates0List.length;i++)(o=this._updates0List[i])&&(o.paused=!0,r.push(o.target));for(i=0;i<this._updatesPosList.length;i++)(o=this._updatesPosList[i])&&o.priority>=t&&(o.paused=!0,r.push(o.target));return r},resumeTargets:function(t){if(t)for(var e=0;e<t.length;e++)this.resumeTarget(t[e])},pauseTarget:function(t){cc.assertID(t,1503);var e=u(t);cc.assertID(e,1510);var i=this._hashForTimers[e];i&&(i.paused=!0);var n=this._hashForUpdates[e];n&&(n.entry.paused=!0)},resumeTarget:function(t){cc.assertID(t,1504);var e=u(t);cc.assertID(e,1510);var i=this._hashForTimers[e];i&&(i.paused=!1);var n=this._hashForUpdates[e];n&&(n.entry.paused=!1)},isTargetPaused:function(t){cc.assertID(t,1505);var e=u(t);cc.assertID(e,1510);var i=this._hashForTimers[e];if(i)return i.paused;var n=this._hashForUpdates[e];return!!n&&n.entry.paused},scheduleUpdateForTarget:function(t,e,i){this.scheduleUpdate(t,e,i)},unscheduleCallbackForTarget:function(t,e){this.unschedule(e,t)},unscheduleUpdateForTarget:function(t){this.unscheduleUpdate(t)},unscheduleAllCallbacksForTarget:function(t){this.unscheduleAllForTarget(t)},unscheduleAllCallbacks:function(){this.unscheduleAllWithMinPriority(cc.Scheduler.PRIORITY_SYSTEM)},unscheduleAllCallbacksWithMinPriority:function(t){this.unscheduleAllWithMinPriority(t)}}),cc.Scheduler.PRIORITY_SYSTEM=1<<31,cc.Scheduler.PRIORITY_NON_SYSTEM=cc.Scheduler.PRIORITY_SYSTEM+1}),{}],40:[(function(t,e,i){var n=t("./CCRawAsset");cc.Asset=cc.Class({name:"cc.Asset",extends:n,properties:{rawUrl:{get:function(){if(this._rawFiles){if(cc.AssetLibrary)return cc.AssetLibrary.getLibUrlNoExt(this._uuid)+"/"+this._rawFiles[0];cc.errorID(6400)}return""},visible:!1},rawUrls:{get:function(){if(this._rawFiles){if(cc.AssetLibrary){var t=cc.AssetLibrary.getLibUrlNoExt(this._uuid)+"/";return this._rawFiles.map((function(e){return t+e}))}cc.errorID(6401)}return[]},visible:!1},_rawFiles:null},statics:{deserialize:function(t){return cc.deserialize(t)},preventDeferredLoadDependents:!1},serialize:function(){return Editor.serialize(this)},createNode:null,_setRawFiles:function(t){this._rawFiles=t.length>0?t:null},_preloadRawFiles:null}),e.exports=cc.Asset}),{"./CCRawAsset":46}],41:[(function(t,e,i){var n=cc.Class({name:"cc.AudioClip",extends:cc.RawAsset});cc.AudioClip=n,e.exports=n}),{}],42:[(function(t,e,i){var n=cc.Class({name:"cc.BitmapFont",extends:cc.Font,properties:{fntDataStr:{default:""},spriteFrame:{default:null,type:cc.SpriteFrame},fontSize:{default:-1},_fntConfig:null}});cc.BitmapFont=n,e.exports=n}),{}],43:[(function(t,e,i){var n=cc.Class({name:"cc.Font",extends:cc.Asset});cc.Font=n,e.exports=n}),{}],44:[(function(t,e,i){var n=cc.Class({name:"cc.LabelAtlas",extends:cc.BitmapFont});cc.LabelAtlas=n,e.exports=n}),{}],45:[(function(t,e,i){var n=cc.Class({name:"cc.Prefab",extends:cc.Asset,properties:{data:null,asyncLoadAssets:void 0,_createFunction:{default:null,serializable:!1}},createNode:!1,compileCreateFunction:function(){var e=t("../platform/instantiate-jit");this._createFunction=e.compile(this.data)},_doInstantiate:function(t){return this.data._prefab?this.data._prefab._synced=!0:cc.warnID(3700),this._createFunction||this.compileCreateFunction(),this._createFunction(t)},_instantiate:function(){return this.data._prefab._synced=!0,this.data._instantiate()}});cc.Prefab=e.exports=n,cc.js.obsolete(cc,"cc._Prefab","Prefab")}),{"../platform/instantiate-jit":175}],46:[(function(t,e,i){var n=t("../platform/CCObject");cc.RawAsset=cc.Class({name:"cc.RawAsset",extends:n,ctor:function(){Object.defineProperty(this,"_uuid",{value:"",writable:!0})},statics:{createNodeByInfo:null}}),Object.defineProperty(cc.RawAsset,"isRawAssetType",{value:function(t){return cc.isChildClassOf(t,cc.RawAsset)&&!cc.isChildClassOf(t,cc.Asset)}}),e.exports=cc.RawAsset}),{"../platform/CCObject":162}],47:[(function(t,e,i){var n=cc.Class({name:"cc.SceneAsset",extends:cc.Asset,properties:{scene:null,asyncLoadAssets:void 0}});cc.SceneAsset=n,e.exports=n}),{}],48:[(function(t,e,i){var n=cc.Class({name:"cc.Script",extends:cc.Asset});cc._Script=n;var r=cc.Class({name:"cc.JavaScript",extends:n});cc._JavaScript=r;var s=cc.Class({name:"cc.CoffeeScript",extends:n});cc._CoffeeScript=s;var o=cc.Class({name:"cc.TypeScript",extends:n});cc._TypeScript=o}),{}],49:[(function(t,e,i){var n=cc.Class({name:"cc.SpriteAtlas",extends:cc.Asset,properties:{_spriteFrames:{default:{}}},getTexture:function(){var t=Object.keys(this._spriteFrames);if(t.length>0){var e=this._spriteFrames[t[0]];return e?e.getTexture():null}return null},getSpriteFrame:function(t){return this._spriteFrames[t]},getSpriteFrames:function(){var t=[],e=this._spriteFrames;for(var i in e)t.push(e[i]);return t}});cc.SpriteAtlas=n,e.exports=n}),{}],50:[(function(t,e,i){var n=cc.Class({name:"cc.TTFFont",extends:cc.Font});cc.TTFFont=n,e.exports=n}),{}],51:[(function(t,e,i){t("./CCRawAsset"),t("./CCAsset"),t("./CCFont"),t("./CCPrefab"),t("./CCAudioClip"),t("./CCScripts"),t("./CCSceneAsset"),t("../sprites/CCSpriteFrame"),t("../textures/CCTexture2D"),t("./CCTTFFont"),t("./CCSpriteAtlas"),t("./CCBitmapFont"),t("./CCLabelAtlas")}),{"../sprites/CCSpriteFrame":195,"../textures/CCTexture2D":196,"./CCAsset":40,"./CCAudioClip":41,"./CCBitmapFont":42,"./CCFont":43,"./CCLabelAtlas":44,"./CCPrefab":45,"./CCRawAsset":46,"./CCSceneAsset":47,"./CCScripts":48,"./CCSpriteAtlas":49,"./CCTTFFont":50}],52:[(function(t,e,i){var n=t("../utils/misc"),r=t("../event-manager"),s=!!cc.ActionManager,o=function(){};cc.s_globalOrderOfArrival=1,_ccsg.Node=cc.Class({name:"ccsg.Node",properties:{_running:!1,_localZOrder:0,_globalZOrder:0,_arrivalOrder:0,_reorderChildDirty:!1,_vertexZ:0,_customZ:void 0,_rotationX:0,_rotationY:0,_scaleX:1,_scaleY:1,_position:cc.p(0,0),_skewX:0,_skewY:0,_children:[],_visible:!0,_anchorPoint:cc.p(0,0),_contentSize:cc.size(0,0),_parent:null,_ignoreAnchorPointForPosition:!1,tag:cc.macro.NODE_TAG_INVALID,_name:"",_realOpacity:255,_realColor:cc.Color.WHITE,_cascadeColorEnabled:!1,_cascadeOpacityEnabled:!1,_isTransitionFinished:!1,_actionManager:null,_scheduler:null,_renderCmd:null},ctor:function(){this.__instanceId=cc.ClassManager.getNewInstanceId(),this._renderCmd=this._createRenderCmd()},init:function(){return!0},attr:function(t){for(var e in t)this[e]=t[e]},getSkewX:function(){return this._skewX},setSkewX:function(t){this._skewX=t,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty)},getSkewY:function(){return this._skewY},setSkewY:function(t){this._skewY=t,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty)},setLocalZOrder:function(t){this._parent?this._parent.reorderChild(this,t):this._localZOrder=t,r._setDirtyForNode(this)},_setLocalZOrder:function(t){this._localZOrder=t},getLocalZOrder:function(){return this._localZOrder},getZOrder:function(){return cc.logID(1600),this.getLocalZOrder()},setZOrder:function(t){cc.logID(1601),this.setLocalZOrder(t)},setGlobalZOrder:function(t){this._globalZOrder!==t&&(this._globalZOrder=t,r._setDirtyForNode(this))},getGlobalZOrder:function(){return this._globalZOrder},getVertexZ:function(){return this._vertexZ},setVertexZ:function(t){this._customZ=this._vertexZ=t},getRotation:function(){return this._rotationX!==this._rotationY&&cc.logID(1602),this._rotationX},setRotation:function(t){this._rotationX=this._rotationY=t,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty)},getRotationX:function(){return this._rotationX},setRotationX:function(t){this._rotationX=t,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty)},getRotationY:function(){return this._rotationY},setRotationY:function(t){this._rotationY=t,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty)},getScale:function(){return this._scaleX!==this._scaleY&&cc.logID(1603),this._scaleX},setScale:function(t,e){this._scaleX=t,this._scaleY=e||0===e?e:t,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty)},getScaleX:function(){return this._scaleX},setScaleX:function(t){this._scaleX=t,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty)},getScaleY:function(){return this._scaleY},setScaleY:function(t){this._scaleY=t,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty)},setPosition:function(t,e){var i=this._position;if(void 0===e){if(i.x===t.x&&i.y===t.y)return;i.x=t.x,i.y=t.y}else{if(i.x===t&&i.y===e)return;i.x=t,i.y=e}this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty)},getPosition:function(){return cc.p(this._position)},getPositionX:function(){return this._position.x},setPositionX:function(t){this._position.x=t,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty)},getPositionY:function(){return this._position.y},setPositionY:function(t){this._position.y=t,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty)},getChildrenCount:function(){return this._children.length},getChildren:function(){return this._children},isVisible:function(){return this._visible},setVisible:function(t){this._visible!==t&&(this._visible=t,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty),cc.renderer.childrenOrderDirty=!0)},getAnchorPoint:function(){return cc.p(this._anchorPoint)},setAnchorPoint:function(t,e){var i=this._anchorPoint;if(void 0===e){if(t.x===i.x&&t.y===i.y)return;i.x=t.x,i.y=t.y}else{if(t===i.x&&e===i.y)return;i.x=t,i.y=e}this._renderCmd._updateAnchorPointInPoint()},_getAnchorX:function(){return this._anchorPoint.x},_setAnchorX:function(t){this._anchorPoint.x!==t&&(this._anchorPoint.x=t,this._renderCmd._updateAnchorPointInPoint())},_getAnchorY:function(){return this._anchorPoint.y},_setAnchorY:function(t){this._anchorPoint.y!==t&&(this._anchorPoint.y=t,this._renderCmd._updateAnchorPointInPoint())},getAnchorPointInPoints:function(){return this._renderCmd.getAnchorPointInPoints()},_getWidth:function(){return this._contentSize.width},_setWidth:function(t){this._contentSize.width=t,this._renderCmd._updateAnchorPointInPoint()},_getHeight:function(){return this._contentSize.height},_setHeight:function(t){this._contentSize.height=t,this._renderCmd._updateAnchorPointInPoint()},getContentSize:function(){return cc.size(this._contentSize)},setContentSize:function(t,e){var i=this._contentSize;if(void 0===e){if(t.width===i.width&&t.height===i.height)return;i.width=t.width,i.height=t.height}else{if(t===i.width&&e===i.height)return;i.width=t,i.height=e}this._renderCmd._updateAnchorPointInPoint()},isRunning:function(){return this._running},getParent:function(){return this._parent},setParent:function(t){this._parent=t;var e=_ccsg.Node._dirtyFlags;this._renderCmd.setDirtyFlag(e.transformDirty|e.opacityDirty)},isIgnoreAnchorPointForPosition:function(){return this._ignoreAnchorPointForPosition},setIgnoreAnchorPointForPosition:function(t){t!==this._ignoreAnchorPointForPosition&&(this._ignoreAnchorPointForPosition=t,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty))},getTag:function(){return this.tag},setTag:function(t){this.tag=t},setName:function(t){this._name=t},getName:function(){return this._name},updateOrderOfArrival:function(){this._arrivalOrder=++cc.s_globalOrderOfArrival},getScheduler:function(){return this._scheduler||cc.director.getScheduler()},setScheduler:function(t){this._scheduler!==t&&(this.unscheduleAllCallbacks(),this._scheduler=t)},boundingBox:function(){return cc.logID(1608),this.getBoundingBox()},getBoundingBox:function(){var t=cc.rect(0,0,this._contentSize.width,this._contentSize.height);return cc._rectApplyAffineTransformIn(t,this.getNodeToParentTransform())},cleanup:function(){this.stopAllActions(),this.unscheduleAllCallbacks(),r.removeListeners(this)},getChildByTag:function(t){var e=this._children;if(null!==e)for(var i=0;i<e.length;i++){var n=e[i];if(n&&n.tag===t)return n}return null},getChildByName:function(t){if(!t)return cc.log("Invalid name"),null;for(var e=this._children,i=0,n=e.length;i<n;i++)if(e[i]._name===t)return e[i];return null},addChild:function(t,e,i){e=void 0===e?t._localZOrder:e;var n,r=!1;void 0===i?n=t._name:"string"==typeof i?(n=i,i=void 0):"number"==typeof i&&(r=!0,n=""),cc.assertID(t,1606),cc.assertID(null===t._parent,1605),this._addChildHelper(t,e,i,n,r)},_addChildHelper:function(t,e,i,n,r){this._children||(this._children=[]),this._insertChild(t,e),r?t.setTag(i):t.setName(n),t.setParent(this),t.updateOrderOfArrival(),this._running&&(t.performRecursive(_ccsg.Node.performType.onEnter),this._isTransitionFinished&&t.performRecursive(_ccsg.Node.performType.onEnterTransitionDidFinish)),t._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty),this._cascadeColorEnabled&&t._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.colorDirty),this._cascadeOpacityEnabled&&t._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.opacityDirty)},removeFromParent:function(t){this._parent&&(void 0===t&&(t=!0),this._parent.removeChild(this,t))},removeFromParentAndCleanup:function(t){cc.logID(1607),this.removeFromParent(t)},removeChild:function(t,e){0!==this._children.length&&(void 0===e&&(e=!0),this._children.indexOf(t)>-1&&this._detachChild(t,e),cc.renderer.childrenOrderDirty=!0)},removeChildByTag:function(t,e){t===cc.macro.NODE_TAG_INVALID&&cc.logID(1609);var i=this.getChildByTag(t);i?this.removeChild(i,e):cc.logID(1610,t)},removeAllChildrenWithCleanup:function(t){this.removeAllChildren(t)},removeAllChildren:function(t){var e=this._children;if(null!==e){void 0===t&&(t=!0);for(var i=0;i<e.length;i++){var n=e[i];n&&(this._running&&(n.performRecursive(_ccsg.Node.performType.onExitTransitionDidStart),n.performRecursive(_ccsg.Node.performType.onExit)),t&&n.performRecursive(_ccsg.Node.performType.cleanup),n.parent=null,n._renderCmd.detachFromParent())}this._children.length=0,cc.renderer.childrenOrderDirty=!0}},_detachChild:function(t,e){this._running&&(t.performRecursive(_ccsg.Node.performType.onExitTransitionDidStart),t.performRecursive(_ccsg.Node.performType.onExit)),e&&t.performRecursive(_ccsg.Node.performType.cleanup),t.parent=null,t._renderCmd.detachFromParent(),cc.js.array.remove(this._children,t)},_insertChild:function(t,e){cc.renderer.childrenOrderDirty=this._reorderChildDirty=!0,this._children.push(t),t._setLocalZOrder(e)},setNodeDirty:function(){this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty)},reorderChild:function(t,e){cc.assertID(t,1617),-1!==this._children.indexOf(t)?e!==t.zIndex&&(cc.renderer.childrenOrderDirty=this._reorderChildDirty=!0,t.updateOrderOfArrival(),t._setLocalZOrder(e),this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.orderDirty)):cc.logID(1635)},sortAllChildren:function(){if(this._reorderChildDirty){var t,e,i,n=this._children,r=n.length;for(t=1;t<r;t++){for(i=n[t],e=t-1;e>=0;){if(i._localZOrder<n[e]._localZOrder)n[e+1]=n[e];else{if(!(i._localZOrder===n[e]._localZOrder&&i._arrivalOrder<n[e]._arrivalOrder))break;n[e+1]=n[e]}e--}n[e+1]=i}this._reorderChildDirty=!1}},draw:function(t){},transformAncestors:function(){null!==this._parent&&(this._parent.transformAncestors(),this._parent.transform())},onEnter:function(){this._isTransitionFinished=!1,this._running=!0,this.resume()},performRecursive:function(t){var e=_ccsg.Node.performType;if(!(t>=e.max)){var i,n,r,s,o,a=0,c=_ccsg.Node._performStacks[_ccsg.Node._performing];for(c||(c=[],_ccsg.Node._performStacks.push(c)),c.length=0,_ccsg.Node._performing++,r=c[0]=this;r;){if((i=r._children)&&i.length>0)for(s=0,o=i.length;s<o;++s)n=i[s],c.push(n);r=c[++a]}switch(t){case e.onEnter:for(s=c.length-1;s>=0;--s)r=c[s],c[s]=null,r&&r.onEnter();break;case e.onExit:for(s=c.length-1;s>=0;--s)r=c[s],c[s]=null,r&&r.onExit();break;case e.onEnterTransitionDidFinish:for(s=c.length-1;s>=0;--s)r=c[s],c[s]=null,r&&r.onEnterTransitionDidFinish();break;case e.cleanup:for(s=c.length-1;s>=0;--s)r=c[s],c[s]=null,r&&r.cleanup();break;case e.onExitTransitionDidStart:for(s=c.length-1;s>=0;--s)r=c[s],c[s]=null,r&&r.onExitTransitionDidStart()}_ccsg.Node._performing--}},onEnterTransitionDidFinish:function(){this._isTransitionFinished=!0},onExitTransitionDidStart:function(){},onExit:function(){this._running=!1,this.pause()},runAction:s?function(t){return cc.assertID(t,1618),cc.director.getActionManager().addAction(t,this,!this._running),t}:o,stopAllActions:s?function(){cc.director.getActionManager().removeAllActionsFromTarget(this)}:o,stopAction:s?function(t){cc.director.getActionManager().removeAction(t)}:o,stopActionByTag:s?function(t){t!==cc.Action.TAG_INVALID?cc.director.getActionManager().removeActionByTag(t,this):cc.logID(1612)}:o,getActionByTag:s?function(t){return t===cc.Action.TAG_INVALID?(cc.logID(1613),null):cc.director.getActionManager().getActionByTag(t,this)}:function(){return null},getNumberOfRunningActions:s?function(){return cc.director.getActionManager().getNumberOfRunningActionsInTarget(this)}:function(){return 0},scheduleUpdate:function(){this.scheduleUpdateWithPriority(0)},scheduleUpdateWithPriority:function(t){this.scheduler.scheduleUpdate(this,t,!this._running)},unscheduleUpdate:function(){this.scheduler.unscheduleUpdate(this)},schedule:function(t,e,i,n,r){var s=arguments.length;"function"==typeof t?1===s?(e=0,i=cc.macro.REPEAT_FOREVER,n=0,r=this.__instanceId):2===s?"number"==typeof e?(i=cc.macro.REPEAT_FOREVER,n=0,r=this.__instanceId):(r=e,e=0,i=cc.macro.REPEAT_FOREVER,n=0):3===s?("string"==typeof i?(r=i,i=cc.macro.REPEAT_FOREVER):r=this.__instanceId,n=0):4===s&&(r=this.__instanceId):1===s?(e=0,i=cc.macro.REPEAT_FOREVER,n=0):2===s&&(i=cc.macro.REPEAT_FOREVER,n=0),cc.assertID(t,1619),cc.assertID(e>=0,1620),e=e||0,i=isNaN(i)?cc.macro.REPEAT_FOREVER:i,n=n||0,this.scheduler.schedule(t,this,e,i,n,!this._running,r)},scheduleOnce:function(t,e,i){void 0===i&&(i=this.__instanceId),this.schedule(t,0,0,e,i)},unschedule:function(t){t&&this.scheduler.unschedule(t,this)},unscheduleAllCallbacks:function(){this.scheduler.unscheduleAllForTarget(this)},resumeSchedulerAndActions:function(){cc.logID(1614),this.resume()},resume:function(){this.scheduler.resumeTarget(this),s&&cc.director.getActionManager().resumeTarget(this),r.resumeTarget(this)},pauseSchedulerAndActions:function(){cc.logID(1615),this.pause()},pause:function(){this.scheduler.pauseTarget(this),s&&cc.director.getActionManager().pauseTarget(this),r.pauseTarget(this)},getParentToNodeTransform:function(){return this._renderCmd.getParentToNodeTransform()},parentToNodeTransform:function(){return this.getParentToNodeTransform()},getNodeToWorldTransform:function(){for(var t=this.getNodeToParentTransform(),e=this._parent;null!==e;e=e.parent)t=cc.affineTransformConcat(t,e.getNodeToParentTransform());return t},nodeToWorldTransform:function(){return this.getNodeToWorldTransform()},getWorldToNodeTransform:function(){return cc.affineTransformInvert(this.getNodeToWorldTransform())},worldToNodeTransform:function(){return this.getWorldToNodeTransform()},convertToNodeSpace:function(t){return cc.pointApplyAffineTransform(t,this.getWorldToNodeTransform())},convertToWorldSpace:function(t){return t=t||cc.v2(0,0),cc.pointApplyAffineTransform(t,this.getNodeToWorldTransform())},convertToNodeSpaceAR:function(t){return cc.pSub(this.convertToNodeSpace(t),this._renderCmd.getAnchorPointInPoints())},convertToWorldSpaceAR:function(t){t=t||cc.v2(0,0);var e=cc.pAdd(t,this._renderCmd.getAnchorPointInPoints());return this.convertToWorldSpace(e)},_convertToWindowSpace:function(t){var e=this.convertToWorldSpace(t);return cc.director.convertToUI(e)},convertTouchToNodeSpace:function(t){var e=t.getLocation();return this.convertToNodeSpace(e)},convertTouchToNodeSpaceAR:function(t){var e=cc.director.convertToGL(t.getLocation());return this.convertToNodeSpaceAR(e)},updateTransform:function(){for(var t=this._children,e=0;e<t.length;e++){var i;(i=t[e])&&i.updateTransform()}},retain:function(){},release:function(){},visit:function(t){var e=this._renderCmd,i=t?t._renderCmd:null;if(this._visible){var n=cc.renderer;e.visit(i);var r,s,o=this._children,a=o.length;if(a>0){for(this._reorderChildDirty&&this.sortAllChildren(),r=0;r<a&&(s=o[r])._localZOrder<0;r++)s.visit(this);for(n.pushRenderCommand(e);r<a;r++)o[r].visit(this)}else n.pushRenderCommand(e);e._dirtyFlag=0}else e._propagateFlagsDown(i)},transform:function(t,e){this._renderCmd.transform(t,e)},nodeToParentTransform:function(){return this.getNodeToParentTransform()},getNodeToParentTransform:function(t){var e=this._renderCmd.getNodeToParentTransform();if(t){for(var i={a:e.a,b:e.b,c:e.c,d:e.d,tx:e.tx,ty:e.ty},n=this._parent;null!=n&&n!=t;n=n.getParent())cc.affineTransformConcatIn(i,n.getNodeToParentTransform());return i}return e},getNodeToParentAffineTransform:function(t){return this.getNodeToParentTransform(t)},getShaderProgram:function(){return this._renderCmd.getShaderProgram()},setShaderProgram:function(t){this._renderCmd.setShaderProgram(t)},getGLServerState:function(){return 0},setGLServerState:function(t){},getBoundingBoxToWorld:function(){var t=cc.rect(0,0,this._contentSize.width,this._contentSize.height),e=this.getNodeToWorldTransform();if(cc._rectApplyAffineTransformIn(t,e),!this._children)return t;for(var i=this._children,n=0;n<i.length;n++){var r=i[n];if(r&&r._visible){var s=r._getBoundingBoxToCurrentNode(e);s&&(t=cc.rectUnion(t,s))}}return t},_getBoundingBoxToCurrentNode:function(t){var e=cc.rect(0,0,this._contentSize.width,this._contentSize.height),i=void 0===t?this.getNodeToParentTransform():cc.affineTransformConcat(this.getNodeToParentTransform(),t);if(cc._rectApplyAffineTransformIn(e,i),!this._children)return e;for(var n=this._children,r=0;r<n.length;r++){var s=n[r];if(s&&s._visible){var o=s._getBoundingBoxToCurrentNode(i);o&&(e=cc.rectUnion(e,o))}}return e},getOpacity:function(){return this._realOpacity},getDisplayedOpacity:function(){return this._renderCmd.getDisplayedOpacity()},setOpacity:function(t){this._realOpacity=t,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.opacityDirty)},updateDisplayedOpacity:function(t){this._renderCmd._updateDisplayOpacity(t)},isCascadeOpacityEnabled:function(){return this._cascadeOpacityEnabled},setCascadeOpacityEnabled:function(t){this._cascadeOpacityEnabled!==t&&(this._cascadeOpacityEnabled=t,this._renderCmd.setCascadeOpacityEnabledDirty())},getColor:function(){var t=this._realColor;return cc.color(t.r,t.g,t.b,t.a)},getDisplayedColor:function(){return this._renderCmd.getDisplayedColor()},setColor:function(t){var e=this._realColor;e.r=t.r,e.g=t.g,e.b=t.b,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.colorDirty)},updateDisplayedColor:function(t){this._renderCmd._updateDisplayColor(t)},isCascadeColorEnabled:function(){return this._cascadeColorEnabled},setCascadeColorEnabled:function(t){this._cascadeColorEnabled!==t&&(this._cascadeColorEnabled=t,this._renderCmd.setCascadeColorEnabledDirty())},setOpacityModifyRGB:function(t){},isOpacityModifyRGB:function(){return!1},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_CANVAS?new _ccsg.Node.CanvasRenderCmd(this):new _ccsg.Node.WebGLRenderCmd(this)}}),_ccsg.Node.extend=cc._Class.extend,_ccsg.Node.prototype.ctor=_ccsg.Node,_ccsg.Node.performType={onEnter:1,onExit:2,cleanup:3,onEnterTransitionDidFinish:4,onExitTransitionDidStart:5,max:6},_ccsg.Node._performStacks=[[]],_ccsg.Node._performing=0;n.propertyDefine(_ccsg.Node,["skewX","skewY","vertexZ","rotation","rotationX","rotationY","scale","scaleX","scaleY","children","childrenCount","parent","scheduler","shaderProgram","opacity","color"],{x:["getPositionX","setPositionX"],y:["getPositionY","setPositionY"],width:["_getWidth","_setWidth"],height:["_getHeight","_setHeight"],anchorX:["_getAnchorX","_setAnchorX"],anchorY:["_getAnchorY","_setAnchorY"],zIndex:["getLocalZOrder","setLocalZOrder"],visible:["isVisible","setVisible"],running:["isRunning"],ignoreAnchor:["isIgnoreAnchorPointForPosition","setIgnoreAnchorPointForPosition"],opacityModifyRGB:["isOpacityModifyRGB","setOpacityModifyRGB"],cascadeOpacity:["isCascadeOpacityEnabled","setCascadeOpacityEnabled"],cascadeColor:["isCascadeColorEnabled","setCascadeColorEnabled"]})}),{"../event-manager":90,"../utils/misc":206}],53:[(function(t,e,i){function n(t,e){var i,n,r,s,o,a,c=1,h=_ccsg.Node._performStacks[_ccsg.Node._performing];h||(h=[],_ccsg.Node._performStacks.push(h)),h.length=0,_ccsg.Node._performing++,h[0]=t;for(;c;)if(c--,r=h[c],h[c]=null,r&&(i=r._children)&&i.length>0)for(s=r._renderCmd,o=0,a=i.length;o<a;++o)n=i[o],h[c]=n,c++,n._renderCmd[e](s);_ccsg.Node._performing--}cc.CustomRenderCmd=function(t,e){this._needDraw=!0,this._target=t,this._callback=e},cc.CustomRenderCmd.prototype.rendering=function(t,e,i){this._callback&&this._callback.call(this._target,t,e,i)};var r=_ccsg.Node._dirtyFlags={transformDirty:1,visibleDirty:2,colorDirty:4,opacityDirty:8,cacheDirty:16,orderDirty:32,textDirty:64,gradientDirty:128,textureDirty:256,contentDirty:512,cullingDirty:1024,COUNT:9};cc.js.get(r,"all",(function(){return(1<<r.COUNT)-1}),!1),_ccsg.Node._requestDirtyFlag=function(t){cc.assertID(!r[t],1622,t);var e=1<<r.COUNT;return r[t]=e,r.COUNT++,e};var s=Math.PI/180;_ccsg.Node.RenderCmd=function(t){this._node=t,this._anchorPointInPoints=new cc.Vec2(0,0),this._needDraw=!1,this._dirtyFlag=1,this._curLevel=-1,this._cameraFlag=0,this._displayedColor=new cc.Color(255,255,255,255),this._displayedOpacity=255,this._cascadeColorEnabledDirty=!1,this._cascadeOpacityEnabledDirty=!1,this._transform={a:1,b:0,c:0,d:1,tx:0,ty:0},this._worldTransform={a:1,b:0,c:0,d:1,tx:0,ty:0},this._inverse={a:1,b:0,c:0,d:1,tx:0,ty:0},this._transformUpdated=!1,cc.renderer.pushDirtyNode(this)},_ccsg.Node.RenderCmd.prototype={constructor:_ccsg.Node.RenderCmd,_ctor:_ccsg.Node.RenderCmd,getAnchorPointInPoints:function(){return cc.p(this._anchorPointInPoints)},getDisplayedColor:function(){var t=this._displayedColor;return cc.color(t.r,t.g,t.b,t.a)},getDisplayedOpacity:function(){return this._displayedOpacity},setCascadeColorEnabledDirty:function(){this._cascadeColorEnabledDirty=!0,this.setDirtyFlag(r.colorDirty)},setCascadeOpacityEnabledDirty:function(){this._cascadeOpacityEnabledDirty=!0,this.setDirtyFlag(r.opacityDirty)},getParentToNodeTransform:function(){return this._dirtyFlag&r.transformDirty&&cc.affineTransformInvertOut(this.getNodeToParentTransform(),this._inverse),this._inverse},detachFromParent:function(){},_updateAnchorPointInPoint:function(){var t=this._anchorPointInPoints,e=this._node._contentSize,i=this._node._anchorPoint;t.x=e.width*i.x,t.y=e.height*i.y,this.setDirtyFlag(r.transformDirty)},setDirtyFlag:function(t){0===this._dirtyFlag&&0!==t&&cc.renderer.pushDirtyNode(this),this._dirtyFlag|=t},getParentRenderCmd:function(){return this._node&&this._node._parent&&this._node._parent._renderCmd?this._node._parent._renderCmd:null},updateTransform:function(t,e){var i=this._node,n=t?t._worldTransform:null,r=this._transform,o=this._worldTransform;if(!this._transformUpdated){var a=i._rotationX||i._rotationY,c=i._skewX||i._skewY,h=i._scaleX,l=i._scaleY,_=this._anchorPointInPoints.x,u=this._anchorPointInPoints.y,d=1,m=0,f=0,p=1;if(a||c){if(r.tx=i._position.x,r.ty=i._position.y,a){var g=i._rotationX*s;if(f=Math.sin(g),p=Math.cos(g),i._rotationY===i._rotationX)d=p,m=-f;else{var v=i._rotationY*s;d=Math.cos(v),m=-Math.sin(v)}}if(r.a=d*=h,r.b=m*=h,r.c=f*=l,r.d=p*=l,c){var y=Math.tan(i._skewX*s),x=Math.tan(i._skewY*s);y===1/0&&(y=99999999),x===1/0&&(x=99999999),r.a=d+f*x,r.b=m+p*x,r.c=f+d*y,r.d=p+m*y}(_||u)&&(r.tx-=r.a*_+r.c*u,r.ty-=r.b*_+r.d*u,i._ignoreAnchorPointForPosition&&(r.tx+=_,r.ty+=u))}else r.a=h,r.b=0,r.c=0,r.d=l,r.tx=i._position.x,r.ty=i._position.y,(_||u)&&(r.tx-=r.a*_,r.ty-=r.d*u,i._ignoreAnchorPointForPosition&&(r.tx+=_,r.ty+=u))}n?(o.a=r.a*n.a+r.b*n.c,o.b=r.a*n.b+r.b*n.d,o.c=r.c*n.a+r.d*n.c,o.d=r.c*n.b+r.d*n.d,o.tx=r.tx*n.a+r.ty*n.c+n.tx,o.ty=r.tx*n.b+r.ty*n.d+n.ty):(o.a=r.a,o.b=r.b,o.c=r.c,o.d=r.d,o.tx=r.tx,o.ty=r.ty)},transform:function(t,e){this.updateTransform(t),this._currentRegion&&(this._updateCurrentRegions(),this._notifyRegionStatus&&this._notifyRegionStatus(_ccsg.Node.CanvasRenderCmd.RegionStatus.DirtyDouble)),cc.macro.ENABLE_CULLING?(this._updateCameraFlag(t),this._doCulling&&this._doCulling()):this._doCulling&&(this._needDraw=!0),e&&n(this._node,"transform")},_updateCameraFlag:function(t){var e=cc.Camera;cc._renderType===cc.game.RENDER_TYPE_WEBGL&&e&&t&&this._cameraFlag!=e.flags.InCamera&&(this._cameraFlag=t._cameraFlag>0?e.flags.ParentInCamera:0)},culling:function(t,e){cc.macro.ENABLE_CULLING?(this._updateCameraFlag(t),this._doCulling&&this._doCulling(),e&&n(this._node,"culling")):this._doCulling&&(this._needDraw=!0)},getNodeToParentTransform:function(){return this._dirtyFlag&r.transformDirty&&this.transform(),this._transform},setNodeToParentTransform:function(t){t?(this._transform=t,this._transformUpdated=!0):this._transformUpdated=!1,this.setDirtyFlag(r.transformDirty)},_propagateFlagsDown:function(t){if(t){var e=this._dirtyFlag,i=t._node,n=t._dirtyFlag;i._cascadeColorEnabled&&n&r.colorDirty&&(e|=r.colorDirty),i._cascadeOpacityEnabled&&n&r.opacityDirty&&(e|=r.opacityDirty),n&r.transformDirty&&(e|=r.transformDirty),n&r.cullingDirty&&(e|=r.cullingDirty),this._dirtyFlag=e}},visit:function(t){var e=this._node,i=cc.renderer;t&&(this._curLevel=t._curLevel+1),this._propagateFlagsDown(t),isNaN(e._customZ)&&(e._vertexZ=i.assignedZ,i.assignedZ+=i.assignedZStep),this._syncStatus(t)},_updateDisplayColor:function(t){var e,i,n,s,o=this._node,a=this._displayedColor,c=o._realColor;if(this._notifyRegionStatus&&this._notifyRegionStatus(_ccsg.Node.CanvasRenderCmd.RegionStatus.Dirty),this._cascadeColorEnabledDirty&&!o._cascadeColorEnabled){a.r=c.r,a.g=c.g,a.b=c.b;var h=new cc.Color(255,255,255,255);for(e=0,i=(n=o._children).length;e<i;e++)(s=n[e])&&s._renderCmd&&s._renderCmd._updateDisplayColor(h);this._cascadeColorEnabledDirty=!1}else{if(void 0===t){var l=o._parent;t=l&&l._cascadeColorEnabled?l.getDisplayedColor():cc.Color.WHITE}if(a.r=0|c.r*t.r/255,a.g=0|c.g*t.g/255,a.b=0|c.b*t.b/255,o._cascadeColorEnabled)for(e=0,i=(n=o._children).length;e<i;e++)(s=n[e])&&s._renderCmd&&(s._renderCmd._updateDisplayColor(a),s._renderCmd._updateColor())}this._dirtyFlag&=~r.colorDirty},_updateDisplayOpacity:function(t){var e,i,n,s,o=this._node;if(this._notifyRegionStatus&&this._notifyRegionStatus(_ccsg.Node.CanvasRenderCmd.RegionStatus.Dirty),this._cascadeOpacityEnabledDirty&&!o._cascadeOpacityEnabled){for(this._displayedOpacity=o._realOpacity,e=0,i=(n=o._children).length;e<i;e++)(s=n[e])&&s._renderCmd&&s._renderCmd._updateDisplayOpacity(255);this._cascadeOpacityEnabledDirty=!1}else{if(void 0===t){var a=o._parent;t=255,a&&a._cascadeOpacityEnabled&&(t=a.getDisplayedOpacity())}if(this._displayedOpacity=o._realOpacity*t/255,o._cascadeOpacityEnabled)for(e=0,i=(n=o._children).length;e<i;e++)(s=n[e])&&s._renderCmd&&(s._renderCmd._updateDisplayOpacity(this._displayedOpacity),s._renderCmd._updateColor())}this._dirtyFlag&=~r.opacityDirty},_syncDisplayColor:function(t){var e=this._node,i=this._displayedColor,n=e._realColor;if(void 0===t){var r=e._parent;t=r&&r._cascadeColorEnabled?r.getDisplayedColor():cc.Color.WHITE}i.r=0|n.r*t.r/255,i.g=0|n.g*t.g/255,i.b=0|n.b*t.b/255},_syncDisplayOpacity:function(t){var e=this._node;if(void 0===t){var i=e._parent;t=255,i&&i._cascadeOpacityEnabled&&(t=i.getDisplayedOpacity())}this._displayedOpacity=e._realOpacity*t/255},_updateColor:function(){},updateStatus:function(){var t=this._dirtyFlag,e=t&r.colorDirty,i=t&r.opacityDirty;if(t&r.contentDirty&&(this._notifyRegionStatus&&this._notifyRegionStatus(_ccsg.Node.CanvasRenderCmd.RegionStatus.Dirty),this._dirtyFlag&=~r.contentDirty),e&&this._updateDisplayColor(),i&&this._updateDisplayOpacity(),(e||i)&&this._updateColor(),t&r.transformDirty){var n=this.getParentRenderCmd();this.transform(n,!0),this._dirtyFlag&=~r.transformDirty,this._dirtyFlag&=~r.cullingDirty}else t&r.cullingDirty&&(this.culling(n,!0),this._dirtyFlag&=~r.cullingDirty)},_syncStatus:function(t){var e=this._dirtyFlag,i=e&r.colorDirty,n=e&r.opacityDirty;i&&this._syncDisplayColor(),n&&this._syncDisplayOpacity(),(i||n)&&this._updateColor(),e&r.transformDirty?this.transform(t):e&r.cullingDirty&&this.culling(t)}},_ccsg.Node.RenderCmd.prototype.originUpdateTransform=_ccsg.Node.RenderCmd.prototype.updateTransform,_ccsg.Node.RenderCmd.prototype.originTransform=_ccsg.Node.RenderCmd.prototype.transform,_ccsg.Node.RenderCmd.prototype.originCulling=_ccsg.Node.RenderCmd.prototype.culling,_ccsg.Node.RenderCmd.prototype.originUpdateStatus=_ccsg.Node.RenderCmd.prototype.updateStatus,_ccsg.Node.RenderCmd.prototype._originSyncStatus=_ccsg.Node.RenderCmd.prototype._syncStatus}),{}],54:[(function(t,e,i){_ccsg.Node.CanvasRenderCmd=function(t){this._ctor(t),this._currentRegion=new cc.Region,this._oldRegion=new cc.Region,this._regionFlag=0},_ccsg.Node.CanvasRenderCmd.RegionStatus={NotDirty:0,Dirty:1,DirtyDouble:2};var n=_ccsg.Node.CanvasRenderCmd.prototype=Object.create(_ccsg.Node.RenderCmd.prototype);n.constructor=_ccsg.Node.CanvasRenderCmd,n._rootCtor=_ccsg.Node.CanvasRenderCmd,n._notifyRegionStatus=function(t){this._needDraw&&this._regionFlag<t&&(this._regionFlag=t)};var r=new cc.Rect;n.getLocalBB=function(){var t=this._node;return r.x=r.y=0,r.width=t._contentSize.width,r.height=t._contentSize.height,r},n._updateCurrentRegions=function(){var t=this._currentRegion;this._currentRegion=this._oldRegion,this._oldRegion=t,_ccsg.Node.CanvasRenderCmd.RegionStatus.DirtyDouble!==this._regionFlag||this._currentRegion.isEmpty()||this._oldRegion.union(this._currentRegion),this._currentRegion.updateRegion(this.getLocalBB(),this._worldTransform)},n.detachFromParent=function(){for(var t,e=this._node._children,i=0,n=e.length;i<n;i++)(t=e[i])&&t._renderCmd&&t._renderCmd.detachFromParent()},n.setShaderProgram=function(t){},n.getShaderProgram=function(){return null},_ccsg.Node.CanvasRenderCmd._getCompositeOperationByBlendFunc=function(t){return t?t.src===cc.macro.SRC_ALPHA&&t.dst===cc.macro.ONE||t.src===cc.macro.ONE&&t.dst===cc.macro.ONE?"lighter":t.src===cc.macro.ZERO&&t.dst===cc.macro.SRC_ALPHA?"destination-in":t.src===cc.macro.ZERO&&t.dst===cc.macro.ONE_MINUS_SRC_ALPHA?"destination-out":"source-over":"source-over"}}),{}],55:[(function(t,e,i){_ccsg.Node.WebGLRenderCmd=function(t){this._ctor(t),this._shaderProgram=null};var n=_ccsg.Node.WebGLRenderCmd.prototype=Object.create(_ccsg.Node.RenderCmd.prototype);n.constructor=_ccsg.Node.WebGLRenderCmd,n._rootCtor=_ccsg.Node.WebGLRenderCmd,n._updateColor=function(){},n.setShaderProgram=function(t){this._shaderProgram=t},n.getShaderProgram=function(){return this._shaderProgram}}),{}],56:[(function(t,e,i){function n(t){return t instanceof cc.Scene?cc.visibleRect:!t._sizeProvider||t._sizeProvider instanceof _ccsg.Node?t._contentSize:t.getContentSize()}function r(t,e,i,n){for(var r=t._parent._scaleX,s=t._parent._scaleY,o=0,a=0,c=t._parent;;){var h=c._position;if(o+=h.x,a+=h.y,!(c=c._parent))return i.x=i.y=0,void(n.x=n.y=1);if(c===e)break;var l=c._scaleX,_=c._scaleY;o*=l,a*=_,r*=l,s*=_}n.x=0!==r?1/r:1,n.y=0!==s?1/s:1,i.x=-o,i.y=-a}function s(t,e){var i,s,o,a=e._target;a?r(t,i=a,s=_,o=u):i=t._parent;var c=n(i),d=i._anchorPoint,m=i instanceof cc.Scene,f=t._position.x,p=t._position.y,g=t._anchorPoint;if(e._alignFlags&h){var v,y,x=c.width;m?(v=cc.visibleRect.left.x,y=cc.visibleRect.right.x):y=(v=-d.x*x)+x,v+=e._isAbsLeft?e._left:e._left*x,y-=e._isAbsRight?e._right:e._right*x,a&&(v+=s.x,v*=o.x,y+=s.x,y*=o.x);var C,A=g.x,T=t._scaleX;if(T<0&&(A=1-A,T=-T),e.isStretchWidth)C=y-v,0!==T&&(t.width=C/T),f=v+A*C;else if(C=t.width*T,e.isAlignHorizontalCenter){var b=e._isAbsHorizontalCenter?e._horizontalCenter:e._horizontalCenter*x,w=(.5-d.x)*c.width;a&&(b*=o.x,w+=s.x,w*=o.x),f=w+(A-.5)*C+b}else f=e.isAlignLeft?v+A*C:y+(A-1)*C}if(e._alignFlags&l){var S,E,I=c.height;m?(E=cc.visibleRect.bottom.y,S=cc.visibleRect.top.y):S=(E=-d.y*I)+I,E+=e._isAbsBottom?e._bottom:e._bottom*I,S-=e._isAbsTop?e._top:e._top*I,a&&(E+=s.y,E*=o.y,S+=s.y,S*=o.y);var R,P=g.y,B=t._scaleY;if(B<0&&(P=1-P,B=-B),e.isStretchHeight)R=S-E,0!==B&&(t.height=R/B),p=E+P*R;else if(R=t.height*B,e.isAlignVerticalCenter){var L=e._isAbsVerticalCenter?e._verticalCenter:e._verticalCenter*I,O=(.5-d.y)*c.height;a&&(L*=o.y,O+=s.y,O*=o.y),p=O+(P-.5)*R+L}else p=e.isAlignBottom?E+P*R:S+(P-1)*R}t.setPosition(f,p)}function o(t){var e=t._widget;if(e){s(t,e),e.isAlignOnce?e.enabled=!1:d.push(e)}for(var i=t._children,n=0;n<i.length;n++){var r=i[n];r._active&&o(r)}}function a(){var t=cc.director.getScene();if(t){if(m.isAligning=!0,m._nodesOrderDirty)d.length=0,o(t),m._nodesOrderDirty=!1;else{var e,i=m._activeWidgetsIterator;for(i.i=0;i.i<d.length;++i.i)s((e=d[i.i]).node,e)}m.isAligning=!1}}function c(t){var e=t._parent;cc.Node.isNode(e)&&c(e);var i=t._widget||t.getComponent(cc.Widget);i&&s(t,i)}var h=56,l=7,_=cc.Vec2.ZERO,u=cc.Vec2.ONE,d=[],m=cc._widgetManager=e.exports={_AlignFlags:{TOP:1,MID:2,BOT:4,LEFT:8,CENTER:16,RIGHT:32},isAligning:!1,_nodesOrderDirty:!1,_activeWidgetsIterator:new cc.js.array.MutableForwardIterator(d),init:function(t){t.on(cc.Director.EVENT_BEFORE_VISIT,a)},add:function(t){t.node._widget=t,this._nodesOrderDirty=!0},remove:function(t){t.node._widget=null,this._activeWidgetsIterator.remove(t)},updateAlignment:c}}),{}],57:[(function(t,e,i){var n;n=_ccsg.Node._dirtyFlags.cullingDirty,t("./CCSGCameraNode");var r=cc.Class({name:"cc.Camera",extends:cc._RendererUnderSG,ctor:function(){this.viewMatrix=cc.affineTransformMake(),this.invertViewMatrix=cc.affineTransformMake(),this._lastViewMatrix=cc.affineTransformMake(),this._sgTarges=[],this._checkedTimes=0,this.visibleRect={left:cc.v2(),right:cc.v2(),top:cc.v2(),bottom:cc.v2()},this.viewPort=cc.rect()},editor:!1,properties:{_targets:{default:[],type:cc.Node,visible:!0},zoomRatio:1},statics:{main:null},_createSgNode:function(){if(cc._renderType===cc.game.RENDER_TYPE_CANVAS){cc.errorID(8301);var t=new _ccsg.Node;return t.setTransform=t.addTarget=t.removeTarget=function(){},t}return new _ccsg.CameraNode},_initSgNode:function(){this._sgNode.setContentSize(this.node.getContentSize(!0))},_addSgTargetInSg:function(t){var e;if(t instanceof cc.Node?e=t._sgNode:t instanceof _ccsg.Node&&(e=t),e&&!e._cameraInfo){e._cameraInfo={touched:this._checkedTimes},this._sgNode.addTarget(e),this._sgTarges.push(e);var i=e._renderCmd;i.setDirtyFlag(n),i._cameraFlag=r.flags.InCamera,cc.renderer.childrenOrderDirty=!0}},_removeTargetInSg:function(t){var e;if(t instanceof cc.Node?e=t._sgNode:t instanceof _ccsg.Node&&(e=t),e&&e._cameraInfo){this._sgNode.removeTarget(e),delete e._cameraInfo,cc.js.array.remove(this._sgTarges,e);var i=e._renderCmd;i.setDirtyFlag(n),i._cameraFlag=0,cc.renderer.childrenOrderDirty=!0}},onEnable:function(){if(r.main)cc.errorID(8300);else{r.main=this;for(var t=this._targets,e=0,i=t.length;e<i;e++)this._addSgTargetInSg(t[e])}},onDisable:function(){if(r.main===this){r.main=null;for(var t=this._sgTarges,e=t.length-1;e>=0;e--)this._removeTargetInSg(t[e])}},addTarget:function(t){-1===this._targets.indexOf(t)&&(this._addSgTargetInSg(t),this._targets.push(t))},removeTarget:function(t){-1!==this._targets.indexOf(t)&&(this._removeTargetInSg(t),cc.js.array.remove(this._targets,t))},getTargets:function(){return this._targets},getNodeToCameraTransform:function(t){var e=t.getNodeToWorldTransform();return this.containsNode(t)&&(e=cc.affineTransformConcatIn(e,cc.Camera.main.viewMatrix)),e},getCameraToWorldPoint:function(t){return cc.Camera.main&&(t=cc.pointApplyAffineTransform(t,cc.Camera.main.invertViewMatrix)),t},containsNode:function(t){t instanceof cc.Node&&(t=t._sgNode);for(var e=this._sgTarges;t;){if(-1!==e.indexOf(t))return!0;t=t.parent}return!1},_setSgNodesCullingDirty:function(){for(var t=this._sgTarges,e=0;e<t.length;e++)t[e]._renderCmd.setDirtyFlag(n)},_checkSgTargets:function(){for(var t=this._targets,e=this._sgTarges,i=++this._checkedTimes,n=0,r=t.length;n<r;n++){var s=t[n],o=s;s instanceof cc.Node&&(o=s._sgNode)&&!o._cameraInfo&&this._addSgTargetInSg(o),o&&(o._cameraInfo.touched=i)}for(var a=e.length-1;a>=0;a--){var c=e[a];c._cameraInfo.touched!==i&&this._removeTargetInSg(c)}},lateUpdate:function(){this._checkSgTargets();var t=this.viewMatrix,e=this.invertViewMatrix,i=this.viewPort,n=cc.visibleRect,r=this.visibleRect,s=this.node.getNodeToWorldTransformAR(),o=.5*-(Math.atan2(s.b,s.a)+Math.atan2(-s.c,s.d)),a=1,c=0,h=0,l=1;o&&(h=Math.sin(o),a=l=Math.cos(o),c=-h);var _=this.zoomRatio;a*=_,c*=_,h*=_,l*=_,t.a=a,t.b=c,t.c=h,t.d=l;var u=n.center;t.tx=u.x-(a*s.tx+h*s.ty),t.ty=u.y-(c*s.tx+l*s.ty),cc.affineTransformInvertOut(t,e),i.x=n.bottomLeft.x,i.y=n.bottomLeft.y,i.width=n.width,i.height=n.height,cc._rectApplyAffineTransformIn(i,e),r.left.x=i.xMin,r.right.x=i.xMax,r.bottom.y=i.yMin,r.top.y=i.yMax,this._sgNode.setTransform(a,c,h,l,t.tx,t.ty);var d=this._lastViewMatrix;d.a===t.a&&d.b===t.b&&d.c===t.c&&d.d===t.d&&d.tx===t.tx&&d.ty===t.ty||(this._setSgNodesCullingDirty(),d.a=t.a,d.b=t.b,d.c=t.c,d.d=t.d,d.tx=t.tx,d.ty=t.ty)}});r.flags=cc.Enum({InCamera:1,ParentInCamera:2}),e.exports=cc.Camera=r}),{"./CCSGCameraNode":58}],58:[(function(t,e,i){var n=new cc.math.Matrix4,r=_ccsg.Node.extend({ctor:function(){this._super(),this._mat=new cc.math.Matrix4,this._mat.identity(),this._beforeVisitCmd=new cc.CustomRenderCmd(this,this._onBeforeVisit),this._afterVisitCmd=new cc.CustomRenderCmd(this,this._onAfterVisit)},setTransform:function(t,e,i,n,r,s){var o=this._mat.mat;o[0]=t,o[1]=e,o[4]=i,o[5]=n,o[12]=r,o[13]=s},addTarget:function(t){var e=t._cameraInfo;e.sgCameraNode=this,e.originVisit=t.visit,t.visit=this._visit},removeTarget:function(t){t.visit=t._cameraInfo.originVisit},_visit:function(t){var e=this._cameraInfo,i=e.sgCameraNode;cc.renderer.pushRenderCommand(i._beforeVisitCmd),e.originVisit.call(this,t),cc.renderer.pushRenderCommand(i._afterVisitCmd)},_onBeforeVisit:function(){cc.renderer._breakBatch(),cc.math.glMatrixMode(cc.math.KM_GL_PROJECTION),n.assignFrom(cc.current_stack.top),n.multiply(this._mat),cc.current_stack.push(n)},_onAfterVisit:function(){cc.renderer._breakBatch(),cc.math.glMatrixMode(cc.math.KM_GL_PROJECTION),cc.current_stack.pop()}});e.exports=_ccsg.CameraNode=r}),{}],59:[(function(t,e,i){cc.Collider.Box=cc.Class({properties:{_offset:cc.v2(0,0),_size:cc.size(100,100),offset:{tooltip:!1,get:function(){return this._offset},set:function(t){this._offset=t},type:cc.Vec2},size:{tooltip:!1,get:function(){return this._size},set:function(t){this._size.width=t.width<0?0:t.width,this._size.height=t.height<0?0:t.height},type:cc.Size}},resetInEditor:!1});var n=cc.Class({name:"cc.BoxCollider",extends:cc.Collider,mixins:[cc.Collider.Box],editor:!1});cc.BoxCollider=e.exports=n}),{}],60:[(function(t,e,i){cc.Collider.Circle=cc.Class({properties:{_offset:cc.v2(0,0),_radius:50,offset:{get:function(){return this._offset},set:function(t){this._offset=t},type:cc.Vec2},radius:{tooltip:!1,get:function(){return this._radius},set:function(t){this._radius=t<0?0:t}}},resetInEditor:!1});var n=cc.Class({name:"cc.CircleCollider",extends:cc.Collider,mixins:[cc.Collider.Circle],editor:!1});cc.CircleCollider=e.exports=n}),{}],61:[(function(t,e,i){var n=cc.Class({name:"cc.Collider",extends:cc.Component,properties:{editing:{default:!1,serializable:!1,tooltip:!1},tag:{tooltip:!1,default:0,range:[0,1e7],type:cc.Integer}},onDisable:function(){cc.director.getCollisionManager().removeCollider(this)},onEnable:function(){cc.director.getCollisionManager().addCollider(this)}});cc.Collider=e.exports=n}),{}],62:[(function(t,e,i){var n=t("./CCContact"),r=n.CollisionType,s=cc.rect(),o=cc.v2(),a=cc.Class({mixins:[cc.EventTarget],properties:{enabled:!1,enabledDrawBoundingBox:!1},ctor:function(){this.__instanceId=cc.ClassManager.getNewInstanceId(),this._contacts=[],this._colliders=[],this._debugDrawer=null,this._enabledDebugDraw=!1},update:function(t){if(this.enabled){var e,i,n=this._colliders;for(e=0,i=n.length;e<i;e++)this.updateCollider(n[e]);var s=this._contacts,o=[];for(e=0,i=s.length;e<i;e++){var a=s[e].updateState();a!==r.None&&o.push([a,s[e]])}for(e=0,i=o.length;e<i;e++){var c=o[e];this._doCollide(c[0],c[1])}this.drawColliders()}},_doCollide:function(t,e){var i;switch(t){case r.CollisionEnter:i="onCollisionEnter";break;case r.CollisionStay:i="onCollisionStay";break;case r.CollisionExit:i="onCollisionExit"}var n,s,o,a=e.collider1,c=e.collider2,h=a.node._components,l=c.node._components;for(n=0,s=h.length;n<s;n++)(o=h[n])[i]&&o[i](c,a);for(n=0,s=l.length;n<s;n++)(o=l[n])[i]&&o[i](a,c)},shouldCollide:function(t,e){var i=t.node,n=e.node,r=cc.game.collisionMatrix;return i!==n&&r[i.groupIndex][n.groupIndex]},initCollider:function(t){if(!t.world){var e=t.world={};e.aabb=cc.rect(),e.preAabb=cc.rect(),e.radius=0,t instanceof cc.BoxCollider?(e.position=null,e.points=[cc.v2(),cc.v2(),cc.v2(),cc.v2()]):t instanceof cc.PolygonCollider?(e.position=null,e.points=t.points.map((function(t){return cc.v2(t.x,t.y)}))):t instanceof cc.CircleCollider&&(e.position=cc.v2(),e.points=null)}},updateCollider:function(t){var e=t.offset,i=t.world,n=i.aabb,r=i.transform=t.node.getNodeToWorldTransformAR(),a=i.preAabb;if(a.x=n.x,a.y=n.y,a.width=n.width,a.height=n.height,t instanceof cc.BoxCollider){var c=t.size;s.x=e.x-c.width/2,s.y=e.y-c.height/2,s.width=c.width,s.height=c.height;var h=i.points,l=h[0],_=h[1],u=h[2],d=h[3];cc.obbApplyAffineTransform(s,r,l,_,u,d);var m=Math.min(l.x,_.x,u.x,d.x),f=Math.min(l.y,_.y,u.y,d.y),p=Math.max(l.x,_.x,u.x,d.x),g=Math.max(l.y,_.y,u.y,d.y);n.x=m,n.y=f,n.width=p-m,n.height=g-f}else if(t instanceof cc.CircleCollider){var v=cc.pointApplyAffineTransform(t.offset,r);i.position.x=v.x,i.position.y=v.y,r.tx=r.ty=0,o.x=t.radius,o.y=0;var y=cc.pointApplyAffineTransform(o,r),x=Math.sqrt(y.x*y.x+y.y*y.y);i.radius=x,n.x=v.x-x,n.y=v.y-x,n.width=2*x,n.height=2*x}else if(t instanceof cc.PolygonCollider){var C=t.points,A=i.points;A.length=C.length;m=1e6,f=1e6,p=-1e6,g=-1e6;for(var T=0,b=C.length;T<b;T++){A[T]||(A[T]=cc.v2()),o.x=C[T].x+e.x,o.y=C[T].y+e.y;v=cc.pointApplyAffineTransform(o,r);A[T].x=v.x,A[T].y=v.y,v.x>p&&(p=v.x),v.x<m&&(m=v.x),v.y>g&&(g=v.y),v.y<f&&(f=v.y)}n.x=m,n.y=f,n.width=p-m,n.height=g-f}},addCollider:function(t){var e=this._colliders;if(-1===e.indexOf(t)){for(var i=0,r=e.length;i<r;i++){var s=e[i];if(this.shouldCollide(t,s)){var o=new n(t,s);this._contacts.push(o)}}e.push(t),this.initCollider(t)}t.node.on("group-changed",this.onNodeGroupChanged,this)},removeCollider:function(t){var e=this._colliders,i=e.indexOf(t);if(i>=0){e.splice(i,1);for(var n=this._contacts,s=n.length-1;s>=0;s--){var o=n[s];o.collider1!==t&&o.collider2!==t||(o.touching&&this._doCollide(r.CollisionExit,o),n.splice(s,1))}t.node.off("group-changed",this.onNodeGroupChanged,this)}else cc.errorID(6600)},attachDebugDrawToCamera:function(t){this._debugDrawer&&t.addTarget(this._debugDrawer)},detachDebugDrawFromCamera:function(t){this._debugDrawer&&t.removeTarget(this._debugDrawer)},onNodeGroupChanged:function(t){for(var e=t.currentTarget.getComponents(cc.Collider),i=0,n=e.length;i<n;i++)this.removeCollider(e[i]),this.addCollider(e[i])},drawColliders:function(){var t=this._debugDrawer;if(this._enabledDebugDraw&&t){t.clear();for(var e=this._colliders,i=0,n=e.length;i<n;i++){var r=e[i];if(r instanceof cc.BoxCollider||r instanceof cc.PolygonCollider){var s=r.world.points;if(s.length>0){t.strokeColor=cc.Color.WHITE,t.moveTo(s[0].x,s[0].y);for(var o=1;o<s.length;o++)t.lineTo(s[o].x,s[o].y);t.close(),t.stroke()}}else r instanceof cc.CircleCollider&&(t.circle(r.world.position.x,r.world.position.y,r.world.radius),t.stroke());if(this.enabledDrawBoundingBox){var a=r.world.aabb;t.strokeColor=cc.Color.BLUE,t.moveTo(a.xMin,a.yMin),t.lineTo(a.xMin,a.yMax),t.lineTo(a.xMax,a.yMax),t.lineTo(a.xMax,a.yMin),t.close(),t.stroke()}}}},onSceneLaunched:function(){this._enabledDebugDraw&&this._debugDrawer&&(this._debugDrawer.removeFromParent(),cc.director.getScene()._sgNode.addChild(this._debugDrawer))}});cc.js.getset(a.prototype,"enabledDebugDraw",(function(){return this._enabledDebugDraw}),(function(t){t&&!this._enabledDebugDraw?(this._debugDrawer||(this._debugDrawer=new _ccsg.GraphicsNode,this._debugDrawer.retain()),cc.director.getScene()._sgNode.addChild(this._debugDrawer),cc.director.on(cc.Director.EVENT_AFTER_SCENE_LAUNCH,this.onSceneLaunched,this)):!t&&this._enabledDebugDraw&&(this._debugDrawer.clear(),this._debugDrawer.removeFromParent(!1),cc.director.off(cc.Director.EVENT_AFTER_SCENE_LAUNCH,this.onSceneLaunched,this)),this._enabledDebugDraw=t})),cc.CollisionManager=e.exports=a}),{"./CCContact":63}],63:[(function(t,e,i){function n(t,e){this.collider1=t,this.collider2=e,this.touching=!1;var i=t instanceof cc.BoxCollider||t instanceof cc.PolygonCollider,n=e instanceof cc.BoxCollider||e instanceof cc.PolygonCollider,s=t instanceof cc.CircleCollider,o=e instanceof cc.CircleCollider;i&&n?this.testFunc=r.polygonPolygon:s&&o?this.testFunc=r.circleCircle:i&&o?this.testFunc=r.polygonCircle:s&&n?(this.testFunc=r.polygonCircle,this.collider1=e,this.collider2=t):cc.errorID(6601,cc.js.getClassName(t),cc.js.getClassName(e))}var r=t("./CCIntersection"),s=cc.Enum({None:0,CollisionEnter:1,CollisionStay:2,CollisionExit:3});n.prototype.test=function(){var t=this.collider1.world,e=this.collider2.world;return!!t.aabb.intersects(e.aabb)&&(this.testFunc===r.polygonPolygon?this.testFunc(t.points,e.points):this.testFunc===r.circleCircle?this.testFunc(t,e):this.testFunc===r.polygonCircle&&this.testFunc(t.points,e))},n.prototype.updateState=function(){var t=this.test(),e=s.None;return t&&!this.touching?(this.touching=!0,e=s.CollisionEnter):t&&this.touching?e=s.CollisionStay:!t&&this.touching&&(this.touching=!1,e=s.CollisionExit),e},n.CollisionType=s,e.exports=n}),{"./CCIntersection":1}],64:[(function(t,e,i){cc.Collider.Polygon=cc.Class({properties:{threshold:{default:1,serializable:!1,visible:!1},_offset:cc.v2(0,0),offset:{get:function(){return this._offset},set:function(t){this._offset=t},type:cc.Vec2},points:{tooltip:!1,default:function(){return[cc.v2(-50,-50),cc.v2(50,-50),cc.v2(50,50),cc.v2(-50,50)]},type:[cc.Vec2]}},resetPointsByContour:!1});var n=cc.Class({name:"cc.PolygonCollider",extends:cc.Collider,mixins:[cc.Collider.Polygon],editor:!1});cc.PolygonCollider=e.exports=n}),{}],65:[(function(t,e,i){t("./CCCollisionManager"),t("./CCCollider"),t("./CCBoxCollider"),t("./CCCircleCollider"),t("./CCPolygonCollider")}),{"./CCBoxCollider":59,"./CCCircleCollider":60,"./CCCollider":61,"./CCCollisionManager":62,"./CCPolygonCollider":64}],66:[(function(t,e,i){function n(t,e){for(var i=e.constructor._executionOrder,n=e.__instanceId,r=0,s=t.length-1,o=s>>>1;r<=s;o=r+s>>>1){var a=t[o],c=a.constructor._executionOrder;if(c>i)s=o-1;else if(c<i)r=o+1;else{var h=a.__instanceId;if(h>n)s=o-1;else{if(!(h<n))return o;r=o+1}}}return~r}function r(t,e){for(var i=t.array,n=t.i+1;n<i.length;){var r=i[n];r._enabled&&r.node._activeInHierarchy?++n:(t.removeAt(n),e&&(r._objFlags&=~e))}}function s(t,e){return t.constructor._executionOrder-e.constructor._executionOrder}function o(t,e){if("function"==typeof t)return e?function(e,i){var n=e.array;for(e.i=0;e.i<n.length;++e.i){var r=n[e.i];t(r,i)}}:function(e){var i=e.array;for(e.i=0;e.i<i.length;++e.i){var n=i[e.i];t(n)}};var i="var a=it.array;for(it.i=0;it.i<a.length;++it.i){var c=a[it.i];"+t+"}";return e?Function("it","dt",i):Function("it",i)}function a(){this.startInvoker=new p(o(u)),this.updateInvoker=new g(o(d,!0)),this.lateUpdateInvoker=new g(o(m,!0)),this.scheduleInNextFrame=[],this._updating=!1}t("./platform/CCClass");var c=t("./platform/CCObject").Flags,h=t("./platform/js").array,l=c.IsStartCalled,_=c.IsOnEnableCalled,u=(c.IsEditorOnEnableCalled,function(t){t.start(),t._objFlags|=l}),d=function(t,e){t.update(e)},m=function(t,e){t.lateUpdate(e)},f=cc.Class({__ctor__:function(t){var e=h.MutableForwardIterator;this._zero=new e([]),this._neg=new e([]),this._pos=new e([]),this._invoke=t},statics:{stableRemoveInactive:r},add:null,remove:null,invoke:null}),p=cc.Class({extends:f,add:function(t){var e=t.constructor._executionOrder;(0===e?this._zero:e<0?this._neg:this._pos).array.push(t)},remove:function(t){var e=t.constructor._executionOrder;(0===e?this._zero:e<0?this._neg:this._pos).fastRemove(t)},cancelInactive:function(t){r(this._zero,t),r(this._neg,t),r(this._pos,t)},invoke:function(){var t=this._neg;t.array.length>0&&(t.array.sort(s),this._invoke(t),t.array.length=0),this._invoke(this._zero),this._zero.array.length=0;var e=this._pos;e.array.length>0&&(e.array.sort(s),this._invoke(e),e.array.length=0)}}),g=cc.Class({extends:f,add:function(t){var e=t.constructor._executionOrder;if(0===e)this._zero.array.push(t);else{var i=e<0?this._neg.array:this._pos.array,r=n(i,t);r<0&&i.splice(~r,0,t)}},remove:function(t){var e=t.constructor._executionOrder;if(0===e)this._zero.fastRemove(t);else{var i=e<0?this._neg:this._pos,r=n(i.array,t);r>=0&&i.removeAt(r)}},invoke:function(t){this._neg.array.length>0&&this._invoke(this._neg,t),this._invoke(this._zero,t),this._pos.array.length>0&&this._invoke(this._pos,t)}}),v=cc.Class({ctor:a,unscheduleAll:a,statics:{LifeCycleInvoker:f,OneOffInvoker:p,createInvokeImpl:o,invokeOnEnable:function(t){var e=cc.director._compScheduler,i=t.array;for(t.i=0;t.i<i.length;++t.i){var n=i[t.i];if(n._enabled){n.onEnable();!n.node._activeInHierarchy||e._onEnabled(n)}}}},_onEnabled:function(t){cc.director.getScheduler().resumeTarget(t),t._objFlags|=_,this._updating?this.scheduleInNextFrame.push(t):this._scheduleImmediate(t)},_onDisabled:function(t){cc.director.getScheduler().pauseTarget(t),t._objFlags&=~_;var e=this.scheduleInNextFrame.indexOf(t);e>=0?h.fastRemoveAt(this.scheduleInNextFrame,e):(!t.start||t._objFlags&l||this.startInvoker.remove(t),t.update&&this.updateInvoker.remove(t),t.lateUpdate&&this.lateUpdateInvoker.remove(t))},enableComp:function(t,e){if(!(t._objFlags&_)){if(t.onEnable){if(e)return void e.add(t);t.onEnable();if(!t.node._activeInHierarchy)return}this._onEnabled(t)}},disableComp:function(t){t._objFlags&_&&(t.onDisable&&t.onDisable(),this._onDisabled(t))},_scheduleImmediate:function(t){!t.start||t._objFlags&l||this.startInvoker.add(t),t.update&&this.updateInvoker.add(t),t.lateUpdate&&this.lateUpdateInvoker.add(t)},_deferredSchedule:function(){for(var t=this.scheduleInNextFrame,e=0,i=t.length;e<i;e++){var n=t[e];this._scheduleImmediate(n)}t.length=0},startPhase:function(){this._updating=!0,this.scheduleInNextFrame.length>0&&this._deferredSchedule(),this.startInvoker.invoke()},updatePhase:function(t){this.updateInvoker.invoke(t)},lateUpdatePhase:function(t){this.lateUpdateInvoker.invoke(t),this._updating=!1}});e.exports=v}),{"./platform/CCClass":156,"./platform/CCObject":162,"./platform/js":177,"./utils/misc":206}],67:[(function(t,e,i){function n(t,e){return t===e||t&&e&&(t.name===e.name||t._uuid===e._uuid)}var r=t("../../animation/animation-animator"),s=t("../../animation/animation-clip"),o=cc.Class({name:"cc.Animation",extends:t("./CCComponent"),mixins:[cc.EventTarget],editor:!1,ctor:function(){cc.EventTarget.call(this),this._animator=null,this._nameToState={},this._didInit=!1,this._currentClip=null},properties:{_defaultClip:{default:null,type:s},defaultClip:{type:s,get:function(){return this._defaultClip},set:function(t){return void 0},tooltip:!1},currentClip:{get:function(){return this._currentClip},set:function(t){this._currentClip=t},type:s,visible:!1},_clips:{default:[],type:[s],tooltip:!1,visible:!0},playOnLoad:{default:!1,tooltip:!1}},start:function(){if(this.playOnLoad&&this._defaultClip){if(!(this._animator&&this._animator.isPlaying)){var t=this.getAnimationState(this._defaultClip.name);this._animator.playState(t)}}},onEnable:function(){this._animator&&this._animator.resume()},onDisable:function(){this._animator&&this._animator.pause()},onDestroy:function(){this.stop()},getClips:function(){return this._clips},play:function(t,e){var i=this.playAdditive(t,e);return this._animator.stopStatesExcept(i),i},playAdditive:function(t,e){this._init();var i=this.getAnimationState(t||this._defaultClip&&this._defaultClip.name);if(i){this.enabled=!0;var n=this._animator;n.isPlaying&&i.isPlaying?i.isPaused?n.resumeState(i):(n.stopState(i),n.playState(i,e)):n.playState(i,e),this.currentClip=i.clip}return i},stop:function(t){if(this._didInit)if(t){var e=this._nameToState[t];e&&this._animator.stopState(e)}else this._animator.stop()},pause:function(t){if(this._didInit)if(t){var e=this._nameToState[t];e&&this._animator.pauseState(e)}else this.enabled=!1},resume:function(t){if(this._didInit)if(t){var e=this._nameToState[t];e&&this._animator.resumeState(e)}else this.enabled=!0},setCurrentTime:function(t,e){if(this._init(),e){var i=this._nameToState[e];i&&this._animator.setStateTime(i,t)}else this._animator.setStateTime(t)},getAnimationState:function(t){this._init();var e=this._nameToState[t];return e&&!e.curveLoaded&&this._animator._reloadClip(e),e||null},addClip:function(t,e){if(t){this._init(),cc.js.array.contains(this._clips,t)||this._clips.push(t),e=e||t.name;var i=this._nameToState[e];if(i){if(i.clip===t)return i;var n=this._clips.indexOf(i.clip);-1!==n&&this._clips.splice(n,1)}var r=new cc.AnimationState(t,e);return this._nameToState[e]=r,r}cc.warnID(3900)},removeClip:function(t,e){if(t){this._init();var i;for(var n in this._nameToState){if((i=this._nameToState[n]).clip===t)break}if(t===this._defaultClip){if(!e)return void cc.warnID(3902);this._defaultClip=null}if(i&&i.isPlaying){if(!e)return void cc.warnID(3903);this.stop(i.name)}this._clips=this._clips.filter((function(e){return e!==t})),i&&delete this._nameToState[i.name]}else cc.warnID(3901)},sample:function(t){if(this._init(),t){var e=this._nameToState[t];e&&e.sample()}else this._animator.sample()},on:function(t,e,i,n){this._init();for(var r=cc.EventTarget.prototype.on.call(this,t,e,i,n),s=this._animator._anims.array,o=0;o<s.length;++o)s[o]._setListeners(this);return r},off:function(t,e,i,n){this._init(),cc.EventTarget.prototype.off.call(this,t,e,i,n);var r=this._nameToState;for(var s in r){r[s]._setListeners(null)}},_init:function(){this._didInit||(this._didInit=!0,this._animator=new r(this.node,this),this._createStates())},_createStates:function(){this._nameToState={};for(var t=null,e=!1,i=0;i<this._clips.length;++i){var r=this._clips[i];r&&(t=new cc.AnimationState(r),this._nameToState[t.name]=t,n(this._defaultClip,r)&&(e=t))}this._defaultClip&&!e&&(t=new cc.AnimationState(this._defaultClip),this._nameToState[t.name]=t)}});cc.Animation=e.exports=o}),{"../../animation/animation-animator":12,"../../animation/animation-clip":13,"./CCComponent":72}],68:[(function(t,e,i){var n=cc.Class({name:"cc.AudioSource",extends:t("./CCComponent"),editor:!1,ctor:function(){this.audio=new cc.Audio},properties:{_clip:{default:"",url:cc.AudioClip},_volume:1,_mute:!1,_loop:!1,_pausedFlag:{default:!1,serializable:!1},isPlaying:{get:function(){if(!this.audio)return!1;return this.audio.getState()===cc.Audio.State.PLAYING},visible:!1},clip:{get:function(){return this._clip},set:function(t){t!==this._clip&&(this._clip=t,this.audio.stop(),this.audio.src=this._clip,this.audio.preload&&this.audio.preload())},url:cc.AudioClip,tooltip:!1,animatable:!1},volume:{get:function(){return this._volume},set:function(t){t=cc.clamp01(t),this._volume=t;var e=this.audio;return e&&!this._mute&&(e.setVolume(t),e._loaded||e.on("load",(function(){e.setVolume(t)}))),t},tooltip:!1},mute:{get:function(){return this._mute},set:function(t){return this._mute=t,this.audio&&this.audio.setVolume(t?0:this._volume),t},animatable:!1,tooltip:!1},loop:{get:function(){return this._loop},set:function(t){return this._loop=t,this.audio&&this.audio.setLoop(t),t},animatable:!1,tooltip:!1},playOnLoad:{default:!1,tooltip:!1,animatable:!1},preload:{default:!1,animatable:!1}},_pausedCallback:function(){var t=this.audio;t&&!t.paused&&(this.audio.pause(),this._pausedFlag=!0)},_restoreCallback:function(){this.audio&&(this._pausedFlag&&this.audio.resume(),this._pausedFlag=!1)},onEnable:function(){this.playOnLoad?this.play():this.preload&&(this.audio.src=this._clip,this.audio.preload()),cc.game.on(cc.game.EVENT_HIDE,this._pausedCallback,this),cc.game.on(cc.game.EVENT_SHOW,this._restoreCallback,this)},onDisable:function(){this.stop(),cc.game.off(cc.game.EVENT_HIDE,this._pausedCallback,this),cc.game.off(cc.game.EVENT_SHOW,this._restoreCallback,this)},onDestroy:function(){this.stop(),this.audio.destroy(),cc.audioEngine.uncache(this._clip)},play:function(){if(this._clip){var t=this._mute?0:this._volume,e=this.audio,i=this._loop;if(e._loaded)return e.stop(),e.setCurrentTime(0),void e.play();e.src=this._clip,e.once("load",(function(){e.setLoop(i),e.setVolume(t),e.play()})),e.preload()}},stop:function(){this.audio&&this.audio.stop()},pause:function(){this.audio&&this.audio.pause()},resume:function(){this.audio&&this.audio.resume()},rewind:function(){this.audio&&this.audio.setCurrentTime(0)},getCurrentTime:function(){var t=0;return this.audio&&(t=this.audio.getCurrentTime()),t},setCurrentTime:function(t){var e=this.audio;return e?e._loaded?(e.setCurrentTime(t),t):(e.once("load",(function(){e.setCurrentTime(t)})),t):t},getDuration:function(){var t=0;return this.audio&&(t=this.audio.getDuration()),t}});cc.AudioSource=e.exports=n}),{"./CCComponent":72}],69:[(function(t,e,i){function n(t){t.stopPropagation()}var r=["touchstart","touchmove","touchend","mousedown","mousemove","mouseup","mouseenter","mouseleave","mousewheel"],s=cc.Class({name:"cc.BlockInputEvents",extends:t("./CCComponent"),editor:{menu:"i18n:MAIN_MENU.component.ui/Block Input Events",inspector:"packages://inspector/inspectors/comps/block-input-events.js",help:"i18n:COMPONENT.help_url.block-input-events"},onEnable:function(){for(var t=0;t<r.length;t++)this.node.on(r[t],n,this)},onDisable:function(){for(var t=0;t<r.length;t++)this.node.off(r[t],n,this)}});cc.BlockInputEvents=e.exports=s}),{"./CCComponent":72}],70:[(function(t,e,i){var n=cc.Enum({NONE:0,COLOR:1,SPRITE:2,SCALE:3}),r=cc.Class({name:"cc.Button",extends:t("./CCComponent"),ctor:function(){this._resetState(),this._fromColor=null,this._toColor=null,this._time=0,this._transitionFinished=!0,this._fromScale=1,this._toScale=1,this._originalScale=1,this._sprite=null},_resetState:function(){this._pressed=!1,this._hovered=!1},editor:!1,properties:{interactable:{default:!0,tooltip:!1,notify:function(t){this._updateState(),this.interactable||this._resetState()},animatable:!1},_resizeToTarget:{animatable:!1,set:function(t){t&&this._resizeNodeToTargetNode()}},enableAutoGrayEffect:{default:!1,tooltip:!1,notify:function(){this._updateDisabledState()}},transition:{default:n.NONE,tooltip:!1,type:n,animatable:!1},normalColor:{default:cc.color(214,214,214),displayName:"Normal",tooltip:!1,notify:function(){this._updateState()}},pressedColor:{default:cc.color(211,211,211),displayName:"Pressed",tooltip:!1},hoverColor:{default:cc.Color.WHITE,displayName:"Hover",tooltip:!1},disabledColor:{default:cc.color(124,124,124),displayName:"Disabled",tooltip:!1,notify:function(){this._updateState()}},duration:{default:.1,range:[0,10],tooltip:!1},zoomScale:{default:1.2,tooltip:!1},normalSprite:{default:null,type:cc.SpriteFrame,displayName:"Normal",tooltip:!1,notify:function(){this._updateState()}},pressedSprite:{default:null,type:cc.SpriteFrame,displayName:"Pressed",tooltip:!1,formerlySerializedAs:"pressedSprite",notify:function(){this._updateState()}},hoverSprite:{default:null,type:cc.SpriteFrame,displayName:"Hover",tooltip:!1,formerlySerializedAs:"hoverSprite",notify:function(){this._updateState()}},disabledSprite:{default:null,type:cc.SpriteFrame,displayName:"Disabled",tooltip:!1,notify:function(){this._updateState()}},target:{default:null,type:cc.Node,tooltip:!1,notify:function(){this._applyTarget()}},clickEvents:{default:[],type:cc.Component.EventHandler,tooltip:!1}},statics:{Transition:n},__preload:function(){this.target||(this.target=this.node),this._applyTarget(),this._updateState()},onEnable:function(){this.normalSprite&&this.normalSprite.ensureLoadTexture(),this.hoverSprite&&this.hoverSprite.ensureLoadTexture(),this.pressedSprite&&this.pressedSprite.ensureLoadTexture(),this.disabledSprite&&this.disabledSprite.ensureLoadTexture(),this._registerEvent()},update:function(t){var e=this.target;if(!this._transitionFinished&&(this.transition===n.COLOR||this.transition===n.SCALE)){this.time+=t;var i=1;this.duration>0&&(i=this.time/this.duration),i>=1&&(i=1,this._transitionFinished=!0),this.transition===n.COLOR?e.color=this._fromColor.lerp(this._toColor,i):this.transition===n.SCALE&&(e.scale=cc.lerp(this._fromScale,this._toScale,i))}},_registerEvent:function(){this.node.on(cc.Node.EventType.TOUCH_START,this._onTouchBegan,this),this.node.on(cc.Node.EventType.TOUCH_MOVE,this._onTouchMove,this),this.node.on(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,this._onTouchCancel,this),this.node.on(cc.Node.EventType.MOUSE_ENTER,this._onMouseMoveIn,this),this.node.on(cc.Node.EventType.MOUSE_LEAVE,this._onMouseMoveOut,this)},_getTargetSprite:function(t){var e=null;return t&&(e=t.getComponent(cc.Sprite)),e},_applyTarget:function(){this._sprite=this._getTargetSprite(this.target),this.target&&(this._originalScale=this.target.scale)},_onTouchBegan:function(t){this.interactable&&this.enabledInHierarchy&&(this._pressed=!0,this._updateState(),t.stopPropagation())},_onTouchMove:function(t){if(this.interactable&&this.enabledInHierarchy&&this._pressed){var e=t.touch,i=this.node._hitTest(e.getLocation());if(this.transition===n.SCALE&&this.target)i?(this._fromScale=this._originalScale,this._toScale=this._originalScale*this.zoomScale,this._transitionFinished=!1):(this.time=0,this._transitionFinished=!0,this.target.scale=this._originalScale);else{var r;r=i?"pressed":"normal",this._applyTransition(r)}t.stopPropagation()}},_onTouchEnded:function(t){this.interactable&&this.enabledInHierarchy&&(this._pressed&&(cc.Component.EventHandler.emitEvents(this.clickEvents,t),this.node.emit("click",this)),this._pressed=!1,this._updateState(),t.stopPropagation())},_zoomUp:function(){this._fromScale=this._originalScale,this._toScale=this._originalScale*this.zoomScale,this.time=0,this._transitionFinished=!1},_zoomBack:function(){this._fromScale=this.target.scale,this._toScale=this._originalScale,this.time=0,this._transitionFinished=!1},_onTouchCancel:function(){this.interactable&&this.enabledInHierarchy&&(this._pressed=!1,this._updateState())},_onMouseMoveIn:function(){!this._pressed&&this.interactable&&this.enabledInHierarchy&&(this.transition!==n.SPRITE||this.hoverSprite)&&(this._hovered||(this._hovered=!0,this._updateState()))},_onMouseMoveOut:function(){this._hovered&&(this._hovered=!1,this._updateState())},_updateState:function(){var t=this._getButtonState();this._applyTransition(t),this._updateDisabledState()},onDisable:function(){this._hovered=!1,this._pressed=!1,this.node.off(cc.Node.EventType.TOUCH_START,this._onTouchBegan,this),this.node.off(cc.Node.EventType.TOUCH_MOVE,this._onTouchMove,this),this.node.off(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this),this.node.off(cc.Node.EventType.TOUCH_CANCEL,this._onTouchCancel,this),this.node.off(cc.Node.EventType.MOUSE_ENTER,this._onMouseMoveIn,this),this.node.off(cc.Node.EventType.MOUSE_LEAVE,this._onMouseMoveOut,this)},_getButtonState:function(){return this.interactable?this._pressed?"pressed":this._hovered?"hover":"normal":"disabled"},_updateColorTransition:function(t){var e=this[t+"Color"],i=this.target;this._fromColor=i.color.clone(),this._toColor=e,this.time=0,this._transitionFinished=!1},_updateSpriteTransition:function(t){var e=this[t+"Sprite"];this._sprite&&e&&(this._sprite.spriteFrame=e)},_updateScaleTransition:function(t){"pressed"===t?this._zoomUp():this._zoomBack()},_applyTransition:function(t){var e=this.transition;e===n.COLOR?this._updateColorTransition(t):e===n.SPRITE?this._updateSpriteTransition(t):e===n.SCALE&&this._updateScaleTransition(t)},_resizeNodeToTargetNode:!1,_updateDisabledState:function(){this._sprite&&this._sprite._sgNode.setState(0),this.enableAutoGrayEffect&&this.transition!==n.COLOR&&(this.transition===n.SPRITE&&this.disabledSprite||this._sprite&&!this.interactable&&this._sprite._sgNode.setState(1))}});cc.Button=e.exports=r}),{"./CCComponent":72}],71:[(function(t,e,i){var n=t("../event-manager"),r={getContentSize:function(){return cc.visibleRect},setContentSize:function(t){},_getWidth:function(){return this.getContentSize().width},_getHeight:function(){return this.getContentSize().height}},s=cc.Class({name:"cc.Canvas",extends:t("./CCComponent"),editor:!1,resetInEditor:!1,statics:{instance:null},properties:{_designResolution:cc.size(960,640),designResolution:{get:function(){return cc.size(this._designResolution)},set:function(t){this._designResolution.width=t.width,this._designResolution.height=t.height,this.applySettings()},tooltip:!1},_fitWidth:!1,_fitHeight:!0,fitHeight:{get:function(){return this._fitHeight},set:function(t){this._fitHeight!==t&&(this._fitHeight=t,this.applySettings())},tooltip:!1},fitWidth:{get:function(){return this._fitWidth},set:function(t){this._fitWidth!==t&&(this._fitWidth=t,this.applySettings())},tooltip:!1}},ctor:function(){this._thisOnResized=this.onResized.bind(this)},__preload:function(){if(s.instance)return cc.errorID(6700,this.node.name,s.instance.node.name);if(s.instance=this,this.node._sizeProvider){}else this.node._sizeProvider=r;cc.director.on(cc.Director.EVENT_BEFORE_VISIT,this.alignWithScreen,this),cc.sys.isMobile?window.addEventListener("resize",this._thisOnResized):n.addCustomListener("canvas-resize",this._thisOnResized),this.applySettings(),this.onResized()},onDestroy:function(){this.node._sizeProvider===r&&(this.node._sizeProvider=null),cc.director.off(cc.Director.EVENT_BEFORE_VISIT,this.alignWithScreen,this),cc.sys.isMobile?window.removeEventListener("resize",this._thisOnResized):n.removeCustomListeners("canvas-resize",this._thisOnResized),s.instance===this&&(s.instance=null)},alignWithScreen:function(){var t,e=cc.visibleRect,i=0,n=0;!this.fitHeight&&!this.fitWidth&&(i=.5*((t=cc.view.getDesignResolutionSize()).width-e.width),n=.5*(t.height-e.height)),this.node.setPosition(.5*e.width+i,.5*e.height+n)},onResized:function(){this.alignWithScreen()},applySettings:function(){var t,e=cc.ResolutionPolicy;t=this.fitHeight&&this.fitWidth?e.SHOW_ALL:this.fitHeight||this.fitWidth?this.fitWidth?e.FIXED_WIDTH:e.FIXED_HEIGHT:e.NO_BORDER;var i=this._designResolution;cc.view.setDesignResolutionSize(i.width,i.height,t)}});cc.Canvas=e.exports=s}),{"../event-manager":90,"./CCComponent":72}],72:[(function(t,e,i){var n=t("../platform/CCObject"),r=t("../platform/js"),s=new(t("../platform/id-generater"))("Comp"),o=n.Flags.IsOnEnableCalled,a=n.Flags.IsOnLoadCalled,c=cc.Class({name:"cc.Component",extends:n,ctor:function(){this.__instanceId=cc.ClassManager.getNewInstanceId(),this.__eventTargets=[]},properties:{node:{default:null,visible:!1},name:{get:function(){if(this._name)return this._name;var t=cc.js.getClassName(this),e=t.lastIndexOf(".");return e>=0&&(t=t.slice(e+1)),this.node.name+"<"+t+">"},set:function(t){this._name=t},visible:!1},_id:{default:"",serializable:!1},uuid:{get:function(){var t=this._id;return t||(t=this._id=s.getNewId()),t},visible:!1},__scriptAsset:!1,_enabled:!0,enabled:{get:function(){return this._enabled},set:function(t){if(this._enabled!==t&&(this._enabled=t,this.node._activeInHierarchy)){var e=cc.director._compScheduler;t?e.enableComp(this):e.disableComp(this)}},visible:!1},enabledInHierarchy:{get:function(){return(this._objFlags&o)>0},visible:!1},_isOnLoadCalled:{get:function(){return this._objFlags&a}}},update:null,lateUpdate:null,__preload:null,onLoad:null,start:null,onEnable:null,onDisable:null,onDestroy:null,onFocusInEditor:null,onLostFocusInEditor:null,resetInEditor:null,addComponent:function(t){return this.node.addComponent(t)},getComponent:function(t){return this.node.getComponent(t)},getComponents:function(t){return this.node.getComponents(t)},getComponentInChildren:function(t){return this.node.getComponentInChildren(t)},getComponentsInChildren:function(t){return this.node.getComponentsInChildren(t)},_getLocalBounds:null,onRestore:null,destroy:function(){this._super()&&this._enabled&&this.node._activeInHierarchy&&cc.director._compScheduler.disableComp(this)},_onPreDestroy:function(){this.unscheduleAllCallbacks();for(var t=this.__eventTargets,e=0,i=t.length;e<i;++e){var n=t[e];n&&n.targetOff(this)}t.length=0,cc.director._nodeActivator.destroyComp(this),this.node._removeComponent(this)},_instantiate:function(t){return t||(t=cc.instantiate._clone(this,this)),t.node=null,t},isRunning:function(){return this.enabledInHierarchy},schedule:function(t,e,i,n){cc.assertID(t,1619),cc.assertID(e>=0,1620),e=e||0,i=isNaN(i)?cc.macro.REPEAT_FOREVER:i,n=n||0;var r=cc.director.getScheduler(),s=r.isTargetPaused(this);r.schedule(t,this,e,i,n,s)},scheduleOnce:function(t,e){this.schedule(t,0,0,e)},unschedule:function(t){t&&cc.director.getScheduler().unschedule(t,this)},unscheduleAllCallbacks:function(){cc.director.getScheduler().unscheduleAllForTarget(this)}});c._requireComponent=null,c._executionOrder=0,r.value(c,"_registerEditorProps",(function(t,e){var i=e.requireComponent;i&&(t._requireComponent=i);var n=e.executionOrder;n&&"number"==typeof n&&(t._executionOrder=n)})),c.prototype.__scriptUuid="",cc.Component=e.exports=c}),{"../platform/CCObject":162,"../platform/id-generater":173,"../platform/js":177}],73:[(function(t,e,i){cc.Component.EventHandler=cc.Class({name:"cc.ClickEvent",properties:{target:{default:null,type:cc.Node},component:{default:""},handler:{default:""},customEventData:{default:""}},statics:{emitEvents:function(t){"use strict";var e,i,n;if(arguments.length>0)for(i=0,n=(e=new Array(arguments.length-1)).length;i<n;i++)e[i]=arguments[i+1];for(i=0,n=t.length;i<n;i++){var r=t[i];r instanceof cc.Component.EventHandler&&r.emit(e)}}},emit:function(t){var e=this.target;if(cc.isValid(e)){var i=e.getComponent(this.component);if(cc.isValid(i)){var n=i[this.handler];"function"==typeof n&&(null!=this.customEventData&&""!==this.customEventData&&(t=t.slice()).push(this.customEventData),n.apply(i,t))}}}})}),{}],74:[(function(t,e,i){t("../label/CCSGLabel"),t("../label/CCSGLabelCanvasRenderCmd"),t("../label/CCSGLabelWebGLRenderCmd");var n=cc.TextAlignment,r=cc.VerticalTextAlignment,s=_ccsg.Label.Overflow,o=cc.Class({name:"cc.Label",extends:cc._RendererUnderSG,ctor:function(){0},editor:!1,_updateSgNodeString:function(){this._sgNode.setString(this.string),this._updateNodeSize()},_updateSgNodeFontSize:function(){this._sgNode&&(this._sgNode.setFontSize(this._fontSize),this._updateNodeSize())},properties:{_useOriginalSize:!0,string:{default:"Label",multiline:!0,tooltip:!1,notify:function(){this._sgNode&&this._updateSgNodeString()}},horizontalAlign:{default:n.LEFT,type:n,tooltip:!1,notify:function(){this._sgNode&&this._sgNode.setHorizontalAlign(this.horizontalAlign)},animatable:!1},verticalAlign:{default:r.TOP,type:r,tooltip:!1,notify:function(){this._sgNode&&this._sgNode.setVerticalAlign(this.verticalAlign)},animatable:!1},_actualFontSize:{default:40},actualFontSize:{displayName:"Actual Font Size",animatable:!1,readonly:!0,get:function(){return this._sgNode&&(this._actualFontSize=this._sgNode.getFontSize()),this._actualFontSize}},_fontSize:40,fontSize:{get:function(){return this._fontSize},set:function(t){this._fontSize=t,this._updateSgNodeFontSize()},tooltip:!1},fontFamily:{default:"Arial",tooltip:!1,notify:function(){this._sgNode&&this._sgNode.setFontFamily(this.fontFamily)},animatable:!1},_lineHeight:40,lineHeight:{get:function(){return this._sgNode&&(this._lineHeight=this._sgNode.getLineHeight()),this._lineHeight},set:function(t){this._lineHeight=t,this._sgNode&&(this._sgNode.setLineHeight(t),this._updateNodeSize())},tooltip:!1},overflow:{default:s.NONE,type:s,tooltip:!1,notify:function(){this._sgNode&&(this._sgNode.setOverflow(this.overflow),this._updateNodeSize())},animatable:!1},_enableWrapText:!0,enableWrapText:{get:function(){return this._sgNode&&(this._enableWrapText=this._sgNode.isWrapTextEnabled()),this._enableWrapText},set:function(t){this._enableWrapText=t,this._sgNode&&this._sgNode.enableWrapText(t)},animatable:!1,tooltip:!1},_N$file:null,font:{get:function(){return this._N$file},set:function(t){if(t||(this._isSystemFontUsed=!0),this._N$file=t,this._bmFontOriginalSize=-1,t&&this._isSystemFontUsed&&(this._isSystemFontUsed=!1),this._sgNode){"string"==typeof t&&cc.warnID(4e3);var e=this.font;e instanceof cc.BitmapFont?e.spriteFrame?this._sgNode.setFontAsset(e):(cc.warnID(4011,e.name),this._sgNode.setFontFamily("")):this._sgNode.setFontAsset(e)}t instanceof cc.BitmapFont&&(this._bmFontOriginalSize=t.fontSize)},type:cc.Font,tooltip:!1,animatable:!1},_isSystemFontUsed:!0,useSystemFont:{get:function(){return this._isSystemFontUsed},set:function(t){this._isSystemFontUsed=!!t,t&&(this.font=null,this._sgNode&&this._sgNode.setFontFamily(this.fontFamily))},animatable:!1,tooltip:!1},_bmFontOriginalSize:{displayName:"BMFont Original Size",default:-1,serializable:!1,readonly:!0,visible:!0,animatable:!1},_spacingX:0,spacingX:{get:function(){return this._spacingX},set:function(t){this._spacingX=t,this._sgNode&&(this._sgNode.setSpacingX(this.spacingX),this._updateNodeSize())}}},statics:{HorizontalAlign:n,VerticalAlign:r,Overflow:s},__preload:function(){this._super(),this._sgNode.on("load",this._updateNodeSize,this),this._updateNodeSize()},_createSgNode:function(){return null},_initSgNode:function(){var t=this.font;"string"==typeof t&&cc.warnID(4e3);var e;t instanceof cc.BitmapFont?t.spriteFrame?e=this._sgNode=_ccsg.Label.pool.get(this.string,t):(cc.warnID(4011,t.name),e=this._sgNode=_ccsg.Label.pool.get(this.string)):e=this._sgNode=_ccsg.Label.pool.get(this.string,t,null,this._fontSize),t instanceof cc.BitmapFont&&(this._bmFontOriginalSize=t.fontSize),e.setVisible(!1),e.setHorizontalAlign(this.horizontalAlign),e.setVerticalAlign(this.verticalAlign),e.setFontSize(this._fontSize),this.useSystemFont&&e.setFontFamily(this.fontFamily),e.setOverflow(this.overflow),e.enableWrapText(this._enableWrapText),e.setLineHeight(this._lineHeight),e.setString(this.string),t instanceof cc.BitmapFont&&e.setSpacingX(this.spacingX),e.setContentSize(this.node.getContentSize()),e.setColor(this.node.color)},_updateNodeSize:function(){this._sgNode&&this._sgNode.parent&&(this.overflow!==s.NONE&&this.overflow!==s.RESIZE_HEIGHT||this.node.setContentSize(this._sgNode.getContentSize()))},onDestroy:function(){var t=this._sgNode;this._super(),t&&(t.removeFromParent(!0),_ccsg.Label.pool.put(t))}});cc.Label=e.exports=o}),{"../label/CCSGLabel":106,"../label/CCSGLabelCanvasRenderCmd":107,"../label/CCSGLabelWebGLRenderCmd":108}],75:[(function(t,e,i){var n=cc.Class({name:"cc.LabelOutline",extends:t("./CCComponent"),editor:!1,ctor:function(){this._labelSGNode=null},properties:{_color:cc.color(255,255,255,255),_width:1,color:{get:function(){return this._color},set:function(t){this._color=cc.color(t),this._labelSGNode&&this._labelSGNode.setOutlineColor(cc.color(this._color))}},width:{get:function(){return this._width},set:function(t){this._width=t,this._labelSGNode&&(this._labelSGNode.setOutlineWidth(t),this._labelSGNode.setMargin(t))}}},onEnable:function(){var t=this.node.getComponent("cc.Label"),e=this._labelSGNode=t&&t._sgNode;this._labelSGNode&&(e.setOutlined(!0),e.setOutlineColor(cc.color(this._color)),e.setOutlineWidth(this._width),e.setMargin(this._width))},onDisable:function(){this._labelSGNode&&(this._labelSGNode.setOutlined(!1),this._labelSGNode.setMargin(0)),this._labelSGNode=null}});cc.LabelOutline=e.exports=n}),{"./CCComponent":72}],76:[(function(t,e,i){t("../../clipping-nodes/CCClippingNode"),t("../../clipping-nodes/CCClippingNodeCanvasRenderCmd"),t("../../clipping-nodes/CCClippingNodeWebGLRenderCmd"),t("../../shape-nodes/CCDrawNode");var n=cc._RendererInSG,r=cc.Enum({RECT:0,ELLIPSE:1,IMAGE_STENCIL:2}),s=cc.Class({name:"cc.Mask",extends:n,editor:!1,properties:{_clippingStencil:{default:null,serializable:!1},_type:r.RECT,type:{get:function(){return this._type},set:function(t){this._type=t,this._refreshStencil()},type:r,tooltip:!1},spriteFrame:{default:null,type:cc.SpriteFrame,tooltip:!1,notify:function(){this._refreshStencil()}},alphaThreshold:{default:1,type:cc.Float,range:[0,1,.1],slide:!0,tooltip:!1,notify:function(){cc._renderType!==cc.game.RENDER_TYPE_CANVAS?this._sgNode.setAlphaThreshold(this.alphaThreshold):cc.warnID(4201)}},inverted:{default:!1,type:cc.Boolean,tooltip:!1,notify:function(){cc._renderType!==cc.game.RENDER_TYPE_CANVAS?this._sgNode.setInverted(this.inverted):cc.warnID(4202)}},_segements:64,segements:{get:function(){return this._segements},set:function(t){this._segements=cc.clampf(t,3,1e4),this._refreshStencil()},tooltip:!1},_resizeToTarget:{animatable:!1,set:function(t){t&&this._resizeNodeToTargetNode()}}},statics:{Type:r},_resizeNodeToTargetNode:!1,_initSgNode:function(){},_createSgNode:function(){return new cc.ClippingNode},_hitTest:function(t){var e=this.node.getContentSize(),i=e.width,n=e.height,s=this.node.getNodeToWorldTransform();if(this.type===r.RECT||this.type===r.IMAGE_STENCIL){var o=cc.rect(0,0,i,n);cc._rectApplyAffineTransformIn(o,s);var a=t.x-o.x,c=o.x+o.width-t.x,h=t.y-o.y,l=o.y+o.height-t.y;return a>=0&&c>=0&&l>=0&&h>=0}if(this.type===r.ELLIPSE){var _=i/2,u=n/2,d=s.a*_+s.c*u+s.tx,m=s.b*_+s.d*u+s.ty,f=t.x-d,p=t.y-m;return f*f/(_*_)+p*p/(u*u)<1}},onEnable:function(){this._super(),this.spriteFrame&&this.spriteFrame.ensureLoadTexture(),this._refreshStencil(),this.node.on("size-changed",this._refreshStencil,this),this.node.on("anchor-changed",this._refreshStencil,this)},onDisable:function(){this._super(),this.node.off("size-changed",this._refreshStencil,this),this.node.off("anchor-changed",this._refreshStencil,this)},_calculateCircle:function(t,e,i){for(var n=[],r=2*Math.PI/i,s=0;s<i;++s)n.push(cc.v2(e.x*Math.cos(r*s)+t.x,e.y*Math.sin(r*s)+t.y));return n},_refreshStencil:function(){if(this.type!==r.IMAGE_STENCIL||cc._renderType===cc.game.RENDER_TYPE_WEBGL){var t=this.node.getContentSize(),e=this.node.getAnchorPoint(),i=this._clippingStencil;if(this._type===r.IMAGE_STENCIL){i instanceof cc.Scale9Sprite&&i._spriteFrame===this.spriteFrame||((i=new cc.Scale9Sprite).setSpriteFrame(this.spriteFrame),this._sgNode.setStencil(i)),i.setContentSize(t),i.setAnchorPoint(e),this._sgNode.setAlphaThreshold(this.alphaThreshold)}else{i instanceof cc.DrawNode||(i=new cc.DrawNode,this._sgNode.setStencil(i));var n=t.width,s=t.height,o=-n*e.x,a=-s*e.y,c=cc.color(255,255,255,0);if(i.clear(),this._type===r.RECT){var h=[cc.v2(o,a),cc.v2(o+n,a),cc.v2(o+n,a+s),cc.v2(o,a+s)];i.drawPoly(h,c,0,c)}else if(this._type===r.ELLIPSE){var l=cc.v2(o+n/2,a+s/2),_={x:n/2,y:s/2};i.drawPoly(this._calculateCircle(l,_,this._segements),c,0,c)}}this._sgNode.setInverted(this.inverted),this._clippingStencil=i,cc.renderer.childrenOrderDirty=!0}else cc.warnID(4200)}});cc.Mask=e.exports=s}),{"../../clipping-nodes/CCClippingNode":26,"../../clipping-nodes/CCClippingNodeCanvasRenderCmd":27,"../../clipping-nodes/CCClippingNodeWebGLRenderCmd":28,"../../shape-nodes/CCDrawNode":241}],77:[(function(t,e,i){var n=cc.Class({extends:t("./CCSGComponent"),name:"cc._RendererInSG",ctor:function(){var t=this._sgNode=this._createSgNode();t.setVisible(!1),this._plainNode=new _ccsg.Node},__preload:function(){this._initSgNode()},onEnable:function(){this._replaceSgNode(this._sgNode)},onDisable:function(){this._replaceSgNode(this._plainNode)},onDestroy:function(){this._removeSgNode()},_replaceSgNode:function(t){var e=this.node,i=e._sgNode;i._entity=null;var n=i.getChildren().slice();i.removeAllChildren(!1),t.getChildrenCount()>0&&t.removeAllChildren(!1);for(var r=0,s=n.length;r<s;++r)t.addChild(n[r]);var o=i.getParent();o&&(o.removeChild(i,!1),o.addChild(t),t._arrivalOrder=i._arrivalOrder,cc.renderer.childrenOrderDirty=o._reorderChildDirty=!0),e._sgNode=t,e._sgNode._entity=e,e._updateSgNode()}});cc._RendererInSG=e.exports=n}),{"./CCSGComponent":80}],78:[(function(t,e,i){var n=cc.Class({extends:t("./CCSGComponent"),name:"cc._RendererUnderSG",ctor:function(){var t=this._sgNode=this._createSgNode();t&&t.setVisible(!1)},__preload:function(){this._initSgNode(),this._registSizeProvider(),this._appendSgNode(this._sgNode)},onEnable:function(){this._sgNode&&this._sgNode.setVisible(!0)},onDisable:function(){this._sgNode&&this._sgNode.setVisible(!1)},onDestroy:function(){this.node._sizeProvider===this._sgNode&&(this.node._sizeProvider=null),this._removeSgNode()},_appendSgNode:function(t){if(t){var e=this.node;t.setColor(e._color),e._cascadeOpacityEnabled||t.setOpacity(e._opacity),t.setAnchorPoint(e._anchorPoint),t.setOpacityModifyRGB(e._opacityModifyRGB),t.setLocalZOrder(-1);e._sgNode.addChild(t)}}});cc._RendererUnderSG=e.exports=n}),{"./CCSGComponent":80}],79:[(function(t,e,i){t("../label/CCHtmlTextParser"),t("../label/CCTextUtils");var n=cc.TextAlignment,r=cc.VerticalTextAlignment,s=cc.Class({name:"cc.RichText",extends:cc._RendererUnderSG,ctor:function(){this._textArray=null,this._labelSegments=[],this._labelSegmentsCache=[],this._linesWidth=[],this._resetState(),this._updateRichTextStatus=this._updateRichText},editor:!1,properties:{string:{default:"<color=#00ff00>Rich</c><color=#0fffff>Text</color>",multiline:!0,tooltip:!1,notify:function(){this._updateRichTextStatus()}},horizontalAlign:{default:n.LEFT,type:n,tooltip:!1,animatable:!1,notify:function(t){this.horizontalAlign!==t&&(this._layoutDirty=!0,this._updateRichTextStatus())}},fontSize:{default:40,tooltip:!1,notify:function(t){this.fontSize!==t&&(this._layoutDirty=!0,this._updateRichTextStatus())}},font:{default:null,type:cc.TTFFont,tooltip:!1,notify:function(t){this.font!==t&&(this._layoutDirty=!0,this.font&&this._onTTFLoaded(),this._updateRichTextStatus())}},maxWidth:{default:0,tooltip:!1,notify:function(t){this.maxWidth!==t&&(this._layoutDirty=!0,this._updateRichTextStatus())}},lineHeight:{default:40,tooltip:!1,notify:function(t){this.lineHeight!==t&&(this._layoutDirty=!0,this._updateRichTextStatus())}},imageAtlas:{default:null,type:cc.SpriteAtlas,tooltip:!1,notify:function(t){this.imageAtlas!==t&&(this._layoutDirty=!0,this._updateRichTextStatus())}},handleTouchEvent:{default:!0,tooltip:!1,notify:function(t){this.handleTouchEvent!==t&&this.enabledInHierarchy&&(this.handleTouchEvent?this._addEventListeners():this._removeEventListeners())}}},statics:{HorizontalAlign:n,VerticalAlign:r},onEnable:function(){this._super(),this.handleTouchEvent&&this._addEventListeners()},onDisable:function(){this._super(),this.handleTouchEvent&&this._removeEventListeners()},_addEventListeners:function(){this.node.on(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this)},_removeEventListeners:function(){this.node.off(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this)},_createSgNode:function(){var t=new _ccsg.Node;t.setCascadeOpacityEnabled(!0);var e=this;return t.setColor=function(){e._updateLabelSegmentTextAttributes()},t._setContentSize=t.setContentSize,t.setContentSize=function(){},t},_updateLabelSegmentTextAttributes:function(){this._labelSegments.forEach(function(t){this._applyTextAttribute(t)}.bind(this))},_initSgNode:function(){this._updateRichText(),this._onTTFLoaded()},_createFontLabel:function(t){return _ccsg.Label.pool.get(t,this.font,null,this.fontSize)},_getFontRawUrl:function(){return this.font instanceof cc.TTFFont?this.font.rawUrl:""},_onTTFLoaded:function(){var t=this._getFontRawUrl();if(t){var e=this;cc.CustomFontLoader.loadTTF(t,(function(){e._layoutDirty=!0,e._updateRichText()}))}},_measureText:function(t,e){var i=this,n=function(e){var n;0===i._labelSegmentsCache.length?(n=i._createFontLabel(e),i._labelSegmentsCache.push(n)):(n=i._labelSegmentsCache[0]).setString(e),n._styleIndex=t,i._applyTextAttribute(n);return n.getContentSize().width};return e?n(e):n},_onTouchEnded:function(t){for(var e=this.node.getComponents(cc.Component),i=0;i<this._labelSegments.length;++i){var n=this._labelSegments[i],r=n._clickHandler;r&&this._containsTouchLocation(n,t.touch.getLocation())&&(e.forEach((function(e){e.enabledInHierarchy&&e[r]&&e[r](t)})),t.stopPropagation())}},_containsTouchLocation:function(t,e){var i=t.getBoundingBoxToWorld();return cc.rectContainsPoint(i,e)},_resetState:function(){var t=this._sgNode;t&&t.removeAllChildren(),this._labelSegments.length=0,this._labelSegmentsCache.length=0,this._linesWidth.length=0,this._lineOffsetX=0,this._lineCount=1,this._labelWidth=0,this._labelHeight=0,this._layoutDirty=!0},_addLabelSegment:function(t,e){var i;0===this._labelSegmentsCache.length?i=this._createFontLabel(t):(i=this._labelSegmentsCache.pop()).setString(t),i._styleIndex=e,i._lineCount=this._lineCount,this._applyTextAttribute(i),i.setAnchorPoint(0,0),this._sgNode.addChild(i),this._labelSegments.push(i);return i},_updateRichTextWithMaxWidth:function(t,e,i){var n=e;if(this._lineOffsetX>0&&n+this._lineOffsetX>this.maxWidth)for(var r=0;this._lineOffsetX<=this.maxWidth;){var s=this._getFirstWordLen(t,r,t.length),o=t.substr(r,s),a=this._measureText(i,o);if(!(this._lineOffsetX+a<=this.maxWidth)){if(r>0){var c=t.substr(0,r);this._addLabelSegment(c,i),t=t.substr(r,t.length),n=this._measureText(i,t)}this._updateLineInfo();break}this._lineOffsetX+=a,r+=s}if(n>this.maxWidth)for(var h=cc.TextUtils.fragmentText(t,n,this.maxWidth,this._measureText(i)),l=0;l<h.length;++l){var _=h[l],u=this._addLabelSegment(_,i).getContentSize();this._lineOffsetX+=u.width,h.length>1&&l<h.length-1&&this._updateLineInfo()}else this._lineOffsetX+=n,this._addLabelSegment(t,i)},_isLastComponentCR:function(t){return t.length-1===t.lastIndexOf("\n")},_updateLineInfo:function(){this._linesWidth.push(this._lineOffsetX),this._lineOffsetX=0,this._lineCount++},_needsUpdateTextLayout:function(t){if(this._layoutDirty||!this._textArray||!t)return!0;if(this._textArray.length!==t.length)return!0;for(var e=0;e<this._textArray.length;++e){var i=this._textArray[e],n=t[e];if(i.text!=n.text)return!0;if(i.style){if(n.style){if(i.style.size!==n.style.size||i.style.italic!==n.style.italic||i.style.isImage!==n.style.isImage)return!0;if(i.style.isImage===n.style.isImage&&i.style.src!==n.style.src)return!0}else if(i.style.size||i.style.italic||i.style.isImage)return!0}else if(n.style&&(n.style.size||n.style.italic||n.style.isImage))return!0}return!1},_onSpriteFrameLoaded:function(t,e){var i;(i=e||t.target).__sprite.setSpriteFrame(i)},_applySpriteFrame:function(t){t&&(t.textureLoaded()?this._onSpriteFrameLoaded(null,t):(t.once("load",this._onSpriteFrameLoaded,this),t.ensureLoadTexture()))},_addRichTextImageElement:function(t){var e=t.style.src,i=this.imageAtlas.getSpriteFrame(e);if(i){var n=new cc.Scale9Sprite;n.setAnchorPoint(0,0),i.__sprite=n,this._sgNode.addChild(n),this._labelSegments.push(n);var r=i.getRect(),s=1,o=r.width,a=r.height,c=t.style.imageWidth,h=t.style.imageHeight;h>0&&h<this.lineHeight?(o*=s=h/a,a*=s):(o*=s=this.lineHeight/a,a*=s),c>0&&(o=c),this.maxWidth>0?(this._lineOffsetX+o>this.maxWidth&&this._updateLineInfo(),this._lineOffsetX+=o):(this._lineOffsetX+=o,this._lineOffsetX>this._labelWidth&&(this._labelWidth=this._lineOffsetX)),this._applySpriteFrame(i),n.setContentSize(o,a),n._lineCount=this._lineCount,t.style.event&&t.style.event.click&&(n._clickHandler=t.style.event.click)}else cc.warnID(4400)},_updateRichText:function(){if(this.enabled){var t=cc.htmlTextParser.parse(this.string);if(!this._needsUpdateTextLayout(t))return this._textArray=t,void this._updateLabelSegmentTextAttributes();this._textArray=t,this._resetState();for(var e,i=!1,n=0;n<this._textArray.length;++n){var r=this._textArray[n],s=r.text;if(""===s){if(r.style&&r.style.newline){this._updateLineInfo();continue}if(r.style&&r.style.isImage&&this.imageAtlas){this._addRichTextImageElement(r);continue}}for(var o=s.split("\n"),a=0;a<o.length;++a){var c=o[a];if(""!==c)if(i=!1,this.maxWidth>0){var h=this._measureText(n,c);this._updateRichTextWithMaxWidth(c,h,n),o.length>1&&a<o.length-1&&this._updateLineInfo()}else e=this._addLabelSegment(c,n).getContentSize(),this._lineOffsetX+=e.width,this._lineOffsetX>this._labelWidth&&(this._labelWidth=this._lineOffsetX),o.length>1&&a<o.length-1&&this._updateLineInfo();else{if(this._isLastComponentCR(s)&&a==o.length-1)continue;this._updateLineInfo(),i=!0}}}i||this._linesWidth.push(this._lineOffsetX),this.maxWidth>0&&(this._labelWidth=this.maxWidth),this._labelHeight=this._lineCount*this.lineHeight,this.node.setContentSize(this._labelWidth,this._labelHeight),this._sgNode._setContentSize(this._labelWidth,this._labelHeight),this._updateRichTextPosition(),this._layoutDirty=!1}},_getFirstWordLen:function(t,e,i){var n=t.charAt(e);if(cc.TextUtils.isUnicodeCJK(n)||cc.TextUtils.isUnicodeSpace(n))return 1;for(var r=1,s=e+1;s<i&&(n=t.charAt(s),!cc.TextUtils.isUnicodeSpace(n)&&!cc.TextUtils.isUnicodeCJK(n));++s)r++;return r},_updateRichTextPosition:function(){for(var t=0,e=1,i=this._lineCount,n=0;n<this._labelSegments.length;++n){var r=this._labelSegments[n],s=r._lineCount;s>e&&(t=0,e=s);var o=0;switch(this.horizontalAlign){case cc.TextAlignment.LEFT:o=0;break;case cc.TextAlignment.CENTER:o=(this._labelWidth-this._linesWidth[s-1])/2;break;case cc.TextAlignment.RIGHT:o=this._labelWidth-this._linesWidth[s-1]}r.setPositionX(t+o);var a=r.getContentSize(),c=(i-s)*this.lineHeight;r instanceof cc.Scale9Sprite&&(c+=(this.lineHeight-r.getContentSize().height)/2),r.setPositionY(c),s===e&&(t+=a.width)}},_convertLiteralColorValue:function(t){var e=t.toUpperCase();return cc.Color[e]?cc.Color[e]:cc.hexToColor(t)},_applyTextAttribute:function(t){if(!(t instanceof cc.Scale9Sprite)){var e=t._styleIndex;t.setLineHeight(this.lineHeight),t.setVerticalAlign(r.CENTER);var i=null;this._textArray[e]&&(i=this._textArray[e].style),i&&i.color?t.setColor(this._convertLiteralColorValue(i.color)):t.setColor(this.node.color),i&&i.bold?t.enableBold(!0):t.enableBold(!1),i&&i.italic?t.enableItalics(!0):t.enableItalics(!1),i&&i.underline?t.enableUnderline(!0):t.enableUnderline(!1),i&&i.outline?(t.setOutlined(!0),t.setOutlineColor(this._convertLiteralColorValue(i.outline.color)),t.setOutlineWidth(i.outline.width),t.setMargin(i.outline.width)):(t.setOutlined(!1),t.setMargin(0)),i&&i.size?t.setFontSize(i.size):t.setFontSize(this.fontSize),i&&i.event&&i.event.click&&(t._clickHandler=i.event.click)}},onDestroy:function(){this._super();for(var t=0;t<this._labelSegments.length;++t)this._labelSegments[t].removeFromParent(!0),_ccsg.Label.pool.put(this._labelSegments[t]);this._resetState()}});cc.RichText=e.exports=s}),{"../label/CCHtmlTextParser":105,"../label/CCTextUtils":109}],80:[(function(t,e,i){var n=t("../utils/scene-graph-helper"),r=cc.Class({extends:t("./CCComponent"),name:"cc._SGComponent",editor:!1,properties:{_sgNode:{default:null,serializable:!1}},_createSgNode:null,_initSgNode:null,_removeSgNode:n.removeSgNode,_registSizeProvider:function(){if(this.node._sizeProvider){}else this.node._sizeProvider=this._sgNode}});cc._SGComponent=e.exports=r}),{"../utils/scene-graph-helper":209,"./CCComponent":72}],81:[(function(t,e,i){var n=t("./CCRendererUnderSG"),r=cc.Scale9Sprite.RenderingType,s=cc.Scale9Sprite.FillType,o=cc.BlendFunc.BlendFactor,a=cc.Enum({CUSTOM:0,TRIMMED:1,RAW:2}),c=cc.Class({name:"cc.Sprite",extends:n,editor:!1,ctor:function(){this._blendFunc=new cc.BlendFunc(this._srcBlendFactor,this._dstBlendFactor)},properties:{_spriteFrame:{default:null,type:cc.SpriteFrame},_type:r.SIMPLE,_sizeMode:a.TRIMMED,_fillType:0,_fillCenter:cc.v2(0,0),_fillStart:0,_fillRange:0,_isTrimmedMode:!0,_srcBlendFactor:o.SRC_ALPHA,_dstBlendFactor:o.ONE_MINUS_SRC_ALPHA,_atlas:{default:null,type:cc.SpriteAtlas,tooltip:!1,editorOnly:!0,visible:!0,animatable:!1},spriteFrame:{get:function(){return this._spriteFrame},set:function(t,e){var i=this._spriteFrame;i!==t&&(this._spriteFrame=t,this._applySpriteFrame(i))},type:cc.SpriteFrame},type:{get:function(){return this._type},set:function(t){this._type=t,this._sgNode.setRenderingType(t)},type:r,animatable:!1,tooltip:!1},fillType:{get:function(){return this._fillType},set:function(t){this._fillType=t,this._sgNode&&this._sgNode.setFillType(t)},type:s,tooltip:!1},fillCenter:{get:function(){return this._fillCenter},set:function(t){this._fillCenter=cc.v2(t),this._sgNode&&this._sgNode.setFillCenter(this._fillCenter)},tooltip:!1},fillStart:{get:function(){return this._fillStart},set:function(t){this._fillStart=cc.clampf(t,-1,1),this._sgNode&&this._sgNode.setFillStart(t)},tooltip:!1},fillRange:{get:function(){return this._fillRange},set:function(t){this._fillRange=cc.clampf(t,-1,1),this._sgNode&&this._sgNode.setFillRange(t)},tooltip:!1},trim:{get:function(){return this._isTrimmedMode},set:function(t){this._isTrimmedMode!==t&&(this._isTrimmedMode=t,this._sgNode.enableTrimmedContentSize(t))},animatable:!1,tooltip:!1},srcBlendFactor:{get:function(){return this._srcBlendFactor},set:function(t){this._srcBlendFactor=t,this._blendFunc.src=t,this._sgNode.setBlendFunc(this._blendFunc)},animatable:!1,type:o,tooltip:!1},dstBlendFactor:{get:function(){return this._dstBlendFactor},set:function(t){this._dstBlendFactor=t,this._blendFunc.dst=t,this._sgNode.setBlendFunc(this._blendFunc)},animatable:!1,type:o,tooltip:!1},sizeMode:{get:function(){return this._sizeMode},set:function(t){this._sizeMode=t,t!==a.CUSTOM&&this._applySpriteSize()},animatable:!1,type:a,tooltip:!1}},statics:{FillType:s,Type:r,SizeMode:a},setVisible:function(t){this.enabled=t},setInsetLeft:function(t){this._sgNode.setInsetLeft(t)},getInsetLeft:function(){return this._sgNode.getInsetLeft()},setInsetTop:function(t){this._sgNode.setInsetTop(t)},getInsetTop:function(){return this._sgNode.getInsetTop()},setInsetRight:function(t){this._sgNode.setInsetRight(t)},getInsetRight:function(){return this._sgNode.getInsetRight()},setInsetBottom:function(t){this._sgNode.setInsetBottom(t)},getInsetBottom:function(){return this._sgNode.getInsetBottom()},onEnable:function(){this._sgNode&&this._spriteFrame&&this._spriteFrame.textureLoaded()&&this._sgNode.setVisible(!0)},_applyAtlas:!1,_applySpriteFrameInsets:function(){var t=this._spriteFrame,e=this._sgNode;e.setInsetTop(t.insetTop),e.setInsetBottom(t.insetBottom),e.setInsetRight(t.insetRight),e.setInsetLeft(t.insetLeft)},_applySpriteSize:function(){if(this._spriteFrame)if(a.RAW===this._sizeMode){var t=this._spriteFrame.getOriginalSize();this.node.setContentSize(t)}else if(a.TRIMMED===this._sizeMode){var e=this._spriteFrame.getRect();this.node.setContentSize(e.width,e.height)}},_onTextureLoaded:function(t){if(this.isValid){var e=this._sgNode;e.setSpriteFrame(this._spriteFrame),this._applySpriteSize(),this.enabledInHierarchy&&!e.isVisible()&&e.setVisible(!0)}},_applySpriteFrame:function(t,e){var i=this._sgNode;t&&t.off&&t.off("load",this._onTextureLoaded,this);var n=this._spriteFrame;n?(e||this._applySpriteFrameInsets(),n.textureLoaded()?this._onTextureLoaded(null):(n.once("load",this._onTextureLoaded,this),n.ensureLoadTexture())):(i.setSpriteFrame(null),i.setVisible(!1))},_createSgNode:function(){return new cc.Scale9Sprite},_initSgNode:function(){var t=this._sgNode,e=0!==t.getInsetLeft()||0!==t.getInsetRight()||0!==t.getInsetTop()||0!==t.getInsetBottom();this._applySpriteFrame(null,e),t.setContentSize(this.node.getContentSize(!0)),this._applySpriteSize(),t.setRenderingType(this._type),t.setFillType(this._fillType),t.setFillCenter(this._fillCenter),t.setFillStart(this._fillStart),t.setFillRange(this._fillRange),t.enableTrimmedContentSize(this._isTrimmedMode),this._blendFunc.src=this._srcBlendFactor,this._blendFunc.dst=this._dstBlendFactor,t.setBlendFunc(this._blendFunc)},_resized:!1});t("../utils/misc").propertyDefine(c,["insetLeft","insetTop","insetRight","insetBottom"],{type:[null,"setRenderingType"]}),cc.Sprite=e.exports=c}),{"../utils/misc":206,"./CCRendererUnderSG":78}],82:[(function(t,e,i){var n=cc.Class({name:"cc.SpriteDistortion",extends:t("./CCComponent"),editor:!1,ctor:function(){this._spriteSGNode=null},properties:{_distortionOffset:cc.v2(0,0),offset:{get:function(){return this._distortionOffset},set:function(t){this._distortionOffset.x=t.x,this._distortionOffset.y=t.y,this._spriteSGNode&&this._spriteSGNode.setDistortionOffset(this._distortionOffset)}},_distortionTiling:cc.v2(1,1),tiling:{get:function(){return this._distortionTiling},set:function(t){this._distortionTiling.x=t.x,this._distortionTiling.y=t.y,this._spriteSGNode&&this._spriteSGNode.setDistortionTiling(this._distortionTiling)}}},onEnable:function(){var t=this.node.getComponent("cc.Sprite"),e=this._spriteSGNode=t&&t._sgNode;this._spriteSGNode&&(e.setState(cc.Scale9Sprite.state.DISTORTION),e.setDistortionOffset(this._distortionOffset),e.setDistortionTiling(this._distortionTiling))},onDisable:function(){this._spriteSGNode&&this._spriteSGNode.setState(cc.Scale9Sprite.state.NORMAL),this._spriteSGNode=null}});cc.SpriteDistortion=e.exports=n}),{"./CCComponent":72}],83:[(function(t,e,i){t("../videoplayer/CCSGVideoPlayer");var n=_ccsg.VideoPlayer.EventType,r=cc.Enum({REMOTE:0,LOCAL:1}),s=cc.Class({name:"cc.VideoPlayer",extends:cc._RendererUnderSG,editor:!1,properties:{_resourceType:r.REMOTE,resourceType:{tooltip:!1,type:r,set:function(t){this._resourceType=t,this._updateVideoSource()},get:function(){return this._resourceType}},_remoteURL:"",remoteURL:{tooltip:!1,type:cc.String,set:function(t){this._remoteURL=t,this._updateVideoSource()},get:function(){return this._remoteURL}},_clip:{default:null,url:cc.RawAsset},clip:{tooltip:!1,get:function(){return this._clip},set:function(t){"string"!=typeof t&&(t=""),this._clip=t,this._updateVideoSource()},url:cc.RawAsset},currentTime:{tooltip:!1,type:cc.Float,set:function(t){this._sgNode&&this._sgNode.seekTo(t)},get:function(){return this._sgNode?this._sgNode.currentTime():-1}},keepAspectRatio:{tooltip:!1,default:!0,type:cc.Boolean,notify:function(){this._sgNode.setKeepAspectRatioEnabled(this.keepAspectRatio)}},isFullscreen:{tooltip:!1,default:!1,type:cc.Boolean,notify:function(){this._sgNode.setFullScreenEnabled(this.isFullscreen)}},videoPlayerEvent:{default:[],type:cc.Component.EventHandler}},statics:{EventType:n,ResourceType:r},onLoad:function(){0},_createSgNode:function(){return new _ccsg.VideoPlayer},_updateVideoSource:function(){var t=this._sgNode;this.resourceType===r.REMOTE?t.setURL(this.remoteURL):t.setURL(this._clip||"")},_initSgNode:function(){var t=this._sgNode;t&&(t.createDomElementIfNeeded(),this._updateVideoSource(),t.seekTo(this.currentTime),t.setKeepAspectRatioEnabled(this.keepAspectRatio),t.setFullScreenEnabled(this.isFullscreen),t.setContentSize(this.node.getContentSize()),this.pause(),t.setEventListener(n.PLAYING,this.onPlaying.bind(this)),t.setEventListener(n.PAUSED,this.onPasued.bind(this)),t.setEventListener(n.STOPPED,this.onStopped.bind(this)),t.setEventListener(n.COMPLETED,this.onCompleted.bind(this)),t.setEventListener(n.META_LOADED,this.onMetaLoaded.bind(this)),t.setEventListener(n.CLICKED,this.onClicked.bind(this)),t.setEventListener(n.READY_TO_PLAY,this.onReadyToPlay.bind(this)))},onReadyToPlay:function(){cc.Component.EventHandler.emitEvents(this.videoPlayerEvent,this,n.READY_TO_PLAY),this.node.emit("ready-to-play",this)},onMetaLoaded:function(){cc.Component.EventHandler.emitEvents(this.videoPlayerEvent,this,n.META_LOADED),this.node.emit("meta-loaded",this)},onClicked:function(){cc.Component.EventHandler.emitEvents(this.videoPlayerEvent,this,n.CLICKED),this.node.emit("clicked",this)},onPlaying:function(){cc.Component.EventHandler.emitEvents(this.videoPlayerEvent,this,n.PLAYING),this.node.emit("playing",this)},onPasued:function(){cc.Component.EventHandler.emitEvents(this.videoPlayerEvent,this,n.PAUSED),this.node.emit("paused",this)},onStopped:function(){cc.Component.EventHandler.emitEvents(this.videoPlayerEvent,this,n.STOPPED),this.node.emit("stopped",this)},onCompleted:function(){cc.Component.EventHandler.emitEvents(this.videoPlayerEvent,this,n.COMPLETED),this.node.emit("completed",this)},play:function(){this._sgNode&&this._sgNode.play()},resume:function(){this._sgNode&&this._sgNode.resume()},pause:function(){this._sgNode&&this._sgNode.pause()},stop:function(){this._sgNode&&this._sgNode.stop()},getDuration:function(){return this._sgNode?this._sgNode.duration():-1},isPlaying:function(){return!!this._sgNode&&this._sgNode.isPlaying()}});cc.VideoPlayer=e.exports=s}),{"../videoplayer/CCSGVideoPlayer":220}],84:[(function(t,e,i){t("./CCComponent"),t("./CCRendererInSG"),t("./CCRendererUnderSG"),t("./CCComponentEventHandler"),t("./missing-script"),e.exports=[t("./CCSprite"),t("./CCWidget"),t("./CCCanvas"),t("./CCAudioSource"),t("./CCAnimation"),t("./CCButton"),t("./CCLabel"),t("./CCProgressBar"),t("./CCMask"),t("./CCScrollBar"),t("./CCScrollView"),t("./CCPageViewIndicator"),t("./CCPageView"),t("./CCSlider"),t("./CCLayout"),t("./CCEditBox"),t("./CCVideoPlayer"),t("./CCWebView"),t("./CCSpriteDistortion"),t("./CCLabelOutline"),t("./CCRichText"),t("./CCToggleContainer"),t("./CCToggleGroup"),t("./CCToggle"),t("./CCBlockInputEvents")]}),{"./CCAnimation":67,"./CCAudioSource":68,"./CCBlockInputEvents":69,"./CCButton":70,"./CCCanvas":71,"./CCComponent":72,"./CCComponentEventHandler":73,"./CCEditBox":1,"./CCLabel":74,"./CCLabelOutline":75,"./CCLayout":1,"./CCMask":76,"./CCPageView":1,"./CCPageViewIndicator":1,"./CCProgressBar":1,"./CCRendererInSG":77,"./CCRendererUnderSG":78,"./CCRichText":79,"./CCScrollBar":1,"./CCScrollView":1,"./CCSlider":1,"./CCSprite":81,"./CCSpriteDistortion":82,"./CCToggle":1,"./CCToggleContainer":1,"./CCToggleGroup":1,"./CCVideoPlayer":83,"./CCWebView":1,"./CCWidget":1,"./missing-script":85}],85:[(function(t,e,i){var n=cc.js,r=t("../utils/misc").BUILTIN_CLASSID_RE,s=cc.Class({name:"cc.MissingClass",properties:{_$erialized:{default:null,visible:!1,editorOnly:!0}}}),o=cc.Class({name:"cc.MissingScript",extends:cc.Component,editor:{inspector:"packages://inspector/inspectors/comps/missing-script.js"},properties:{compiled:{default:!1,serializable:!1},_$erialized:{default:null,visible:!1,editorOnly:!0}},ctor:!1,statics:{safeFindClass:function(t,e){var i=n._getClassById(t);return i||(t?(cc.deserialize.reportMissingClass(t),o.getMissingWrapper(t,e)):null)},getMissingWrapper:function(t,e){return e.node&&(/^[0-9a-zA-Z+/]{23}$/.test(t)||r.test(t))?o:s}},onLoad:function(){cc.warnID(4600,this.node.name)}});cc._MissingScript=e.exports=o}),{"../utils/misc":206}],86:[(function(t,e,i){var n=cc.js;t("../event/event");var r=function(t,e){cc.Event.call(this,cc.Event.MOUSE,e),this._eventType=t,this._button=0,this._x=0,this._y=0,this._prevX=0,this._prevY=0,this._scrollX=0,this._scrollY=0};n.extend(r,cc.Event);var s=r.prototype;s.setScrollData=function(t,e){this._scrollX=t,this._scrollY=e},s.getScrollX=function(){return this._scrollX},s.getScrollY=function(){return this._scrollY},s.setLocation=function(t,e){this._x=t,this._y=e},s.getLocation=function(){return{x:this._x,y:this._y}},s.getLocationInView=function(){return{x:this._x,y:cc.view._designResolutionSize.height-this._y}},s._setPrevCursor=function(t,e){this._prevX=t,this._prevY=e},s.getPreviousLocation=function(){return{x:this._prevX,y:this._prevY}},s.getDelta=function(){return{x:this._x-this._prevX,y:this._y-this._prevY}},s.getDeltaX=function(){return this._x-this._prevX},s.getDeltaY=function(){return this._y-this._prevY},s.setButton=function(t){this._button=t},s.getButton=function(){return this._button},s.getLocationX=function(){return this._x},s.getLocationY=function(){return this._y},r.NONE=0,r.DOWN=1,r.UP=2,r.MOVE=3,r.SCROLL=4,r.BUTTON_LEFT=0,r.BUTTON_RIGHT=2,r.BUTTON_MIDDLE=1,r.BUTTON_4=3,r.BUTTON_5=4,r.BUTTON_6=5,r.BUTTON_7=6,r.BUTTON_8=7;var o=function(t,e){cc.Event.call(this,cc.Event.TOUCH,e),this._eventCode=0,this._touches=t||[],this.touch=null,this.currentTouch=null};n.extend(o,cc.Event),(s=o.prototype).getEventCode=function(){return this._eventCode},s.getTouches=function(){return this._touches},s._setEventCode=function(t){this._eventCode=t},s._setTouches=function(t){this._touches=t},s.setLocation=function(t,e){this.touch&&this.touch.setTouchInfo(this.touch.getID(),t,e)},s.getLocation=function(){return this.touch?this.touch.getLocation():cc.v2()},s.getLocationInView=function(){return this.touch?this.touch.getLocationInView():cc.v2()},s.getPreviousLocation=function(){return this.touch?this.touch.getPreviousLocation():cc.v2()},s.getStartLocation=function(){return this.touch?this.touch.getStartLocation():cc.v2()},s.getID=function(){return this.touch?this.touch.getID():null},s.getDelta=function(){return this.touch?this.touch.getDelta():cc.v2()},s.getDeltaX=function(){return this.touch?this.touch.getDelta().x:0},s.getDeltaY=function(){return this.touch?this.touch.getDelta().y:0},s.getLocationX=function(){return this.touch?this.touch.getLocationX():0},s.getLocationY=function(){return this.touch?this.touch.getLocationY():0},o.MAX_TOUCHES=5,o.BEGAN=0,o.MOVED=1,o.ENDED=2,o.CANCELED=3;var a=function(t,e){cc.Event.call(this,cc.Event.ACCELERATION,e),this.acc=t};n.extend(a,cc.Event);var c=function(t,e,i){cc.Event.call(this,cc.Event.KEYBOARD,i),this.keyCode=t,this.isPressed=e};n.extend(c,cc.Event),cc.Event.EventMouse=r,cc.Event.EventTouch=o,cc.Event.EventAcceleration=a,cc.Event.EventKeyboard=c,e.exports=cc.Event}),{"../event/event":93}],87:[(function(t,e,i){cc.EventListener=cc._Class.extend({ctor:function(t,e,i){this._onEvent=i,this._type=t||0,this._listenerID=e||"",this._registered=!1,this._fixedPriority=0,this._node=null,this._target=null,this._paused=!0,this._isEnabled=!0},_setPaused:function(t){this._paused=t},_isPaused:function(){return this._paused},_setRegistered:function(t){this._registered=t},_isRegistered:function(){return this._registered},_getType:function(){return this._type},_getListenerID:function(){return this._listenerID},_setFixedPriority:function(t){this._fixedPriority=t},_getFixedPriority:function(){return this._fixedPriority},_setSceneGraphPriority:function(t){this._target=t,this._node=t},_getSceneGraphPriority:function(){return this._node},checkAvailable:function(){return null!==this._onEvent},clone:function(){return null},setEnabled:function(t){this._isEnabled=t},isEnabled:function(){return this._isEnabled},retain:function(){},release:function(){}}),cc.EventListener.UNKNOWN=0,cc.EventListener.TOUCH_ONE_BY_ONE=1,cc.EventListener.TOUCH_ALL_AT_ONCE=2,cc.EventListener.KEYBOARD=3,cc.EventListener.MOUSE=4,cc.EventListener.ACCELERATION=6,cc.EventListener.CUSTOM=8,cc._EventListenerCustom=cc.EventListener.extend({_onCustomEvent:null,ctor:function(t,e){this._onCustomEvent=e,cc.EventListener.prototype.ctor.call(this,cc.EventListener.CUSTOM,t,this._callback)},_callback:function(t){null!==this._onCustomEvent&&this._onCustomEvent(t)},checkAvailable:function(){return cc.EventListener.prototype.checkAvailable.call(this)&&null!==this._onCustomEvent},clone:function(){return new cc._EventListenerCustom(this._listenerID,this._onCustomEvent)}}),cc._EventListenerMouse=cc.EventListener.extend({onMouseDown:null,onMouseUp:null,onMouseMove:null,onMouseScroll:null,ctor:function(){cc.EventListener.prototype.ctor.call(this,cc.EventListener.MOUSE,cc._EventListenerMouse.LISTENER_ID,this._callback)},_callback:function(t){var e=cc.Event.EventMouse;switch(t._eventType){case e.DOWN:this.onMouseDown&&this.onMouseDown(t);break;case e.UP:this.onMouseUp&&this.onMouseUp(t);break;case e.MOVE:this.onMouseMove&&this.onMouseMove(t);break;case e.SCROLL:this.onMouseScroll&&this.onMouseScroll(t)}},clone:function(){var t=new cc._EventListenerMouse;return t.onMouseDown=this.onMouseDown,t.onMouseUp=this.onMouseUp,t.onMouseMove=this.onMouseMove,t.onMouseScroll=this.onMouseScroll,t},checkAvailable:function(){return!0}}),cc._EventListenerMouse.LISTENER_ID="__cc_mouse",cc._EventListenerTouchOneByOne=cc.EventListener.extend({_claimedTouches:null,swallowTouches:!1,onTouchBegan:null,onTouchMoved:null,onTouchEnded:null,onTouchCancelled:null,ctor:function(){cc.EventListener.prototype.ctor.call(this,cc.EventListener.TOUCH_ONE_BY_ONE,cc._EventListenerTouchOneByOne.LISTENER_ID,null),this._claimedTouches=[]},setSwallowTouches:function(t){this.swallowTouches=t},isSwallowTouches:function(){return this.swallowTouches},clone:function(){var t=new cc._EventListenerTouchOneByOne;return t.onTouchBegan=this.onTouchBegan,t.onTouchMoved=this.onTouchMoved,t.onTouchEnded=this.onTouchEnded,t.onTouchCancelled=this.onTouchCancelled,t.swallowTouches=this.swallowTouches,t},checkAvailable:function(){return!!this.onTouchBegan||(cc.logID(1801),!1)}}),cc._EventListenerTouchOneByOne.LISTENER_ID="__cc_touch_one_by_one",cc._EventListenerTouchAllAtOnce=cc.EventListener.extend({onTouchesBegan:null,onTouchesMoved:null,onTouchesEnded:null,onTouchesCancelled:null,ctor:function(){cc.EventListener.prototype.ctor.call(this,cc.EventListener.TOUCH_ALL_AT_ONCE,cc._EventListenerTouchAllAtOnce.LISTENER_ID,null)},clone:function(){var t=new cc._EventListenerTouchAllAtOnce;return t.onTouchesBegan=this.onTouchesBegan,t.onTouchesMoved=this.onTouchesMoved,t.onTouchesEnded=this.onTouchesEnded,t.onTouchesCancelled=this.onTouchesCancelled,t},checkAvailable:function(){return null!==this.onTouchesBegan||null!==this.onTouchesMoved||null!==this.onTouchesEnded||null!==this.onTouchesCancelled||(cc.logID(1802),!1)}}),cc._EventListenerTouchAllAtOnce.LISTENER_ID="__cc_touch_all_at_once",cc.EventListener.create=function(t){cc.assertID(t&&t.event,1900);var e=t.event;delete t.event;var i=null;e===cc.EventListener.TOUCH_ONE_BY_ONE?i=new cc._EventListenerTouchOneByOne:e===cc.EventListener.TOUCH_ALL_AT_ONCE?i=new cc._EventListenerTouchAllAtOnce:e===cc.EventListener.MOUSE?i=new cc._EventListenerMouse:e===cc.EventListener.CUSTOM?(i=new cc._EventListenerCustom(t.eventName,t.callback),delete t.eventName,delete t.callback):e===cc.EventListener.KEYBOARD?i=new cc._EventListenerKeyboard:e===cc.EventListener.ACCELERATION&&(i=new cc._EventListenerAcceleration(t.callback),delete t.callback);for(var n in t)i[n]=t[n];return i},cc._EventListenerAcceleration=cc.EventListener.extend({_onAccelerationEvent:null,ctor:function(t){this._onAccelerationEvent=t,cc.EventListener.prototype.ctor.call(this,cc.EventListener.ACCELERATION,cc._EventListenerAcceleration.LISTENER_ID,this._callback)},_callback:function(t){this._onAccelerationEvent(t.acc,t)},checkAvailable:function(){return cc.assertID(this._onAccelerationEvent,1803),!0},clone:function(){return new cc._EventListenerAcceleration(this._onAccelerationEvent)}}),cc._EventListenerAcceleration.LISTENER_ID="__cc_acceleration",cc._EventListenerKeyboard=cc.EventListener.extend({onKeyPressed:null,onKeyReleased:null,ctor:function(){cc.EventListener.prototype.ctor.call(this,cc.EventListener.KEYBOARD,cc._EventListenerKeyboard.LISTENER_ID,this._callback)},_callback:function(t){t.isPressed?this.onKeyPressed&&this.onKeyPressed(t.keyCode,t):this.onKeyReleased&&this.onKeyReleased(t.keyCode,t)},clone:function(){var t=new cc._EventListenerKeyboard;return t.onKeyPressed=this.onKeyPressed,t.onKeyReleased=this.onKeyReleased,t},checkAvailable:function(){return null!==this.onKeyPressed||null!==this.onKeyReleased||(cc.logID(1800),!1)}}),cc._EventListenerKeyboard.LISTENER_ID="__cc_keyboard"}),{}],88:[(function(t,e,i){var n=t("../platform/js"),r=cc._Class.extend({ctor:function(){this._fixedListeners=[],this._sceneGraphListeners=[],this.gt0Index=0},size:function(){return this._fixedListeners.length+this._sceneGraphListeners.length},empty:function(){return 0===this._fixedListeners.length&&0===this._sceneGraphListeners.length},push:function(t){0===t._getFixedPriority()?this._sceneGraphListeners.push(t):this._fixedListeners.push(t)},clearSceneGraphListeners:function(){this._sceneGraphListeners.length=0},clearFixedListeners:function(){this._fixedListeners.length=0},clear:function(){this._sceneGraphListeners.length=0,this._fixedListeners.length=0},getFixedPriorityListeners:function(){return this._fixedListeners},getSceneGraphPriorityListeners:function(){return this._sceneGraphListeners}}),s={DIRTY_NONE:0,DIRTY_FIXED_PRIORITY:1,DIRTY_SCENE_GRAPH_PRIORITY:2,DIRTY_ALL:3,_listenersMap:{},_priorityDirtyFlagMap:{},_nodeListenersMap:{},_nodePriorityMap:{},_globalZOrderNodeMap:{},_toAddedListeners:[],_toRemovedListeners:[],_dirtyNodes:[],_inDispatch:0,_isEnabled:!1,_nodePriorityIndex:0,_internalCustomListenerIDs:[],_setDirtyForNode:function(t){if(void 0!==this._nodeListenersMap[t.__instanceId]&&this._dirtyNodes.push(t),t.getChildren)for(var e=t.getChildren(),i=0,n=e?e.length:0;i<n;i++)this._setDirtyForNode(e[i])},pauseTarget:function(t,e){if(t instanceof cc._BaseNode||t instanceof _ccsg.Node){var i,n,r=this._nodeListenersMap[t.__instanceId];if(r)for(i=0,n=r.length;i<n;i++)r[i]._setPaused(!0);if(!0===e){var s=t.getChildren();for(i=0,n=s?s.length:0;i<n;i++)this.pauseTarget(s[i],!0)}}else cc.warnID(3506)},resumeTarget:function(t,e){if(t instanceof cc._BaseNode||t instanceof _ccsg.Node){var i,n,r=this._nodeListenersMap[t.__instanceId];if(r)for(i=0,n=r.length;i<n;i++)r[i]._setPaused(!1);if(this._setDirtyForNode(t),!0===e&&t.getChildren){var s=t.getChildren();for(i=0,n=s?s.length:0;i<n;i++)this.resumeTarget(s[i],!0)}}else cc.warnID(3506)},_addListener:function(t){0===this._inDispatch?this._forceAddEventListener(t):this._toAddedListeners.push(t)},_forceAddEventListener:function(t){var e=t._getListenerID(),i=this._listenersMap[e];if(i||(i=new r,this._listenersMap[e]=i),i.push(t),0===t._getFixedPriority()){this._setDirty(e,this.DIRTY_SCENE_GRAPH_PRIORITY);var n=t._getSceneGraphPriority();null===n&&cc.logID(3507),this._associateNodeAndEventListener(n,t),n.isRunning()&&this.resumeTarget(n)}else this._setDirty(e,this.DIRTY_FIXED_PRIORITY)},_getListeners:function(t){return this._listenersMap[t]},_updateDirtyFlagForSceneGraph:function(){if(0!==this._dirtyNodes.length){for(var t,e,i=this._dirtyNodes,n=this._nodeListenersMap,r=0,s=i.length;r<s;r++)if(t=n[i[r].__instanceId])for(var o=0,a=t.length;o<a;o++)(e=t[o])&&this._setDirty(e._getListenerID(),this.DIRTY_SCENE_GRAPH_PRIORITY);this._dirtyNodes.length=0}},_removeAllListenersInVector:function(t){if(t)for(var e,i=0;i<t.length;)(e=t[i])._setRegistered(!1),null!=e._getSceneGraphPriority()&&(this._dissociateNodeAndEventListener(e._getSceneGraphPriority(),e),e._setSceneGraphPriority(null)),0===this._inDispatch?cc.js.array.remove(t,e):++i},_removeListenersForListenerID:function(t){var e,i=this._listenersMap[t];if(i){var n=i.getFixedPriorityListeners(),r=i.getSceneGraphPriorityListeners();this._removeAllListenersInVector(r),this._removeAllListenersInVector(n),delete this._priorityDirtyFlagMap[t],this._inDispatch||(i.clear(),delete this._listenersMap[t])}var s,o=this._toAddedListeners;for(e=0;e<o.length;)(s=o[e])&&s._getListenerID()===t?cc.js.array.remove(o,s):++e},_sortEventListeners:function(t){var e=this.DIRTY_NONE,i=this._priorityDirtyFlagMap;if(i[t]&&(e=i[t]),e!==this.DIRTY_NONE&&(i[t]=this.DIRTY_NONE,e&this.DIRTY_FIXED_PRIORITY&&this._sortListenersOfFixedPriority(t),e&this.DIRTY_SCENE_GRAPH_PRIORITY)){var n=cc.director.getScene();n&&this._sortListenersOfSceneGraphPriority(t,n)}},_sortListenersOfSceneGraphPriority:function(t,e){var i=this._getListeners(t);if(i){var n=i.getSceneGraphPriorityListeners();n&&0!==n.length&&(this._nodePriorityIndex=0,this._nodePriorityMap={},this._visitTarget(e,!0),i.getSceneGraphPriorityListeners().sort(this._sortEventListenersOfSceneGraphPriorityDes))}},_sortEventListenersOfSceneGraphPriorityDes:function(t,e){var i=s._nodePriorityMap,n=t._getSceneGraphPriority(),r=e._getSceneGraphPriority();return e&&r&&i[r.__instanceId]?t&&n&&i[n.__instanceId]?i[r.__instanceId]-i[n.__instanceId]:1:-1},_sortListenersOfFixedPriority:function(t){var e=this._listenersMap[t];if(e){var i=e.getFixedPriorityListeners();if(i&&0!==i.length){i.sort(this._sortListenersOfFixedPriorityAsc);for(var n=0,r=i.length;n<r&&!(i[n]._getFixedPriority()>=0);)++n;e.gt0Index=n}}},_sortListenersOfFixedPriorityAsc:function(t,e){return t._getFixedPriority()-e._getFixedPriority()},_onUpdateListeners:function(t){var e,i,n,r=t.getFixedPriorityListeners(),s=t.getSceneGraphPriorityListeners(),o=this._toRemovedListeners;if(s)for(e=0;e<s.length;)(i=s[e])._isRegistered()?++e:(cc.js.array.remove(s,i),-1!==(n=o.indexOf(i))&&o.splice(n,1));if(r)for(e=0;e<r.length;)(i=r[e])._isRegistered()?++e:(cc.js.array.remove(r,i),-1!==(n=o.indexOf(i))&&o.splice(n,1));s&&0===s.length&&t.clearSceneGraphListeners(),r&&0===r.length&&t.clearFixedListeners()},frameUpdateListeners:function(){var t=this._listenersMap,e=this._priorityDirtyFlagMap;for(var i in t)t[i].empty()&&(delete e[i],delete t[i]);var n=this._toAddedListeners;if(0!==n.length){for(var r=0,s=n.length;r<s;r++)this._forceAddEventListener(n[r]);n.length=0}0!==this._toRemovedListeners.length&&this._cleanToRemovedListeners()},_updateTouchListeners:function(t){var e=this._inDispatch;if(cc.assertID(e>0,3508),!(e>1)){var i;(i=this._listenersMap[cc._EventListenerTouchOneByOne.LISTENER_ID])&&this._onUpdateListeners(i),(i=this._listenersMap[cc._EventListenerTouchAllAtOnce.LISTENER_ID])&&this._onUpdateListeners(i),cc.assertID(1===e,3509);var n=this._toAddedListeners;if(0!==n.length){for(var r=0,s=n.length;r<s;r++)this._forceAddEventListener(n[r]);this._toAddedListeners.length=0}0!==this._toRemovedListeners.length&&this._cleanToRemovedListeners()}},_cleanToRemovedListeners:function(){for(var t=this._toRemovedListeners,e=0;e<t.length;e++){var i=t[e],n=this._listenersMap[i._getListenerID()];if(n){var r,s=n.getFixedPriorityListeners(),o=n.getSceneGraphPriorityListeners();o&&-1!==(r=o.indexOf(i))&&o.splice(r,1),s&&-1!==(r=s.indexOf(i))&&s.splice(r,1)}}t.length=0},_onTouchEventCallback:function(t,e){if(!t._isRegistered)return!1;var i=e.event,n=i.currentTouch;i.currentTarget=t._node;var r,o=!1,a=i.getEventCode(),c=cc.Event.EventTouch;return a===c.BEGAN?t.onTouchBegan&&(o=t.onTouchBegan(n,i))&&t._registered&&t._claimedTouches.push(n):t._claimedTouches.length>0&&-1!==(r=t._claimedTouches.indexOf(n))&&(o=!0,a===c.MOVED&&t.onTouchMoved?t.onTouchMoved(n,i):a===c.ENDED?(t.onTouchEnded&&t.onTouchEnded(n,i),t._registered&&t._claimedTouches.splice(r,1)):a===c.CANCELLED&&(t.onTouchCancelled&&t.onTouchCancelled(n,i),t._registered&&t._claimedTouches.splice(r,1))),i.isStopped()?(s._updateTouchListeners(i),!0):!!(o&&t._registered&&t.swallowTouches)&&(e.needsMutableSet&&e.touches.splice(n,1),!0)},_dispatchTouchEvent:function(t){this._sortEventListeners(cc._EventListenerTouchOneByOne.LISTENER_ID),this._sortEventListeners(cc._EventListenerTouchAllAtOnce.LISTENER_ID);var e=this._getListeners(cc._EventListenerTouchOneByOne.LISTENER_ID),i=this._getListeners(cc._EventListenerTouchAllAtOnce.LISTENER_ID);if(null!==e||null!==i){var n=t.getTouches(),r=cc.js.array.copy(n),s={event:t,needsMutableSet:e&&i,touches:r,selTouch:null};if(e)for(var o=0;o<n.length;o++)t.currentTouch=n[o],t._propagationStopped=t._propagationImmediateStopped=!1,this._dispatchEventToListeners(e,this._onTouchEventCallback,s);i&&r.length>0&&(this._dispatchEventToListeners(i,this._onTouchesEventCallback,{event:t,touches:r}),t.isStopped())||this._updateTouchListeners(t)}},_onTouchesEventCallback:function(t,e){if(!t._registered)return!1;var i=cc.Event.EventTouch,n=e.event,r=e.touches,o=n.getEventCode();return n.currentTarget=t._node,o===i.BEGAN&&t.onTouchesBegan?t.onTouchesBegan(r,n):o===i.MOVED&&t.onTouchesMoved?t.onTouchesMoved(r,n):o===i.ENDED&&t.onTouchesEnded?t.onTouchesEnded(r,n):o===i.CANCELLED&&t.onTouchesCancelled&&t.onTouchesCancelled(r,n),!!n.isStopped()&&(s._updateTouchListeners(n),!0)},_associateNodeAndEventListener:function(t,e){var i=this._nodeListenersMap[t.__instanceId];i||(i=[],this._nodeListenersMap[t.__instanceId]=i),i.push(e)},_dissociateNodeAndEventListener:function(t,e){var i=this._nodeListenersMap[t.__instanceId];i&&(cc.js.array.remove(i,e),0===i.length&&delete this._nodeListenersMap[t.__instanceId])},_dispatchEventToListeners:function(t,e,i){var n,r,s=!1,o=t.getFixedPriorityListeners(),a=t.getSceneGraphPriorityListeners(),c=0;if(o&&0!==o.length)for(;c<t.gt0Index;++c)if((r=o[c]).isEnabled()&&!r._isPaused()&&r._isRegistered()&&e(r,i)){s=!0;break}if(a&&!s)for(n=0;n<a.length;n++)if((r=a[n]).isEnabled()&&!r._isPaused()&&r._isRegistered()&&e(r,i)){s=!0;break}if(o&&!s)for(;c<o.length;++c)if((r=o[c]).isEnabled()&&!r._isPaused()&&r._isRegistered()&&e(r,i)){s=!0;break}},_setDirty:function(t,e){var i=this._priorityDirtyFlagMap;null==i[t]?i[t]=e:i[t]=e|i[t]},_visitTarget:function(t,e){t._reorderChildDirty&&t.sortAllChildren();var i=t.getChildren(),n=0,r=i.length,s=this._globalZOrderNodeMap,o=this._nodeListenersMap;if(r>0){for(var a;n<r&&((a=i[n])&&a.getLocalZOrder()<0);n++)this._visitTarget(a,!1);for(void 0!==o[t.__instanceId]&&(s[t.getGlobalZOrder()]||(s[t.getGlobalZOrder()]=[]),s[t.getGlobalZOrder()].push(t.__instanceId));n<r;n++)(a=i[n])&&this._visitTarget(a,!1)}else void 0!==o[t.__instanceId]&&(s[t.getGlobalZOrder()]||(s[t.getGlobalZOrder()]=[]),s[t.getGlobalZOrder()].push(t.__instanceId));if(e){var c=[];for(var h in s)c.push(h);c.sort(this._sortNumberAsc);var l,_,u=c.length,d=this._nodePriorityMap;for(n=0;n<u;n++)for(l=s[c[n]],_=0;_<l.length;_++)d[l[_]]=++this._nodePriorityIndex;this._globalZOrderNodeMap={}}},_sortNumberAsc:function(t,e){return t-e},hasEventListener:function(t){return!!this._getListeners(t)},addListener:function(t,e){if(cc.assertID(t&&e,3503),cc.js.isNumber(e)||e instanceof cc._BaseNode||e instanceof _ccsg.Node){if(t instanceof cc.EventListener){if(t._isRegistered())return void cc.logID(3505)}else cc.assertID(!cc.js.isNumber(e),3504),t=cc.EventListener.create(t);if(t.checkAvailable()){if(cc.js.isNumber(e)){if(0===e)return void cc.logID(3500);t._setSceneGraphPriority(null),t._setFixedPriority(e),t._setRegistered(!0),t._setPaused(!1),this._addListener(t)}else t._setSceneGraphPriority(e),t._setFixedPriority(0),t._setRegistered(!0),this._addListener(t);return t}}else cc.warnID(3506)},addCustomListener:function(t,e){var i=new cc._EventListenerCustom(t,e);return this.addListener(i,1),i},removeListener:function(t){if(null!=t){var e,i=this._listenersMap;for(var n in i){var r=i[n],s=r.getFixedPriorityListeners(),o=r.getSceneGraphPriorityListeners();if((e=this._removeListenerInVector(o,t))?this._setDirty(t._getListenerID(),this.DIRTY_SCENE_GRAPH_PRIORITY):(e=this._removeListenerInVector(s,t))&&this._setDirty(t._getListenerID(),this.DIRTY_FIXED_PRIORITY),r.empty()&&(delete this._priorityDirtyFlagMap[t._getListenerID()],delete i[n]),e)break}if(!e)for(var a=this._toAddedListeners,c=0,h=a.length;c<h;c++){var l=a[c];if(l===t){cc.js.array.remove(a,l),l._setRegistered(!1);break}}}},_removeListenerInCallback:function(t,e){if(null==t)return!1;for(var i=0,n=t.length;i<n;i++){var r=t[i];if(r._onCustomEvent===e||r._onEvent===e)return r._setRegistered(!1),null!=r._getSceneGraphPriority()&&(this._dissociateNodeAndEventListener(r._getSceneGraphPriority(),r),r._setSceneGraphPriority(null)),0===this._inDispatch?cc.js.array.remove(t,r):this._toRemovedListeners.push(r),!0}return!1},_removeListenerInVector:function(t,e){if(null==t)return!1;for(var i=0,n=t.length;i<n;i++){var r=t[i];if(r===e)return r._setRegistered(!1),null!=r._getSceneGraphPriority()&&(this._dissociateNodeAndEventListener(r._getSceneGraphPriority(),r),r._setSceneGraphPriority(null)),0===this._inDispatch?cc.js.array.remove(t,r):this._toRemovedListeners.push(r),!0}return!1},removeListeners:function(t,e){if(cc.js.isNumber(t)||t instanceof cc._BaseNode||t instanceof _ccsg.Node)if(void 0!==t.__instanceId){delete this._nodePriorityMap[t.__instanceId],cc.js.array.remove(this._dirtyNodes,t);var i,n=this._nodeListenersMap[t.__instanceId];if(n){var r=cc.js.array.copy(n);for(i=0;i<r.length;i++)this.removeListener(r[i]);delete this._nodeListenersMap[t.__instanceId]}var s=this._toAddedListeners;for(i=0;i<s.length;){var o=s[i];o._getSceneGraphPriority()===t?(o._setSceneGraphPriority(null),o._setRegistered(!1),s.splice(i,1)):++i}if(!0===e){var a,c=t.getChildren();for(i=0,a=c.length;i<a;i++)this.removeListeners(c[i],!0)}}else t===cc.EventListener.TOUCH_ONE_BY_ONE?this._removeListenersForListenerID(cc._EventListenerTouchOneByOne.LISTENER_ID):t===cc.EventListener.TOUCH_ALL_AT_ONCE?this._removeListenersForListenerID(cc._EventListenerTouchAllAtOnce.LISTENER_ID):t===cc.EventListener.MOUSE?this._removeListenersForListenerID(cc._EventListenerMouse.LISTENER_ID):t===cc.EventListener.ACCELERATION?this._removeListenersForListenerID(cc._EventListenerAcceleration.LISTENER_ID):t===cc.EventListener.KEYBOARD?this._removeListenersForListenerID(cc._EventListenerKeyboard.LISTENER_ID):cc.logID(3501);else cc.warnID(3506)},removeCustomListeners:function(t){this._removeListenersForListenerID(t)},removeAllListeners:function(){var t=this._listenersMap,e=this._internalCustomListenerIDs;for(var i in t)-1===e.indexOf(i)&&this._removeListenersForListenerID(i)},setPriority:function(t,e){if(null!=t){var i=this._listenersMap;for(var n in i){var r=i[n].getFixedPriorityListeners();if(r){if(-1!==r.indexOf(t))return null!=t._getSceneGraphPriority()&&cc.logID(3502),void(t._getFixedPriority()!==e&&(t._setFixedPriority(e),this._setDirty(t._getListenerID(),this.DIRTY_FIXED_PRIORITY)))}}}},setEnabled:function(t){this._isEnabled=t},isEnabled:function(){return this._isEnabled},dispatchEvent:function(t){if(this._isEnabled){if(this._updateDirtyFlagForSceneGraph(),this._inDispatch++,!t||!t.getType)throw new Error("event is undefined");if(t.getType().startsWith(cc.Event.TOUCH))return this._dispatchTouchEvent(t),void this._inDispatch--;var e=(function(t){var e=cc.Event,i=t.type;return i===e.ACCELERATION?cc._EventListenerAcceleration.LISTENER_ID:i===e.KEYBOARD?cc._EventListenerKeyboard.LISTENER_ID:i.startsWith(e.MOUSE)?cc._EventListenerMouse.LISTENER_ID:(i.startsWith(e.TOUCH)&&cc.logID(2e3),"")})(t);this._sortEventListeners(e);var i=this._listenersMap[e];null!=i&&(this._dispatchEventToListeners(i,this._onListenerCallback,t),this._onUpdateListeners(i)),this._inDispatch--}},_onListenerCallback:function(t,e){return e.currentTarget=t._target,t._onEvent(e),e.isStopped()},dispatchCustomEvent:function(t,e){var i=new cc.Event.EventCustom(t);i.setUserData(e),this.dispatchEvent(i)}};n.get(cc,"eventManager",(function(){return cc.warnID(1405,"cc.eventManager","cc.EventTarget or cc.systemEvent"),s})),e.exports=s}),{"../platform/js":177}],89:[(function(t,e,i){cc.Touch=cc._Class.extend({ctor:function(t,e,i){this._lastModified=0,this.setTouchInfo(i,t,e)},getLocation:function(){return{x:this._point.x,y:this._point.y}},getLocationX:function(){return this._point.x},getLocationY:function(){return this._point.y},getPreviousLocation:function(){return{x:this._prevPoint.x,y:this._prevPoint.y}},getStartLocation:function(){return{x:this._startPoint.x,y:this._startPoint.y}},getDelta:function(){return cc.pSub(this._point,this._prevPoint)},getLocationInView:function(){return{x:this._point.x,y:cc.view._designResolutionSize.height-this._point.y}},getPreviousLocationInView:function(){return{x:this._prevPoint.x,y:cc.view._designResolutionSize.height-this._prevPoint.y}},getStartLocationInView:function(){return{x:this._startPoint.x,y:cc.view._designResolutionSize.height-this._startPoint.y}},getID:function(){return this._id},setTouchInfo:function(t,e,i){this._prevPoint=this._point,this._point=cc.p(e||0,i||0),this._id=t,this._startPointCaptured||(this._startPoint=cc.p(this._point),cc.view._convertPointWithScale(this._startPoint),this._startPointCaptured=!0)},_setPoint:function(t,e){void 0===e?(this._point.x=t.x,this._point.y=t.y):(this._point.x=t,this._point.y=e)},_setPrevPoint:function(t,e){this._prevPoint=void 0===e?cc.p(t.x,t.y):cc.p(t||0,e||0)}})}),{}],90:[(function(t,e,i){t("./CCEvent");var n;t("./CCTouch"),t("./CCEventListener"),n=t("./CCEventManager"),e.exports=n}),{"./CCEvent":86,"./CCEventListener":87,"./CCEventManager":88,"./CCTouch":89}],91:[(function(t,e,i){function n(){s.call(this)}var r=cc.js,s=t("../platform/callbacks-invoker").CallbacksHandler;r.extend(n,s),n.prototype.invoke=function(t,e){var i=t.type,n=this._callbackTable[i];if(n){var r=!n.isInvoking;n.isInvoking=!0;for(var s=n.callbacks,o=n.targets,a=0,c=s.length;a<c;++a){var h=s[a];if(h){var l=o[a]||t.currentTarget;if(h.call(l,t,e),t._propagationImmediateStopped)break}}r&&(n.isInvoking=!1,n.containCanceled&&n.purgeCanceled())}},e.exports=n}),{"../platform/callbacks-invoker":170}],92:[(function(t,e,i){function n(){this._capturingListeners=null,this._bubblingListeners=null,this._hasListenerCache=null}var r=t("./event-listeners");t("./event");var s=cc.js.array.fastRemove,o=new Array(16);o.length=0;var a=n.prototype;a._addEventFlag=function(t,e,i){var n=this._hasListenerCache;n||(n=this._hasListenerCache=cc.js.createMap()),void 0===n[t]&&(n[t]=0);var r=i?2:4;n[t]|=r},a._purgeEventFlag=function(t,e,i){var n=this._hasListenerCache;if(n&&!e.has(t)){var r=i?2:4;n[t]&=~r,0===n[t]&&delete n[t]}},a._resetFlagForTarget=function(t,e,i){var n=this._hasListenerCache;if(n){var r=i?2:4;for(var s in n)e.has(s)||(n[s]&=~r,0===n[s]&&delete n[s])}},a.hasEventListener=function(t,e){var i=this._hasListenerCache;if(!i)return!1;var n=e?2:4;return(i[t]&n)>0},a.on=function(t,e,i,n){"boolean"==typeof i?(n=i,i=void 0):n=!!n;if(e){var s=null;return(s=n?this._capturingListeners=this._capturingListeners||new r:this._bubblingListeners=this._bubblingListeners||new r).has(t,e,i)||(s.add(t,e,i),i&&i.__eventTargets&&i.__eventTargets.push(this),this._addEventFlag(t,s,n)),e}cc.errorID(6800)},a.off=function(t,e,i,n){if("boolean"==typeof i?(n=i,i=void 0):n=!!n,e){var r=n?this._capturingListeners:this._bubblingListeners;r&&(r.remove(t,e,i),i&&i.__eventTargets&&s(i.__eventTargets,this),this._purgeEventFlag(t,r,n))}else this._capturingListeners&&this._capturingListeners.removeAll(t),this._bubblingListeners&&this._bubblingListeners.removeAll(t),this._hasListenerCache&&delete this._hasListenerCache[t]},a.targetOff=function(t){this._capturingListeners&&(this._capturingListeners.removeAll(t),this._resetFlagForTarget(t,this._capturingListeners,!0)),this._bubblingListeners&&(this._bubblingListeners.removeAll(t),this._resetFlagForTarget(t,this._bubblingListeners,!1))},a.once=function(t,e,i,n){var r="__ONCE_FLAG:"+t,s=n?this._capturingListeners:this._bubblingListeners;if(!(s&&s.has(r,e,i))){var o=this,a=function(c){o.off(t,a,i,n),s.remove(r,e,i),e.call(this,c)};this.on(t,a,i,n),s||(s=n?this._capturingListeners:this._bubblingListeners),s.add(r,e,i)}},a.dispatchEvent=function(t){(function(t,e){var i,n;for(e.target=t,o.length=0,t._getCapturingTargets(e.type,o),e.eventPhase=1,n=o.length-1;n>=0;--n)if((i=o[n])._isTargetActive(e.type)&&i._capturingListeners&&(e.currentTarget=i,i._capturingListeners.invoke(e,o),e._propagationStopped))return void(o.length=0);if(o.length=0,t._isTargetActive(e.type)&&(e.eventPhase=2,e.currentTarget=t,t._capturingListeners&&t._capturingListeners.invoke(e),!e._propagationImmediateStopped&&t._bubblingListeners&&t._bubblingListeners.invoke(e)),!e._propagationStopped&&e.bubbles)for(t._getBubblingTargets(e.type,o),e.eventPhase=3,n=0;n<o.length;++n)if((i=o[n])._isTargetActive(e.type)&&i._bubblingListeners&&(e.currentTarget=i,i._bubblingListeners.invoke(e),e._propagationStopped))return void(o.length=0);o.length=0})(this,t),o.length=0},a.emit=function(t,e){var i=this._hasListenerCache;if(i){var n=i[t];if(n){var r=cc.Event.EventCustom.get(t);r.detail=e,r.eventPhase=2,r.target=r.currentTarget=this;var s=this._capturingListeners;s&&2&n&&s.invoke(r);var o=this._bubblingListeners;o&&4&n&&!r._propagationImmediateStopped&&o.invoke(r),r.detail=null,cc.Event.EventCustom.put(r)}}},a._isTargetActive=function(t){return!0},a._getCapturingTargets=function(t,e){},a._getBubblingTargets=function(t,e){},n.prototype._EventTargetOn=n.prototype.on,n.prototype._EventTargetOnce=n.prototype.once,n.prototype._EventTargetOff=n.prototype.off,n.prototype._EventTargetTargetOff=n.prototype.targetOff,cc.EventTarget=e.exports=n}),{"./event":93,"./event-listeners":91}],93:[(function(t,e,i){var n=t("../platform/js");cc.Event=function(t,e){this.type=t,this.bubbles=!!e,this.target=null,this.currentTarget=null,this.eventPhase=0,this._propagationStopped=!1,this._propagationImmediateStopped=!1},cc.Event.prototype={constructor:cc.Event,unuse:function(){this.type=cc.Event.NO_TYPE,this.target=null,this.currentTarget=null,this.eventPhase=cc.Event.NONE,this._propagationStopped=!1,this._propagationImmediateStopped=!1},reuse:function(t,e){this.type=t,this.bubbles=e||!1},stopPropagation:function(){this._propagationStopped=!0},stopPropagationImmediate:function(){this._propagationImmediateStopped=!0},isStopped:function(){return this._propagationStopped||this._propagationImmediateStopped},getCurrentTarget:function(){return this.currentTarget},getType:function(){return this.type}},cc.Event.NO_TYPE="no_type",cc.Event.TOUCH="touch",cc.Event.MOUSE="mouse",cc.Event.KEYBOARD="keyboard",cc.Event.ACCELERATION="acceleration",cc.Event.NONE=0,cc.Event.CAPTURING_PHASE=1,cc.Event.AT_TARGET=2,cc.Event.BUBBLING_PHASE=3;var r=function(t,e){cc.Event.call(this,t,e),this.detail=null};n.extend(r,cc.Event),r.prototype.reset=r,r.prototype.setUserData=function(t){this.detail=t},r.prototype.getUserData=function(){return this.detail},r.prototype.getEventName=cc.Event.prototype.getType;var s=new n.Pool(10);r.put=function(t){s.put(t)},r.get=function(t,e){var i=s._get();return i?i.reset(t,e):i=new r(t,e),i},cc.Event.EventCustom=r,e.exports=cc.Event}),{"../platform/js":177}],94:[(function(t,e,i){t("./event"),t("./event-listeners"),t("./event-target"),t("./system-event")}),{"./event":93,"./event-listeners":91,"./event-target":92,"./system-event":95}],95:[(function(t,e,i){var n,r=t("../event/event-target"),s=t("../event-manager");n=t("../platform/CCInputManager");var o=cc.Enum({KEY_DOWN:"keydown",KEY_UP:"keyup",DEVICEMOTION:"devicemotion"}),a=null,c=null,h=0,l=cc.Class({name:"SystemEvent",extends:r,statics:{EventType:o},setAccelerometerEnabled:function(t){n.setAccelerometerEnabled(t)},setAccelerometerInterval:function(t){n.setAccelerometerInterval(t)},on:function(t,e,i,n){if(this._super(t,e,i,n),(t===o.KEY_DOWN||t===o.KEY_UP)&&(a||(a=cc.EventListener.create({event:cc.EventListener.KEYBOARD,onKeyPressed:function(t,e){e.type=o.KEY_DOWN,cc.systemEvent.dispatchEvent(e)},onKeyReleased:function(t,e){e.type=o.KEY_UP,cc.systemEvent.dispatchEvent(e)}})),!s.hasEventListener(cc._EventListenerKeyboard.LISTENER_ID))){var r=cc.director.getTotalFrames();r!==h&&(s.addListener(a,1),h=r)}t===o.DEVICEMOTION&&(c||(c=cc.EventListener.create({event:cc.EventListener.ACCELERATION,callback:function(t,e){e.type=o.DEVICEMOTION,cc.systemEvent.dispatchEvent(e)}})),s.hasEventListener(cc._EventListenerAcceleration.LISTENER_ID)||s.addListener(c,1))},off:function(t,e,i,n){if(this._super(t,e,i,n),a&&(t===o.KEY_DOWN||t===o.KEY_UP)){var r=this.hasEventListener(o.KEY_DOWN),h=this.hasEventListener(o.KEY_UP);r||h||s.removeListener(a)}c&&t===o.DEVICEMOTION&&s.removeListener(c)}});cc.SystemEvent=e.exports=l,cc.systemEvent=new cc.SystemEvent}),{"../event-manager":90,"../event/event-target":92,"../platform/CCInputManager":160}],96:[(function(t,e,i){"use strict";function n(t,e,i){i=i||2;var n=e&&e.length,c=n?e[0]*i:t.length,l=r(t,0,c,i,!0),_=[];if(!l)return _;var u,f,p,g,v,y,x;if(n&&(l=(function(t,e,i,n){var o,c,l,_,u,f=[];for(o=0,c=e.length;o<c;o++)l=e[o]*n,_=o<c-1?e[o+1]*n:t.length,(u=r(t,l,_,n,!1))===u.next&&(u.steiner=!0),f.push(function(t){var e=t,i=t;do{e.x<i.x&&(i=e),e=e.next}while(e!==t);return i}(u));for(f.sort(a),o=0;o<f.length;o++)(function(t,e){if(e=(function(t,e){var i,n=e,r=t.x,s=t.y,o=-1/0;do{if(s<=n.y&&s>=n.next.y){var a=n.x+(s-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(a<=r&&a>o){if(o=a,a===r){if(s===n.y)return n;if(s===n.next.y)return n.next}i=n.x<n.next.x?n:n.next}}n=n.next}while(n!==e);if(!i)return null;if(r===o)return i.prev;var c,l=i,_=i.x,u=i.y,m=1/0;for(n=i.next;n!==l;)r>=n.x&&n.x>=_&&h(s<u?r:o,s,_,u,s<u?o:r,s,n.x,n.y)&&((c=Math.abs(s-n.y)/(r-n.x))<m||c===m&&n.x>i.x)&&d(n,t)&&(i=n,m=c),n=n.next;return i})(t,e)){var i=m(e,t);s(i,i.next)}})(f[o],i),i=s(i,i.next);return i})(t,e,l,i)),t.length>80*i){u=p=t[0],f=g=t[1];for(var C=i;C<c;C+=i)v=t[C],y=t[C+1],v<u&&(u=v),y<f&&(f=y),v>p&&(p=v),y>g&&(g=y);x=Math.max(p-u,g-f)}return o(l,_,i,u,f,x),_}function r(t,e,i,n,r){var s,o;if(r===v(t,e,i,n)>0)for(s=e;s<i;s+=n)o=f(s,t[s],t[s+1],o);else for(s=i-n;s>=e;s-=n)o=f(s,t[s],t[s+1],o);return o&&_(o,o.next)&&(p(o),o=o.next),o}function s(t,e){if(!t)return t;e||(e=t);var i,n=t;do{if(i=!1,n.steiner||!_(n,n.next)&&0!==l(n.prev,n,n.next))n=n.next;else{if(p(n),(n=e=n.prev)===n.next)return null;i=!0}}while(i||n!==e);return e}function o(t,e,i,n,r,a,f){if(t){!f&&a&&(function(t,e,i,n){var r=t;do{null===r.z&&(r.z=c(r.x,r.y,e,i,n)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,(function(t){var e,i,n,r,s,o,a,c,h=1;do{for(i=t,t=null,s=null,o=0;i;){for(o++,n=i,a=0,e=0;e<h&&(a++,n=n.nextZ);e++);for(c=h;a>0||c>0&&n;)0===a?(r=n,n=n.nextZ,c--):0!==c&&n?i.z<=n.z?(r=i,i=i.nextZ,a--):(r=n,n=n.nextZ,c--):(r=i,i=i.nextZ,a--),s?s.nextZ=r:t=r,r.prevZ=s,s=r;i=n}s.nextZ=null,h*=2}while(o>1)})(r)})(t,n,r,a);for(var g,v,y=t;t.prev!==t.next;)if(g=t.prev,v=t.next,a?(function(t,e,i,n){var r=t.prev,s=t,o=t.next;if(l(r,s,o)>=0)return!1;var a=r.x<s.x?r.x<o.x?r.x:o.x:s.x<o.x?s.x:o.x,_=r.y<s.y?r.y<o.y?r.y:o.y:s.y<o.y?s.y:o.y,u=r.x>s.x?r.x>o.x?r.x:o.x:s.x>o.x?s.x:o.x,d=r.y>s.y?r.y>o.y?r.y:o.y:s.y>o.y?s.y:o.y,m=c(a,_,e,i,n),f=c(u,d,e,i,n),p=t.nextZ;for(;p&&p.z<=f;){if(p!==t.prev&&p!==t.next&&h(r.x,r.y,s.x,s.y,o.x,o.y,p.x,p.y)&&l(p.prev,p,p.next)>=0)return!1;p=p.nextZ}p=t.prevZ;for(;p&&p.z>=m;){if(p!==t.prev&&p!==t.next&&h(r.x,r.y,s.x,s.y,o.x,o.y,p.x,p.y)&&l(p.prev,p,p.next)>=0)return!1;p=p.prevZ}return!0})(t,n,r,a):(function(t){var e=t.prev,i=t,n=t.next;if(l(e,i,n)>=0)return!1;var r=t.next.next;for(;r!==t.prev;){if(h(e.x,e.y,i.x,i.y,n.x,n.y,r.x,r.y)&&l(r.prev,r,r.next)>=0)return!1;r=r.next}return!0})(t))e.push(g.i/i),e.push(t.i/i),e.push(v.i/i),p(t),t=v.next,y=v.next;else if((t=v)===y){f?1===f?o(t=(function(t,e,i){var n=t;do{var r=n.prev,s=n.next.next;!_(r,s)&&u(r,n,n.next,s)&&d(r,s)&&d(s,r)&&(e.push(r.i/i),e.push(n.i/i),e.push(s.i/i),p(n),p(n.next),n=t=s),n=n.next}while(n!==t);return n})(t,e,i),e,i,n,r,a,2):2===f&&(function(t,e,i,n,r,a){var c=t;do{for(var h=c.next.next;h!==c.prev;){if(c.i!==h.i&&(function(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!(function(t,e){var i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&u(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1})(t,e)&&d(t,e)&&d(e,t)&&(function(t,e){var i=t,n=!1,r=(t.x+e.x)/2,s=(t.y+e.y)/2;do{i.y>s!=i.next.y>s&&r<(i.next.x-i.x)*(s-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next}while(i!==t);return n})(t,e)})(c,h)){var l=m(c,h);return c=s(c,c.next),l=s(l,l.next),o(c,e,i,n,r,a),void o(l,e,i,n,r,a)}h=h.next}c=c.next}while(c!==t)})(t,e,i,n,r,a):o(s(t),e,i,n,r,a,1);break}}}function a(t,e){return t.x-e.x}function c(t,e,i,n,r){return t=32767*(t-i)/r,e=32767*(e-n)/r,t=16711935&(t|t<<8),t=252645135&(t|t<<4),t=858993459&(t|t<<2),t=1431655765&(t|t<<1),e=16711935&(e|e<<8),e=252645135&(e|e<<4),e=858993459&(e|e<<2),e=1431655765&(e|e<<1),t|e<<1}function h(t,e,i,n,r,s,o,a){return(r-o)*(e-a)-(t-o)*(s-a)>=0&&(t-o)*(n-a)-(i-o)*(e-a)>=0&&(i-o)*(s-a)-(r-o)*(n-a)>=0}function l(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function _(t,e){return t.x===e.x&&t.y===e.y}function u(t,e,i,n){return!!(_(t,e)&&_(i,n)||_(t,n)&&_(i,e))||l(t,e,i)>0!=l(t,e,n)>0&&l(i,n,t)>0!=l(i,n,e)>0}function d(t,e){return l(t.prev,t,t.next)<0?l(t,e,t.next)>=0&&l(t,t.prev,e)>=0:l(t,e,t.prev)<0||l(t,t.next,e)<0}function m(t,e){var i=new g(t.i,t.x,t.y),n=new g(e.i,e.x,e.y),r=t.next,s=e.prev;return t.next=e,e.prev=t,i.next=r,r.prev=i,n.next=i,i.prev=n,s.next=n,n.prev=s,n}function f(t,e,i,n){var r=new g(t,e,i);return n?(r.next=n.next,r.prev=n,n.next.prev=r,n.next=r):(r.prev=r,r.next=r),r}function p(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function g(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function v(t,e,i,n){for(var r=0,s=e,o=i-n;s<i;s+=n)r+=(t[o]-t[s])*(t[s+1]+t[o+1]),o=s;return r}e.exports=n,n.deviation=function(t,e,i,n){var r=e&&e.length,s=r?e[0]*i:t.length,o=Math.abs(v(t,0,s,i));if(r)for(var a=0,c=e.length;a<c;a++){var h=e[a]*i,l=a<c-1?e[a+1]*i:t.length;o-=Math.abs(v(t,h,l,i))}var _=0;for(a=0;a<n.length;a+=3){var u=n[a]*i,d=n[a+1]*i,m=n[a+2]*i;_+=Math.abs((t[u]-t[m])*(t[d+1]-t[u+1])-(t[u]-t[d])*(t[m+1]-t[u+1]))}return 0===o&&0===_?0:Math.abs((_-o)/o)},n.flatten=function(t){for(var e=t[0][0].length,i={vertices:[],holes:[],dimensions:e},n=0,r=0;r<t.length;r++){for(var s=0;s<t[r].length;s++)for(var o=0;o<e;o++)i.vertices.push(t[r][s][o]);r>0&&(n+=t[r-1].length,i.holes.push(n))}return i}}),{}],97:[(function(t,e,i){cc.js;var n=t("./types").LineCap,r=t("./types").LineJoin,s=t("./helper"),o=function(t){this._rootCtor(t),this._needDraw=!0,this.cmds=[],this.style={strokeStyle:"black",fillStyle:"white",lineCap:"butt",lineJoin:"miter",miterLimit:10}},a=o.prototype=Object.create(_ccsg.Node.CanvasRenderCmd.prototype);a.constructor=o,a._updateCurrentRegions=function(){var t=this._currentRegion;this._currentRegion=this._oldRegion,this._oldRegion=t,this._currentRegion.setTo(0,0,cc.visibleRect.width,cc.visibleRect.height)},a.rendering=function(t,e,i){var n=t||cc._renderContext,r=n.getContext();n.setTransform(this._worldTransform,e,i),r.save(),r.scale(1,-1);var s=this.style;r.strokeStyle=s.strokeStyle,r.fillStyle=s.fillStyle,r.lineWidth=s.lineWidth,r.lineJoin=s.lineJoin,r.miterLimit=s.miterLimit;for(var o=!0,a=this.cmds,c=0,h=a.length;c<h;c++){var l=a[c],_=l[0],u=l[1];"moveTo"===_&&o?(r.beginPath(),o=!1):"fill"!==_&&"stroke"!==_&&"fillRect"!==_||(o=!0),"function"==typeof r[_]?r[_].apply(r,u):r[_]=u}r.restore()},a.setStrokeColor=function(t){var e="rgba("+(0|t.r)+","+(0|t.g)+","+(0|t.b)+","+t.a/255+")";this.cmds.push(["strokeStyle",e]),this.style.strokeStyle=e},a.setFillColor=function(t){var e="rgba("+(0|t.r)+","+(0|t.g)+","+(0|t.b)+","+t.a/255+")";this.cmds.push(["fillStyle",e]),this.style.fillStyle=e},a.setLineWidth=function(t){this.cmds.push(["lineWidth",t]),this.style.lineWidth=t},a.setLineCap=function(t){var e="butt";t===n.BUTT?e="butt":t===n.ROUND?e="round":t===n.SQUARE&&(e="square"),this.cmds.push(["lineCap",e]),this.style.lineCap=e},a.setLineJoin=function(t){var e="bevel";t===r.BEVEL?e="bevel":t===r.ROUND?e="round":t===r.MITER&&(e="miter"),this.cmds.push(["lineJoin",e]),this.style.lineJoin=e},a.setMiterLimit=function(t){this.cmds.push(["miterLimit",t]),this.style.miterLimit=t},a.beginPath=function(){},a.moveTo=function(t,e){this.cmds.push(["moveTo",[t,e]])},a.lineTo=function(t,e){this.cmds.push(["lineTo",[t,e]])},a.bezierCurveTo=function(t,e,i,n,r,s){this.cmds.push(["bezierCurveTo",[t,e,i,n,r,s]])},a.quadraticCurveTo=function(t,e,i,n){this.cmds.push(["quadraticCurveTo",[t,e,i,n]])},a.arc=function(t,e,i,n,r,o){s.arc(this,t,e,i,n,r,o)},a.ellipse=function(t,e,i,n){s.ellipse(this,t,e,i,n)},a.circle=function(t,e,i){s.ellipse(this,t,e,i,i)},a.rect=function(t,e,i,n){this.moveTo(t,e),this.lineTo(t+i,e),this.lineTo(t+i,e+n),this.lineTo(t,e+n),this.close()},a.roundRect=function(t,e,i,n,r){s.roundRect(this,t,e,i,n,r)},a.fillRect=function(t,e,i,n){this.cmds.push(["fillRect",[t,e,i,n]]),this.setDirtyFlag(_ccsg.Node._dirtyFlags.contentDirty)},a.close=function(){this.cmds.push(["closePath",[]])},a.stroke=function(){this.cmds.push(["stroke",[]]),this.setDirtyFlag(_ccsg.Node._dirtyFlags.contentDirty)},a.fill=function(){this.cmds.push(["fill",[]]),this.setDirtyFlag(_ccsg.Node._dirtyFlags.contentDirty)},a.clear=function(){this.cmds.length=0,this.setDirtyFlag(_ccsg.Node._dirtyFlags.contentDirty)},e.exports=o}),{"./helper":101,"./types":103}],98:[(function(t,e,i){var n=t("./graphics-canvas-cmd"),r=t("./graphics-webgl-cmd"),s=t("./types").LineCap,o=t("./types").LineJoin,a=(cc.js,_ccsg.Node.extend({ctor:function(){this._super(),this.strokeColor=cc.Color.BLACK,this.fillColor=cc.Color.WHITE},clear:function(t){this._renderCmd.clear(t)},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_CANVAS?new n(this):new r(this)}})),c=a.prototype;c._strokeColor=null,c._fillColor=null,c._lineWidth=1,c._lineCap=s.BUTT,c._lineJoin=o.MITER,c._miterLimit=10,c.setStrokeColor=function(t){this._strokeColor=t,this._renderCmd.setStrokeColor(t)},c.getStrokeColor=function(){return this._strokeColor},c.setFillColor=function(t){this._fillColor=t,this._renderCmd.setFillColor(t)},c.getFillColor=function(){return this._fillColor},c.setLineWidth=function(t){this._lineWidth=t,this._renderCmd.setLineWidth(t)},c.getLineWidth=function(){return this._lineWidth},c.setLineCap=function(t){this._lineCap=t,this._renderCmd.setLineCap(t)},c.getLineCap=function(){return this._lineCap},c.setLineJoin=function(t){this._lineJoin=t,this._renderCmd.setLineJoin(t)},c.getLineJoin=function(){return this._lineJoin},c.setMiterLimit=function(t){this._miterLimit=t,this._renderCmd.setMiterLimit(t)},c.getMiterLimit=function(){return this._miterLimit},c.beginPath=function(){this._renderCmd.beginPath()},c.moveTo=function(t,e){this._renderCmd.moveTo(t,e)},c.lineTo=function(t,e){this._renderCmd.lineTo(t,e)},c.bezierCurveTo=function(t,e,i,n,r,s){this._renderCmd.bezierCurveTo(t,e,i,n,r,s)},c.quadraticCurveTo=function(t,e,i,n){this._renderCmd.quadraticCurveTo(t,e,i,n)},c.arc=function(t,e,i,n,r,s){this._renderCmd.arc(t,e,i,n,r,s)},c.ellipse=function(t,e,i,n){this._renderCmd.ellipse(t,e,i,n)},c.circle=function(t,e,i){this._renderCmd.circle(t,e,i)},c.rect=function(t,e,i,n){this._renderCmd.rect(t,e,i,n)},c.roundRect=function(t,e,i,n,r){this._renderCmd.roundRect(t,e,i,n,r)},c.fillRect=function(t,e,i,n){this._renderCmd.fillRect(t,e,i,n)},c.close=function(){this._renderCmd.close()},c.stroke=function(){this._renderCmd.stroke()},c.fill=function(){this._renderCmd.fill()},e.exports=a}),{"./graphics-canvas-cmd":97,"./graphics-webgl-cmd":99,"./types":103}],99:[(function(t,e,i){function n(t,e,i){return t<e?e:t>i?i:t}function r(t,e){u.call(this,t,e),this.reset()}function s(){this.reset()}function o(){this.vertsOffset=0,this.vertsVBO=gl.createBuffer(),this.vertsBuffer=null,this.uint32VertsBuffer=null,this.vertsDirty=!1,this.indicesOffset=0,this.indicesVBO=gl.createBuffer(),this.indicesBuffer=null,this.indicesDirty=!1}function a(t){this._rootCtor(t),this._needDraw=!0;cc._renderContext;this._buffers=[],this._buffer=null,this._allocBuffer(),this._matrix=new cc.math.Matrix4,this._matrix.identity(),this._paths=[],this._points=[],this._curColorValue=0,this._blendFunc=new cc.BlendFunc(cc.macro.BLEND_SRC,cc.macro.BLEND_DST);var e=new cc.GLProgram;e.initWithVertexShaderByteArray(cc.PresetShaders.POSITION_COLOR_VERT,cc.PresetShaders.POSITION_COLOR_FRAG),e.retain(),e.addAttribute(cc.macro.ATTRIBUTE_NAME_POSITION,cc.macro.VERTEX_ATTRIB_POSITION),e.addAttribute(cc.macro.ATTRIBUTE_NAME_COLOR,cc.macro.VERTEX_ATTRIB_COLOR),e.link(),e.updateUniforms(),this._shaderProgram=e,this._allocVerts(m)}var c=t("./types").LineCap,h=t("./types").LineJoin,l=t("./earcut"),_=t("./helper"),u=cc.Vec2,d=cc.js,m=32,f=Math.PI,p=Math.min,g=Math.max,v=Math.ceil,y=Math.acos,x=Math.cos,C=Math.sin,A=Math.atan2,T=Math.abs,b=cc.Enum({PT_CORNER:1,PT_LEFT:2,PT_BEVEL:4,PT_INNERBEVEL:8});d.extend(r,u),r.prototype.reset=function(){this.dx=0,this.dy=0,this.dmx=0,this.dmy=0,this.flags=0,this.len=0},s.prototype.reset=function(){this.closed=!1,this.nbevel=0,this.complex=!0,this.points?this.points.length=0:this.points=[]},o.prototype.clear=function(){this.vertsOffset=0,this.indicesOffset=0},o.prototype.alloc=function(t,e){var i=this.vertsOffset+t;if(i>65535)return!1;var n=this.vertsBuffer,r=n?n.length/3:0;if(i>r){for(0===r&&(r=m);i>r;)r*=2;var s=new Float32Array(3*r),o=new Uint32Array(s.buffer);if(n)for(var a=this.uint32VertsBuffer,c=0,h=n.length;c<h;c+=3)s[c]=n[c],s[c+1]=n[c+1],o[c+2]=a[c+2];this.vertsBuffer=s,this.uint32VertsBuffer=o}var l=this.indicesBuffer,_=this.indicesOffset+e,u=l?l.length:0;if(_>u){for(0===u&&(u=3*m);_>u;)u*=2;var d=new Uint16Array(u);if(l)for(c=0,h=l.length;c<h;c++)d[c]=l[c];this.indicesBuffer=d}return!0},(a.prototype=Object.create(_ccsg.Node.WebGLRenderCmd.prototype)).constructor=a;var w=a.prototype;w._tessTol=.25,w._distTol=.01,w.lineWidth=1,w.lineCap=c.BUTT,w.lineJoin=h.MITER,w.miterLimit=10,w.beginPath=function(){this._pathOffset=this._pathLength},w.moveTo=function(t,e){this._updatePathOffset&&(this._pathOffset=this._pathLength,this._updatePathOffset=!1),this._addPath(),this._addPoint(t,e,b.PT_CORNER),this._commandx=t,this._commandy=e},w.lineTo=function(t,e){this._addPoint(t,e,b.PT_CORNER),this._commandx=t,this._commandy=e},w.bezierCurveTo=function(t,e,i,n,r,s){var o=this._curPath,a=o.points[o.points.length-1];a.x!==t||a.y!==e||i!==r||n!==s?(this._tesselateBezier(a.x,a.y,t,e,i,n,r,s,0,b.PT_CORNER),this._commandx=r,this._commandy=s):this.lineTo(r,s)},w.quadraticCurveTo=function(t,e,i,n){var r=this._commandx,s=this._commandy;this.bezierCurveTo(r+2/3*(t-r),s+2/3*(e-s),i+2/3*(t-i),n+2/3*(e-n),i,n)},w.arc=function(t,e,i,n,r,s){_.arc(this,t,e,i,n,r,s)},w.ellipse=function(t,e,i,n){_.ellipse(this,t,e,i,n),this._curPath.complex=!1},w.circle=function(t,e,i){_.ellipse(this,t,e,i,i),this._curPath.complex=!1},w.rect=function(t,e,i,n){this.moveTo(t,e),this.lineTo(t,e+n),this.lineTo(t+i,e+n),this.lineTo(t+i,e),this.close(),this._curPath.complex=!1},w.roundRect=function(t,e,i,n,r){_.roundRect(this,t,e,i,n,r),this._curPath.complex=!1},w.fillRect=function(t,e,i,n){this.rect(t,e,i,n),this.fill()},w.close=function(){this._curPath.closed=!0},w.stroke=function(){this._flattenPaths();var t=this._strokeColor;this._curColorValue=(t.a<<24>>>0)+(t.b<<16)+(t.g<<8)+t.r,this._expandStroke(),this._updatePathOffset=!0},w.fill=function(){var t=this._fillColor;this._curColorValue=(t.a<<24>>>0)+(t.b<<16)+(t.g<<8)+t.r,this._expandFill(),this._updatePathOffset=!0,this._filling=!1},w._strokeColor=null,w._fillColor=null,w.setStrokeColor=function(t){this._strokeColor=t},w.getStrokeColor=function(){return this._strokeColor},w.setFillColor=function(t){this._fillColor=t},w.getFillColor=function(){return this._fillColor},w.setLineWidth=function(t){this.lineWidth=t},w.setLineJoin=function(t){this.lineJoin=t},w.setLineCap=function(t){this.lineCap=t},w.setMiterLimit=function(t){this.miterLimit=t},d.getset(w,"strokeColor",w.getStrokeColor,w.setStrokeColor),d.getset(w,"fillColor",w.getFillColor,w.setFillColor),w._render=function(){var t=this._buffers;if(0!==t.length){for(var e=cc._renderContext,i=0,n=t.length;i<n;i++){var r=t[i];e.bindBuffer(e.ARRAY_BUFFER,r.vertsVBO),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,r.indicesVBO),r.vertsDirty&&(e.bufferData(e.ARRAY_BUFFER,r.vertsBuffer,e.STREAM_DRAW),r.vertsDirty=!1),r.indicesDirty&&r.indicesBuffer&&(e.bufferData(e.ELEMENT_ARRAY_BUFFER,r.indicesBuffer,e.STREAM_DRAW),r.indicesDirty=!1),e.enableVertexAttribArray(cc.macro.VERTEX_ATTRIB_POSITION),e.enableVertexAttribArray(cc.macro.VERTEX_ATTRIB_COLOR),e.vertexAttribPointer(cc.macro.VERTEX_ATTRIB_POSITION,2,e.FLOAT,!1,12,0),e.vertexAttribPointer(cc.macro.VERTEX_ATTRIB_COLOR,4,e.UNSIGNED_BYTE,!0,12,8),e.drawElements(e.TRIANGLES,r.indicesOffset,e.UNSIGNED_SHORT,0),cc.g_NumberOfDraws++}0}},w.rendering=function(){cc.gl.blendFunc(this._blendFunc.src,this._blendFunc.dst);var t=this._worldTransform,e=this._matrix.mat;e[0]=t.a,e[4]=t.c,e[12]=t.tx,e[1]=t.b,e[5]=t.d,e[13]=t.ty;var i=this._shaderProgram;i.use(),i._setUniformForMVPMatrixWithMat4(this._matrix),this._render()},w.clear=function(t){if(this._pathLength=0,this._pathOffset=0,this._pointsOffset=0,this._curPath=null,t)this._paths.length=0,this._points.length=0,this._buffer=null,this._buffers=[];else{for(var e=this._buffers,i=0;i<e.length;i++)e[i].clear();this._buffer=e[0]}},w._updatePathOffset=!1,w._paths=null,w._pathLength=0,w._pathOffset=0,w._points=null,w._pointsOffset=0,w._commandx=0,w._commandy=0,w._addPath=function(){var t=this._pathLength,e=this._paths[t];return e?e.reset():(e=new s,this._paths.push(e)),this._pathLength++,this._curPath=e,e},w._addPoint=function(t,e,i){var n=this._curPath;if(n){var s,o=this._points,a=n.points;(s=o[this._pointsOffset++])?(s.x=t,s.y=e):(s=new r(t,e),o.push(s)),s.flags=i,a.push(s)}},w._flattenPaths=function(){for(var t=this._paths,e=this._pathOffset,i=this._pathLength;e<i;e++){var n=t[e],r=n.points,s=r[r.length-1],o=r[0];s.equals(o)&&(n.closed=!0,r.pop(),s=r[r.length-1]);for(var a=0,c=r.length;a<c;a++){var h=o.sub(s);s.len=h.mag(),(h.x||h.y)&&h.normalizeSelf(),s.dx=h.x,s.dy=h.y,s=o,o=r[a+1]}}},w._allocBuffer=function(){if(this._buffer){var t=this._buffers.indexOf(this._buffer);if(t<this._buffers.length-1)return void(this._buffer=this._buffers[t+1])}var e=new o;this._buffers.push(e),this._buffer=e},w._allocVerts=function(t){this._buffer||this._allocBuffer();var e=3*(t-2*(this._pathLength-this._pathOffset));this._buffer.alloc(t,e)||(this._allocBuffer(),this._buffer.alloc(t,e)),this._buffer.vertsDirty=!0},w._expandStroke=function(){var t=.5*this.lineWidth,e=this.lineCap,i=this.lineJoin,n=this.miterLimit,r=this._curveDivs(t,f,this._tessTol),s=this._paths;this._calculateJoins(t,i,n);for(var o=0,a=this._pathOffset,l=this._pathLength;a<l;a++){var _=(d=s[a]).points.length;i===h.ROUND?o+=2*(_+d.nbevel*(r+2)+1):o+=2*(_+5*d.nbevel+1),d.closed||(e===c.ROUND?o+=2*(2*r+2):o+=12)}this._allocVerts(o);var u=this._buffer;for(a=this._pathOffset,l=this._pathLength;a<l;a++){var d,m,p,g,v,y,x=(d=s[a]).points;_=d.points.length;y=d.closed;var C=u.vertsOffset;if(y?(m=x[_-1],p=x[0],g=0,v=_):(m=x[0],p=x[1],g=1,v=_-1),!y){(E=p.sub(m)).normalizeSelf();var A=E.x,T=E.y;e===c.BUTT?this._buttCap(m,A,T,t,0):e===c.SQUARE?this._buttCap(m,A,T,t,t):e===c.ROUND&&this._roundCapStart(m,A,T,t,r)}for(var w=g;w<v;++w)i===h.ROUND?this._roundJoin(m,p,t,t,r):0!=(p.flags&(b.PT_BEVEL|b.PT_INNERBEVEL))?this._bevelJoin(m,p,t,t):(this._vset(p.x+p.dmx*t,p.y+p.dmy*t),this._vset(p.x-p.dmx*t,p.y-p.dmy*t)),m=p,p=x[w+1];if(y){var S=u.vertsBuffer;this._vset(S[3*C],S[3*C+1]),this._vset(S[3*(C+1)],S[3*(C+1)+1])}else{var E;(E=p.sub(m)).normalizeSelf();A=E.x,T=E.y;e===c.BUTT?this._buttCap(p,A,T,t,0):e===c.BUTT||e===c.SQUARE?this._buttCap(p,A,T,t,t):e===c.ROUND&&this._roundCapEnd(p,A,T,t,r)}for(var I=u.indicesOffset,R=u.indicesBuffer,P=C+2,B=u.vertsOffset;P<B;P++)R[I++]=P-2,R[I++]=P-1,R[I++]=P;u.indicesOffset=I,u.indicesDirty=!0}},w._expandFill=function(){for(var t=this._paths,e=0,i=this._pathOffset,n=this._pathLength;i<n;i++){e+=o=(s=t[i]).points.length}this._allocVerts(e);var r=this._buffer;for(i=this._pathOffset,n=this._pathLength;i<n;i++){var s,o,a=(s=t[i]).points;if(0!==(o=a.length)){for(var c=r.vertsOffset,h=0;h<o;++h)this._vset(a[h].x,a[h].y,.5,1);var _=s.indicesOffset=r.indicesOffset,u=r.indicesBuffer,d=0;if(s.complex){var m=[],f=3*c,p=3*r.vertsOffset;for(h=f;h<p;h+=3)m.push(r.vertsBuffer[h]),m.push(r.vertsBuffer[h+1]);var g=l(m,null,2);if(!g||0===g.length)continue;h=0;for(var v=d=g.length;h<v;h++)u[_+h]=g[h]+c}else{var y=c;for(f=c+2,p=r.vertsOffset;f<p;f++)u[_++]=y,u[_++]=f-1,u[_++]=f;d=_-r.indicesOffset}r.indicesOffset+=d,r.indicesDirty=!0}}},w._curveDivs=function(t,e,i){var n=2*y(t/(t+i));return g(2,v(e/n))},w._calculateJoins=function(t,e,i){var n=0;t>0&&(n=1/t);for(var r=this._paths,s=this._pathOffset,o=this._pathLength;s<o;s++){var a=r[s],c=a.points,l=c.length,_=c[l-1],u=c[0];a.nbevel=0;for(var d=0;d<l;d++){var m,f,v=_.dy,y=-_.dx,x=u.dy,C=-u.dx;if(u.dmx=.5*(v+x),u.dmy=.5*(y+C),(m=u.dmx*u.dmx+u.dmy*u.dmy)>1e-6){var A=1/m;A>600&&(A=600),u.dmx*=A,u.dmy*=A}u.dx*_.dy-_.dx*u.dy>0&&(0,u.flags|=b.PT_LEFT),m*(f=g(11,p(_.len,u.len)*n))*f<1&&(u.flags|=b.PT_INNERBEVEL),u.flags&b.PT_CORNER&&(m*i*i<1||e===h.BEVEL||e===h.ROUND)&&(u.flags|=b.PT_BEVEL),0!=(u.flags&(b.PT_BEVEL|b.PT_INNERBEVEL))&&a.nbevel++,_=u,u=c[d+1]}}},w._vset=function(t,e){var i=this._buffer,n=3*i.vertsOffset,r=i.vertsBuffer;r[n]=t,r[n+1]=e,i.uint32VertsBuffer[n+2]=this._curColorValue,i.vertsOffset++},w._chooseBevel=function(t,e,i,n){var r,s,o,a,c=i.x,h=i.y;return 0!==t?(r=c+e.dy*n,s=h-e.dx*n,o=c+i.dy*n,a=h-i.dx*n):(r=o=c+i.dmx*n,s=a=h+i.dmy*n),[r,s,o,a]},w._buttCap=function(t,e,i,n,r){var s=t.x-e*r,o=t.y-i*r,a=i,c=-e;this._vset(s+a*n,o+c*n),this._vset(s-a*n,o-c*n)},w._roundCapStart=function(t,e,i,n,r){for(var s=t.x,o=t.y,a=i,c=-e,h=0;h<r;h++){var l=h/(r-1)*f,_=x(l)*n,u=C(l)*n;this._vset(s-a*_-e*u,o-c*_-i*u),this._vset(s,o)}this._vset(s+a*n,o+c*n),this._vset(s-a*n,o-c*n)},w._roundCapEnd=function(t,e,i,n,r){var s=t.x,o=t.y,a=i,c=-e;this._vset(s+a*n,o+c*n),this._vset(s-a*n,o-c*n);for(var h=0;h<r;h++){var l=h/(r-1)*f,_=x(l)*n,u=C(l)*n;this._vset(s,o),this._vset(s-a*_+e*u,o-c*_+i*u)}},w._roundJoin=function(t,e,i,r,s){var o=t.dy,a=-t.dx,c=e.dy,h=-e.dx,l=e.x,_=e.y;if(0!=(e.flags&b.PT_LEFT)){var u=(E=this._chooseBevel(e.flags&b.PT_INNERBEVEL,t,e,i))[0],d=E[1],m=E[2],p=E[3],g=A(-a,-o);(I=A(-h,-c))>g&&(I-=2*f),this._vset(u,d),this._vset(l-o*r,e.y-a*r);for(var y=n(v((g-I)/f)*s,2,s),T=0;T<y;T++){var w=l+x(O=g+T/(y-1)*(I-g))*r,S=_+C(O)*r;this._vset(l,_),this._vset(w,S)}this._vset(m,p),this._vset(l-c*r,_-h*r)}else{var E,I,R=(E=this._chooseBevel(e.flags&b.PT_INNERBEVEL,t,e,-r))[0],P=E[1],B=E[2],L=E[3];g=A(a,o);(I=A(h,c))<g&&(I+=2*f),this._vset(l+o*r,_+a*r),this._vset(R,P);for(y=n(v((I-g)/f)*s,2,s),T=0;T<y;T++){var O,D=l+x(O=g+T/(y-1)*(I-g))*i,N=_+C(O)*i;this._vset(D,N),this._vset(l,_)}this._vset(l+c*r,_+h*r),this._vset(B,L)}},w._bevelJoin=function(t,e,i,n){var r,s,o,a,c,h,l,_,u=t.dy,d=-t.dx,m=e.dy,f=-e.dx;if(e.flags&b.PT_LEFT){c=(p=this._chooseBevel(e.flags&b.PT_INNERBEVEL,t,e,i))[0],h=p[1],l=p[2],_=p[3],this._vset(c,h),this._vset(e.x-u*n,e.y-d*n),this._vset(l,_),this._vset(e.x-m*n,e.y-f*n)}else{var p;r=(p=this._chooseBevel(e.flags&b.PT_INNERBEVEL,t,e,-n))[0],s=p[1],o=p[2],a=p[3],this._vset(e.x+u*i,e.y+d*i),this._vset(r,s),this._vset(e.x+m*i,e.y+f*i),this._vset(o,a)}},w._tesselateBezier=function(t,e,i,n,r,s,o,a,c,h){var l,_,u,d,m,f,p,g,v,y,x,C,A,w,S,E;c>10||(m=.5*(r+o),f=.5*(s+a),p=.5*((l=.5*(t+i))+(u=.5*(i+r))),g=.5*((_=.5*(e+n))+(d=.5*(n+s))),((S=T((i-o)*(w=a-e)-(n-a)*(A=o-t)))+(E=T((r-o)*w-(s-a)*A)))*(S+E)<this._tessTol*(A*A+w*w)?this._addPoint(o,a,0===h?h|b.PT_BEVEL:h):(x=.5*(p+(v=.5*(u+m))),C=.5*(g+(y=.5*(d+f))),this._tesselateBezier(t,e,l,_,p,g,x,C,c+1,0),this._tesselateBezier(x,C,v,y,m,f,o,a,c+1,h)))},e.exports=a}),{"./earcut":96,"./helper":101,"./types":103}],100:[(function(t,e,i){var n=t("./types").LineCap,r=t("./types").LineJoin,s=cc.Class({name:"cc.Graphics",extends:cc._RendererUnderSG,editor:!1,properties:{_lineWidth:1,_strokeColor:cc.Color.BLACK,_lineJoin:r.MITER,_lineCap:n.BUTT,_fillColor:cc.Color.WHITE,_miterLimit:10,lineWidth:{get:function(){return this._lineWidth},set:function(t){this._sgNode.lineWidth=this._lineWidth=t}},lineJoin:{get:function(){return this._lineJoin},set:function(t){this._sgNode.lineJoin=this._lineJoin=t},type:r},lineCap:{get:function(){return this._lineCap},set:function(t){this._sgNode.lineCap=this._lineCap=t},type:n},strokeColor:{get:function(){return this._strokeColor},set:function(t){this._sgNode.strokeColor=this._strokeColor=t}},fillColor:{get:function(){return this._fillColor},set:function(t){this._sgNode.fillColor=this._fillColor=t}},miterLimit:{get:function(){return this._miterLimit},set:function(t){this._sgNode.miterLimit=this._miterLimit=t}}},statics:{LineJoin:r,LineCap:n},_createSgNode:function(){return new _ccsg.GraphicsNode},_initSgNode:function(){var t=this._sgNode;t.lineWidth=this._lineWidth,t.lineJoin=this._lineJoin,t.lineCap=this._lineCap,t.strokeColor=this._strokeColor,t.fillColor=this._fillColor,t.miterLimit=this._miterLimit,t.setContentSize(this.node.getContentSize(!0))},moveTo:function(t,e){this._sgNode.moveTo(t,e)},lineTo:function(t,e){this._sgNode.lineTo(t,e)},bezierCurveTo:function(t,e,i,n,r,s){this._sgNode.bezierCurveTo(t,e,i,n,r,s)},quadraticCurveTo:function(t,e,i,n){this._sgNode.quadraticCurveTo(t,e,i,n)},arc:function(t,e,i,n,r,s){s=s||!1,this._sgNode.arc(t,e,i,n,r,s)},ellipse:function(t,e,i,n){this._sgNode.ellipse(t,e,i,n)},circle:function(t,e,i){this._sgNode.circle(t,e,i)},rect:function(t,e,i,n){this._sgNode.rect(t,e,i,n)},roundRect:function(t,e,i,n,r){this._sgNode.roundRect(t,e,i,n,r)},fillRect:function(t,e,i,n){this._sgNode.fillRect(t,e,i,n)},clear:function(t){this._sgNode.clear(!!t)},close:function(){this._sgNode.close()},stroke:function(){this._sgNode.stroke()},fill:function(){this._sgNode.fill()}});cc.Graphics=e.exports=s}),{"./types":103}],101:[(function(t,e,i){var n=Math.PI,r=Math.min,s=Math.max,o=Math.cos,a=Math.sin,c=Math.abs,h=Math.sign,l=.5522847493;e.exports={arc:function(t,e,i,h,l,_,u){var d,m,f=0,p=0,g=0,v=0,y=0,x=0,C=0,A=0,T=0,b=0,w=0,S=0,E=0,I=0;if(p=_-l,u=u||!1)if(c(p)>=2*n)p=2*n;else for(;p<0;)p+=2*n;else if(c(p)>=2*n)p=2*-n;else for(;p>0;)p-=2*n;for(m=0|s(1,r(c(p)/(.5*n)+.5,5)),v=c(4/3*(1-o(g=p/m/2))/a(g)),u||(v=-v),d=0;d<=m;d++)C=e+(y=o(f=l+p*(d/m)))*h,A=i+(x=a(f))*h,T=-x*h*v,b=y*h*v,0===d?t.moveTo(C,A):t.bezierCurveTo(w+E,S+I,C-T,A-b,C,A),w=C,S=A,E=T,I=b},ellipse:function(t,e,i,n,r){t.moveTo(e-n,i),t.bezierCurveTo(e-n,i+r*l,e-n*l,i+r,e,i+r),t.bezierCurveTo(e+n*l,i+r,e+n,i+r*l,e+n,i),t.bezierCurveTo(e+n,i-r*l,e+n*l,i-r,e,i-r),t.bezierCurveTo(e-n*l,i-r,e-n,i-r*l,e-n,i),t.close()},roundRect:function(t,e,i,n,s,o){if(o<.1)t.rect(e,i,n,s);else{var a=r(o,.5*c(n))*h(n),_=r(o,.5*c(s))*h(s);t.moveTo(e,i+_),t.lineTo(e,i+s-_),t.bezierCurveTo(e,i+s-_*(1-l),e+a*(1-l),i+s,e+a,i+s),t.lineTo(e+n-a,i+s),t.bezierCurveTo(e+n-a*(1-l),i+s,e+n,i+s-_*(1-l),e+n,i+s-_),t.lineTo(e+n,i+_),t.bezierCurveTo(e+n,i+_*(1-l),e+n-a*(1-l),i,e+n-a,i),t.lineTo(e+a,i),t.bezierCurveTo(e+a*(1-l),i,e,i+_*(1-l),e,i+_),t.close()}}}}),{}],102:[(function(t,e,i){"use strict";var n;if(n=_ccsg.GraphicsNode=t("./graphics-node")){t("../utils/misc").propertyDefine(n,["lineWidth","lineCap","lineJoin","miterLimit","strokeColor","fillColor"],{})}t("./graphics")}),{"../utils/misc":206,"./graphics":100,"./graphics-node":98}],103:[(function(t,e,i){"use strict";var n=cc.Enum({BUTT:0,ROUND:1,SQUARE:2}),r=cc.Enum({BEVEL:0,ROUND:1,MITER:2});e.exports={LineCap:n,LineJoin:r}}),{}],104:[(function(t,e,i){t("./platform"),t("./assets"),t("./CCNode"),t("./CCScene"),t("./components"),t("./graphics"),t("./collider"),t("./collider/CCIntersection"),t("./physics"),t("./camera/CCCamera"),t("./base-ui/CCWidgetManager")}),{"./CCNode":37,"./CCScene":38,"./assets":51,"./base-ui/CCWidgetManager":56,"./camera/CCCamera":57,"./collider":65,"./collider/CCIntersection":1,"./components":84,"./graphics":102,"./physics":138,"./platform":174}],105:[(function(t,e,i){var n=/^(click)(\s)*=/,r=/(\s)*src(\s)*=|(\s)*height(\s)*=|(\s)*width(\s)*=|(\s)*click(\s)*=/;cc.HtmlTextParser=function(){this._parsedObject={},this._specialSymbolArray=[],this._specialSymbolArray.push([/&lt;/g,"<"]),this._specialSymbolArray.push([/&gt;/g,">"]),this._specialSymbolArray.push([/&amp;/g,"&"]),this._specialSymbolArray.push([/&quot;/g,'"']),this._specialSymbolArray.push([/&apos;/g,"'"])},cc.HtmlTextParser.prototype={constructor:cc.HtmlTextParser,parse:function(t){this._resultObjectArray=[],this._stack=[];for(var e=0,i=t.length;e<i;){var n=t.indexOf("<",e);if(n<0)this._stack.pop(),this._processResult(t.substring(e)),e=i;else{this._processResult(t.substring(e,n));var r=t.indexOf(">",e);-1===r?r=n:"/"===t.charAt(n+1)?this._stack.pop():this._addToStack(t.substring(n+1,r)),e=r+1}}return this._resultObjectArray},_attributeToObject:function(t){var e,i,n,s,o={},a=(t=t.trim()).match(/^(color|size)(\s)*=/);if(a){if(e=a[0],""===(t=t.substring(e.length).trim()))return o;switch(i=t.indexOf(" "),e[0]){case"c":o.color=i>-1?t.substring(0,i).trim():t;break;case"s":o.size=parseInt(t)}return i>-1&&(s=t.substring(i+1).trim(),n=this._processEventHandler(s),o.event=n),o}if((a=t.match(/^(br(\s)*\/)/))&&a[0].length>0&&(e=a[0].trim()).startsWith("br")&&"/"===e[e.length-1])return o.isNewLine=!0,this._resultObjectArray.push({text:"",style:{newline:!0}}),o;if((a=t.match(/^(img(\s)*src(\s)*=[^>]+\/)/))&&a[0].length>0&&(e=a[0].trim()).startsWith("img")&&"/"===e[e.length-1]){a=t.match(r);for(var c,h=!1;a;)e=(t=t.substring(t.indexOf(a[0]))).substr(0,a[0].length),u=(i=(c=t.substring(e.length).trim()).indexOf(" "))>-1?c.substr(0,i):c,e=(e=e.replace(/[^a-zA-Z]/g,"").trim()).toLocaleLowerCase(),t=c.substring(i).trim(),"src"===e?(o.isImage=!0,u.endsWith("/")&&(u=u.substring(0,u.length-1)),0===u.indexOf("'")?(h=!0,u=u.substring(1,u.length-1)):0===u.indexOf('"')&&(h=!0,u=u.substring(1,u.length-1)),o.src=u):"height"===e?o.imageHeight=parseInt(u):"width"===e?o.imageWidth=parseInt(u):"click"===e&&(o.event=this._processEventHandler(e+"="+u)),a=t.match(r);return h&&o.isImage&&this._resultObjectArray.push({text:"",style:o}),{}}if(a=t.match(/^(outline(\s)*[^>]*)/)){var l={color:"#ffffff",width:1};if(t=a[0].substring("outline".length).trim()){var _=/(\s)*color(\s)*=|(\s)*width(\s)*=|(\s)*click(\s)*=/;a=t.match(_);for(var u;a;)e=(t=t.substring(t.indexOf(a[0]))).substr(0,a[0].length),u=(i=(c=t.substring(e.length).trim()).indexOf(" "))>-1?c.substr(0,i):c,e=(e=e.replace(/[^a-zA-Z]/g,"").trim()).toLocaleLowerCase(),t=c.substring(i).trim(),"click"===e?o.event=this._processEventHandler(e+"="+u):"color"===e?l.color=u:"width"===e&&(l.width=parseInt(u)),a=t.match(_)}o.outline=l}if((a=t.match(/^(on|u|b|i)(\s)*/))&&a[0].length>0){switch(e=a[0],t=t.substring(e.length).trim(),e[0]){case"u":o.underline=!0;break;case"i":o.italic=!0;break;case"b":o.bold=!0}if(""===t)return o;n=this._processEventHandler(t),o.event=n}return o},_processEventHandler:function(t){for(var e=0,i={},r=t.match(n),s=!1;r;){var o=r[0],a="";if(s=!1,'"'===(t=t.substring(o.length).trim()).charAt(0))(e=t.indexOf('"',1))>-1&&(a=t.substring(1,e).trim(),s=!0),e++;else if("'"===t.charAt(0))(e=t.indexOf("'",1))>-1&&(a=t.substring(1,e).trim(),s=!0),e++;else{var c=t.match(/(\S)+/);e=(a=c?c[0]:"").length}s&&(i[o=o.substring(0,o.length-1).trim()]=a),r=(t=t.substring(e).trim()).match(n)}return i},_addToStack:function(t){var e=this._attributeToObject(t);if(0===this._stack.length)this._stack.push(e);else{if(e.isNewLine||e.isImage)return;var i=this._stack[this._stack.length-1];for(var n in i)e[n]||(e[n]=i[n]);this._stack.push(e)}},_processResult:function(t){""!==t&&(t=this._escapeSpecialSymbol(t),this._stack.length>0?this._resultObjectArray.push({text:t,style:this._stack[this._stack.length-1]}):this._resultObjectArray.push({text:t}))},_escapeSpecialSymbol:function(t){for(var e=0;e<this._specialSymbolArray.length;++e){var i=this._specialSymbolArray[e][0],n=this._specialSymbolArray[e][1];t=t.replace(i,n)}return t}},cc.htmlTextParser=new cc.HtmlTextParser}),{}],106:[(function(t,e,i){t("./CCTextUtils");var n=t("../event/event-target"),r=t("../platform/js"),s=function(){this._u=0,this._v=0,this._width=0,this._height=0,this._offsetX=0,this._offsetY=0,this._textureID=0,this._validDefinition=!1,this._xAdvance=0};cc.FontAtlas=function(t){this._lineHeight=t.commonHeight,this._fontSize=t.fontSize,this._letterDefinitions={},this._fntConfig=t},cc.FontAtlas.prototype={constructor:cc.FontAtlas,setFontSize:function(t){this._fontSize=t},getOriginalFontSize:function(){return this._fntConfig.fontSize},addLetterDefinitions:function(t,e){this._letterDefinitions[t]=e},cloneLetterDefinition:function(){var t={};for(var e in this._letterDefinitions){var i=new s;cc.js.mixin(i,this._letterDefinitions[e]),t[e]=i}return t},assignLetterDefinitions:function(t){for(var e in this._letterDefinitions){var i=t[e],n=this._letterDefinitions[e];cc.js.mixin(n,i)}},scaleFontLetterDefinition:function(t){for(var e in this._letterDefinitions){var i=this._letterDefinitions[e];i._width*=t,i._height*=t,i._offsetX*=t,i._offsetY*=t,i._xAdvance*=t}},getLetterDefinitionForChar:function(t){return this._letterDefinitions.hasOwnProperty(t.charCodeAt(0))?this._letterDefinitions[t.charCodeAt(0)]:null}};var o=function(){this._char="",this._valid=!0,this._positionX=0,this._positionY=0,this._lineIndex=0};_ccsg.Label=_ccsg.Node.extend({_hAlign:cc.TextAlignment.LEFT,_vAlign:cc.VerticalTextAlignment.TOP,_string:"",_fontSize:40,_drawFontsize:40,_overFlow:0,_isWrapText:!0,_spacingX:0,_blendFunc:null,_labelType:0,_fontHandle:"",_lineSpacing:0,_maxLineWidth:0,_labelDimensions:cc.size(0,0),_labelWidth:0,_labelHeight:0,_lineHeight:40,_outlined:!1,_outlineColor:null,_outlineWidth:1,_gradientEnabled:!1,_gradientStartColor:cc.color(255,255,255,255),_gradientEndColor:cc.color(255,255,255,255),_gradientDirection:0,_className:"Label",_margin:0,_isBold:!1,_isItalic:!1,_isUnderline:!1,_fontAsset:null,onExit:function(){this._super(),this._renderCmd._texture.releaseTexture(),this._notifyLabelSkinDirty()},ctor:function(t,e){n.call(this);var i=e instanceof cc.Font,r=i?e.rawUrl:"";this._fontHandle=r,"string"!=typeof t&&(t=""+t),this._string=t,_ccsg.Node.prototype.ctor.call(this),this.setAnchorPoint(.5,.5),_ccsg.Node.prototype.setContentSize.call(this,10,10),this._blendFunc=cc.BlendFunc._alphaNonPremultiplied(),this._imageOffset=cc.p(0,0),this._numberOfLines=0,this._lettersInfo=[],this._linesWidth=[],this._linesOffsetX=[],this._horizontalKernings=[],this._reusedRect=cc.rect(0,0,0,0),i?this.setFontAsset(e):this.setFontFamily(r),this.setString(this._string)},_resetBMFont:function(){this._imageOffset.x=this._imageOffset.y=0,this._cascadeColorEnabled=!0,this._cascadeOpacityEnabled=!0,this._fontAtlas=null,this._config=null,this._numberOfLines=0,this._lettersInfo.length=0,this._linesWidth.length=0,this._linesOffsetX.length=0,this._textDesiredHeight=0,this._letterOffsetY=0,this._tailoredTopY=0,this._tailoredBottomY=0,this._bmfontScale=1,this._horizontalKernings.length=0,this._lineBreakWithoutSpaces=!1,this._reusedRect.x=this._reusedRect.y=this._reusedRect.width=this._reusedRect.height=0,this._textureLoaded=!1,this._spriteBatchNode&&(this.removeChild(this._spriteBatchNode),this._spriteBatchNode=null)},setHorizontalAlign:function(t){this._hAlign!==t&&(this._hAlign=t,this._notifyLabelSkinDirty())},getHorizontalAlign:function(){return this._hAlign},setVerticalAlign:function(t){this._vAlign!==t&&(this._vAlign=t,this._notifyLabelSkinDirty())},getVerticalAlign:function(){return this._vAlign},setString:function(t){"string"!=typeof t&&(t=""+t),this._string!==t&&(this._string=t,this._notifyLabelSkinDirty())},setMargin:function(t){this._margin!==t&&(this._margin=t,this._notifyLabelSkinDirty())},getString:function(){return this._string},getStringLength:function(){return this._string.length},enableWrapText:function(t){this._isWrapText!==t&&this._overFlow!==_ccsg.Label.Overflow.RESIZE_HEIGHT&&this._overFlow!==_ccsg.Label.Overflow.NONE&&(this._isWrapText=t,this._rescaleWithOriginalFontSize(),this._notifyLabelSkinDirty())},enableItalics:function(t){this._isItalic=t,t?this.setSkewX(12):this.setSkewX(0)},enableBold:function(t){this._isBold!==t&&(this._isBold=t,this._notifyLabelSkinDirty())},enableUnderline:function(t){this._isUnderline!==t&&(this._isUnderline=t,this._notifyLabelSkinDirty())},isWrapTextEnabled:function(){return this._isWrapText},getFontName:function(){return this._fontHandle},setFontSize:function(t){this._fontSize!==t&&(this._fontSize=t,this._drawFontsize=t,this._notifyLabelSkinDirty())},getFontSize:function(){return this._fontSize},isOutlined:function(){return this._outlined},setOutlined:function(t){this._outlined!==t&&(this._outlined=!!t,this._notifyLabelSkinDirty())},setFillColorGradientEnabled:function(t){this._gradientEnabled!==t&&(this._gradientEnabled=!!t,this._notifyLabelSkinDirty())},getFillColorGradientEnabled:function(){return this._gradientEnabled},setGradientStartColor:function(t){this._gradientStartColor!==t&&(this._gradientStartColor=t,this._notifyLabelSkinDirty())},getGradientStartColor:function(){return this._gradientStartColor},setGradientEndColor:function(t){this._gradientEndColor!==t&&(this._gradientEndColor=t,this._notifyLabelSkinDirty())},getGradientEndColor:function(){return this._gradientEndColor},setFillColorGradientDirection:function(t){this._gradientDirection=t,this._notifyLabelSkinDirty()},getFillColorGradientDirection:function(){return this._gradientDirection},getOutlineColor:function(){return this._outlineColor},setOutlineColor:function(t){this._outlineColor!==t&&(this._outlineColor=cc.color(t),this._notifyLabelSkinDirty())},setOutlineWidth:function(t){this._outlineWidth!==t&&(this._outlineWidth=t,this._notifyLabelSkinDirty())},getOutlineWidth:function(){return this._outlineWidth},_updateWrapText:function(t){t===_ccsg.Label.Overflow.RESIZE_HEIGHT&&(this._isWrapText=!0),t===_ccsg.Label.Overflow.NONE&&(this._isWrapText=!1)},_setOverflowBMFont:function(){this._labelType===_ccsg.Label.Type.BMFont&&(this._overFlow===_ccsg.Label.Overflow.RESIZE_HEIGHT&&this._setDimensions(this._labelDimensions.width,0),this._overFlow===_ccsg.Label.Overflow.NONE&&this._setDimensions(0,0),this._rescaleWithOriginalFontSize())},setOverflow:function(t){this._overFlow!==t&&(this._overFlow=t,this._updateWrapText(this._overFlow),this._setOverflowBMFont(),this._notifyLabelSkinDirty())},getOverflow:function(){return this._overFlow},setSpacingX:function(t){this._spacingX!==t&&(this._spacingX=t,this._notifyLabelSkinDirty())},setLineHeight:function(t){this._lineHeight!==t&&(this._lineHeight=t,this._notifyLabelSkinDirty())},setLineBreakWithoutSpace:function(t){this._lineBreakWithoutSpaces!==t&&(this._lineBreakWithoutSpaces=t,this._notifyLabelSkinDirty())},getSpacingX:function(){return this._spacingX},getLineHeight:function(){return this._lineHeight},getBMFontLineHeight:function(){if(this._fontAtlas)return this._fontAtlas._lineHeight},setFontFamily:function(t){this._resetBMFont(),this._fontHandle=t||"Arial",this._labelType=_ccsg.Label.Type.SystemFont,this._blendFunc=cc.BlendFunc._alphaPremultiplied(),this._renderCmd._needDraw=!0,this._notifyLabelSkinDirty(),this.emit("load")},setFontAsset:function(t){this._fontAsset=t;var e=t instanceof cc.Font;if(e){var i=e?t.rawUrl:"",n=cc.path.extname(i);this._resetBMFont(),".ttf"===n?(this._labelType=_ccsg.Label.Type.TTF,this._blendFunc=cc.BlendFunc._alphaPremultiplied(),this._renderCmd._needDraw=!0,this._fontHandle=this._loadTTFFont(i)):t.spriteFrame&&(this._labelType=_ccsg.Label.Type.BMFont,this._blendFunc=cc.BlendFunc._alphaNonPremultiplied(),this._renderCmd._needDraw=!1,this._initBMFontWithString(this._string,t)),this._notifyLabelSkinDirty()}else this.setFontFamily("")},_loadTTFFont:function(t){var e=this,i=function(){e._notifyLabelSkinDirty(),e.emit("load")},n="";return(n=wx.loadFont(t))||(n=cc.CustomFontLoader._getFontFamily(t),cc.warn("TTF font is not supported on debugger, but it will be displayed correctly on mobile device.")),i(),n},setContentSize:function(t,e){this._overFlow!==_ccsg.Label.Overflow.NONE&&this._setDimensions(t,e)},setBlendFunc:function(t,e){var i=this._blendFunc;void 0===e?(i.src=t.src,i.dst=t.dst):(i.src=t,i.dst=e)},getBlendFunc:function(){return new cc.BlendFunc(this._blendFunc.src,this._blendFunc.dst)},_setupBMFontOverflowMetrics:function(t,e){this._overFlow===_ccsg.Label.Overflow.RESIZE_HEIGHT&&(e=0),this._overFlow===_ccsg.Label.Overflow.NONE&&(t=0,e=0),this._labelWidth=t,this._labelHeight=e,this._labelDimensions.width=t,this._labelDimensions.height=e,this._maxLineWidth=t},_updateLabel:function(){if(this._labelType===_ccsg.Label.Type.BMFont){var t=this._contentSize,e=t.width,i=t.height;this._setupBMFontOverflowMetrics(e,i),this._updateContent(),this.setColor(this.color)}else this._labelType!==_ccsg.Label.Type.TTF&&this._labelType!==_ccsg.Label.Type.SystemFont||this._renderCmd._bakeLabel()},_notifyLabelSkinDirty:function(){this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.textDirty|_ccsg.Node._dirtyFlags.contentDirty)},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_WEBGL?new _ccsg.Label.WebGLRenderCmd(this):new _ccsg.Label.CanvasRenderCmd(this)},getContentSize:function(){return this._renderCmd._dirtyFlag&_ccsg.Node._dirtyFlags.textDirty&&(this._updateLabel(),this._renderCmd._dirtyFlag&=~_ccsg.Node._dirtyFlags.textDirty),_ccsg.Node.prototype.getContentSize.call(this)},_getWidth:function(){return this._renderCmd._dirtyFlag&_ccsg.Node._dirtyFlags.textDirty&&(this._updateLabel(),this._renderCmd._dirtyFlag&=~_ccsg.Node._dirtyFlags.textDirty),_ccsg.Node.prototype._getWidth.call(this)},_getHeight:function(){return this._renderCmd._dirtyFlag&_ccsg.Node._dirtyFlags.textDirty&&(this._updateLabel(),this._renderCmd._dirtyFlag&=~_ccsg.Node._dirtyFlags.textDirty),_ccsg.Node.prototype._getHeight.call(this)},_alignText:function(){var t=!0;do{if(!this._spriteBatchNode)return!0;if(this._textDesiredHeight=0,this._linesWidth=[],this._lineBreakWithoutSpaces?this._multilineTextWrapByChar():this._multilineTextWrapByWord(),this._computeAlignmentOffset(),this._overFlow===_ccsg.Label.Overflow.SHRINK){this.getFontSize()>0&&this._isVerticalClamp()&&this._shrinkLabelToContentSize(this._isVerticalClamp.bind(this))}if(!this._updateQuads()){t=!1,this._overFlow===_ccsg.Label.Overflow.SHRINK&&this._shrinkLabelToContentSize(this._isHorizontalClamp.bind(this));break}}while(0);return t},_isHorizontalClamped:function(t,e){var i=this._linesWidth[e],n=t>this._contentSize.width||t<0;return this._isWrapText?i>this._contentSize.width&&n:n},_updateQuads:function(){var t=!0;this._spriteBatchNode.removeAllChildren();for(var e=0;e<this._string.length;++e)if(this._lettersInfo[e]._valid){var i=this._fontAtlas._letterDefinitions[this._lettersInfo[e]._char];this._reusedRect.height=i._height,this._reusedRect.width=i._width,this._reusedRect.x=i._u,this._reusedRect.y=i._v;var n=this._lettersInfo[e]._positionY+this._letterOffsetY;if(this._labelHeight>0){if(n>this._tailoredTopY){var r=n-this._tailoredTopY;this._reusedRect.y+=r,this._reusedRect.height-=r,n-=r}n-i._height*this._bmfontScale<this._tailoredBottomY&&(this._reusedRect.height=n<this._tailoredBottomY?0:n-this._tailoredBottomY)}var s=this._lettersInfo[e]._lineIndex,o=this._lettersInfo[e]._positionX+i._width/2*this._bmfontScale+this._linesOffsetX[s];if(this._labelWidth>0&&this._isHorizontalClamped(o,s))if(this._overFlow===_ccsg.Label.Overflow.CLAMP)this._reusedRect.width=0;else if(this._overFlow===_ccsg.Label.Overflow.SHRINK){if(this._contentSize.width>i._width){t=!1;break}this._reusedRect.width=0}if(this._reusedRect.height>0&&this._reusedRect.width>0){var a=this.getChildByTag(e),c=this._spriteBatchNode._texture,h=this._spriteFrame,l=this._spriteFrame.isRotated(),_=h._originalSize,u=h._rect,d=h._offset,m=d.x+(_.width-u.width)/2,f=d.y-(_.height-u.height)/2;if(l){var p=this._reusedRect.x;this._reusedRect.x=u.x+u.height-this._reusedRect.y-this._reusedRect.height-f,this._reusedRect.y=p+u.y-m,this._reusedRect.y<0&&(this._reusedRect.height=this._reusedRect.height+f)}else this._reusedRect.x+=u.x-m,this._reusedRect.y+=u.y+f;a?a.setTextureRect(this._reusedRect,l):((a=new _ccsg.Sprite).initWithTexture(c,this._reusedRect,l),a.setAnchorPoint(cc.p(0,1)));var g=this._lettersInfo[e]._positionX+this._linesOffsetX[this._lettersInfo[e]._lineIndex];a.setPosition(g,n),this._updateLetterSpriteScale(a),this._spriteBatchNode.addChild(a)}}return t},_updateLetterSpriteScale:function(t){this._labelType===_ccsg.Label.Type.BMFont&&this._fontSize>0&&t.setScale(this._bmfontScale)},_recordPlaceholderInfo:function(t,e){if(t>=this._lettersInfo.length){var i=new o;this._lettersInfo.push(i)}this._lettersInfo[t]._char=e,this._lettersInfo[t]._valid=!1},_recordLetterInfo:function(t,e,i,n){if(i>=this._lettersInfo.length){var r=new o;this._lettersInfo.push(r)}e=e.charCodeAt(0),this._lettersInfo[i]._lineIndex=n,this._lettersInfo[i]._char=e,this._lettersInfo[i]._valid=this._fontAtlas._letterDefinitions[e]._validDefinition,this._lettersInfo[i]._positionX=t.x,this._lettersInfo[i]._positionY=t.y},_setDimensions:function(t,e){var i="number"==typeof t.width?t.width:t,n="number"==typeof t.height?t.height:e,r=this.getContentSize();_ccsg.Node.prototype.setContentSize.call(this,t,e),n===r.height&&i===r.width||(this._setupBMFontOverflowMetrics(i,n),this._drawFontsize>0&&this._restoreFontSize(),this._notifyLabelSkinDirty())},_restoreFontSize:function(){this._fontSize=this._drawFontsize},_multilineTextWrap:function(t){var e=this.getStringLength(),i=0,n=0,r=0,s=0,o=0,a=this._lineSpacing,c=0,h=0,l=null,_=cc.p(0,0);this._updateBMFontScale();for(var u=0;u<e;){var d=this._string.charAt(u);if("\n"!==d){for(var m=t(this._string,u,e),f=c,p=h,g=o,v=n,y=!1,x=0;x<m;++x){var C=u+x;if("\r"!==(d=this._string.charAt(C)))if(l=this._fontAtlas.getLetterDefinitionForChar(d)){var A=v+l._offsetX*this._bmfontScale;if(this._isWrapText&&this._maxLineWidth>0&&n>0&&A+l._width*this._bmfontScale>this._maxLineWidth&&!cc.TextUtils.isUnicodeSpace(d)){this._linesWidth.push(o),o=0,i++,n=0,r-=this._lineHeight*this._bmfontScale+a,y=!0;break}_.x=A,_.y=r-l._offsetY*this._bmfontScale,this._recordLetterInfo(_,d,C,i),C+1<this._horizontalKernings.length&&C<e-1&&(v+=this._horizontalKernings[C+1]),v+=l._xAdvance*this._bmfontScale+this._spacingX,g=_.x+l._width*this._bmfontScale,f<_.y&&(f=_.y),p>_.y-l._height*this._bmfontScale&&(p=_.y-l._height*this._bmfontScale)}else this._recordPlaceholderInfo(C,d),console.log("Can't find letter definition in texture atlas "+this._config.atlasName+" for letter:"+d);else this._recordPlaceholderInfo(C,d)}y||(n=v,o=g,c<f&&(c=f),h>p&&(h=p),s<o&&(s=o),u+=m)}else this._linesWidth.push(o),o=0,i++,n=0,r-=this._lineHeight*this._bmfontScale+a,this._recordPlaceholderInfo(u,d),u++}this._linesWidth.push(o),this._numberOfLines=i+1,this._textDesiredHeight=this._numberOfLines*this._lineHeight*this._bmfontScale,this._numberOfLines>1&&(this._textDesiredHeight+=(this._numberOfLines-1)*this._lineSpacing);var T=cc.size(this._labelWidth,this._labelHeight);return this._labelWidth<=0&&(T.width=parseFloat(s.toFixed(2))),this._labelHeight<=0&&(T.height=parseFloat(this._textDesiredHeight.toFixed(2))),_ccsg.Node.prototype.setContentSize.call(this,T),this._tailoredTopY=T.height,this._tailoredBottomY=0,c>0&&(this._tailoredTopY=T.height+c),h<-this._textDesiredHeight&&(this._tailoredBottomY=this._textDesiredHeight+h),!0},_multilineTextWrapByWord:function(){return this._multilineTextWrap(this._getFirstWordLen.bind(this))},_multilineTextWrapByChar:function(){return this._multilineTextWrap(this._getFirstCharLen.bind(this))},_isVerticalClamp:function(){return this._textDesiredHeight>this._contentSize.height},_isHorizontalClamp:function(){for(var t=!1,e=0;e<this.getStringLength();++e)if(this._lettersInfo[e]._valid){var i=this._fontAtlas._letterDefinitions[this._lettersInfo[e]._char],n=this._lettersInfo[e]._positionX+i._width/2*this._bmfontScale,r=this._lettersInfo[e]._lineIndex;if(this._labelWidth>0)if(this._isWrapText){if(this._linesWidth[r]>this._contentSize.width&&(n>this._contentSize.width||n<0)){t=!0;break}}else if(n>this._contentSize.width){t=!0;break}}return t},_shrinkLabelToContentSize:function(t){for(var e=this.getFontSize(),i=0,n=this._fontAtlas.cloneLetterDefinition(),r=this._lineHeight,s=!0;t();){var o=e-++i;if(s=!1,o<=0)break;var a=o/e;this._fontAtlas.assignLetterDefinitions(n),this._fontAtlas.scaleFontLetterDefinition(a),this._lineHeight=r*a,this._lineBreakWithoutSpaces?this._multilineTextWrapByChar():this._multilineTextWrapByWord(),this._computeAlignmentOffset()}this._lineHeight=r,this._fontAtlas.assignLetterDefinitions(n),s||e-i>=0&&this._scaleFontSizeDown(e-i)},_scaleFontSizeDown:function(t){var e=!0;this._labelType===_ccsg.Label.Type.BMFont&&(t||(t=.1,e=!1),this._fontSize=t,e&&this._updateContent())},_updateContent:function(){this._fontAtlas&&(this._computeHorizontalKerningForText(this._string),this._alignText())},_computeAlignmentOffset:function(){switch(this._linesOffsetX=[],this._hAlign){case cc.TextAlignment.LEFT:for(var t=0;t<this._numberOfLines;++t)this._linesOffsetX.push(0);break;case cc.TextAlignment.CENTER:this._linesWidth.forEach(function(t){this._linesOffsetX.push((this._contentSize.width-t)/2)}.bind(this));break;case cc.TextAlignment.RIGHT:this._linesWidth.forEach(function(t){this._linesOffsetX.push(this._contentSize.width-t)}.bind(this))}switch(this._vAlign){case cc.VerticalTextAlignment.TOP:this._letterOffsetY=this._contentSize.height;break;case cc.VerticalTextAlignment.CENTER:this._letterOffsetY=(this._contentSize.height+this._textDesiredHeight)/2;break;case cc.VerticalTextAlignment.BOTTOM:this._letterOffsetY=this._textDesiredHeight}},_getFirstCharLen:function(){return 1},_getFirstWordLen:function(t,e,i){var n=t.charAt(e);if(cc.TextUtils.isUnicodeCJK(n)||"\n"===n||cc.TextUtils.isUnicodeSpace(n))return 1;var r=1;if(!(s=this._fontAtlas.getLetterDefinitionForChar(n)))return r;for(var s,o=s._xAdvance*this._bmfontScale+this._spacingX,a=e+1;a<i&&(n=t.charAt(a),s=this._fontAtlas.getLetterDefinitionForChar(n));++a){if(o+s._offsetX*this._bmfontScale+s._width*this._bmfontScale>this._maxLineWidth&&!cc.TextUtils.isUnicodeSpace(n)&&this._maxLineWidth>0)return r;if(o+=s._xAdvance*this._bmfontScale+this._spacingX,"\n"===n||cc.TextUtils.isUnicodeSpace(n)||cc.TextUtils.isUnicodeCJK(n))break;r++}return r},_updateBMFontScale:function(){if(this._labelType===_ccsg.Label.Type.BMFont){var t=this._fontAtlas._fontSize;this._bmfontScale=this._fontSize/t}else this._bmfontScale=1},_initBMFontWithString:function(t,e){if(this._config)return cc.logID(4002),!1;this._string=t,this._setBMFontFile(e)},_createSpriteBatchNode:function(t){this._spriteBatchNode=new cc.SpriteBatchNode(t,this._string.length),this._spriteBatchNode.setCascadeColorEnabled(!0),this._spriteBatchNode.setCascadeOpacityEnabled(!0),this.addChild(this._spriteBatchNode),this._updateContent(),this.setColor(this.color)},_createFontChars:function(){if(this._config){this._fontAtlas=new cc.FontAtlas(this._config),this._lineHeight||(this._lineHeight=this._fontAtlas._lineHeight);var t=this._config.fontDefDictionary;for(var e in t){var i=new s,n=t[e].rect;i._offsetX=parseInt(t[e].xOffset),i._offsetY=parseInt(t[e].yOffset),i._width=parseInt(n.width),i._height=parseInt(n.height),i._u=parseInt(n.x)+this._imageOffset.x,i._v=parseInt(n.y)+this._imageOffset.y,i._textureID=0,i._validDefinition=!0,i._xAdvance=parseInt(t[e].xAdvance),this._fontAtlas.addLetterDefinitions(e,i)}}},_rescaleWithOriginalFontSize:function(){var t=this.getFontSize();this._drawFontsize-t>=1&&this._overFlow===_ccsg.Label.Overflow.SHRINK&&(this._labelType===_ccsg.Label.Type.BMFont?this._scaleFontSizeDown(this._drawFontsize):this._fontSize=this._drawFontsize)},_computeHorizontalKerningForText:function(){for(var t=this.getStringLength(),e=this._config.kerningDict,i=-1,n=0;n<t;++n){var r=this._string.charCodeAt(n),s=e[i<<16|65535&r]||0;this._horizontalKernings[n]=n<t-1?s:0,i=r}},_setBMFontFile:function(t){if(t&&this._labelType===_ccsg.Label.Type.BMFont){var e=this;this._resetBMFont();var i=this._fontAsset._fntConfig;i?e._config=i:cc.warn("Invalid BMFont Assets!");var n=t.spriteFrame;e._createFontChars(),e._spriteFrame=n;var r=function(){var t=n.getTexture();e._textureLoaded=t.loaded,e._createSpriteBatchNode(t),e.emit("load")};n.textureLoaded()?r():(n.once("load",r),n.ensureLoadTexture())}}}),_ccsg.Label.pool=new r.Pool(function(t){return t instanceof _ccsg.Label&&(t._string="",t._fontAsset=null,t._fontHandle="",t._labelType=0,t._resetBMFont(),!0)},10),_ccsg.Label.pool.get=function(t,e){var i=this._get();if(i){var n=e instanceof cc.Font,r=n?e.rawUrl:"";return i._fontHandle=r,"string"!=typeof t&&(t=""+t),i._string=t,i._position.x=0,i._position.y=0,i.setAnchorPoint(.5,.5),_ccsg.Node.prototype.setContentSize.call(i,10,10),n?i.setFontAsset(e):i.setFontFamily("Arial"),i.setString(t),i.setHorizontalAlign(cc.TextAlignment.LEFT),i.setVerticalAlign(cc.VerticalTextAlignment.TOP),i.setFontSize(40),i.setOverflow(0),i.enableWrapText(!0),i.setVisible(!0),i.setLineHeight(40),i.setOutlined(!1),i.enableBold(!1),i.enableItalics(!1),i.enableUnderline(!1),i}return new _ccsg.Label(t||"",e)};var a=_ccsg.Label.prototype;cc.js.addon(a,n.prototype),_ccsg.Label.Type=cc.Enum({TTF:0,BMFont:1,SystemFont:2}),_ccsg.Label.Overflow=cc.Enum({NONE:0,CLAMP:1,SHRINK:2,RESIZE_HEIGHT:3});var c=_ccsg.Label.prototype;Object.defineProperty(c,"width",{get:c._getWidth,set:_ccsg.Node.prototype._setWidth}),Object.defineProperty(c,"height",{get:c._getHeight,set:_ccsg.Node.prototype._setHeight})}),{"../event/event-target":92,"../platform/js":177,"./CCTextUtils":109}],107:[(function(t,e,i){(function(){_ccsg.Label.TTFLabelBaker=function(){};var t=_ccsg.Label.TTFLabelBaker.prototype=Object.create(Object.prototype);t.updateStatus=function(){var t=_ccsg.Node._dirtyFlags,e=this._dirtyFlag,i=e&t.colorDirty,n=e&t.opacityDirty;i&&this._updateDisplayColor(),n&&(this._updateDisplayOpacity(),this._notifyRegionStatus&&this._notifyRegionStatus(_ccsg.Node.CanvasRenderCmd.RegionStatus.Dirty)),e&t.contentDirty&&(this._notifyRegionStatus&&this._notifyRegionStatus(_ccsg.Node.CanvasRenderCmd.RegionStatus.Dirty),this._dirtyFlag&=~t.contentDirty),(i||e&t.textDirty)&&(this._notifyRegionStatus&&this._notifyRegionStatus(_ccsg.Node.CanvasRenderCmd.RegionStatus.Dirty),this._rebuildLabelSkin()),this._dirtyFlag&t.transformDirty&&(this.transform(this.getParentRenderCmd(),!0),this._dirtyFlag&=~t.transformDirty)},t._syncStatus=function(t){var e=_ccsg.Node._dirtyFlags,i=this._dirtyFlag,n=t?t._node:null;n&&n._cascadeColorEnabled&&t._dirtyFlag&e.colorDirty&&(i|=e.colorDirty),n&&n._cascadeOpacityEnabled&&t._dirtyFlag&e.opacityDirty&&(i|=e.opacityDirty),t&&t._dirtyFlag&e.transformDirty&&(i|=e.transformDirty);var r=i&e.colorDirty,s=i&e.opacityDirty;this._dirtyFlag=i,r&&this._syncDisplayColor(),s&&this._syncDisplayOpacity(),(r||s||this._dirtyFlag&e.textDirty)&&this._rebuildLabelSkin(),this._dirtyFlag&e.transformDirty&&this.transform(t)},t._getLineHeight=function(){var t=this._node.getLineHeight(),e=this._node;return 0|(t=0===t?e._fontSize:t*e._fontSize/this._drawFontsize)},t._constructFontDesc=function(){var t=this._node,e=t._fontSize.toString()+"px ";return e+=0===t._fontHandle.length?"serif":t._fontHandle,t._isBold&&(e="bold "+e),e},t._measureText=function(t){return function(e){return t.measureText(e).width}},t._calculateLabelFont=function(){var t=this._node,e=t._string.split("\n");t._fontSize=t._drawFontsize;var i=this._constructFontDesc();this._labelContext.font=i;var n=this._calculateParagraphLength(e,this._labelContext);if(_ccsg.Label.Overflow.SHRINK===t._overFlow){this._splitedStrings=e;var r=0,s=0,o=0;if(t._isWrapText){var a=this._canvasSize.width-2*this._getMargin(),c=this._canvasSize.height-2*this._getMargin();if(a<0||c<0)return i=this._constructFontDesc(),this._labelContext.font=i,i;s=c+1,o=a+1;for(var h=this._drawFontsize+1,l="",_=!0,u=0|h;s>c||o>a;){if(_?h=u/2|0:u=h=u-1,h<=0){cc.logID(4003);break}for(t._fontSize=h,i=this._constructFontDesc(),this._labelContext.font=i,this._splitedStrings=[],s=0,r=0;r<e.length;++r){var d=0,m=this._labelContext.measureText(e[r]).width;for(l=cc.TextUtils.fragmentText(e[r],m,a,this._measureText(this._labelContext));d<l.length;){o=this._labelContext.measureText(l[d]).width,s+=this._getLineHeight(),++d}this._splitedStrings=this._splitedStrings.concat(l)}_&&(s>c?u=0|h:(_=!1,s=c+1))}}else{for(s=e.length*this._getLineHeight(),r=0;r<e.length;++r)o<n[r]&&(o=n[r]);var f=(this._canvasSize.width-2*this._getMargin())/o,p=this._canvasSize.height/s;t._fontSize=this._drawFontsize*Math.min(1,f,p)|0,i=this._constructFontDesc(),this._labelContext.font=i}}return i},t._getMargin=function(){return this._node&&this._node._margin||0},t._calculateParagraphLength=function(t,e){for(var i=[],n=0;n<t.length;++n){var r=e.measureText(t[n]);i.push(r.width)}return i},t._calculateCanvasSize=function(){var t=this._node,e=t._contentSize.width,i=t._contentSize.height;return e<=0&&(e=1),i<=0&&(i=1),cc.size(e,i)},t._calculateSplitedStrings=function(){var t,e=this._node,i=e._string.split("\n");if(e._isWrapText){this._splitedStrings=[];var n=this._canvasSize.width-2*this._getMargin();for(t=0;t<i.length;++t){var r=this._labelContext.measureText(i[t]).width,s=cc.TextUtils.fragmentText(i[t],r,n,this._measureText(this._labelContext));this._splitedStrings=this._splitedStrings.concat(s)}}else this._splitedStrings=i},t._updateLabelDimensions=function(){var t,e=this._node,i=e._string.split("\n"),n=this._labelContext;if(_ccsg.Label.Overflow.RESIZE_HEIGHT===e._overFlow)this._canvasSize.height=this._splitedStrings.length*this._getLineHeight(),_ccsg.Node.prototype.setContentSize.call(e,this._canvasSize);else if(_ccsg.Label.Overflow.NONE===e._overFlow){this._splitedStrings=i;var r=0,s=0;for(t=0;t<i.length;++t){var o=n.measureText(i[t]).width;r=r>o?r:o}s=this._splitedStrings.length*this._getLineHeight(),this._canvasSize.width=Math.round(r.toFixed(2))+2*this._getMargin(),this._canvasSize.height=Math.round(s.toFixed(2)),e._isItalic&&(this._canvasSize.width+=e._drawFontsize*Math.tan(.20943951)),_ccsg.Node.prototype.setContentSize.call(e,this._canvasSize)}this._labelCanvas.width=this._canvasSize.width,this._labelCanvas.height=this._canvasSize.height},t._calculateFillTextStartPosition=function(){var t,e,i=this._node,n=this._getLineHeight(),r=this._splitedStrings.length;return t=cc.TextAlignment.RIGHT===i._hAlign?this._canvasSize.width-this._getMargin():cc.TextAlignment.CENTER===i._hAlign?this._canvasSize.width/2:0+this._getMargin(),e=cc.VerticalTextAlignment.TOP===i._vAlign?0:cc.VerticalTextAlignment.CENTER===i._vAlign?this._canvasSize.height/2-n*(r-1)/2:this._canvasSize.height-n*(r-1),cc.p(t,e)},t._calculateTextBaseline=function(){var t,e,i=this._node;t=cc.TextAlignment.RIGHT===i._hAlign?"right":cc.TextAlignment.CENTER===i._hAlign?"center":"left",this._labelContext.textAlign=t,e=cc.VerticalTextAlignment.TOP===i._vAlign?"top":cc.VerticalTextAlignment.CENTER===i._vAlign?"middle":"bottom",this._labelContext.textBaseline=e},t._bakeLabel=function(){var t=this._node;this._drawFontsize=t._drawFontsize,this._canvasSize=this._calculateCanvasSize(),this._fontDesc=this._calculateLabelFont(),this._calculateSplitedStrings(),this._updateLabelDimensions(),this._calculateTextBaseline(),this._updateTexture()},t._calculateUnderlineStartPosition=function(){var t,e,i=this._node,n=this._getLineHeight(),r=this._splitedStrings.length;return t=0+this._getMargin(),e=cc.VerticalTextAlignment.TOP===i._vAlign?i._fontSize:cc.VerticalTextAlignment.CENTER===i._vAlign?this._canvasSize.height/2-n*(r-1)/2+i._fontSize/2:this._canvasSize.height-n*(r-1),cc.p(t,e)},t._updateTexture=function(){this._labelContext.clearRect(0,0,this._canvasSize.width,this._canvasSize.height),this._labelContext.font=this._fontDesc;var t=this._calculateFillTextStartPosition(),e=this._getLineHeight();this._labelContext.lineJoin="round";var i=this._displayedColor;this._labelContext.fillStyle="rgb("+i.r+","+i.g+","+i.b+")";for(var n,r=0;r<this._splitedStrings.length;++r){if(this._node.isOutlined()){var s=this._node.getOutlineColor()||cc.color(255,255,255,255);this._labelContext.globalCompositeOperation="source-over",this._labelContext.strokeStyle="rgb("+s.r+","+s.g+","+s.b+")",this._labelContext.lineWidth=2*this._node.getOutlineWidth(),this._labelContext.strokeText(this._splitedStrings[r],t.x,t.y+r*e)}if(this._node.getFillColorGradientEnabled()){var o=this._node.getGradientStartColor()||cc.color(255,255,255,255),a=this._node.getGradientEndColor()||cc.color(255,255,255,255),c=this._getGradientArgs(),h=this._labelContext.createLinearGradient(c.left,c.top,c.right,c.bottom);h.addColorStop(0,cc.colorToHex(o)),h.addColorStop(1,cc.colorToHex(a)),this._labelContext.fillStyle=h}this._labelContext.fillText(this._splitedStrings[r],t.x,t.y+r*e),this._node._isUnderline&&(n=this._calculateUnderlineStartPosition(),this._labelContext.save(),this._labelContext.beginPath(),this._labelContext.lineWidth=this._node._fontSize/8,this._labelContext.strokeStyle="rgb("+i.r+","+i.g+","+i.b+")",this._labelContext.moveTo(n.x,n.y+r*e-1),this._labelContext.lineTo(n.x+this._labelCanvas.width,n.y+r*e-1),this._labelContext.stroke(),this._labelContext.restore())}this._texture.loaded=!1,this._texture._image=this._labelCanvas,this._texture.handleLoadedTexture(!0)},t._getGradientArgs=function(){this._gradientArgument={},this._gradientArgument.left=0,this._gradientArgument.top=0;var t=this._node._contentSize;switch(this._node.getFillColorGradientDirection()){case 0:this._gradientArgument.right=t.width,this._gradientArgument.bottom=0;break;case 1:this._gradientArgument.right=0,this._gradientArgument.bottom=t.height;break;case 2:this._gradientArgument.right=t.width,this._gradientArgument.bottom=t.height}return this._gradientArgument},t._rebuildLabelSkin=function(){this._dirtyFlag&=~_ccsg.Node._dirtyFlags.textDirty;this._node._updateLabel()}})(),(function(){_ccsg.Label.CanvasRenderCmd=function(t){this._rootCtor(t),this._needDraw=!0,this._texture=new cc.Texture2D,this._labelCanvas=document.createElement("canvas"),this._labelCanvas.width=1,this._labelCanvas.height=1,this._labelContext=this._labelCanvas.getContext("2d"),this._texture.initWithElement(this._labelCanvas),this._splitedStrings=null};var t=_ccsg.Label.CanvasRenderCmd.prototype=Object.create(_ccsg.Node.CanvasRenderCmd.prototype);cc.js.mixin(t,_ccsg.Label.TTFLabelBaker.prototype),t.constructor=_ccsg.Label.CanvasRenderCmd,t._doCulling=function(){var t=cc.visibleRect,e=this._currentRegion,i=e._minX,n=e._maxX,r=e._minY,s=e._maxY,o=t.left.x,a=t.right.x,c=t.top.y,h=t.bottom.y;this._needDraw=!(n<o||i>a||s<h||r>c)},t.rendering=function(t,e,i){var n=this._node;if(n._labelType===_ccsg.Label.Type.TTF||n._labelType===_ccsg.Label.Type.SystemFont){var r=this._displayedOpacity,s=r/255;if(0===r)return;var o=t||cc._renderContext,a=o.getContext();if(o.setTransform(this._worldTransform,e,i),o.setCompositeOperation(_ccsg.Node.CanvasRenderCmd._getCompositeOperationByBlendFunc(n._blendFunc)),o.setGlobalAlpha(s),this._texture){var c,h,l,_,u;0,l=-this._node._contentSize.height,_=this._node._contentSize.width,u=this._node._contentSize.height;0,0,c=this._texture.getPixelWidth(),h=this._texture.getPixelHeight();var d=this._texture._image;""!==this._texture._pattern?(o.setFillStyle(a.createPattern(d,this._texture._pattern)),a.fillRect(0,l,_,u)):0!==c&&0!==h&&0!==_&&0!==u&&a.drawImage(d,0,0,c,h,0,l,_,u)}cc.g_NumberOfDraws=cc.g_NumberOfDraws+1}}})()}),{}],108:[(function(t,e,i){var n;_ccsg.Label.WebGLRenderCmd=function(t){this._rootCtor(t),this._needDraw=!0,this._texture=new cc.Texture2D,n=n||document.createElement("canvas"),this._labelCanvas=n,this._texture.initWithElement(this._labelCanvas),this._labelContext=this._labelCanvas.getContext("2d"),this._labelCanvas.width=1,this._labelCanvas.height=1,this._splitedStrings=null,this._drawFontsize=0,this._vertices=[{x:0,y:0,u:0,v:0},{x:0,y:0,u:0,v:1},{x:0,y:0,u:1,v:0},{x:0,y:0,u:1,v:1}],this._color=new Uint32Array(1),this._dirty=!1,this._shaderProgram=cc.shaderCache.programForKey(cc.macro.SHADER_SPRITE_POSITION_TEXTURECOLOR)};var r=_ccsg.Label.WebGLRenderCmd.prototype=Object.create(_ccsg.Node.WebGLRenderCmd.prototype);cc.js.mixin(r,_ccsg.Label.TTFLabelBaker.prototype),r.constructor=_ccsg.Label.WebGLRenderCmd,r.updateTransform=function(t){this.originUpdateTransform(t);this._node;var e=this._node.width,i=this._node.height,n=this._worldTransform,r=this._vertices;r[0].x=0*n.a+i*n.c+n.tx,r[0].y=0*n.b+i*n.d+n.ty,r[1].x=0*n.a+0*n.c+n.tx,r[1].y=0*n.b+0*n.d+n.ty,r[2].x=e*n.a+i*n.c+n.tx,r[2].y=e*n.b+i*n.d+n.ty,r[3].x=e*n.a+0*n.c+n.tx,r[3].y=e*n.b+0*n.d+n.ty},r._doCulling=function(){var t=this._node;if(t._string&&(t._labelType===_ccsg.Label.Type.TTF||t._labelType===_ccsg.Label.Type.SystemFont)){var e=cc.visibleRect;this._cameraFlag>0&&(e=cc.Camera.main.visibleRect);var i=e.left.x,n=e.right.x,r=e.top.y,s=e.bottom.y,o=this._vertices;(o[0].x-i&o[1].x-i&o[2].x-i&o[3].x-i)>>31||(n-o[0].x&n-o[1].x&n-o[2].x&n-o[3].x)>>31||(o[0].y-s&o[1].y-s&o[2].y-s&o[3].y-s)>>31||(r-o[0].y&r-o[1].y&r-o[2].y&r-o[3].y)>>31?this._needDraw=!1:this._needDraw=!0}},r.uploadData=function(t,e,i){var n=this._node;if(!n._string||n._labelType!==_ccsg.Label.Type.TTF&&n._labelType!==_ccsg.Label.Type.SystemFont)return 0;var r=this._displayedOpacity;this._color[0]=~~r<<24>>>0|~~r<<16|~~r<<8|~~r;var s,o,a=n._vertexZ,c=this._vertices,h=c.length,l=i;for(s=0;s<h;++s)o=c[s],t[l]=o.x,t[l+1]=o.y,t[l+2]=a,e[l+3]=this._color[0],t[l+4]=o.u,t[l+5]=o.v,l+=6;return h}}),{}],109:[(function(t,e,i){var n=function(){this._status="unloaded",this._observers=[],this._isLoadWithCSS=!1};n.prototype.onLoaded=function(){this._status="loaded",this._observers.forEach((function(t){t()}))},n.prototype.isLoaded=function(){return"loaded"===this._status},n.prototype.addHandler=function(t){-1===this._observers.indexOf(t)&&this._observers.push(t)};var r={_fontCache:{},_fontWidthCache:{},_canvasContext:null,_testString:"BESbswy",_allFontsLoaded:!1,_intervalId:0,loadTTF:function(t,e){var i=this._getFontFamily(t),n=cc.loader.md5Pipe;n&&(t=n.transformURL(t));var r=cc.sys.browserType!==cc.sys.BROWSER_TYPE_BAIDU&&cc.sys.browserType!==cc.sys.BROWSER_TYPE_BAIDU_APP&&cc.sys.browserType!==cc.sys.BROWSER_TYPE_MOBILE_QQ;window.FontFace&&r?this._loadWithFontFace(i,t,e):this._loadWithCSS(i,t,e),0===this._intervalId&&(this._intervalId=setInterval(this._checkFontLoaded.bind(this),100))},_checkFontLoaded:function(){this._allFontsLoaded=!0;for(var t in this._fontCache){var e=this._fontCache[t];if(!e.isLoaded()&&e._isLoadWithCSS){var i=this._fontWidthCache[t];this._canvasContext.font="40px "+t;i!==this._canvasContext.measureText(this._testString).width?e.onLoaded():this._allFontsLoaded=!1}}this._allFontsLoaded&&(clearInterval(this._intervalId),this._intervalId=0)},_loadWithFontFace:function(t,e,i){var r=this._fontCache[t];if(r)r.isLoaded()||r.addHandler(i);else{var s=new FontFace(t,"url('"+e+"')");document.fonts.add(s),(r=new n).addHandler(i),this._fontCache[t]=r,s.loaded.then((function(){r.onLoaded()}))}},_loadWithCSS:function(t,e,i){var r=this._fontCache[t];if(r)r.isLoaded()||r.addHandler(i);else{var s=document,o=document.createElement("style");o.type="text/css",s.body.appendChild(o);var a="";isNaN(t-0)?a+="@font-face { font-family:"+t+"; src:":a+="@font-face { font-family:'"+t+"'; src:",a+="url('"+e+"');",o.textContent=a+"}";var c=document.createElement("div"),h=c.style;if(h.fontFamily=t,c.innerHTML=".",h.position="absolute",h.left="-100px",h.top="-100px",s.body.appendChild(c),(r=new n).addHandler(i),this._fontCache[t]=r,r._isLoadWithCSS=!0,!this._canvasContext){var l=document.createElement("canvas");l.width=100,l.height=100,this._canvasContext=l.getContext("2d")}var _="40px "+t;this._canvasContext.font=_;var u=this._canvasContext.measureText(this._testString).width;this._fontWidthCache[t]=u;var d=this;o.onload=function(){setTimeout((function(){d._allFontsLoaded||(cc.logID(4004),r.onLoaded(),cc.director.getScheduler().unschedule(this._checkFontLoaded,this))}),2e4)}}},_getFontFamily:function(t){var e=t.lastIndexOf(".ttf");if(-1===e)return t;var i=t.lastIndexOf("/");return-1===i?t.substring(0,e)+"_LABEL":t.substring(i+1,e)+"_LABEL"}};cc.TextUtils=e.exports={label_wordRex:/([a-zA-Z0-9--]+|\S)/,label_symbolRex:/^[!,.:;'}\]%\?>]/,label_lastWordRex:/([a-zA-Z0-9--]+|\S)$/,label_lastEnglish:/[a-zA-Z0-9--]+$/,label_firstEnglish:/^[a-zA-Z0-9--]/,label_wrapinspection:!0,isUnicodeCJK:function(t){return/^[\u4E00-\u9FFF\u3400-\u4DFF]+$/.test(t)||/[\u3000-\u303F]|[\u3040-\u309F]|[\u30A0-\u30FF]|[\uFF00-\uFFEF]|[\u4E00-\u9FAF]|[\u2605-\u2606]|[\u2190-\u2195]|\u203B/g.test(t)||/^[\u1100-\u11FF]|[\u3130-\u318F]|[\uA960-\uA97F]|[\uAC00-\uD7AF]|[\uD7B0-\uD7FF]+$/.test(t)},isUnicodeSpace:function(t){return(t=t.charCodeAt(0))>=9&&t<=13||32===t||133===t||160===t||5760===t||t>=8192&&t<=8202||8232===t||8233===t||8239===t||8287===t||12288===t},fragmentText:function(t,e,i,n){var r=[];if(0===t.length||i<0)return r.push(""),r;for(var s=t;e>i&&s.length>1;){for(var o=s.length*(i/e)|0,a=s.substr(o),c=e-n(a),h=a,l=0,_=0;c>i&&_++<10;)o*=i/c,o|=0,c=e-n(a=s.substr(o));for(_=0;c<=i&&_++<10;){if(a){var u=this.label_wordRex.exec(a);l=u?u[0].length:1,h=a}o+=l,c=e-n(a=s.substr(o))}0==(o-=l)&&(o=1,h=h.substr(1));var d,m=s.substr(0,o);this.label_wrapinspection&&this.label_symbolRex.test(h||a)&&(0==(o-=(d=this.label_lastWordRex.exec(m))?d[0].length:0)&&(o=1),h=s.substr(o),m=s.substr(0,o)),this.label_firstEnglish.test(h)&&(d=this.label_lastEnglish.exec(m))&&m!==d[0]&&(o-=d[0].length,h=s.substr(o),m=s.substr(0,o)),0===r.length?r.push(m):(m=m.trim()).length>0&&r.push(m),e=n(s=h||a)}return 0===r.length?r.push(s):(s=s.trim()).length>0&&r.push(s),r}},cc.CustomFontLoader=e.exports=r}),{}],110:[(function(t,e,i){function n(t){var e,i,n;if("object"==typeof t){if(i=t,t.url)return i;e=t.uuid}else i={},e=t;return n=i.type?"uuid"===i.type:cc.AssetLibrary._getAssetUrl(e),cc.AssetLibrary._getAssetInfoInRuntime(e,p),i.url=n?p.url:e,p.url&&"uuid"===i.type&&p.raw?(i.type=null,i.isRawAsset=!0):n||(i.isRawAsset=!0),i}function r(){var t=new c,e=new h,i=new l;o.call(this,[t,e,i]),this.assetLoader=t,this.downloader=e,this.loader=i,this.onProgress=null,this._autoReleaseSetting={}}var s=t("../platform/js"),o=t("./pipeline"),a=t("./loading-items"),c=t("./asset-loader"),h=t("./downloader"),l=t("./loader"),_=t("./asset-table"),u=t("../platform/utils").callInNextTick,d=t("./auto-release-utils"),m=new _,f=["mp3","ogg","wav","m4a"],p={url:null,raw:!1},g=[],v=[];s.extend(r,o);var y=r.prototype;y.init=function(t){},y.getXMLHttpRequest=function(){return window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP")},y.addDownloadHandlers=function(t){this.downloader.addHandlers(t)},y.addLoadHandlers=function(t){this.loader.addHandlers(t)},y.load=function(t,e,i){void 0===i&&(i=e,e=this.onProgress||null);var r=this,s=!1;t instanceof Array||(s=!0,t=t?[t]:[]),g.length=0;for(var o=0;o<t.length;++o){var c=t[o];c&&c.id&&(cc.warnID(4920,c.id),c.uuid||c.url||(c.url=c.id));var h=n(c);if(h.url||h.uuid){var l=this._cache[h.url];g.push(l||h)}}var _=a.create(this,e,(function(t,e){u((function(){if(i){if(s){var n=h.url;i.call(r,e.getError(n),e.getContent(n))}else i.call(r,t,e);i=null}e.destroy()}))}));a.initQueueDeps(_),_.append(g),g.length=0},y.flowInDeps=function(t,e,i){v.length=0;for(var r=0;r<e.length;++r){var s=n(e[r]);if(s.url||s.uuid){var o=this._cache[s.url];o?v.push(o):v.push(s)}}var c=a.create(this,t?function(t,e,i){this._ownerQueue&&this._ownerQueue.onProgress&&this._ownerQueue._childOnProgress(i)}:null,(function(e,n){i(e,n),t&&t.deps&&(t.deps.length=0),n.destroy()}));if(t){var h=a.getQueue(t);c._ownerQueue=h._ownerQueue||h}var l=c.append(v,t);return v.length=0,l},y._resources=m,y._getResUuid=function(t,e,i){if(!t)return null;var n=t.indexOf("?");-1!==n&&(t=t.substr(0,n));var r=m.getUuid(t,e);if(!r){var s=cc.path.extname(t);s&&(t=t.slice(0,-s.length),(r=m.getUuid(t,e))&&!i&&cc.warnID(4901,t,s))}return r},y._getReferenceKey=function(t){var e;return"object"==typeof t?e=t._uuid||null:"string"==typeof t&&(e=this._getResUuid(t,null,!0)||t),e?(cc.AssetLibrary._getAssetInfoInRuntime(e,p),this._cache[p.url]?p.url:e):(cc.warnID(4800,t),e)},y._urlNotFound=function(t,e,i){u((function(){t=cc.url.normalize(t);var n=(e?s.getClassName(e):"Asset")+' in "resources/'+t+'" does not exist.';i&&i(new Error(n),[])}))},y._parseLoadResArgs=function(t,e,i){if(void 0===i){var n=cc.isChildClassOf(t,cc.RawAsset);e?(i=e,n&&(e=this.onProgress||null)):void 0!==e||n||(i=t,e=this.onProgress||null,t=null),void 0===e||n||(e=t,t=null)}return{type:t,onProgress:e,onComplete:i}},y.loadRes=function(t,e,i,n){var r=this._parseLoadResArgs(e,i,n);e=r.type,i=r.onProgress,n=r.onComplete;var s=this,o=s._getResUuid(t,e);o?this.load({type:"uuid",uuid:o},i,(function(t,e){e&&s.setAutoReleaseRecursively(o,!1),n&&n(t,e)})):s._urlNotFound(t,e,n)},y._loadResUuids=function(t,e,i,n){if(t.length>0){var r=this,s=t.map((function(t){return{type:"uuid",uuid:t}}));this.load(s,e,(function(t,e){if(i){for(var o=[],a=n&&[],c=0;c<s.length;++c){var h=s[c].uuid,l=this._getReferenceKey(h),_=e.getContent(l);_&&(r.setAutoReleaseRecursively(h,!1),o.push(_),a&&a.push(n[c]))}n?i(t,o,a):i(t,o)}}))}else i&&u((function(){n?i(null,[],[]):i(null,[])}))},y.loadResArray=function(t,e,i,n){var r=this._parseLoadResArgs(e,i,n);e=r.type,i=r.onProgress,n=r.onComplete;for(var s=[],o=0;o<t.length;o++){var a=t[o],c=this._getResUuid(a,e);if(!c)return void this._urlNotFound(a,e,n);s.push(c)}this._loadResUuids(s,i,n)},y.loadResDir=function(t,e,i,n){var r=this._parseLoadResArgs(e,i,n);e=r.type,i=r.onProgress,n=r.onComplete;var s=[],o=m.getUuidArray(t,e,s);this._loadResUuids(o,i,n,s)},y.getRes=function(t,e){var i=this._cache[t];if(!i){var n=this._getResUuid(t,e,!0);if(!n)return null;var r=this._getReferenceKey(n);i=this._cache[r]}return i&&i.alias&&(i=i.alias),i&&i.complete?i.content:null},y.getResCount=function(){return Object.keys(this._cache).length},y.getDependsRecursively=function(t){if(t){var e=this._getReferenceKey(t),i=d.getDependsRecursively(e);return i.push(e),i}return[]},y.release=function(t){if(Array.isArray(t))for(var e=0;e<t.length;e++){var i=t[e];this.release(i)}else if(t){var n=this._getReferenceKey(t),r=this.getItem(n);if(r){this.removeItem(n);if((t=r.content)instanceof cc.Asset){0;for(var s=t.rawUrls,o=0;o<s.length;o++)this.release(s[o])}else t instanceof cc.Texture2D?cc.textureCache.removeTextureForKey(r.rawUrl||r.url):-1!==f.indexOf(r.type)&&cc.audioEngine.uncache(r.rawUrl||r.url);0}}},y.releaseAsset=function(t){var e=t._uuid;e&&this.release(e)},y.releaseRes=function(t,e){var i=this._getResUuid(t,e);i?this.release(i):cc.errorID(4914,t)},y.releaseResDir=function(t,e){for(var i=m.getUuidArray(t,e),n=0;n<i.length;n++){var r=i[n];this.release(r)}},y.releaseAll=function(){for(var t in this._cache)this.release(t)},y.removeItem=function(t){var e=o.prototype.removeItem.call(this,t);return delete this._autoReleaseSetting[t],e},y.setAutoRelease=function(t,e){var i=this._getReferenceKey(t);i&&(this._autoReleaseSetting[i]=!!e)},y.setAutoReleaseRecursively=function(t,e){e=!!e;var i=this._getReferenceKey(t);if(i){this._autoReleaseSetting[i]=e;for(var n=d.getDependsRecursively(i),r=0;r<n.length;r++){var s=n[r];this._autoReleaseSetting[s]=e}}else 0},y.isAutoRelease=function(t){var e=this._getReferenceKey(t);return!!e&&!!this._autoReleaseSetting[e]},cc.loader=new r,e.exports=cc.loader}),{"../platform/js":177,"../platform/utils":181,"./asset-loader":111,"./asset-table":112,"./auto-release-utils":114,"./downloader":115,"./loader":118,"./loading-items":119,"./pipeline":122,"./released-asset-checker":123}],111:[(function(t,e,i){var n=t("../utils/CCPath"),r=t("./pipeline"),s=t("./loading-items"),o=function(t){this.id="AssetLoader",this.async=!0,this.pipeline=null};o.ID="AssetLoader";var a=[];o.prototype.handle=function(t,e){var i=t.uuid;if(!i)return t.content?t.content:null;cc.AssetLibrary.queryAssetInfo(i,(function(r,o,c){if(r)e(r);else if(t.url=t.rawUrl=o,t.isRawAsset=c,c){var h=n.extname(o).toLowerCase();if(!h)return void e(new Error("Download Uuid: can not find type of raw asset["+i+"]: "+o));h=h.substr(1);var l=s.getQueue(t);a[0]={queueId:t.queueId,id:o,url:o,type:h,error:null,alias:t,complete:!0},l.append(a),t.type=h,e(null,t.content)}else t.type="uuid",e(null,t.content)}))},r.AssetLoader=e.exports=o}),{"../utils/CCPath":199,"./loading-items":119,"./pipeline":122}],112:[(function(t,e,i){function n(){this._pathToUuid={}}function r(t,e){if(t.length>e.length){var i=t.charCodeAt(e.length);return 46===i||47===i}return!0}var s=t("../utils/misc").pushToMap,o=n.prototype;o.getUuid=function(t,e){t=cc.url.normalize(t);var i=this._pathToUuid[t];if(i)if(Array.isArray(i)){if(!e)return i[0].uuid;for(var n=0;n<i.length;n++){var r=i[n];if(cc.isChildClassOf(r.type,e))return r.uuid}}else if(!e||cc.isChildClassOf(i.type,e))return i.uuid;return""},o.getUuidArray=function(t,e,i){"/"===(t=cc.url.normalize(t))[t.length-1]&&(t=t.slice(0,-1));var n=this._pathToUuid,s=[],o=cc.isChildClassOf;for(var a in n)if(a.startsWith(t)&&r(a,t)||!t){var c=n[a];if(Array.isArray(c))for(var h=0;h<c.length;h++){var l=c[h];e&&!o(l.type,e)||(s.push(l.uuid),i&&i.push(a))}else e&&!o(c.type,e)||(s.push(c.uuid),i&&i.push(a))}return s},o.add=function(t,e,i,n){t=t.substring(0,t.length-cc.path.extname(t).length);var r=new function(t,e){this.uuid=t,this.type=e}(e,i);s(this._pathToUuid,t,r,n)},o._getInfo_DEBUG=!1,o.reset=function(){this._pathToUuid={}},e.exports=n}),{"../utils/misc":206}],113:[(function(t,e,i){t("../utils/CCPath");var n=t("../platform/CCSys"),r=(t("./pipeline"),t("../../audio/CCAudioEngine"),n.__audioSupport),s=r.format,o=r.context;e.exports=function(t,e){if(0===s.length)return new Error("Audio Downloader: audio not supported on this browser!");t.content=t.url,!r.WEB_AUDIO||t.urlParam&&t.urlParam.useDom?(function(t,e){var i=document.createElement("audio");if(i.src=t.url,n.platform===n.WECHAT_GAME)return t.element=i,void e(null,t.id);var s=function(){clearTimeout(o),i.removeEventListener("canplaythrough",a,!1),i.removeEventListener("error",c,!1),r.USE_LOADER_EVENT&&i.removeEventListener(r.USE_LOADER_EVENT,a,!1)},o=setTimeout((function(){0===i.readyState?c():a()}),8e3),a=function(){s(),t.element=i,e(null,t.url)},c=function(){s();var i="load audio failure - "+t.url;cc.log(i),e(i,t.url)};i.addEventListener("canplaythrough",a,!1),i.addEventListener("error",c,!1),r.USE_LOADER_EVENT&&i.addEventListener(r.USE_LOADER_EVENT,a,!1)})(t,e):(function(t,e){o||e(new Error("Audio Downloader: no web audio context."));var i=cc.loader.getXMLHttpRequest();i.open("GET",t.url,!0),i.responseType="arraybuffer",i.onload=function(){o.decodeAudioData(i.response,(function(i){t.buffer=i,e(null,t.id)}),(function(){e("decode error - "+t.id,null)}))},i.onerror=function(){e("request error - "+t.id,null)},i.send()})(t,e)}}),{"../../audio/CCAudioEngine":24,"../platform/CCSys":165,"../utils/CCPath":199,"./pipeline":122}],114:[(function(t,e,i){function n(t,e){var i=cc.loader.getItem(t);if(i){var r=i.dependKeys;if(r)for(var s=0;s<r.length;s++){var o=r[s];e[o]||(e[o]=!0,n(o,e))}}}function r(t,e){var i=cc.loader._getReferenceKey(t);e[i]||(e[i]=!0,n(i,e))}function s(t,e){for(var i=Object.getOwnPropertyNames(t),n=0;n<i.length;n++){var s=t[i[n]];if("object"==typeof s&&s)if(Array.isArray(s))for(var o=0;o<s.length;o++){var a=s[o];a instanceof cc.RawAsset&&r(a,e)}else if(s.constructor&&s.constructor!==Object)s instanceof cc.RawAsset&&r(s,e);else for(var c=Object.getOwnPropertyNames(s),h=0;h<c.length;h++){var l=s[c[h]];l instanceof cc.RawAsset&&r(l,e)}}}function o(t,e){for(var i=0;i<t._components.length;i++)s(t._components[i],e);for(var n=0;n<t._children.length;n++)o(t._children[n],e)}var a=t("../platform/js");e.exports={autoRelease:function(t,e,i){var n=cc.loader._autoReleaseSetting,r=a.createMap();if(e)for(var s=0;s<e.length;s++)r[e[s]]=!0;for(var c=0;c<i.length;c++)o(i[c],r);if(t)for(var h=0;h<t.length;h++){var l=t[h];!1===n[l]||r[l]||cc.loader.release(l)}for(var _=Object.keys(n),u=0;u<_.length;u++){var d=_[u];!0!==n[d]||r[d]||cc.loader.release(d)}},getDependsRecursively:function(t){var e={};return n(t,e),Object.keys(e)}}}),{"../platform/js":177}],115:[(function(t,e,i){function n(t,e,i,r){void 0===i&&(i=!0);var s=m(t.url);if(r=r||l.imagePool.get(),i&&"file:"!==window.location.protocol?r.crossOrigin="anonymous":r.crossOrigin=null,r.complete&&r.naturalWidth>0&&r.src===s)return r;(function(){function i(){r.removeEventListener("load",i),r.removeEventListener("error",o),e(null,r)}function o(){r.removeEventListener("load",i),r.removeEventListener("error",o),"https:"!==window.location.protocol&&r.crossOrigin&&"anonymous"===r.crossOrigin.toLowerCase()?n(t,e,!1,r):e(new Error("Load image ("+s+") failed"))}r.addEventListener("load",i),r.addEventListener("error",o),r.src=s})()}function r(t,e,i){var n=document,r=document.createElement("style");r.type="text/css",n.body.appendChild(r);var s="";if(isNaN(t-0)?s+="@font-face { font-family:"+t+"; src:":s+="@font-face { font-family:'"+t+"'; src:",e instanceof Array)for(var o=0,a=e.length;o<a;o++){var c=e[o];i=h.extname(c).toLowerCase(),s+="url('"+e[o]+"') format('"+f[i]+"')",s+=o===a-1?";":","}else i=i.toLowerCase(),s+="url('"+e+"') format('"+f[i]+"');";r.textContent+=s+"}";var l=document.createElement("div"),_=l.style;_.fontFamily=t,l.innerHTML=".",_.position="absolute",_.left="-100px",_.top="-100px",n.body.appendChild(l)}function s(t,e){var i=t.url,n=t.type,s=t.name,o=t.srcs;if(s&&o?(-1===o.indexOf(i)&&o.push(i),r(s,o)):(n=h.extname(i),r(s=h.basename(i,n),i,n)),!document.fonts)return null;document.fonts.load("1em "+s).then((function(){e(null,null)}),(function(t){e(t)}))}var o,a=t("../platform/js"),c=t("../platform/CCSys"),h=t("../utils/CCPath"),l=t("../utils/misc"),_=t("./pipeline"),u=t("./pack-downloader"),d=t("./text-downloader"),m=t("./utils").urlAppendTimestamp,f={".eot":"embedded-opentype",".ttf":"truetype",".ttc":"truetype",".woff":"woff",".svg":"svg"},p={js:function(e,i,n){function r(){h.parentNode.removeChild(h),h.removeEventListener("load",r,!1),h.removeEventListener("error",s,!1),i(null,o)}function s(){h.parentNode.removeChild(h),h.removeEventListener("load",r,!1),h.removeEventListener("error",s,!1),i(new Error("Load "+o+" failed!"),o)}if(c.platform===c.WECHAT_GAME)return t(e.url),void i(null,e.url);var o=e.url,a=document,h=document.createElement("script");h.async=n,h.src=m(o),h.addEventListener("load",r,!1),h.addEventListener("error",s,!1),a.body.appendChild(h)},png:n,jpg:n,bmp:n,jpeg:n,gif:n,ico:n,tiff:n,webp:function(t,e,i,r){return cc.sys.capabilities.webp?n(t,e,i,r):new Error("Load Webp ( "+t.url+" ) failed")},image:n,mp3:o=t("./audio-downloader"),ogg:o,wav:o,m4a:o,txt:d,xml:d,vsh:d,fsh:d,atlas:d,tmx:d,tsx:d,json:d,ExportJson:d,plist:d,fnt:d,font:s,eot:s,ttf:s,woff:s,svg:s,ttc:s,uuid:function(t,e){var i=u.load(t,e);return void 0===i?this.extMap.json(t,e):i||void 0},default:d},g=function(t){this.id="Downloader",this.async=!0,this.pipeline=null,this._curConcurrent=0,this._loadQueue=[],this.extMap=a.mixin(t,p)};g.ID="Downloader",g.PackDownloader=u,g.prototype.addHandlers=function(t){a.mixin(this.extMap,t)},g.prototype._handleLoadQueue=function(){for(;this._curConcurrent<cc.macro.DOWNLOAD_MAX_CONCURRENT;){var t=this._loadQueue.shift();if(!t)break;var e=this.handle(t.item,t.callback);void 0!==e&&(e instanceof Error?t.callback(e):t.callback(null,e))}},g.prototype.handle=function(t,e){var i=this,n=this.extMap[t.type]||this.extMap.default,r=void 0;if(this._curConcurrent<cc.macro.DOWNLOAD_MAX_CONCURRENT){if(this._curConcurrent++,void 0!==(r=n.call(this,t,(function(t,n){i._curConcurrent=Math.max(0,i._curConcurrent-1),i._handleLoadQueue(),e&&e(t,n)}))))return this._curConcurrent=Math.max(0,this._curConcurrent-1),this._handleLoadQueue(),r}else if(t.ignoreMaxConcurrency){if(void 0!==(r=n.call(this,t,e)))return r}else this._loadQueue.push({item:t,callback:e})},_.Downloader=e.exports=g}),{"../platform/CCSys":165,"../platform/js":177,"../utils/CCPath":199,"../utils/misc":206,"./audio-downloader":113,"./pack-downloader":121,"./pipeline":122,"./text-downloader":124,"./utils":125}],116:[(function(t,e,i){t("./downloader"),t("./loader"),t("./json-unpacker"),t("./loading-items"),t("./pipeline"),t("./CCLoader")}),{"./CCLoader":110,"./downloader":115,"./json-unpacker":117,"./loader":118,"./loading-items":119,"./pipeline":122}],117:[(function(t,e,i){function n(){this.jsons={},this.state=-1}n.prototype.read=function(t,e){var i="string"==typeof e?JSON.parse(e):e;i.length!==t.length&&cc.errorID(4915);for(var n=0;n<t.length;n++){var r=t[n],s=i[n];this.jsons[r]=s}},n.prototype.retrieve=function(t){return this.jsons[t]||null},e.exports=n}),{}],118:[(function(t,e,i){function n(t,e){if("string"!=typeof t.content)return new Error("JSON Loader: Input item doesn't contain string content");try{return JSON.parse(t.content)}catch(e){return new Error("JSON Loader: Parse json ["+t.id+"] failed : "+e)}}function r(t,e){if(o.platform!==o.WECHAT_GAME&&o.platform!==o.QQ_PLAY&&!(t.content instanceof Image))return new Error("Image Loader: Input item doesn't contain Image content");var i=t.rawUrl,n=cc.textureCache.getTextureForKey(i)||new c;return n.url=i,n.initWithElement(t.content),n.handleLoadedTexture(),cc.textureCache.cacheImage(i,n),n}var s=t("../platform/js"),o=t("../platform/CCSys"),a=t("./pipeline"),c=t("../textures/CCTexture2D"),h=t("./uuid-loader"),l=(t("../utils/misc"),{png:r,jpg:r,bmp:r,jpeg:r,gif:r,ico:r,tiff:r,webp:r,image:r,json:n,ExportJson:n,plist:function(t,e){if("string"!=typeof t.content)return new Error("Plist Loader: Input item doesn't contain string content");var i=cc.plistParser.parse(t.content);return i||new Error("Plist Loader: Parse ["+t.id+"] failed")},uuid:h,prefab:h,fire:h,scene:h,default:function(t,e){return null}}),_=function(t){this.id="Loader",this.async=!0,this.pipeline=null,this.extMap=s.mixin(t,l)};_.ID="Loader",_.prototype.addHandlers=function(t){this.extMap=s.mixin(this.extMap,t)},_.prototype.handle=function(t,e){return(this.extMap[t.type]||this.extMap.default).call(this,t,e)},a.Loader=e.exports=_}),{"../platform/CCSys":165,"../platform/js":177,"../textures/CCTexture2D":196,"../utils/misc":206,"./pipeline":122,"./uuid-loader":126}],119:[(function(t,e,i){function n(t){return"string"==typeof(t.url||t)}function r(t,e){var i="object"==typeof t?t.url:t,n={queueId:e,id:i,url:i,rawUrl:void 0,urlParam:(function(t){if(t){var e=t.split("?");if(e&&e[0]&&e[1]){var i={};return e[1].split("&").forEach((function(t){var e=t.split("=");i[e[0]]=e[1]})),i}}})(i),type:"",error:null,content:null,complete:!1,states:{},deps:null};if("object"==typeof t&&(c.mixin(n,t),t.skips))for(var r=0;r<t.skips.length;r++){var s=t.skips[r];n.states[s]=u.COMPLETE}return n.rawUrl=n.url,i&&!n.type&&(n.type=a.extname(i).toLowerCase().substr(1)),n}function s(t,e,i){if(!t||!e)return!1;var n=!1;if(m.push(e.id),e.deps){var r,o,a=e.deps;for(r=0;r<a.length;r++){if((o=a[r]).id===t.id){n=!0;break}if(!(m.indexOf(o.id)>=0)&&(o.deps&&s(t,o,!0))){n=!0;break}}}return i||(m.length=0),n}var o=t("../platform/callbacks-invoker"),a=t("../utils/CCPath"),c=t("../platform/js"),h=0|998*Math.random(),l={},_=[],u={WORKING:1,COMPLETE:2,ERROR:3},d={},m=[],f=function(t,e,i,n){o.call(this),this._id=++h,l[this._id]=this,this._pipeline=t,this._errorUrls=[],this._appending=!1,this._ownerQueue=null,this.onProgress=i,this.onComplete=n,this.map={},this.completed={},this.totalCount=0,this.completedCount=0,this._pipeline?this.active=!0:this.active=!1,e&&(e.length>0?this.append(e):this.allComplete())};f.ItemState=new cc.Enum(u),f.create=function(t,e,i,n){void 0===i?"function"==typeof e&&(n=e,e=i=null):void 0===n&&("function"==typeof e?(n=i,i=e,e=null):(n=i,i=null));var r=_.pop();return r?(r._pipeline=t,r.onProgress=i,r.onComplete=n,l[r._id]=r,r._pipeline&&(r.active=!0),e&&r.append(e)):r=new f(t,e,i,n),r},f.getQueue=function(t){return t.queueId?l[t.queueId]:null},f.itemComplete=function(t){var e=l[t.queueId];e&&e.itemComplete(t.id)},f.initQueueDeps=function(t){var e=d[t._id];e?(e.completed.length=0,e.deps.length=0):e=d[t._id]={completed:[],deps:[]}},f.registerQueueDep=function(t,e){var i=t.queueId||t;if(!i)return!1;var n=d[i];if(n)-1===n.deps.indexOf(e)&&n.deps.push(e);else if(t.id)for(var r in d){var s=d[r];-1!==s.deps.indexOf(t.id)&&-1===s.deps.indexOf(e)&&s.deps.push(e)}},f.finishDep=function(t){for(var e in d){var i=d[e];-1!==i.deps.indexOf(t)&&-1===i.completed.indexOf(t)&&i.completed.push(t)}};var p=f.prototype;c.mixin(p,o.prototype),p.append=function(t,e){if(!this.active)return[];e&&!e.deps&&(e.deps=[]),this._appending=!0;var i,o,a,c=[];for(i=0;i<t.length;++i)if(!(o=t[i]).queueId||this.map[o.id]){if(n(o)){var h=(a=r(o,this._id)).id;this.map[h]||(this.map[h]=a,this.totalCount++,e&&e.deps.push(a),f.registerQueueDep(e||this._id,h),c.push(a))}}else{if(this.map[o.id]=o,e&&e.deps.push(o),o.complete||s(e,o)){this.totalCount++,this.itemComplete(o.id);continue}var _=this,u=l[o.queueId];u&&(this.totalCount++,f.registerQueueDep(e||this._id,o.id),u.addListener(o.id,(function(t){_.itemComplete(t.id)})))}return this._appending=!1,this.completedCount===this.totalCount?this.allComplete():this._pipeline.flowIn(c),c},p._childOnProgress=function(t){if(this.onProgress){var e=d[this._id];this.onProgress(e?e.completed.length:this.completedCount,e?e.deps.length:this.totalCount,t)}},p.allComplete=function(){var t=0===this._errorUrls.length?null:this._errorUrls;this.onComplete&&this.onComplete(t,this)},p.isCompleted=function(){return this.completedCount>=this.totalCount},p.isItemCompleted=function(t){return!!this.completed[t]},p.exists=function(t){return!!this.map[t]},p.getContent=function(t){var e=this.map[t],i=null;return e&&(e.content?i=e.content:e.alias&&(i=e.alias.content)),i},p.getError=function(t){var e=this.map[t],i=null;return e&&(e.error?i=e.error:e.alias&&(i=e.alias.error)),i},p.addListener=o.prototype.add,p.hasListener=o.prototype.has,p.removeListener=o.prototype.remove,p.removeAllListeners=o.prototype.removeAll,p.removeItem=function(t){var e=this.map[t];e&&this.completed[e.alias||t]&&(delete this.completed[t],delete this.map[t],e.alias&&(delete this.completed[e.alias.id],delete this.map[e.alias.id]),this.completedCount--,this.totalCount--)},p.itemComplete=function(t){var e=this.map[t];if(e){var i=this._errorUrls.indexOf(t);if(e.error&&-1===i?this._errorUrls.push(t):e.error||-1===i||this._errorUrls.splice(i,1),this.completed[t]=e,this.completedCount++,f.finishDep(e.id),this.onProgress){var n=d[this._id];this.onProgress(n?n.completed.length:this.completedCount,n?n.deps.length:this.totalCount,e)}this.invoke(t,e),this.removeAll(t),!this._appending&&this.completedCount>=this.totalCount&&this.allComplete()}},p.destroy=function(){this.active=!1,this._appending=!1,this._pipeline=null,this._ownerQueue=null,this._errorUrls.length=0,this.onProgress=null,this.onComplete=null,this.map={},this.completed={},this.totalCount=0,this.completedCount=0,o.call(this),l[this._id]=null,d[this._id]&&(d[this._id].completed.length=0,d[this._id].deps.length=0),-1===_.indexOf(this)&&_.length<10&&_.push(this)},cc.LoadingItems=e.exports=f}),{"../platform/callbacks-invoker":170,"../platform/js":177,"../utils/CCPath":199}],120:[(function(t,e,i){var n=t("./pipeline"),r=/(\.[^.\n\\/]*)$/,s=function(t,e,i){this.id="MD5Pipe",this.async=!1,this.pipeline=null,this.md5AssetsMap=t,this.libraryBase=e,this.rawAssetsBase=i};s.ID="MD5Pipe",s.prototype.handle=function(t){return t.url=this.transformURL(t.url),t},s.prototype.transformURL=function(t){var e=t.indexOf("?"),i=t;if(-1!==e&&(i=t.substr(0,e)),i.startsWith(this.libraryBase))i=i.slice(this.libraryBase.length);else{if(!i.startsWith(this.rawAssetsBase))return t;i=i.slice(this.rawAssetsBase.length)}var n=this.md5AssetsMap[i];if(n){var s=!1;t=t.replace(r,(function(t,e){return s=!0,"."+n+e})),s||(t=t+"."+n)}return t},n.MD5Pipe=e.exports=s}),{"./pipeline":122}],121:[(function(t,e,i){function n(t,e){return new Error("Can not retrieve "+t+" from packer "+e)}var r=t("./json-unpacker"),s=t("../utils/misc").pushToMap,o={},a={},c={},h=0,l=2,_=3;e.exports={initPacks:function(t){a=t;for(var e in t)for(var i=t[e],n=0;n<i.length;n++){var r=i[n],c=1===i.length;s(o,r,e,c)}},_loadNewPack:function(t,e,i){var r=this,s=cc.AssetLibrary.getLibUrlNoExt(e)+".json";cc.loader.load({url:s,ignoreMaxConcurrency:!0},(function(s,o){if(s)return cc.errorID(4916,t),i(s);var a=r._doLoadNewPack(t,e,o);a?i(null,a):i(n(t,e))}))},_doPreload:function(t,e){var i=c[t];i||(i=c[t]=new r),i.state!==_&&(i.read(a[t],e),i.state=_)},_doLoadNewPack:function(t,e,i){var n=c[e];return n.state!==_&&(n.read(a[e],i),n.state=_),n.retrieve(t)},_selectLoadedPack:function(t){for(var e=h,i="",n=0;n<t.length;n++){var r=t[n],s=c[r];if(s){var o=s.state;if(o===_)return r;o>e&&(e=o,i=r)}}return e!==h?i:t[0]},load:function(t,e){var i=t.uuid,s=o[i];if(s){Array.isArray(s)&&(s=this._selectLoadedPack(s));var a=c[s];if(a&&a.state===_){var h=a.retrieve(i);return h||n(i,s)}return a||(console.log("Create unpacker %s for %s",s,i),(a=c[s]=new r).state=l),this._loadNewPack(i,s,e),null}}}}),{"../utils/misc":206,"./json-unpacker":117}],122:[(function(t,e,i){function n(t,e){var i=t.id,r=e.states[i],o=t.next,a=t.pipeline;if(!e.error&&r!==s.WORKING&&r!==s.ERROR)if(r===s.COMPLETE)o?n(o,e):a.flowOut(e);else{e.states[i]=s.WORKING;var c=t.handle(e,(function(t,r){t?(e.error=t,e.states[i]=s.ERROR,a.flowOut(e)):(r&&(e.content=r),e.states[i]=s.COMPLETE,o?n(o,e):a.flowOut(e))}));c instanceof Error?(e.error=c,e.states[i]=s.ERROR,a.flowOut(e)):void 0!==c&&(null!==c&&(e.content=c),e.states[i]=s.COMPLETE,o?n(o,e):a.flowOut(e))}}t("../platform/js");var r=t("./loading-items"),s=r.ItemState,o=function(t){this._pipes=t,this._cache={};for(var e=0;e<t.length;++e){var i=t[e];i.handle&&i.id&&(i.pipeline=this,i.next=e<t.length-1?t[e+1]:null)}};o.ItemState=s;var a=o.prototype;a.insertPipe=function(t,e){if(!t.handle||!t.id||e>this._pipes.length)cc.warnID(4921);else if(this._pipes.indexOf(t)>0)cc.warnID(4922);else{t.pipeline=this;var i=null;e<this._pipes.length&&(i=this._pipes[e]);var n=null;e>0&&(n=this._pipes[e-1]),n&&(n.next=t),t.next=i,this._pipes.splice(e,0,t)}},a.insertPipeAfter=function(t,e){var i=this._pipes.indexOf(t);i<0||this.insertPipe(e,i+1)},a.appendPipe=function(t){t.handle&&t.id&&(t.pipeline=this,t.next=null,this._pipes.length>0&&(this._pipes[this._pipes.length-1].next=t),this._pipes.push(t))},a.flowIn=function(t){var e,i,r=this._pipes[0];if(r){for(e=0;e<t.length;e++)i=t[e],this._cache[i.id]=i;for(e=0;e<t.length;e++)n(r,i=t[e])}else for(e=0;e<t.length;e++)this.flowOut(t[e])},a.flowInDeps=function(t,e,i){return r.create(this,(function(t,e){i(t,e),e.destroy()})).append(e,t)},a.flowOut=function(t){t.error?delete this._cache[t.id]:this._cache[t.id]||(this._cache[t.id]=t),t.complete=!0,r.itemComplete(t)},a.copyItemStates=function(t,e){if(e instanceof Array)for(var i=0;i<e.length;++i)e[i].states=t.states;else e.states=t.states},a.isFlowing=function(){return!0},a.getItems=function(){return null},a.getItem=function(t){var e=this._cache[t];return e?(e.alias&&(e=e.alias),e):e},a.removeItem=function(t){var e=this._cache[t];return e&&e.complete&&delete this._cache[t],e},a.clear=function(){for(var t in this._cache){var e=this._cache[t];delete this._cache[t],e.complete||(e.error=new Error("Canceled manually"),this.flowOut(e))}},cc.Pipeline=e.exports=o}),{"../platform/js":177,"./loading-items":119}],123:[(function(t,e,i){}),{"../platform/js":177}],124:[(function(t,e,i){t("../platform/CCSys");var n=t("./utils").urlAppendTimestamp;e.exports=function(t,e){var i=t.url;i=n(i);var r=cc.loader.getXMLHttpRequest(),s="Load "+i+" failed!",o=window.navigator;r.open("GET",i,!0),/msie/i.test(o.userAgent)&&!/opera/i.test(o.userAgent)?(r.setRequestHeader("Accept-Charset","utf-8"),r.onreadystatechange=function(){4===r.readyState&&(200===r.status||0===r.status?e(null,r.responseText):e({status:r.status,errorMessage:s}))}):(r.overrideMimeType&&r.overrideMimeType("text/plain; charset=utf-8"),r.onload=function(){4===r.readyState&&(200===r.status||0===r.status?e(null,r.responseText):e({status:r.status,errorMessage:s}))},r.onerror=function(){e({status:r.status,errorMessage:s})}),r.send(null)}}),{"../platform/CCSys":165,"./utils":125}],125:[(function(t,e,i){var n=/\?/;e.exports={urlAppendTimestamp:function(t){return cc.game.config.noCache&&"string"==typeof t&&(n.test(t)?t+="&_t="+(new Date-0):t+="?_t="+(new Date-0)),t}}}),{}],126:[(function(t,e,i){function n(t){return t&&(t[0]&&"cc.Scene"===t[0].__type__||t[1]&&"cc.Scene"===t[1].__type__||t[0]&&"cc.Prefab"===t[0].__type__)}function r(t,e){var i;if("string"==typeof t.content)try{i=JSON.parse(t.content)}catch(e){return new Error("Uuid Loader: Parse asset ["+t.id+"] failed : "+e.stack)}else{if("object"!=typeof t.content)return new Error("JSON Loader: Input item doesn't contain string content");i=t.content}var r,a=n(i);r=a?cc._MissingScript.safeFindClass:function(t){var e=s._getClassById(t);return e||(cc.warnID(4903,t),Object)};var c,h=cc.deserialize.Details.pool.get();try{c=cc.deserialize(i,h,{classFinder:r,target:t.existingAsset,customEnv:t})}catch(e){cc.deserialize.Details.pool.put(h);var l=e.stack;return new Error("Uuid Loader: Deserialize asset ["+t.id+"] failed : "+l)}c._uuid=t.uuid;var _=(function(t,e,i){var n=e.deferredLoadRaw;return n?t instanceof cc.Asset&&t.constructor.preventDeferredLoadDependents&&(n=!1):i&&(t instanceof cc.SceneAsset||t instanceof cc.Prefab)&&(n=t.asyncLoadAssets),n})(c,t,a);(function(t,e,i,n,r,s){var a,c,h,l,_,u=n.uuidList,d=e.dependKeys=[];if(r)for(a=[],c=[],h=[],l=0;l<u.length;l++){_=u[l];var m=n.uuidObjList[l],f=n.uuidPropList[l],p=cc.AssetLibrary._getAssetInfoInRuntime(_);if(p.raw){var g=p.url;m[f]=g,d.push(g)}else a.push(m),c.push(f),h.push({type:"uuid",uuid:_,deferredLoadRaw:!0})}else for(a=n.uuidObjList,c=n.uuidPropList,h=new Array(u.length),l=0;l<u.length;l++)_=u[l],h[l]={type:"uuid",uuid:_};if(n.rawProp&&(a.push(i),c.push(n.rawProp),h.push(e.url)),i._preloadRawFiles){var v=s;s=function(){i._preloadRawFiles((function(t){v(t||null,i)}))}}if(0===h.length)return cc.deserialize.Details.pool.put(n),s(null,i);e.content=i,t.flowInDeps(e,h,(function(t,e){var r;for(var l in e.map)(r=e.map[l]).uuid&&r.content&&(r.content._uuid=r.uuid);for(var _=0;_<h.length;_++){var u=h[_].uuid,m=h[_].url,f=a[_],p=c[_];if(r=e.map[m]){var g={obj:f,prop:p};function v(t){var e=t.isRawAsset?t.rawUrl:t.content;this.obj[this.prop]=e,t.uuid!==i._uuid&&d.indexOf(t.id)<0&&d.push(t.id)}if(r.complete||r.content)r.error?cc._throw(r.error):v.call(g,r);else{var y=o.getQueue(r),x=y._callbackTable[u];x?x.unshift(v,g):y.addListener(u,v,g)}}}cc.deserialize.Details.pool.put(n),s(null,i)}))})(this.pipeline,t,c,h,_,e)}var s=t("../platform/js");t("../platform/deserialize");var o=t("./loading-items");e.exports=r,r.isSceneObj=n}),{"../platform/deserialize":172,"../platform/js":177,"./loading-items":119}],127:[(function(t,e,i){function n(t,e,i){e?t._removeComponent(e):a.array.removeAt(t._components,i)}function r(){this._activatingStack=[]}var s=t("./component-scheduler"),o=t("./platform/CCObject").Flags,a=t("./platform/js"),c=o.IsPreloadStarted,h=o.IsOnLoadStarted,l=o.IsOnLoadCalled,_=o.Deactivating,u=function(t){t.__preload()},d=function(t){t.onLoad(),t._objFlags|=l},m=cc.Class({extends:s.LifeCycleInvoker,add:function(t){this._zero.array.push(t)},remove:function(t){this._zero.fastRemove(t)},cancelInactive:function(t){s.LifeCycleInvoker.stableRemoveInactive(this._zero,t)},invoke:function(){this._invoke(this._zero),this._zero.array.length=0}}),f=s.createInvokeImpl(u),p=s.createInvokeImpl(d),g=new a.Pool(4);g.get=function(){var t=this._get()||{preload:new m(f),onLoad:new s.OneOffInvoker(p),onEnable:new s.OneOffInvoker(s.invokeOnEnable)};t.preload._zero.i=-1;var e=t.onLoad;return e._zero.i=-1,e._neg.i=-1,e._pos.i=-1,e=t.onEnable,e._zero.i=-1,e._neg.i=-1,e._pos.i=-1,t};var v=cc.Class({ctor:r,reset:r,_activateNodeRecursively:function(t,e,i,r){if(t._objFlags&_)cc.errorID(3816,t.name);else{t._activeInHierarchy=!0;for(var s=t._components.length,o=0;o<s;++o){var a=t._components[o];a instanceof cc.Component?this.activateComp(a,e,i,r):(n(t,a,o),--o,--s)}for(var c=0,h=t._children.length;c<h;++c){var l=t._children[c];l._active&&this._activateNodeRecursively(l,e,i,r)}t._onPostActivated(!0)}},_deactivateNodeRecursively:function(t){t._objFlags|=_,t._activeInHierarchy=!1;for(var e=t._components.length,i=0;i<e;++i){var n=t._components[i];if(n._enabled&&(cc.director._compScheduler.disableComp(n),t._activeInHierarchy))return void(t._objFlags&=~_)}for(var r=0,s=t._children.length;r<s;++r){var o=t._children[r];if(o._activeInHierarchy&&(this._deactivateNodeRecursively(o),t._activeInHierarchy))return void(t._objFlags&=~_)}t._onPostActivated(!1),t._objFlags&=~_},activateNode:function(t,e){if(e){var i=g.get();this._activatingStack.push(i),this._activateNodeRecursively(t,i.preload,i.onLoad,i.onEnable),i.preload.invoke(),i.onLoad.invoke(),i.onEnable.invoke(),this._activatingStack.pop(),g.put(i)}else{this._deactivateNodeRecursively(t);for(var n=this._activatingStack,r=0;r<n.length;r++){var s=n[r];s.preload.cancelInactive(c),s.onLoad.cancelInactive(h),s.onEnable.cancelInactive()}}t.emit("active-in-hierarchy-changed",t)},activateComp:function(t,e,i,n){if(t._objFlags&c||(t._objFlags|=c,"function"==typeof t.__preload&&(e?e.add(t):t.__preload())),t._objFlags&h||(t._objFlags|=h,t.onLoad?i?i.add(t):(t.onLoad(),t._objFlags|=l):t._objFlags|=l),t._enabled){if(!t.node._activeInHierarchy)return;cc.director._compScheduler.enableComp(t,n)}},destroyComp:function(t){cc.director._compScheduler.disableComp(t),t.onDestroy&&t._objFlags&l&&t.onDestroy()},resetComp:!1});e.exports=v}),{"./component-scheduler":66,"./platform/CCObject":162,"./platform/js":177,"./utils/misc":206}],128:[(function(t,e,i){function n(){this.localPoint=cc.v2(),this.normalImpulse=0,this.tangentImpulse=0}function r(){}var s,o=t("./CCPhysicsTypes").PTM_RATIO,a=t("./CCPhysicsTypes").ContactType,c=[],h=[cc.v2(),cc.v2()];s=new b2.WorldManifold;var l={points:[],separations:[],normal:cc.v2()},_=[new n,new n];new b2.Manifold;var u={type:0,localPoint:cc.v2(),localNormal:cc.v2(),points:[]},d={normalImpulses:[],tangentImpulses:[]};r.prototype.init=function(t){this.colliderA=t.GetFixtureA().collider,this.colliderB=t.GetFixtureB().collider,this.disabled=!1,this.disabledOnce=!1,this._impulse=null,this._inverted=!1,this._b2contact=t,t._contact=this},r.prototype.reset=function(){this.colliderA=null,this.colliderB=null,this.disabled=!1,this._impulse=null,this._b2contact._contact=null,this._b2contact=null},r.prototype.getWorldManifold=function(){var t=l.points,e=l.separations,i=l.normal;this._b2contact.GetWorldManifold(s);var n=s.points,r=s.separations,a=this._b2contact.GetManifold().pointCount;t.length=e.length=a;for(var c=0;c<a;c++){var _=h[c];_.x=n[c].x*o,_.y=n[c].y*o,t[c]=_,e[c]=r[c]*o}return i.x=s.normal.x,i.y=s.normal.y,this._inverted&&(i.x*=-1,i.y*=-1),l},r.prototype.getManifold=function(){for(var t=u.points,e=u.localNormal,i=u.localPoint,n=this._b2contact.GetManifold(),r=n.points,s=t.length=n.pointCount,a=0;a<s;a++){var c=_[a],h=r[a];c.localPoint.x=h.localPoint.x*o,c.localPoint.Y=h.localPoint.Y*o,c.normalImpulse=h.normalImpulse*o,c.tangentImpulse=h.tangentImpulse,t[a]=c}return i.x=n.localPoint.x*o,i.y=n.localPoint.y*o,e.x=n.localNormal.x,e.y=n.localNormal.y,u.type=n.type,this._inverted&&(e.x*=-1,e.y*=-1),u},r.prototype.getImpulse=function(){var t=this._impulse;if(!t)return null;var e,i=d.normalImpulses,n=d.tangentImpulses;e=t.count;for(var r=0;r<e;r++)i[r]=t.normalImpulses[r]*o,n[r]=t.tangentImpulses[r];return n.length=i.length=e,d},r.prototype.emit=function(t){var e;switch(t){case a.BEGIN_CONTACT:e="onBeginContact";break;case a.END_CONTACT:e="onEndContact";break;case a.PRE_SOLVE:e="onPreSolve";break;case a.POST_SOLVE:e="onPostSolve"}var i,n,r,s,o=this.colliderA,c=this.colliderB,h=o.body,l=c.body;if(h.enabledContactListener)for(i=h.node._components,this._inverted=!1,n=0,r=i.length;n<r;n++)(s=i[n])[e]&&s[e](this,o,c);if(l.enabledContactListener)for(i=l.node._components,this._inverted=!0,n=0,r=i.length;n<r;n++)(s=i[n])[e]&&s[e](this,c,o);(this.disabled||this.disabledOnce)&&(this.setEnabled(!1),this.disabledOnce=!1)},r.get=function(t){var e;return(e=0===c.length?new cc.PhysicsContact:c.pop()).init(t),e},r.put=function(t){var e=t._contact;e&&(c.push(e),e.reset())};var m=r.prototype;m.setEnabled=function(t){this._b2contact.SetEnabled(t)},m.isTouching=function(){return this._b2contact.IsTouching()},m.setTangentSpeed=function(t){this._b2contact.SetTangentSpeed(t/o)},m.getTangentSpeed=function(){return this._b2contact.GetTangentSpeed()*o},m.setFriction=function(t){this._b2contact.SetFriction(t)},m.getFriction=function(){return this._b2contact.GetFriction()},m.resetFriction=function(){return this._b2contact.ResetFriction()},m.setRestitution=function(t){this._b2contact.SetRestitution(t)},m.getRestitution=function(){return this._b2contact.GetRestitution()},m.resetRestitution=function(){return this._b2contact.ResetRestitution()},r.ContactType=a,cc.PhysicsContact=e.exports=r}),{"./CCPhysicsTypes":130}],129:[(function(t,e,i){var n=t("./CCPhysicsTypes").ContactType,r=t("./CCPhysicsTypes").BodyType,s=t("./CCPhysicsTypes").RayCastType,o=t("./CCPhysicsTypes").PTM_RATIO,a=(t("./CCPhysicsTypes").ANGLE_TO_PHYSICS_ANGLE,t("./CCPhysicsTypes").PHYSICS_ANGLE_TO_ANGLE,new b2.AABB),c=new b2.Vec2,h=new b2.Vec2,l=cc.Class({mixins:[cc.EventTarget],statics:{DrawBits:b2.Draw,PTM_RATIO:o,VELOCITY_ITERATIONS:10,POSITION_ITERATIONS:10,FIXED_TIME_STEP:1/60,MAX_ACCUMULATOR:.2},ctor:function(){this.__instanceId=cc.ClassManager.getNewInstanceId(),this._debugDrawFlags=0,this._debugDrawer=null,this._world=null,this._bodies=[],this._contactMap={},this._contactID=0,this._delayEvents=[],this._accumulator=0,this.enabledAccumulator=!1},pushDelayEvent:function(t,e,i){this._steping?this._delayEvents.push({target:t,func:e,args:i}):t[e].apply(t,i)},update:function(t){var e=this._world;if(e&&this.enabled){this.emit("before-step"),this._steping=!0;var i=l.VELOCITY_ITERATIONS,n=l.POSITION_ITERATIONS;if(this.enabledAccumulator){this._accumulator+=t;var r=l.FIXED_TIME_STEP,s=l.MAX_ACCUMULATOR;for(this._accumulator>s&&(this._accumulator=s);this._accumulator>r;)e.Step(r,i,n),this._accumulator-=r}else{var o=1/cc.game.config.frameRate;e.Step(o,i,n)}e.DrawDebugData(),this._steping=!1;for(var a=this._delayEvents,c=0,h=a.length;c<h;c++){var _=a[c];_.target[_.func].apply(_.target,_.args)}a.length=0,this._syncNode()}},testPoint:function(t){var e=c.x=t.x/o,i=c.y=t.y/o,n=.2/o;a.lowerBound.x=e-n,a.lowerBound.y=i-n,a.upperBound.x=e+n,a.upperBound.y=i+n;var r=this._aabbQueryCallback;r.init(c),this._world.QueryAABB(r,a);var s=r.getFixture();return s?s.collider:null},testAABB:function(t){a.lowerBound.x=t.xMin/o,a.lowerBound.y=t.yMin/o,a.upperBound.x=t.xMax/o,a.upperBound.y=t.yMax/o;var e=this._aabbQueryCallback;e.init(),this._world.QueryAABB(e,a);return e.getFixtures().map((function(t){return t.collider}))},rayCast:function(t,e,i){if(t.equals(e))return[];i=i||s.Closest,c.x=t.x/o,c.y=t.y/o,h.x=e.x/o,h.y=e.y/o;var n=this._raycastQueryCallback;n.init(i),this._world.RayCast(n,c,h);var r=n.getFixtures();if(r.length>0){for(var a=n.getPoints(),l=n.getNormals(),_=n.getFractions(),u=[],d=0,m=r.length;d<m;d++){var f=r[d],p=f.collider;if(i===s.AllClosest){var g=u.find((function(t){return t.collider===p}));if(g){_[d]<g.fraction&&(g.fixtureIndex=p._getFixtureIndex(f),g.point.x=a[d].x*o,g.point.y=a[d].y*o,g.normal.x=l[d].x,g.normal.y=l[d].y,g.fraction=_[d]);continue}}u.push({collider:p,fixtureIndex:p._getFixtureIndex(f),point:cc.v2(a[d].x*o,a[d].y*o),normal:cc.v2(l[d]),fraction:_[d]})}return u}return[]},syncPosition:function(){for(var t=this._bodies,e=0;e<t.length;e++)t[e].syncPosition()},syncRotation:function(){for(var t=this._bodies,e=0;e<t.length;e++)t[e].syncRotation()},attachDebugDrawToCamera:function(t){this._debugDrawer&&t.addTarget(this._debugDrawer.getDrawer())},detachDebugDrawFromCamera:function(t){this._debugDrawer&&t.removeTarget(this._debugDrawer.getDrawer())},_registerContactFixture:function(t){this._contactListener.registerContactFixture(t)},_unregisterContactFixture:function(t){this._contactListener.unregisterContactFixture(t)},_addBody:function(t,e){var i=this._world,n=t.node;i&&n&&(t._b2Body=i.CreateBody(e),t._b2Body.body=t,this._utils.addB2Body(t._b2Body),this._bodies.push(t))},_removeBody:function(t){var e=this._world;if(e){0,t._b2Body.body=null,this._utils.removeB2Body(t._b2Body),e.DestroyBody(t._b2Body),t._b2Body=null;var i=this._bodies.indexOf(t);-1!==i&&this._bodies.splice(i,1)}},_initCallback:function(){if(this._world){if(!this._contactListener){var t=new cc.PhysicsContactListener;t.setBeginContact(this._onBeginContact),t.setEndContact(this._onEndContact),t.setPreSolve(this._onPreSolve),t.setPostSolve(this._onPostSolve),this._world.SetContactListener(t),this._contactListener=t,this._aabbQueryCallback=new cc.PhysicsAABBQueryCallback,this._raycastQueryCallback=new cc.PhysicsRayCastCallback}}else cc.warn("Please init PhysicsManager first")},_init:function(){this.enabled=!0,this.debugDrawFlags=b2.Draw.e_shapeBit},_getWorld:function(){return this._world},_syncNode:function(){this._utils.syncNode();for(var t=this._bodies,e=0,i=t.length;e<i;e++){var n=t[e];n.type===r.Animated&&n.resetVelocity()}},_onSceneLaunched:function(){this._debugDrawer.AddDrawerToNode(cc.director.getScene()._sgNode)},_onBeginContact:function(t){cc.PhysicsContact.get(t).emit(n.BEGIN_CONTACT)},_onEndContact:function(t){var e=t._contact;e&&(e.emit(n.END_CONTACT),cc.PhysicsContact.put(t))},_onPreSolve:function(t){var e=t._contact;e&&e.emit(n.PRE_SOLVE)},_onPostSolve:function(t,e){var i=t._contact;i&&(i._impulse=e,i.emit(n.POST_SOLVE),i._impulse=null)}});cc.js.getset(l.prototype,"enabled",(function(){return this._enabled}),(function(t){if(t&&!this._world){var e=new b2.World(new b2.Vec2(0,-10));e.SetAllowSleeping(!0),this._world=e,this._utils=new cc.PhysicsUtils,this._initCallback()}this._enabled=t})),cc.js.getset(l.prototype,"debugDrawFlags",(function(){return this._debugDrawFlags}),(function(t){if(t&&!this._debugDrawFlags){this._debugDrawer||(this._debugDrawer=new cc.PhysicsDebugDraw(o),this._world.SetDebugDraw(this._debugDrawer));cc.director.getScene()&&this._debugDrawer.AddDrawerToNode(cc.director.getScene()._sgNode),cc.director.on(cc.Director.EVENT_AFTER_SCENE_LAUNCH,this._onSceneLaunched,this)}else!t&&this._debugDrawFlags&&cc.director.off(cc.Director.EVENT_AFTER_SCENE_LAUNCH,this._onSceneLaunched,this);this._debugDrawFlags=t,this._debugDrawer&&this._debugDrawer.SetFlags(t)})),cc.js.getset(l.prototype,"gravity",(function(){if(this._world){var t=this._world.GetGravity();return cc.v2(t.x*o,t.y*o)}return cc.v2()}),(function(t){this._world&&this._world.SetGravity(new b2.Vec2(t.x/o,t.y/o))})),cc.PhysicsManager=e.exports=l}),{"./CCPhysicsTypes":130}],130:[(function(t,e,i){var n=cc.Enum({Static:0,Kinematic:1,Dynamic:2,Animated:3});cc.RigidBodyType=n;var r=cc.Enum({Closest:0,Any:1,AllClosest:2,All:3});cc.RayCastType=r,e.exports={BodyType:n,ContactType:{BEGIN_CONTACT:"begin-contact",END_CONTACT:"end-contact",PRE_SOLVE:"pre-solve",POST_SOLVE:"post-solve"},RayCastType:r,PTM_RATIO:32,ANGLE_TO_PHYSICS_ANGLE:-Math.PI/180,PHYSICS_ANGLE_TO_ANGLE:-180/Math.PI}}),{}],131:[(function(t,e,i){function n(t,e){var i=e.length;return e[t<0?i- -t%i:t%i]}function r(t,e,i){for(var r=[];e<t;)e+=i.length;for(;t<=e;++t)r.push(n(t,i));return r}function s(t){u(t);for(var e,i,d,f,p,g,v=[],y=cc.v2(),x=cc.v2(),C=0,A=0,T=0;T<t.length;++T)if(o(T,t)){i=d=1e8;for(var b=0;b<t.length;++b)c(n(T-1,t),n(T,t),n(b,t))&&l(n(T-1,t),n(T,t),n(b-1,t))&&(f=m(n(T-1,t),n(T,t),n(b,t),n(b-1,t)),a(n(T+1,t),n(T,t),f)&&(e=_(n(T,t),f))<i&&(i=e,y=f,C=b)),c(n(T+1,t),n(T,t),n(b+1,t))&&l(n(T+1,t),n(T,t),n(b,t))&&(f=m(n(T+1,t),n(T,t),n(b,t),n(b+1,t)),c(n(T-1,t),n(T,t),f)&&(e=_(n(T,t),f))<d&&(d=e,A=b,x=f));if(C==(A+1)%t.length){var w=y.add(x).div(2);(p=r(T,A,t)).push(w),(g=r(C,T,t)).push(w)}else{for(var S=0,E=C;A<C;)A+=t.length;for(b=C;b<=A;++b)if(function(t,e,i){if(o(t,i)){if(h(n(t,i),n(t-1,i),n(e,i))&&l(n(t,i),n(t+1,i),n(e,i)))return!1}else if(l(n(t,i),n(t+1,i),n(e,i))||h(n(t,i),n(t-1,i),n(e,i)))return!1;if(o(e,i)){if(h(n(e,i),n(e-1,i),n(t,i))&&l(n(e,i),n(e+1,i),n(t,i)))return!1}else if(l(n(e,i),n(e+1,i),n(t,i))||h(n(e,i),n(e-1,i),n(t,i)))return!1;for(var r=0;r<i.length;++r)if((r+1)%i.length!=t&&r!=t&&(r+1)%i.length!=e&&r!=e){var s=cc.v2();if(function(t,e,i,n,r){if(t==i||t==n||e==i||e==n)return!1;var s=t.x,o=t.y,a=e.x,c=e.y,h=i.x,l=i.y,_=n.x,u=n.y;if(Math.max(s,a)<Math.min(h,_)||Math.max(h,_)<Math.min(s,a))return!1;if(Math.max(o,c)<Math.min(l,u)||Math.max(l,u)<Math.min(o,c))return!1;var d=(_-h)*(o-l)-(u-l)*(s-h),m=(a-s)*(o-l)-(c-o)*(s-h),f=(u-l)*(a-s)-(_-h)*(c-o);if(Math.abs(f)<1e-6)return!1;if(d/=f,m/=f,0<d&&d<1&&0<m&&m<1)return r.x=s+d*(a-s),r.y=o+d*(c-o),!0;return!1}(n(t,i),n(e,i),n(r,i),n(r+1,i),s))return!1}return!0}(T,b,t)){var I=1/(_(n(T,t),n(b,t))+1);o(b,t)?l(n(b-1,t),n(b,t),n(T,t))&&h(n(b+1,t),n(b,t),n(T,t))?I+=3:I+=2:I+=1,I>S&&(E=b,S=I)}p=r(T,E,t),g=r(E,T,t)}return v=v.concat(s(p)),v=v.concat(s(g))}v.push(t);for(T=v.length-1;T>=0;T--)0==v[T].length&&v.splice(T,0);return v}function o(t,e){return a(t,e)}function a(t,e,i){if(void 0===i){var r=t,s=e;t=n(r-1,s),e=n(r,s),i=n(r+1,s)}return f(t,e,i)<0}function c(t,e,i){return f(t,e,i)>0}function h(t,e,i){return f(t,e,i)>=0}function l(t,e,i){return f(t,e,i)<=0}function _(t,e){var i=e.x-t.x,n=e.y-t.y;return i*i+n*n}function u(t){d(t)||t.reverse()}function d(t){return t.length<3||(function(t){var e,i=0;for(e=0;e<t.length;e++){var n=(e+1)%t.length;i+=t[e].x*t[n].y,i-=t[e].y*t[n].x}return i/=2})(t)>0}function m(t,e,i,n){var r=cc.v2(),s=e.y-t.y,o=t.x-e.x,a=s*t.x+o*t.y,c=n.y-i.y,h=i.x-n.x,l=c*i.x+h*i.y,_=s*h-c*o;return (function(t,e){return Math.abs(t-e)<=1e-6})(_,0)||(r.x=(h*a-o*l)/_,r.y=(s*l-c*a)/_),r}function f(t,e,i){return t.x*(e.y-i.y)+e.x*(i.y-t.y)+i.x*(t.y-e.y)}e.exports={ConvexPartition:s,ForceCounterClockWise:u,IsCounterClockWise:d}}),{}],132:[(function(t,e,i){var n=t("./CCPhysicsTypes").PTM_RATIO,r=t("./CCPhysicsTypes").ANGLE_TO_PHYSICS_ANGLE,s=t("./CCPhysicsTypes").PHYSICS_ANGLE_TO_ANGLE,o=t("./utils").getWorldRotation,a=t("./CCPhysicsTypes").BodyType,c=new b2.Vec2,h=new b2.Vec2,l=cc.Vec2.ZERO,_=cc.Class({name:"cc.RigidBody",extends:cc.Component,editor:!1,properties:{_type:a.Dynamic,_allowSleep:!0,_gravityScale:1,_linearDamping:0,_angularDamping:0,_linearVelocity:cc.v2(0,0),_angularVelocity:0,_fixedRotation:!1,enabled:{get:function(){return this._enabled},set:function(){cc.warnID("8200")},visible:!1,override:!0},enabledContactListener:{default:!1,tooltip:!1},bullet:{default:!1,tooltip:!1},type:{type:a,tooltip:!1,get:function(){return this._type},set:function(t){this._type=t,this._b2Body&&(t===a.Animated?this._b2Body.SetType(a.Kinematic):this._b2Body.SetType(t))}},allowSleep:{tooltip:!1,get:function(){return this._b2Body?this._b2Body.IsSleepingAllowed():this._allowSleep},set:function(t){this._allowSleep=t,this._b2Body&&this._b2Body.SetSleepingAllowed(t)}},gravityScale:{tooltip:!1,get:function(){return this._gravityScale},set:function(t){this._gravityScale=t,this._b2Body&&this._b2Body.SetGravityScale(t)}},linearDamping:{tooltip:!1,get:function(){return this._linearDamping},set:function(t){this._linearDamping=t,this._b2Body&&this._b2Body.SetLinearDamping(this._linearDamping)}},angularDamping:{tooltip:!1,get:function(){return this._angularDamping},set:function(t){this._angularDamping=t,this._b2Body&&this._b2Body.SetAngularDamping(t)}},linearVelocity:{tooltip:!1,type:cc.Vec2,get:function(){var t=this._linearVelocity;if(this._b2Body){var e=this._b2Body.GetLinearVelocity();t.x=e.x*n,t.y=e.y*n}return t},set:function(t){this._linearVelocity=t;var e=this._b2Body;if(e){var i=e.m_linearVelocity;i.Set(t.x/n,t.y/n),e.SetLinearVelocity(i)}}},angularVelocity:{tooltip:!1,get:function(){return this._b2Body?this._b2Body.GetAngularVelocity()*s:this._angularVelocity},set:function(t){this._angularVelocity=t,this._b2Body&&this._b2Body.SetAngularVelocity(t*r)}},fixedRotation:{tooltip:!1,get:function(){return this._fixedRotation},set:function(t){this._fixedRotation=t,this._b2Body&&this._b2Body.SetFixedRotation(t)}},awake:{tooltip:!1,get:function(){return!!this._b2Body&&this._b2Body.IsAwake()},set:function(t){this._b2Body&&this._b2Body.SetAwake(t)}},active:{visible:!1,get:function(){return!!this._b2Body&&this._b2Body.IsActive()},set:function(t){this._b2Body&&this._b2Body.SetActive(t)}}},getLocalPoint:function(t,e){if(e=e||cc.v2(),this._b2Body){c.Set(t.x/n,t.y/n);var i=this._b2Body.GetLocalPoint(c);e.x=i.x*n,e.y=i.y*n}return e},getWorldPoint:function(t,e){if(e=e||cc.v2(),this._b2Body){c.Set(t.x/n,t.y/n);var i=this._b2Body.GetWorldPoint(c);e.x=i.x*n,e.y=i.y*n}return e},getWorldVector:function(t,e){if(e=e||cc.v2(),this._b2Body){c.Set(t.x/n,t.y/n);var i=this._b2Body.GetWorldVector(c);e.x=i.x*n,e.y=i.y*n}return e},getLocalVector:function(t,e){if(e=e||cc.v2(),this._b2Body){c.Set(t.x/n,t.y/n);var i=this._b2Body.GetLocalVector(c);e.x=i.x*n,e.y=i.y*n}return e},getWorldPosition:function(t){if(t=t||cc.v2(),this._b2Body){var e=this._b2Body.GetPosition();t.x=e.x*n,t.y=e.y*n}return t},getWorldRotation:function(){return this._b2Body?this._b2Body.GetAngle()*s:0},getLocalCenter:function(t){if(t=t||cc.v2(),this._b2Body){var e=this._b2Body.GetLocalCenter();t.x=e.x*n,t.y=e.y*n}return t},getWorldCenter:function(t){if(t=t||cc.v2(),this._b2Body){var e=this._b2Body.GetWorldCenter();t.x=e.x*n,t.y=e.y*n}return t},getLinearVelocityFromWorldPoint:function(t,e){if(e=e||cc.v2(),this._b2Body){c.Set(t.x/n,t.y/n);var i=this._b2Body.GetLinearVelocityFromWorldPoint(c);e.x=i.x*n,e.y=i.y*n}return e},getMass:function(){return this._b2Body?this._b2Body.GetMass():0},getInertia:function(){return this._b2Body?this._b2Body.GetInertia()*n*n:0},getJointList:function(){if(!this._b2Body)return[];var t=[],e=this._b2Body.GetJointList();if(!e)return[];t.push(e.joint._joint);for(var i=e.prev;i;)t.push(i.joint._joint),i=i.prev;for(var n=e.next;n;)t.push(n.joint._joint),n=n.next;return t},applyForce:function(t,e,i){this._b2Body&&(c.Set(t.x/n,t.y/n),h.Set(e.x/n,e.y/n),this._b2Body.ApplyForce(c,h,i))},applyForceToCenter:function(t,e){this._b2Body&&(c.Set(t.x/n,t.y/n),this._b2Body.ApplyForceToCenter(c,e))},applyTorque:function(t,e){this._b2Body&&this._b2Body.ApplyTorque(t/n,e)},applyLinearImpulse:function(t,e,i){this._b2Body&&(c.Set(t.x/n,t.y/n),h.Set(e.x/n,e.y/n),this._b2Body.ApplyLinearImpulse(c,h,i))},applyAngularImpulse:function(t,e){this._b2Body&&this._b2Body.ApplyAngularImpulse(t/n/n,e)},syncPosition:function(t){var e=this._b2Body;if(e){var i,r=this.node.convertToWorldSpaceAR(l);if(i=this.type===a.Animated?e.GetLinearVelocity():e.GetPosition(),i.x=r.x/n,i.y=r.y/n,this.type===a.Animated&&t){var s=e.GetPosition(),o=cc.game.config.frameRate;i.x=(i.x-s.x)*o,i.y=(i.y-s.y)*o,e.SetAwake(!0),e.SetLinearVelocity(i)}else e.SetTransform(i,e.GetAngle())}},syncRotation:function(t){var e=this._b2Body;if(e){var i=r*o(this.node);if(this.type===a.Animated&&t){var n=e.GetAngle(),s=cc.game.config.frameRate;e.SetAwake(!0),e.SetAngularVelocity((i-n)*s)}else e.SetTransform(e.GetPosition(),i)}},resetVelocity:function(){var t=this._b2Body;if(t){var e=t.m_linearVelocity;e.Set(0,0),t.SetLinearVelocity(e),t.SetAngularVelocity(0)}},onEnable:function(){this._init()},onDisable:function(){this._destroy()},_registerNodeEvents:function(){var t=this.node;t.on("position-changed",this._onNodePositionChanged,this),t.on("rotation-changed",this._onNodeRotationChanged,this),t.on("scale-changed",this._onNodeScaleChanged,this)},_unregisterNodeEvents:function(){var t=this.node;t.off("position-changed",this._onNodePositionChanged,this),t.off("rotation-changed",this._onNodeRotationChanged,this),t.off("scale-changed",this._onNodeScaleChanged,this)},_onNodePositionChanged:function(){this.syncPosition(!0)},_onNodeRotationChanged:function(t){this.syncRotation(!0)},_onNodeScaleChanged:function(t){if(this._b2Body)for(var e=this.getComponents(cc.PhysicsCollider),i=0;i<e.length;i++)e[i].apply()},_init:function(){cc.director.getPhysicsManager().pushDelayEvent(this,"__init",[])},_destroy:function(){cc.director.getPhysicsManager().pushDelayEvent(this,"__destroy",[])},__init:function(){if(!this._inited){this._registerNodeEvents();var t=new b2.BodyDef;this.type===a.Animated?t.type=a.Kinematic:t.type=this.type,t.allowSleep=this.allowSleep,t.gravityScale=this.gravityScale,t.linearDamping=this.linearDamping,t.angularDamping=this.angularDamping;var e=this.linearVelocity;t.linearVelocity=new b2.Vec2(e.x/n,e.y/n),t.angularVelocity=this.angularVelocity*r,t.fixedRotation=this.fixedRotation,t.bullet=this.bullet;var i=this.node,s=i.convertToWorldSpaceAR(l);t.position=new b2.Vec2(s.x/n,s.y/n),t.angle=-Math.PI/180*o(i),cc.director.getPhysicsManager()._addBody(this,t),this._inited=!0}},__destroy:function(){this._inited&&(cc.director.getPhysicsManager()._removeBody(this),this._unregisterNodeEvents(),this._inited=!1)},_getBody:function(){return this._b2Body}});cc.RigidBody=e.exports=_}),{"./CCPhysicsTypes":130,"./utils":153}],133:[(function(t,e,i){var n=t("../CCPhysicsTypes").PTM_RATIO,r=cc.Class({name:"cc.PhysicsBoxCollider",extends:cc.PhysicsCollider,mixins:[cc.Collider.Box],editor:{menu:!1,requireComponent:cc.RigidBody},_createShape:function(t){var e=Math.abs(t.x),i=Math.abs(t.y),r=this.size.width/2/n*e,s=this.size.height/2/n*i,o=this.offset.x/n*e,a=this.offset.y/n*i,c=new b2.PolygonShape;return c.SetAsBox(r,s,new b2.Vec2(o,a),0),c}});cc.PhysicsBoxCollider=e.exports=r}),{"../CCPhysicsTypes":130}],134:[(function(t,e,i){var n=t("../CCPhysicsTypes").PTM_RATIO,r=cc.Class({name:"cc.PhysicsChainCollider",extends:cc.PhysicsCollider,editor:{menu:!1,inspector:!1,requireComponent:cc.RigidBody},properties:{loop:!1,points:{default:function(){return[cc.v2(-50,0),cc.v2(50,0)]},type:[cc.Vec2]},threshold:{default:1,serializable:!1,visible:!1}},_createShape:function(t){for(var e=new b2.ChainShape,i=this.points,r=[],s=0;s<i.length;s++){var o=i[s];r.push(new b2.Vec2(o.x/n*t.x,o.y/n*t.y))}return this.loop?e.CreateLoop(r,r.length):e.CreateChain(r,r.length),e},resetInEditor:!1,resetPointsByContour:!1});cc.PhysicsChainCollider=e.exports=r}),{"../CCPhysicsTypes":130}],135:[(function(t,e,i){var n=t("../CCPhysicsTypes").PTM_RATIO,r=cc.Class({name:"cc.PhysicsCircleCollider",extends:cc.PhysicsCollider,mixins:[cc.Collider.Circle],editor:{menu:!1,requireComponent:cc.RigidBody},_createShape:function(t){var e=Math.abs(t.x),i=Math.abs(t.y),r=this.offset.x/n*e,s=this.offset.y/n*i,o=new b2.CircleShape;return o.m_radius=this.radius/n*e,o.m_p=new b2.Vec2(r,s),o}});cc.PhysicsCircleCollider=e.exports=r}),{"../CCPhysicsTypes":130}],136:[(function(t,e,i){var n=t("../CCPhysicsTypes").PTM_RATIO,r=t("../utils").getWorldScale,s=cc.Class({name:"cc.PhysicsCollider",extends:cc.Collider,ctor:function(){this._fixtures=[],this._shapes=[],this._inited=!1,this._rect=cc.rect()},properties:{_density:1,_sensor:!1,_friction:.2,_restitution:0,density:{tooltip:!1,get:function(){return this._density},set:function(t){this._density=t}},sensor:{tooltip:!1,get:function(){return this._sensor},set:function(t){this._sensor=t}},friction:{tooltip:!1,get:function(){return this._friction},set:function(t){this._friction=t}},restitution:{tooltip:!1,get:function(){return this._restitution},set:function(t){this._restitution=t}},body:{default:null,type:cc.RigidBody,visible:!1}},onDisable:function(){this._destroy()},onEnable:function(){this._init()},start:function(){this._init()},_getFixtureIndex:function(t){return this._fixtures.indexOf(t)},_init:function(){cc.director.getPhysicsManager().pushDelayEvent(this,"__init",[])},_destroy:function(){cc.director.getPhysicsManager().pushDelayEvent(this,"__destroy",[])},__init:function(){if(!this._inited){var t=this.body||this.getComponent(cc.RigidBody);if(t){var e=t._getBody();if(e){var i=t.node,n=r(i),s=0===n.x&&0===n.y?[]:this._createShape(n);s instanceof Array||(s=[s]);for(var o=1<<i.groupIndex,a=0,c=cc.game.collisionMatrix[i.groupIndex],h=0;h<c.length;h++)c[h]&&(a|=1<<h);for(var l={categoryBits:o,maskBits:a,groupIndex:0},_=cc.director.getPhysicsManager(),u=0;u<s.length;u++){var d=s[u],m=new b2.FixtureDef;m.density=this.density,m.isSensor=this.sensor,m.friction=this.friction,m.restitution=this.restitution,m.shape=d,m.filter=l;var f=e.CreateFixture(m);f.collider=this,t.enabledContactListener&&_._registerContactFixture(f),this._shapes.push(d),this._fixtures.push(f)}this.body=t,this._inited=!0}}}},__destroy:function(){if(this._inited){for(var t=this._fixtures,e=this.body._getBody(),i=cc.director.getPhysicsManager(),n=t.length-1;n>=0;n--){var r=t[n];r.collider=null,i._unregisterContactFixture(r),e&&e.DestroyFixture(r)}this.body=null,this._fixtures.length=0,this._shapes.length=0,this._inited=!1}},_createShape:function(){},apply:function(){this._destroy(),this._init()},getAABB:function(){for(var t=1e7,e=1e7,i=-1e7,r=-1e7,s=this._fixtures,o=0;o<s.length;o++)for(var a=s[o],c=a.GetShape().GetChildCount(),h=0;h<c;h++){var l=a.GetAABB(h);l.lowerBound.x<t&&(t=l.lowerBound.x),l.lowerBound.y<e&&(e=l.lowerBound.y),l.upperBound.x>i&&(i=l.upperBound.x),l.upperBound.y>r&&(r=l.upperBound.y)}t*=n,e*=n,i*=n,r*=n;var _=this._rect;return _.x=t,_.y=e,_.width=i-t,_.height=r-e,_}});cc.PhysicsCollider=e.exports=s}),{"../CCPhysicsTypes":130,"../utils":153}],137:[(function(t,e,i){var n=t("../CCPhysicsTypes").PTM_RATIO,r=t("../CCPolygonSeparator"),s=cc.Class({name:"cc.PhysicsPolygonCollider",extends:cc.PhysicsCollider,mixins:[cc.Collider.Polygon],editor:{menu:!1,inspector:!1,requireComponent:cc.RigidBody},_createShape:function(t){var e=[],i=this.points;i.length>0&&i[0].equals(i[i.length-1])&&(i.length-=1);for(var s=r.ConvexPartition(i),o=this.offset,a=0;a<s.length;a++){for(var c=s[a],h=null,l=[],_=null,u=0,d=c.length;u<d;u++){h||(h=new b2.PolygonShape);var m=c[u],f=(m.x+o.x)/n*t.x,p=(m.y+o.y)/n*t.y,g=new b2.Vec2(f,p);l.push(g),_||(_=g),l.length===b2.maxPolygonVertices&&(h.Set(l,l.length),e.push(h),h=null,u<d-1&&(l=[_,l[l.length-1]]))}h&&(h.Set(l,l.length),e.push(h))}return e}});cc.PhysicsPolygonCollider=e.exports=s}),{"../CCPhysicsTypes":130,"../CCPolygonSeparator":131}],138:[(function(t,e,i){window.b2=t("../../../external/box2d/box2d"),t("./CCPhysicsManager"),t("./CCRigidBody"),t("./CCPhysicsContact"),t("./collider/CCPhysicsCollider"),t("./collider/CCPhysicsChainCollider"),t("./collider/CCPhysicsCircleCollider"),t("./collider/CCPhysicsBoxCollider"),t("./collider/CCPhysicsPolygonCollider"),t("./joint/CCJoint"),t("./joint/CCDistanceJoint"),t("./joint/CCRevoluteJoint"),t("./joint/CCMouseJoint"),t("./joint/CCMotorJoint"),t("./joint/CCPrismaticJoint"),t("./joint/CCWeldJoint"),t("./joint/CCWheelJoint"),t("./joint/CCRopeJoint"),t("./platform/CCPhysicsDebugDraw"),t("./platform/CCPhysicsUtils"),t("./platform/CCPhysicsContactListner"),t("./platform/CCPhysicsAABBQueryCallback"),t("./platform/CCPhysicsRayCastCallback")}),{"../../../external/box2d/box2d":247,"./CCPhysicsContact":128,"./CCPhysicsManager":129,"./CCRigidBody":132,"./collider/CCPhysicsBoxCollider":133,"./collider/CCPhysicsChainCollider":134,"./collider/CCPhysicsCircleCollider":135,"./collider/CCPhysicsCollider":136,"./collider/CCPhysicsPolygonCollider":137,"./joint/CCDistanceJoint":139,"./joint/CCJoint":140,"./joint/CCMotorJoint":141,"./joint/CCMouseJoint":142,"./joint/CCPrismaticJoint":143,"./joint/CCRevoluteJoint":144,"./joint/CCRopeJoint":145,"./joint/CCWeldJoint":146,"./joint/CCWheelJoint":147,"./platform/CCPhysicsAABBQueryCallback":148,"./platform/CCPhysicsContactListner":149,"./platform/CCPhysicsDebugDraw":150,"./platform/CCPhysicsRayCastCallback":151,"./platform/CCPhysicsUtils":152}],139:[(function(t,e,i){var n=t("../CCPhysicsTypes").PTM_RATIO,r=cc.Class({name:"cc.DistanceJoint",extends:cc.Joint,editor:!1,properties:{_distance:1,_frequency:0,_dampingRatio:0,distance:{tooltip:!1,get:function(){return this._distance},set:function(t){this._distance=t,this._joint&&this._joint.SetLength(t)}},frequency:{tooltip:!1,get:function(){return this._frequency},set:function(t){this._frequency=t,this._joint&&this._joint.SetFrequency(t)}},dampingRatio:{tooltip:!1,get:function(){return this._dampingRatio},set:function(t){this._dampingRatio=t,this._joint&&this._joint.SetDampingRatio(t)}}},_createJointDef:function(){var t=new b2.DistanceJointDef;return t.localAnchorA=new b2.Vec2(this.anchor.x/n,this.anchor.y/n),t.localAnchorB=new b2.Vec2(this.connectedAnchor.x/n,this.connectedAnchor.y/n),t.length=this.distance/n,t.dampingRatio=this.dampingRatio,t.frequencyHz=this.frequency,t}});cc.DistanceJoint=e.exports=r}),{"../CCPhysicsTypes":130}],140:[(function(t,e,i){var n=t("../CCPhysicsTypes").PTM_RATIO,r=cc.Class({name:"cc.Joint",extends:cc.Component,editor:{requireComponent:cc.RigidBody},properties:{anchor:{default:cc.v2(0,0),tooltip:!1},connectedAnchor:{default:cc.v2(0,0),tooltip:!1},connectedBody:{default:null,type:cc.RigidBody,tooltip:!1},collideConnected:{default:!1,tooltip:!1}},onDisable:function(){this._destroy()},onEnable:function(){this._init()},start:function(){this._init()},apply:function(){this._destroy(),this._init()},getWorldAnchor:function(){if(this._joint){var t=this._joint.GetAnchorA();return cc.v2(t.x*n,t.y*n)}return cc.Vec2.ZERO},getWorldConnectedAnchor:function(){if(this._joint){var t=this._joint.GetAnchorB();return cc.v2(t.x*n,t.y*n)}return cc.Vec2.ZERO},getReactionForce:function(t){return this._joint?this._joint.GetReactionForce(t):0},getReactionTorque:function(t){return this._joint?this._joint.GetReactionTorque(t):0},_init:function(){cc.director.getPhysicsManager().pushDelayEvent(this,"__init",[])},_destroy:function(){cc.director.getPhysicsManager().pushDelayEvent(this,"__destroy",[])},__init:function(){if(!this._inited&&(this.body=this.getComponent(cc.RigidBody),this._isValid())){var t=cc.director.getPhysicsManager()._getWorld(),e=this._createJointDef();if(!e)return;e.bodyA=this.body._getBody(),e.bodyB=this.connectedBody._getBody(),e.collideConnected=this.collideConnected,this._joint=t.CreateJoint(e),this._joint&&(this._joint._joint=this),this._inited=!0}},__destroy:function(){this._inited&&(this._isValid()&&cc.director.getPhysicsManager()._getWorld().DestroyJoint(this._joint),this._joint&&(this._joint._joint=null),this._joint=null,this._inited=!1)},_createJointDef:function(){return null},_isValid:function(){return this.body&&this.body._getBody()&&this.connectedBody&&this.connectedBody._getBody()}});cc.Joint=e.exports=r}),{"../CCPhysicsTypes":130}],141:[(function(t,e,i){var n=t("../CCPhysicsTypes").PTM_RATIO,r=t("../CCPhysicsTypes").ANGLE_TO_PHYSICS_ANGLE,s=cc.Class({name:"cc.MotorJoint",extends:cc.Joint,editor:!1,properties:{_linearOffset:cc.v2(0,0),_angularOffset:0,_maxForce:1,_maxTorque:1,_correctionFactor:.3,anchor:{tooltip:!1,default:cc.v2(0,0),override:!0,visible:!1},connectedAnchor:{tooltip:!1,default:cc.v2(0,0),override:!0,visible:!1},linearOffset:{tooltip:!1,get:function(){return this._linearOffset},set:function(t){this._linearOffset=t,this._joint&&this._joint.SetLinearOffset(new b2.Vec2(t.x/n,t.y/n))}},angularOffset:{tooltip:!1,get:function(){return this._angularOffset},set:function(t){this._angularOffset=t,this._joint&&this._joint.SetAngularOffset(t)}},maxForce:{tooltip:!1,get:function(){return this._maxForce},set:function(t){this._maxForce=t,this._joint&&this._joint.SetMaxForce(t)}},maxTorque:{tooltip:!1,get:function(){return this._maxTorque},set:function(t){this._maxTorque=t,this._joint&&this._joint.SetMaxTorque(t)}},correctionFactor:{tooltip:!1,get:function(){return this._correctionFactor},set:function(t){this._correctionFactor=t,this._joint&&this._joint.SetCorrectionFactor(t)}}},_createJointDef:function(){var t=new b2.MotorJointDef;return t.linearOffset=new b2.Vec2(this.linearOffset.x/n,this.linearOffset.y/n),t.angularOffset=this.angularOffset*r,t.maxForce=this.maxForce,t.maxTorque=this.maxTorque,t.correctionFactor=this.correctionFactor,t}});cc.MotorJoint=e.exports=s}),{"../CCPhysicsTypes":130}],142:[(function(t,e,i){var n=t("../CCPhysicsTypes").PTM_RATIO,r=new b2.Vec2,s=cc.Class({name:"cc.MouseJoint",extends:cc.Joint,editor:!1,properties:{_target:1,_frequency:5,_dampingRatio:.7,_maxForce:0,connectedBody:{default:null,type:cc.RigidBody,visible:!1,override:!0},collideConnected:{default:!0,visible:!1,override:!0},anchor:{tooltip:!1,default:cc.v2(0,0),override:!0,visible:!1},connectedAnchor:{tooltip:!1,default:cc.v2(0,0),override:!0,visible:!1},mouseRegion:{tooltip:!1,default:null,type:cc.Node},target:{tooltip:!1,visible:!1,get:function(){return this._target},set:function(t){this._target=t,this._joint&&(r.x=t.x/n,r.y=t.y/n,this._joint.SetTarget(r))}},frequency:{tooltip:!1,get:function(){return this._frequency},set:function(t){this._frequency=t,this._joint&&this._joint.SetFrequency(t)}},dampingRatio:{tooltip:!1,get:function(){return this._dampingRatio},set:function(t){this._dampingRatio=t,this._joint&&this._joint.SetDampingRatio(t)}},maxForce:{tooltip:!1,visible:!1,get:function(){return this._maxForce},set:function(t){this._maxForce=t,this._joint&&this._joint.SetMaxForce(t)}}},onLoad:function(){var t=this.mouseRegion||this.node;t.on(cc.Node.EventType.TOUCH_START,this.onTouchBegan,this),t.on(cc.Node.EventType.TOUCH_MOVE,this.onTouchMove,this),t.on(cc.Node.EventType.TOUCH_END,this.onTouchEnd,this)},onEnable:function(){},start:function(){},onTouchBegan:function(t){var e=cc.director.getPhysicsManager(),i=this._pressPoint=t.touch.getLocation();cc.Camera&&cc.Camera.main&&(i=cc.Camera.main.getCameraToWorldPoint(i));var n=e.testPoint(i);if(n){(this.connectedBody=n.body).awake=!0,this.maxForce=1e3*this.connectedBody.getMass(),this.target=i,this._init()}},onTouchMove:function(t){this._pressPoint=t.touch.getLocation()},onTouchEnd:function(t){this._destroy(),this._pressPoint=null},_createJointDef:function(){var t=new b2.MouseJointDef;return r.x=this.target.x/n,r.y=this.target.y/n,t.target=r,t.maxForce=this.maxForce,t.dampingRatio=this.dampingRatio,t.frequencyHz=this.frequency,t},update:function(){this._pressPoint&&this._isValid()&&(cc.Camera&&cc.Camera.main?this.target=cc.Camera.main.getCameraToWorldPoint(this._pressPoint):this.target=this._pressPoint)}});cc.MouseJoint=e.exports=s}),{"../CCPhysicsTypes":130}],143:[(function(t,e,i){var n=t("../CCPhysicsTypes").PTM_RATIO,r=t("../CCPhysicsTypes").ANGLE_TO_PHYSICS_ANGLE,s=cc.Class({name:"cc.PrismaticJoint",extends:cc.Joint,editor:!1,properties:{localAxisA:{default:cc.v2(1,0),tooltip:!1},referenceAngle:{default:0,tooltip:!1},enableLimit:{default:!1,tooltip:!1},enableMotor:{default:!1,tooltip:!1},lowerLimit:{default:0,tooltip:!1},upperLimit:{default:0,tooltip:!1},_maxMotorForce:0,_motorSpeed:0,maxMotorForce:{tooltip:!1,get:function(){return this._maxMotorForce},set:function(t){this._maxMotorForce=t,this._joint&&this._joint.SetMaxMotorForce(t)}},motorSpeed:{tooltip:!1,get:function(){return this._motorSpeed},set:function(t){this._motorSpeed=t,this._joint&&this._joint.SetMotorSpeed(t)}}},_createJointDef:function(){var t=new b2.PrismaticJointDef;return t.localAnchorA=new b2.Vec2(this.anchor.x/n,this.anchor.y/n),t.localAnchorB=new b2.Vec2(this.connectedAnchor.x/n,this.connectedAnchor.y/n),t.localAxisA=new b2.Vec2(this.localAxisA.x,this.localAxisA.y),t.referenceAngle=this.referenceAngle*r,t.enableLimit=this.enableLimit,t.lowerTranslation=this.lowerLimit/n,t.upperTranslation=this.upperLimit/n,t.enableMotor=this.enableMotor,t.maxMotorForce=this.maxMotorForce,t.motorSpeed=this.motorSpeed,t}});cc.PrismaticJoint=e.exports=s}),{"../CCPhysicsTypes":130}],144:[(function(t,e,i){var n=t("../CCPhysicsTypes").PTM_RATIO,r=t("../CCPhysicsTypes").ANGLE_TO_PHYSICS_ANGLE,s=t("../CCPhysicsTypes").PHYSICS_ANGLE_TO_ANGLE,o=cc.Class({name:"cc.RevoluteJoint",extends:cc.Joint,editor:!1,properties:{_maxMotorTorque:0,_motorSpeed:0,_enableLimit:!1,_enableMotor:!1,referenceAngle:{default:0,tooltip:!1},lowerAngle:{default:0,tooltip:!1},upperAngle:{default:0,tooltip:!1},maxMotorTorque:{tooltip:!1,get:function(){return this._maxMotorTorque},set:function(t){this._maxMotorTorque=t,this._joint&&this._joint.SetMaxMotorTorque(t)}},motorSpeed:{tooltip:!1,get:function(){return this._motorSpeed},set:function(t){this._motorSpeed=t,this._joint&&this._joint.SetMotorSpeed(t*r)}},enableLimit:{tooltip:!1,get:function(){return this._enableLimit},set:function(t){this._enableLimit=t,this._joint&&this._joint.EnableLimit(t)}},enableMotor:{tooltip:!1,get:function(){return this._enableMotor},set:function(t){this._enableMotor=t,this._joint&&this._joint.EnableMotor(t)}}},getJointAngle:function(){return this._joint?this._joint.GetJointAngle()*s:0},_createJointDef:function(){var t=new b2.RevoluteJointDef;return t.localAnchorA=new b2.Vec2(this.anchor.x/n,this.anchor.y/n),t.localAnchorB=new b2.Vec2(this.connectedAnchor.x/n,this.connectedAnchor.y/n),t.lowerAngle=(this.upperAngle+90)*r,t.upperAngle=(this.lowerAngle+90)*r,t.maxMotorTorque=this.maxMotorTorque,t.motorSpeed=this.motorSpeed*r,t.enableLimit=this.enableLimit,t.enableMotor=this.enableMotor,t.referenceAngle=this.referenceAngle*r,t}});cc.RevoluteJoint=e.exports=o}),{"../CCPhysicsTypes":130}],145:[(function(t,e,i){var n=t("../CCPhysicsTypes").PTM_RATIO,r=cc.Class({name:"cc.RopeJoint",extends:cc.Joint,editor:!1,properties:{_maxLength:1,maxLength:{tooltip:!1,get:function(){return this._maxLength},set:function(t){this._maxLength=t,this._joint&&this._joint.SetMaxLength(t)}}},_createJointDef:function(){var t=new b2.RopeJointDef;return t.localAnchorA=new b2.Vec2(this.anchor.x/n,this.anchor.y/n),t.localAnchorB=new b2.Vec2(this.connectedAnchor.x/n,this.connectedAnchor.y/n),t.maxLength=this.maxLength/n,t}});cc.RopeJoint=e.exports=r}),{"../CCPhysicsTypes":130}],146:[(function(t,e,i){var n=t("../CCPhysicsTypes").PTM_RATIO,r=t("../CCPhysicsTypes").ANGLE_TO_PHYSICS_ANGLE,s=cc.Class({name:"cc.WeldJoint",extends:cc.Joint,editor:!1,properties:{referenceAngle:{default:0,tooltip:!1},_frequency:0,_dampingRatio:0,frequency:{tooltip:!1,get:function(){return this._frequency},set:function(t){this._frequency=t,this._joint&&this._joint.SetFrequency(t)}},dampingRatio:{tooltip:!1,get:function(){return this._dampingRatio},set:function(t){this._dampingRatio=t,this._joint&&this._joint.SetDampingRatio(t)}}},_createJointDef:function(){var t=new b2.WeldJointDef;return t.localAnchorA=new b2.Vec2(this.anchor.x/n,this.anchor.y/n),t.localAnchorB=new b2.Vec2(this.connectedAnchor.x/n,this.connectedAnchor.y/n),t.referenceAngle=this.referenceAngle*r,t.frequencyHz=this.frequency,t.dampingRatio=this.dampingRatio,t}});cc.WeldJoint=e.exports=s}),{"../CCPhysicsTypes":130}],147:[(function(t,e,i){var n=t("../CCPhysicsTypes").PTM_RATIO,r=t("../CCPhysicsTypes").ANGLE_TO_PHYSICS_ANGLE,s=cc.Class({name:"cc.WheelJoint",extends:cc.Joint,editor:!1,properties:{_maxMotorTorque:0,_motorSpeed:0,_enableMotor:!1,_frequency:2,_dampingRatio:.7,localAxisA:{default:cc.v2(1,0),tooltip:!1},maxMotorTorque:{tooltip:!1,get:function(){return this._maxMotorTorque},set:function(t){this._maxMotorTorque=t,this._joint&&this._joint.SetMaxMotorTorque(t)}},motorSpeed:{tooltip:!1,get:function(){return this._motorSpeed},set:function(t){this._motorSpeed=t,this._joint&&this._joint.SetMotorSpeed(t*r)}},enableMotor:{tooltip:!1,get:function(){return this._enableMotor},set:function(t){this._enableMotor=t,this._joint&&this._joint.EnableMotor(t)}},frequency:{tooltip:!1,get:function(){return this._frequency},set:function(t){this._frequency=t,this._joint&&this._joint.SetFrequency(t)}},dampingRatio:{tooltip:!1,get:function(){return this._dampingRatio},set:function(t){this._dampingRatio=t,this._joint&&this._joint.SetDampingRatio(t)}}},_createJointDef:function(){var t=new b2.WheelJointDef;return t.localAnchorA=new b2.Vec2(this.anchor.x/n,this.anchor.y/n),t.localAnchorB=new b2.Vec2(this.connectedAnchor.x/n,this.connectedAnchor.y/n),t.localAxisA=new b2.Vec2(this.localAxisA.x,this.localAxisA.y),t.maxMotorTorque=this.maxMotorTorque,t.motorSpeed=this.motorSpeed*r,t.enableMotor=this.enableMotor,t.dampingRatio=this.dampingRatio,t.frequencyHz=this.frequency,t}});cc.WheelJoint=e.exports=s}),{"../CCPhysicsTypes":130}],148:[(function(t,e,i){function n(){this._point=new b2.Vec2,this._isPoint=!1,this._fixtures=[]}n.prototype.init=function(t){t?(this._isPoint=!0,this._point.x=t.x,this._point.y=t.y):this._isPoint=!1,this._fixtures.length=0},n.prototype.ReportFixture=function(t){if(t.GetBody().GetType()===b2.Body.b2_dynamicBody)if(this._isPoint){if(t.TestPoint(this._point))return this._fixtures.push(t),!1}else this._fixtures.push(t);return!0},n.prototype.getFixture=function(){return this._fixtures[0]},n.prototype.getFixtures=function(){return this._fixtures},cc.PhysicsAABBQueryCallback=e.exports=n}),{}],149:[(function(t,e,i){function n(){this._contactFixtures=[]}n.prototype.setBeginContact=function(t){this._BeginContact=t},n.prototype.setEndContact=function(t){this._EndContact=t},n.prototype.setPreSolve=function(t){this._PreSolve=t},n.prototype.setPostSolve=function(t){this._PostSolve=t},n.prototype.BeginContact=function(t){if(this._BeginContact){var e=t.GetFixtureA(),i=t.GetFixtureB(),n=this._contactFixtures;t._shouldReport=!1,-1===n.indexOf(e)&&-1===n.indexOf(i)||(t._shouldReport=!0,this._BeginContact(t))}},n.prototype.EndContact=function(t){this._EndContact&&t._shouldReport&&(t._shouldReport=!1,this._EndContact(t))},n.prototype.PreSolve=function(t,e){this._PreSolve&&t._shouldReport&&this._PreSolve(t,e)},n.prototype.PostSolve=function(t,e){this._PostSolve&&t._shouldReport&&this._PostSolve(t,e)},n.prototype.registerContactFixture=function(t){this._contactFixtures.push(t)},n.prototype.unregisterContactFixture=function(t){cc.js.array.remove(this._contactFixtures,t)},cc.PhysicsContactListener=e.exports=n}),{}],150:[(function(t,e,i){var n=t("../CCPhysicsTypes").PTM_RATIO,r=cc.Class({name:"cc.PhysicsDebugDraw",mixins:[b2.Draw],ctor:function(){this._drawer=new _ccsg.GraphicsNode,this._drawer.retain()},getDrawer:function(){return this._drawer},AddDrawerToNode:function(t){this._drawer.removeFromParent(),t.addChild(this._drawer)},ClearDraw:function(){this._drawer.clear()},_DrawPolygon:function(t,e){for(var i=this._drawer,r=0;r<e;r++)0===r?i.moveTo(t[r].x*n,t[r].y*n):i.lineTo(t[r].x*n,t[r].y*n);i.close()},DrawPolygon:function(t,e,i){this._applyStrokeColor(i),this._DrawPolygon(t,e),this._drawer.stroke()},DrawSolidPolygon:function(t,e,i){this._applyFillColor(i),this._DrawPolygon(t,e),this._drawer.fill(),this._drawer.stroke()},_DrawCircle:function(t,e){this._drawer.circle(t.x*n,t.y*n,e*n)},DrawCircle:function(t,e,i){this._applyStrokeColor(i),this._DrawCircle(t,e),this._drawer.stroke()},DrawSolidCircle:function(t,e,i,n){this._applyFillColor(n),this._DrawCircle(t,e),this._drawer.fill()},DrawSegment:function(t,e,i){var r=this._drawer;if(t.x===e.x&&t.y===e.y)return this._applyFillColor(i),this._DrawCircle(t,2/n),void r.fill();this._applyStrokeColor(i),r.moveTo(t.x*n,t.y*n),r.lineTo(e.x*n,e.y*n),r.stroke()},DrawPoint:function(t,e,i){},_applyStrokeColor:function(t){this._drawer.setStrokeColor(cc.color(255*t.r,255*t.g,255*t.b,150))},_applyFillColor:function(t){this._drawer.setFillColor(cc.color(255*t.r,255*t.g,255*t.b,150))}});cc.PhysicsDebugDraw=e.exports=r}),{"../CCPhysicsTypes":130}],151:[(function(t,e,i){function n(){this._type=0,this._fixtures=[],this._points=[],this._normals=[],this._fractions=[]}n.prototype.init=function(t){this._type=t,this._fixtures.length=0,this._points.length=0,this._normals.length=0,this._fractions.length=0},n.prototype.ReportFixture=function(t,e,i,n){return 0===this._type?(this._fixtures[0]=t,this._points[0]=e,this._normals[0]=i,this._fractions[0]=n,n):(this._fixtures.push(t),this._points.push(e),this._normals.push(i),this._fractions.push(n),1===this._type?0:this._type>=2?1:n)},n.prototype.getFixtures=function(){return this._fixtures},n.prototype.getPoints=function(){return this._points},n.prototype.getNormals=function(){return this._normals},n.prototype.getFractions=function(){return this._fractions},cc.PhysicsRayCastCallback=e.exports=n}),{}],152:[(function(t,e,i){function n(){}var r=t("../CCPhysicsTypes").PHYSICS_ANGLE_TO_ANGLE,s=t("../CCPhysicsTypes").PTM_RATIO,o=t("../utils").convertToNodeRotation,a=cc.v2();n.prototype.addB2Body=function(t){},n.prototype.removeB2Body=function(t){},n.prototype.syncNode=function(){for(var t=cc.director.getPhysicsManager()._bodies,e=0,i=t.length;e<i;e++){var n=t[e],c=n.node,h=n._b2Body,l=h.GetPosition();a.x=l.x*s,a.y=l.y*s;var _=h.GetAngle()*r;null!==c.parent.parent&&(a=c.parent.convertToNodeSpaceAR(a),_=o(c.parent,_));var u=c._sgNode,d=c._position;d.x=a.x,d.y=a.y,u.setPosition(d),c._rotationX=c._rotationY=_,u.rotation=_}},cc.PhysicsUtils=e.exports=n}),{"../CCPhysicsTypes":130,"../utils":153}],153:[(function(t,e,i){e.exports={getWorldRotation:function(t){for(var e=t.rotationX,i=t.parent;i.parent;)e+=i.rotationX,i=i.parent;return e},getWorldScale:function(t){for(var e=t.scaleX,i=t.scaleY,n=t.parent;n.parent;)e*=n.scaleX,i*=n.scaleY,n=n.parent;return cc.v2(e,i)},convertToNodeRotation:function(t,e){e-=t.rotationX;for(var i=t.parent;i.parent;)e-=i.rotationX,i=i.parent;return e}}}),{}],154:[(function(t,e,i){}),{"../event-manager":90,"../platform/js":177,"./CCMacro":161,"./CCSys":165}],155:[(function(t,e,i){function n(t){return t&&(t.constructor===cc.SceneAsset||t instanceof cc.Scene)}function r(t,e){this.url=t,this.type=e}var s=t("../assets/CCAsset"),o=t("./utils").callInNextTick,a=t("../load-pipeline/CCLoader"),c=t("../load-pipeline/pack-downloader"),h=t("../load-pipeline/auto-release-utils"),l=t("../utils/decode-uuid"),_=t("../load-pipeline/md5-pipe"),u="",d="",m={},f={loadAsset:function(t,e,i){if("string"!=typeof t)return o(e,new Error("[AssetLibrary] uuid must be string"),null);var r={uuid:t,type:"uuid"};i&&i.existingAsset&&(r.existingAsset=i.existingAsset),a.load(r,(function(i,r){if(i||!r)i=new Error("[AssetLibrary] loading JSON or dependencies failed: "+(i?i.message:"Unknown error"));else{if(r.constructor===cc.SceneAsset){var s=cc.loader._getReferenceKey(t);r.scene.dependAssets=h.getDependsRecursively(s)}if(n(r)){var o=cc.loader._getReferenceKey(t);a.removeItem(o)}}e&&e(i,r)}))},getLibUrlNoExt:function(t){return t=l(t),u+t.slice(0,2)+"/"+t},_queryAssetInfoInEditor:function(t,e){0},_getAssetInfoInRuntime:function(t,e){e=e||{url:null,raw:!1};var i=m[t];return i&&!cc.isChildClassOf(i.type,cc.Asset)?(e.url=d+i.url,e.raw=!0):(e.url=this.getLibUrlNoExt(t)+".json",e.raw=!1),e},_getAssetUrl:function(t){var e=m[t];return e?d+e.url:null},queryAssetInfo:function(t,e){var i=this._getAssetInfoInRuntime(t);e(null,i.url,i.raw)},parseUuidInEditor:function(t){},loadJson:function(t,e){var i=""+((new Date).getTime()+Math.random()),r={uuid:i,type:"uuid",content:t,skips:[a.assetLoader.id,a.downloader.id]};a.load(r,(function(t,r){if(t)t=new Error("[AssetLibrary] loading JSON or dependencies failed: "+t.message);else{if(r.constructor===cc.SceneAsset){var s=cc.loader._getReferenceKey(i);r.scene.dependAssets=h.getDependsRecursively(s)}if(n(r)){var o=cc.loader._getReferenceKey(i);a.removeItem(o)}}r._uuid="",e&&e(t,r)}))},getAssetByUuid:function(t){return f._uuidToAsset[t]||null},init:function(t){var e=t.libraryPath;e=e.replace(/\\/g,"/"),u=cc.path.stripSep(e)+"/",d=t.rawAssetsBase;var i=t.md5AssetsMap;if(i){var n=new _(i,u,d);cc.loader.insertPipeAfter(cc.loader.assetLoader,n),cc.loader.md5Pipe=n}var o=a._resources;o.reset();var h=t.rawAssets;if(h){var l="resources/";for(var f in h){var p=h[f];for(var g in p){var v=p[g],y=v[0],x=v[1],C=cc.js._getClassById(x);if(C){if(m[g]=new r(f+"/"+y,C),"assets"===f&&y.startsWith(l)){if(cc.isChildClassOf(C,s)){var A=cc.path.extname(y);y=A?y.slice(l.length,-A.length):y.slice(l.length)}else y=y.slice(l.length);var T=1===v[2];o.add(y,g,C,!T)}}else cc.error("Cannot get",x)}}}t.packedAssets&&c.initPacks(t.packedAssets);var b=t.mountPaths;b||(b={assets:d+"assets",internal:d+"internal"}),cc.url._init(b)}};f._uuidToAsset={},e.exports=cc.AssetLibrary=f}),{"../assets/CCAsset":40,"../load-pipeline/CCLoader":110,"../load-pipeline/auto-release-utils":114,"../load-pipeline/md5-pipe":120,"../load-pipeline/pack-downloader":121,"../utils/decode-uuid":203,"./utils":181}],156:[(function(t,e,i){function n(t,e){t.indexOf(e)<0&&t.push(e)}function r(t,e){n(t.__props__,e)}function s(t,e,i,n,s){var o=n.default;C.setClassAttr(t,i,"default",o),r(t,i);var a=g(t,n,e,i,!1);if(a){for(var c=E,h=0;h<a.length;h++){var l=a[h];C.attr(t,i,l),l._onAfterProp&&c.push(l._onAfterProp)}for(var _=0;_<c.length;_++)c[_](t,i);E.length=0,a.length=0}}function o(t,e,i,n,r){var s=n.get,o=n.set,a=t.prototype,c=Object.getOwnPropertyDescriptor(a,i),h=!c;if(s){0;for(var l=g(t,n,e,i,!0),_=0;_<l.length;_++)C.attr(t,i,l[_]);l.length=0;C.setClassAttr(t,i,"serializable",!1),r||v.get(a,i,s,h,h)}o&&(r||v.set(a,i,o,h,h))}function a(t){return"function"==typeof t?t():t}function c(t,e,i){for(var n in e)t.hasOwnProperty(n)||i&&!i(n)||Object.defineProperty(t,n,v.getPropertyDescriptor(e,n))}function h(t,e,i,r){var s,o,a=r.__ctor__,h=r.ctor,l=r.__ES6__;l?(s=[h],o=h):(s=a?[a]:(function(t,e,i){function r(t){return p._isCCClass(t)?t.__ctors__||[]:[t]}for(var s=[],o=[t].concat(e),a=0;a<o.length;a++){var c=o[a];if(c)for(var h=r(c),l=0;l<h.length;l++)n(s,h[l])}var _=i.ctor;_&&s.push(_);return s})(e,i,r),o=R(s,e,t,r),v.value(o,"extend",(function(t){return t.extends=this,p(t)}),!0)),v.value(o,"__ctors__",s.length>0?s:null,!0);var _=o.prototype;if(e&&(l||(v.extend(o,e),_=o.prototype),v.value(o,"$super",e)),i){for(var u=i.length-1;u>=0;u--){var m=i[u];c(_,m.prototype),c(o,m,(function(t){return m.hasOwnProperty(t)&&!0})),p._isCCClass(m)&&c(C.getClassAttrs(o).constructor.prototype,C.getClassAttrs(m).constructor.prototype)}_.constructor=o}return l||(_.__initProps__=d),v.setClassName(t,o),o}function l(t){for(var e=v.getClassName(t),i=t.constructor,n="new "+e+"(",r=0;r<i.__props__.length;r++){var s=t[i.__props__[r]];if("object"==typeof s)return cc.errorID(3641,e),"new "+e+"()";n+=s,r<i.__props__.length-1&&(n+=",")}return n+")"}function _(t){for(var e=v.getClassName(t),i=t.constructor,n=new i,r=0;r<i.__props__.length;r++){var s=i.__props__[r],o=t[s];if("object"==typeof o)return cc.errorID(3641,e),n;n[s]=o}return n}function u(t){return JSON.stringify(t).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")}function d(t){var e=C.getClassAttrs(t),i=t.__props__;null===i&&(S.init(),i=t.__props__);var n=(function(t,e){return function(){for(var i=[],n=0;n<e.length;n++){var r=e[n],s=r+A+"default";if(s in t){var o,a=t[s];if("object"==typeof a&&a)o=a instanceof cc.ValueType?_(a):Array.isArray(a)?[]:{};else if("function"==typeof a){var c=i.length;i.push(a),o=i[c]()}else o=a;this[r]=o}}}})(e,i);t.prototype.__initProps__=n,n.call(this)}function m(t,e,i){var n=!1;for(var r in e)if(!(w.indexOf(r)>=0)){var s=e[r];if("function"==typeof s){var o=v.getPropertyDescriptor(t.prototype,r);if(o){var a=o.value;if("function"==typeof a){P.test(s)&&(n=!0,e[r]=(function(t,e){return function(){var i=this._super;this._super=t;var n=e.apply(this,arguments);return this._super=i,n}})(a,s));continue}}0}}return n}function f(t,e,i,n,r,a){if(t.__props__=[],n&&n.__props__&&(t.__props__=n.__props__.slice()),r)for(var c=0;c<r.length;++c){var h=r[c];h.__props__&&(t.__props__=t.__props__.concat(h.__props__.filter((function(e){return t.__props__.indexOf(e)<0}))))}if(i){b.preprocessAttrs(i,e,t,a);for(var l in i){var _=i[l];"default"in _?s(t,e,l,_):o(t,e,l,_,a)}}}function p(t){var e=(t=t||{}).name,i=t.extends,n=t.mixins,r=(function(t,e,i,n){var r=cc.Component,s=cc._RF.peek();if(s&&cc.isChildClassOf(e,r)){if(cc.isChildClassOf(s.cls,r))return cc.errorID(3615),null;t=t||s.script}var o=h(t,e,i,n);if(s)if(cc.isChildClassOf(e,r)){var a=s.uuid;a&&v._setClassId(a,o),s.cls=o}else cc.isChildClassOf(s.cls,r)||(s.cls=o);return o})(e,i,n,t);e||(e=cc.js.getClassName(r)),r._sealed=!0,i&&(i._sealed=!1);var s=t.properties;"function"==typeof s||i&&null===i.__props__||n&&n.some((function(t){return null===t.__props__}))?(S.push({cls:r,props:s,mixins:n}),r.__props__=null):f(r,e,s,i,t.mixins,t.__ES6__);var o=t.statics;if(o){var a;0;for(a in o)r[a]=o[a]}for(var c in t)if(!(w.indexOf(c)>=0)){var l=t[c];b.validateMethodWithProps(l,c,e,r,i)&&v.value(r.prototype,c,l,!0,!0)}var _=t.editor;return _&&cc.isChildClassOf(i,cc.Component)&&cc.Component._registerEditorProps(r,_),r}function g(t,e,i,n,r){function s(){return c=n+A,a=C.getClassAttrsProto(t)}function o(t,i){if(t in e){var n=e[t];typeof n===i&&((a||s())[c+t]=n)}}var a=null,c="";L.length=0;var h=L,l=e.type;if(l){var _=B[l];if(_)h.push({type:l,_onAfterProp:T(_,"cc."+l)});else if("Object"===l)0;else if(l===C.ScriptUuid){var u=C.ObjectType(cc.ScriptAsset);u.type="Script",h.push(u)}else"object"==typeof l?y.isEnum(l)&&h.push({type:"Enum",enumList:y.getList(l)}):"function"==typeof l&&(e.url?h.push({type:"Object",ctor:l,_onAfterProp:T("String","cc.String")}):h.push(e._short?{type:"Object",ctor:l}:C.ObjectType(l)))}e.editorOnly&&((a||s())[c+"editorOnly"]=!0),e.url&&((a||s())[c+"saveUrlAsAsset"]=!0),!1===e.serializable&&((a||s())[c+"serializable"]=!1),o("formerlySerializedAs","string");var d=e.range;return d&&Array.isArray(d)&&d.length>=2&&((a||s())[c+"min"]=d[0],a[c+"max"]=d[1],d.length>2&&(a[c+"step"]=d[2])),o("min","number"),o("max","number"),o("step","number"),h}var v=t("./js"),y=t("./CCEnum"),x=t("./utils"),C=(x.isPlainEmptyObj_DEV,x.cloneable_DEV,t("./attribute")),A=C.DELIMETER,T=C.getTypeChecker,b=t("./preprocess-class");t("./requiring-frame");var w=["name","extends","mixins","ctor","__ctor__","properties","statics","editor","__ES6__"],S={datas:null,push:function(t){if(this.datas)this.datas.push(t);else{this.datas=[t];var e=this;setTimeout((function(){e.init()}),0)}},init:function(){var t=this.datas;if(t){for(var e=0;e<t.length;++e){var i=t[e],n=i.cls,r=i.props;"function"==typeof r&&(r=r());var s=v.getClassName(n);r?f(n,s,r,n.$super,i.mixins):cc.errorID(3633,s)}this.datas=null}}},E=[],I=/^[$A-Za-z_][0-9A-Za-z_$]*$/,R=function(t,e,i,n){var r=e&&m(e,n);return function e(){r&&(this._super=null),this.__initProps__(e);var n=t.length,s=e.__ctors__;if(n>0){if(!(i&&i.startsWith("cc.")))try{if(1===n)s[0].apply(this,arguments);else for(var o=0;o<n;o++)s[o].apply(this,arguments)}catch(t){cc._throw(t)}else if(1===n)s[0].apply(this,arguments);else for(var a=0;a<n;a++)s[a].apply(this,arguments)}}},P=/xyz/.test((function(){xyz}))?/\b\._super\b/:/.*/;/xyz/.test((function(){xyz}));p._isCCClass=function(t){return t&&t.hasOwnProperty("__ctors__")},p._fastDefine=function(t,e,i){v.setClassName(t,e);for(var n=e.__props__=Object.keys(i),r=C.getClassAttrsProto(e),s=0;s<n.length;s++){var o=n[s];r[o+A+"visible"]=!1,r[o+A+"default"]=i[o]}},p.Attr=C,p.attr=C.attr,cc.isChildClassOf=function(t,e){if(t&&e){if("function"!=typeof t)return!1;if("function"!=typeof e)return!1;if(t===e)return!0;for(;;){if(!(t=v.getSuper(t)))return!1;if(t===e)return!0}}return!1},p.getInheritanceChain=function(t){for(var e=[];t=v.getSuper(t);)t!==Object&&e.push(t);return e};var B={Integer:"Number",Float:"Number",Boolean:"Boolean",String:"String"},L=[];cc.Class=p,e.exports={isArray:function(t){return t=a(t),Array.isArray(t)},fastDefine:p._fastDefine,getNewValueTypeCode:l,IDENTIFIER_RE:I,escapeForJS:u,getDefault:a}}),{"./CCEnum":158,"./attribute":169,"./js":177,"./preprocess-class":178,"./requiring-frame":179,"./utils":181}],157:[(function(t,e,i){function n(t){return t}function r(t,e){return t[e]||(t[e]={})}function s(t){return function(e){return"function"==typeof e?t(e):function(i){return t(i,e)}}}function o(t,e,i){return function(t){return function(i){return e(i,t)}}}function a(t){return o.bind(null,!1)}function c(t,e){return r(t,d)}function h(t,e,i){return t((function(t,n){var s=c(t);if(s){var o=void 0!==i?i:n;r(r(s,"proto"),"editor")[e]=o}}),e)}function l(t){return t(n)}t("./CCClass");var _=t("./preprocess-class"),u=t("./js"),d="__ccclassCache__",m=o.bind(null,!1),f=a(),p=a(),g=s((function(t,e){var i=u.getSuper(t);i===Object&&(i=null);var n={name:e,extends:i,ctor:t,__ES6__:!0},r=t[d];if(r){var s=r.proto;s&&u.mixin(n,s),t[d]=void 0}return cc.Class(n)})),v=l(s),y=h(m,"requireComponent"),x=l(f),C=h(p,"executionOrder"),A=l(s),T=l(s),b=l(f),w=l(f),S=l(f);cc._decorator=e.exports={ccclass:g,property:function(t,e,i){function n(t,e,i){var n=c(t.constructor);if(n){var o=r(r(n,"proto"),"properties");(function(t,e,i,n,r,s){var o=n&&(_.getFullFormOfProperty(n)||n),a=e[i],c=u.mixin(a||{},o||{});if(r&&(r.get||r.set))r.get&&(c.get=r.get),r.set&&(c.set=r.set);else{var h=void 0;if(r)r.initializer&&(h=(function(t){var e;try{e=t()}catch(e){return t}return"object"!=typeof e||null===e?e:t})(r.initializer));else{var l=s.default||(s.default=(function(t){var e;try{e=new t}catch(t){return{}}return e})(t));l.hasOwnProperty(i)&&(h=l[i])}c.default=h}e[i]=c})(t.constructor,o,e,s,i,n)}}var s=null;if(void 0===e)return s=t,n;n(t,e,i)},executeInEditMode:v,requireComponent:y,menu:x,executionOrder:C,disallowMultiple:A,playOnFocus:T,inspector:b,icon:w,help:S,mixins:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return function(e){var i=c(e);i&&(r(i,"proto").mixins=t)}}}}),{"./CCClass":156,"./js":177,"./preprocess-class":178,"./utils":181}],158:[(function(t,e,i){function n(t){if("__enums__"in t)return t;r.value(t,"__enums__",null,!0);for(var e=-1,i=Object.keys(t),n=0;n<i.length;n++){var s=i[n],o=t[s];if(-1===o)o=++e,t[s]=o;else if("number"==typeof o)e=o;else if("string"==typeof o&&Number.isInteger(parseFloat(s)))continue;var a=""+o;s!==a&&r.value(t,a,s)}return t}var r=t("./js");n.isEnum=function(t){return t&&t.hasOwnProperty("__enums__")},n.getList=function(t){if(t.__enums__)return t.__enums__;var e=t.__enums__=[];for(var i in t){var n=t[i];Number.isInteger(n)&&e.push({name:i,value:n})}return e.sort((function(t,e){return t.value-e.value})),e};e.exports=cc.Enum=n}),{"./js":177}],159:[(function(t,e,i){cc.ClassManager||t("./_CCClass");var n=t("../event-manager"),r=t("./CCInputManager");r.__instanceId=cc.ClassManager.getNewInstanceId();var s;r.setAccelerometerEnabled=function(t){if(this._accelEnabled!==t){this._accelEnabled=t;var e=cc.director.getScheduler();this._accelEnabled,this._accelCurTime=0,e.scheduleUpdate(this)}},r.setAccelerometerInterval=function(t){this._accelInterval!==t&&(this._accelInterval=t)},r._registerKeyboardEvent=function(){cc.game.canvas.addEventListener("keydown",(function(t){n.dispatchEvent(new cc.Event.EventKeyboard(t.keyCode,!0)),t.stopPropagation(),t.preventDefault()}),!1),cc.game.canvas.addEventListener("keyup",(function(t){n.dispatchEvent(new cc.Event.EventKeyboard(t.keyCode,!1)),t.stopPropagation(),t.preventDefault()}),!1)},r._registerAccelerometerEvent=function(){var t=window;this._acceleration=new cc.Acceleration,this._accelDeviceEvent=t.DeviceMotionEvent||t.DeviceOrientationEvent,cc.sys.browserType===cc.sys.BROWSER_TYPE_MOBILE_QQ&&(this._accelDeviceEvent=window.DeviceOrientationEvent);var e=this._accelDeviceEvent===t.DeviceMotionEvent?"devicemotion":"deviceorientation",i=navigator.userAgent;(/Android/.test(i)||/Adr/.test(i)&&cc.sys.browserType===cc.BROWSER_TYPE_UC)&&(this._minus=-1),s=this.didAccelerate.bind(this),t.addEventListener(e,s,!1)},r._unregisterAccelerometerEvent=function(){var t=window,e=this._accelDeviceEvent===t.DeviceMotionEvent?"devicemotion":"deviceorientation";s&&t.removeEventListener(e,s,!1)},r.didAccelerate=function(t){var e=window;if(this._accelEnabled){var i,n,r,s=this._acceleration;if(this._accelDeviceEvent===window.DeviceMotionEvent){var o=t.accelerationIncludingGravity;i=this._accelMinus*o.x*.1,n=this._accelMinus*o.y*.1,r=.1*o.z}else i=t.gamma/90*.981,n=-t.beta/90*.981,r=t.alpha/90*.981;s.x=i,s.y=n,s.z=r,s.timestamp=t.timeStamp||Date.now();var a=s.x;e.orientation===cc.macro.WEB_ORIENTATION_LANDSCAPE_RIGHT?(s.x=-s.y,s.y=a):e.orientation===cc.macro.WEB_ORIENTATION_LANDSCAPE_LEFT?(s.x=s.y,s.y=-a):e.orientation===cc.macro.WEB_ORIENTATION_PORTRAIT_UPSIDE_DOWN&&(s.x=-s.x,s.y=-s.y),cc.sys.os===cc.sys.OS_ANDROID&&cc.sys.browserType!==cc.sys.BROWSER_TYPE_MOBILE_QQ&&(s.x=-s.x,s.y=-s.y)}}}),{"../event-manager":90,"./CCInputManager":160,"./_CCClass":168}],160:[(function(t,e,i){var n=t("../platform/js"),r=t("./CCMacro"),s=t("./CCSys"),o=t("../event-manager"),a=r.TOUCH_TIMEOUT,c={_mousePressed:!1,_isRegisterEvent:!1,_preTouchPoint:cc.p(0,0),_prevMousePoint:cc.p(0,0),_preTouchPool:[],_preTouchPoolPointer:0,_touches:[],_touchesIntegerDict:{},_indexBitsUsed:0,_maxTouches:5,_accelEnabled:!1,_accelInterval:1/30,_accelMinus:1,_accelCurTime:0,_acceleration:null,_accelDeviceEvent:null,_getUnUsedIndex:function(){for(var t=this._indexBitsUsed,e=cc.sys.now(),i=0;i<this._maxTouches;i++){if(!(1&t))return this._indexBitsUsed|=1<<i,i;var n=this._touches[i];if(e-n._lastModified>a)return this._removeUsedIndexBit(i),delete this._touchesIntegerDict[n.getID()],i;t>>=1}return-1},_removeUsedIndexBit:function(t){if(!(t<0||t>=this._maxTouches)){var e=1<<t;e=~e,this._indexBitsUsed&=e}},_glView:null,handleTouchesBegin:function(t){for(var e,i,n,r=[],a=this._touchesIntegerDict,c=s.now(),h=0,l=t.length;h<l;h++)if(e=t[h],n=e.getID(),null==a[n]){var _=this._getUnUsedIndex();if(-1===_){cc.logID(2300,_);continue}(i=this._touches[_]=new cc.Touch(e._point.x,e._point.y,e.getID()))._lastModified=c,i._setPrevPoint(e._prevPoint),a[n]=_,r.push(i)}if(r.length>0){this._glView._convertTouchesWithScale(r);var u=new cc.Event.EventTouch(r);u._eventCode=cc.Event.EventTouch.BEGAN,o.dispatchEvent(u)}},handleTouchesMove:function(t){for(var e,i,n,r=[],a=this._touches,c=s.now(),h=0,l=t.length;h<l;h++)n=(e=t[h]).getID(),null!=(i=this._touchesIntegerDict[n])&&a[i]&&(a[i]._setPoint(e._point),a[i]._setPrevPoint(e._prevPoint),a[i]._lastModified=c,r.push(a[i]));if(r.length>0){this._glView._convertTouchesWithScale(r);var _=new cc.Event.EventTouch(r);_._eventCode=cc.Event.EventTouch.MOVED,o.dispatchEvent(_)}},handleTouchesEnd:function(t){var e=this.getSetOfTouchesEndOrCancel(t);if(e.length>0){this._glView._convertTouchesWithScale(e);var i=new cc.Event.EventTouch(e);i._eventCode=cc.Event.EventTouch.ENDED,o.dispatchEvent(i)}},handleTouchesCancel:function(t){var e=this.getSetOfTouchesEndOrCancel(t);if(e.length>0){this._glView._convertTouchesWithScale(e);var i=new cc.Event.EventTouch(e);i._eventCode=cc.Event.EventTouch.CANCELLED,o.dispatchEvent(i)}},getSetOfTouchesEndOrCancel:function(t){for(var e,i,n,r=[],s=this._touches,o=this._touchesIntegerDict,a=0,c=t.length;a<c;a++)null!=(i=o[n=(e=t[a]).getID()])&&s[i]&&(s[i]._setPoint(e._point),s[i]._setPrevPoint(e._prevPoint),r.push(s[i]),this._removeUsedIndexBit(i),delete o[n]);return r},getHTMLElementPosition:function(t){if(s.platform===s.WECHAT_GAME)return{left:0,top:0,width:window.innerWidth,height:window.innerHeight};var e=document.documentElement,i=window.pageXOffset-e.clientLeft,n=window.pageYOffset-e.clientTop;if("function"==typeof t.getBoundingClientRect){var r=t.getBoundingClientRect();return{left:r.left+i,top:r.top+n,width:r.width,height:r.height}}return t instanceof HTMLCanvasElement?{left:i,top:n,width:t.width,height:t.height}:{left:i,top:n,width:parseInt(t.style.width),height:parseInt(t.style.height)}},getPreTouch:function(t){for(var e=null,i=this._preTouchPool,n=t.getID(),r=i.length-1;r>=0;r--)if(i[r].getID()===n){e=i[r];break}return e||(e=t),e},setPreTouch:function(t){for(var e=!1,i=this._preTouchPool,n=t.getID(),r=i.length-1;r>=0;r--)if(i[r].getID()===n){i[r]=t,e=!0;break}e||(i.length<=50?i.push(t):(i[this._preTouchPoolPointer]=t,this._preTouchPoolPointer=(this._preTouchPoolPointer+1)%50))},getTouchByXY:function(t,e,i){var n=this._preTouchPoint,r=this._glView.convertToLocationInView(t,e,i),s=new cc.Touch(r.x,r.y);return s._setPrevPoint(n.x,n.y),n.x=r.x,n.y=r.y,s},getMouseEvent:function(t,e,i){var n=this._prevMousePoint,r=new cc.Event.EventMouse(i);return r._setPrevCursor(n.x,n.y),n.x=t.x,n.y=t.y,this._glView._convertMouseToLocationInView(n,e),r.setLocation(n.x,n.y),r},getPointByEvent:function(t,e){return null!=t.pageX?{x:t.pageX,y:t.pageY}:(s.platform===s.WECHAT_GAME?(e.left=0,e.top=0):(e.left-=document.body.scrollLeft,e.top-=document.body.scrollTop),{x:t.clientX,y:t.clientY})},getTouchesByEvent:function(t,e){for(var i,n,r,o=[],a=this._glView,c=this._preTouchPoint,h=t.changedTouches.length,l=0;l<h;l++)if(i=t.changedTouches[l]){var _;_=s.BROWSER_TYPE_FIREFOX===s.browserType?a.convertToLocationInView(i.pageX,i.pageY,e):a.convertToLocationInView(i.clientX,i.clientY,e),null!=i.identifier?(n=new cc.Touch(_.x,_.y,i.identifier),r=this.getPreTouch(n).getLocation(),n._setPrevPoint(r.x,r.y),this.setPreTouch(n)):(n=new cc.Touch(_.x,_.y))._setPrevPoint(c.x,c.y),c.x=_.x,c.y=_.y,o.push(n)}return o},registerSystemEvent:function(t){if(!this._isRegisterEvent){this._glView=cc.view;var e=this,i=s.isMobile,n="mouse"in s.capabilities,r="touches"in s.capabilities;if(s.platform===s.WECHAT_GAME&&(i=!1,r=!0,n=!1),n){i||(window.addEventListener("mousedown",(function(){e._mousePressed=!0}),!1),window.addEventListener("mouseup",(function(i){if(e._mousePressed){e._mousePressed=!1;var n=e.getHTMLElementPosition(t),r=e.getPointByEvent(i,n);if(!cc.rectContainsPoint(new cc.Rect(n.left,n.top,n.width,n.height),r)){e.handleTouchesEnd([e.getTouchByXY(r.x,r.y,n)]);var s=e.getMouseEvent(r,n,cc.Event.EventMouse.UP);s.setButton(i.button),o.dispatchEvent(s)}}}),!1));for(var a=cc.Event.EventMouse,c=[!i&&["mousedown",a.DOWN,function(i,n,r,s){e._mousePressed=!0,e.handleTouchesBegin([e.getTouchByXY(r.x,r.y,s)]),t.focus()}],!i&&["mouseup",a.UP,function(t,i,n,r){e._mousePressed=!1,e.handleTouchesEnd([e.getTouchByXY(n.x,n.y,r)])}],!i&&["mousemove",a.MOVE,function(t,i,n,r){e.handleTouchesMove([e.getTouchByXY(n.x,n.y,r)]),e._mousePressed||i.setButton(null)}],["mousewheel",a.SCROLL,function(t,e){e.setScrollData(0,t.wheelDelta)}],["DOMMouseScroll",a.SCROLL,function(t,e){e.setScrollData(0,-120*t.detail)}]],h=0;h<c.length;++h){var l=c[h];l&&(function(){var i=l[0],n=l[1],r=l[2];t.addEventListener(i,(function(i){var s=e.getHTMLElementPosition(t),a=e.getPointByEvent(i,s),c=e.getMouseEvent(a,s,n);c.setButton(i.button),r(i,c,a,s),o.dispatchEvent(c),i.stopPropagation(),i.preventDefault()}),!1)})()}}if(window.navigator.msPointerEnabled){var _={MSPointerDown:e.handleTouchesBegin,MSPointerMove:e.handleTouchesMove,MSPointerUp:e.handleTouchesEnd,MSPointerCancel:e.handleTouchesCancel},u=function(i){var n=_[i];t.addEventListener(i,(function(i){var r=e.getHTMLElementPosition(t);r.left-=document.documentElement.scrollLeft,r.top-=document.documentElement.scrollTop,n.call(e,[e.getTouchByXY(i.clientX,i.clientY,r)]),i.stopPropagation()}),!1)};for(var d in _)u(d)}if(r){var m,f={touchstart:function(i){e.handleTouchesBegin(i),s.platform!==s.WECHAT_GAME&&t.focus()},touchmove:function(t){e.handleTouchesMove(t)},touchend:function(t){e.handleTouchesEnd(t)},touchcancel:function(t){e.handleTouchesCancel(t)}};cc.sys.browserType===cc.sys.BROWSER_TYPE_WECHAT_GAME_SUB?(f={onTouchStart:f.touchstart,onTouchMove:f.touchmove,onTouchEnd:f.touchend,onTouchCancel:f.touchcancel},m=function(i){var n=f[i];wx[i]((function(i){if(i.changedTouches){var r=e.getHTMLElementPosition(t),s=document.body;r.left-=s.scrollLeft||0,r.top-=s.scrollTop||0,n(e.getTouchesByEvent(i,r))}}))}):m=function(i){var n=f[i];t.addEventListener(i,(function(i){if(i.changedTouches){var r=e.getHTMLElementPosition(t),s=document.body;r.left-=s.scrollLeft||0,r.top-=s.scrollTop||0,n(e.getTouchesByEvent(i,r)),i.stopPropagation(),i.preventDefault()}}),!1)};for(var p in f)m(p)}cc.sys.browserType!==cc.sys.BROWSER_TYPE_WECHAT_GAME_SUB&&(this._registerKeyboardEvent(),this._registerAccelerometerEvent()),this._isRegisterEvent=!0}},_registerKeyboardEvent:function(){},_registerAccelerometerEvent:function(){},update:function(t){this._accelCurTime>this._accelInterval&&(this._accelCurTime-=this._accelInterval,o.dispatchEvent(new cc.Event.EventAcceleration(this._acceleration))),this._accelCurTime+=t}};n.get(cc,"inputManager",(function(){return cc.warnID(1405,"cc.inputManager","cc.systemEvent"),c})),e.exports=_cc.inputManager=c}),{"../event-manager":90,"../platform/js":177,"./CCMacro":161,"./CCSys":165}],161:[(function(t,e,i){t("./_CCClass"),cc.KEY={none:0,back:6,menu:18,backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,pause:19,capslock:20,escape:27,space:32,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40,select:41,insert:45,Delete:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,num0:96,num1:97,num2:98,num3:99,num4:100,num5:101,num6:102,num7:103,num8:104,num9:105,"*":106,"+":107,"-":109,numdel:110,"/":111,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,numlock:144,scrolllock:145,";":186,semicolon:186,equal:187,"=":187,",":188,comma:188,dash:189,".":190,period:190,forwardslash:191,grave:192,"[":219,openbracket:219,backslash:220,"]":221,closebracket:221,quote:222,dpadLeft:1e3,dpadRight:1001,dpadUp:1003,dpadDown:1004,dpadCenter:1005},cc.ImageFormat=cc.Enum({JPG:0,PNG:1,TIFF:2,WEBP:3,PVR:4,ETC:5,S3TC:6,ATITC:7,TGA:8,RAWDATA:9,UNKNOWN:10}),cc.getImageFormatByData=function(t){return t.length>8&&137===t[0]&&80===t[1]&&78===t[2]&&71===t[3]&&13===t[4]&&10===t[5]&&26===t[6]&&10===t[7]?cc.ImageFormat.PNG:t.length>2&&(73===t[0]&&73===t[1]||77===t[0]&&77===t[1]||255===t[0]&&216===t[1])?cc.ImageFormat.TIFF:cc.ImageFormat.UNKNOWN},cc.macro={INVALID_INDEX:-1,NODE_TAG_INVALID:-1,PI:Math.PI,PI2:2*Math.PI,FLT_MAX:parseFloat("3.402823466e+38F"),FLT_MIN:parseFloat("1.175494351e-38F"),RAD:Math.PI/180,DEG:180/Math.PI,UINT_MAX:4294967295,REPEAT_FOREVER:Number.MAX_VALUE-1,FLT_EPSILON:1.192092896e-7,ONE:1,ZERO:0,SRC_ALPHA:770,SRC_ALPHA_SATURATE:776,SRC_COLOR:768,DST_ALPHA:772,DST_COLOR:774,ONE_MINUS_SRC_ALPHA:771,ONE_MINUS_SRC_COLOR:769,ONE_MINUS_DST_ALPHA:773,ONE_MINUS_DST_COLOR:775,ONE_MINUS_CONSTANT_ALPHA:32772,ONE_MINUS_CONSTANT_COLOR:32770,LINEAR:9729,BLEND_DST:771,WEB_ORIENTATION_PORTRAIT:0,WEB_ORIENTATION_LANDSCAPE_LEFT:-90,WEB_ORIENTATION_PORTRAIT_UPSIDE_DOWN:180,WEB_ORIENTATION_LANDSCAPE_RIGHT:90,ORIENTATION_PORTRAIT:1,ORIENTATION_LANDSCAPE:2,ORIENTATION_AUTO:3,DENSITYDPI_DEVICE:"device-dpi",DENSITYDPI_HIGH:"high-dpi",DENSITYDPI_MEDIUM:"medium-dpi",DENSITYDPI_LOW:"low-dpi",VERTEX_ATTRIB_FLAG_NONE:0,VERTEX_ATTRIB_FLAG_POSITION:1,VERTEX_ATTRIB_FLAG_COLOR:2,VERTEX_ATTRIB_FLAG_TEX_COORDS:4,VERTEX_ATTRIB_FLAG_POS_COLOR_TEX:7,GL_ALL:0,VERTEX_ATTRIB_POSITION:0,VERTEX_ATTRIB_COLOR:1,VERTEX_ATTRIB_TEX_COORDS:2,VERTEX_ATTRIB_MAX:3,UNIFORM_PMATRIX:0,UNIFORM_MVMATRIX:1,UNIFORM_MVPMATRIX:2,UNIFORM_TIME:3,UNIFORM_SINTIME:4,UNIFORM_COSTIME:5,UNIFORM_RANDOM01:6,UNIFORM_SAMPLER:7,UNIFORM_MAX:8,SHADER_POSITION_TEXTURECOLOR:"ShaderPositionTextureColor",SHADER_SPRITE_POSITION_TEXTURECOLOR:"ShaderSpritePositionTextureColor",SHADER_POSITION_TEXTURECOLORALPHATEST:"ShaderPositionTextureColorAlphaTest",SHADER_SPRITE_POSITION_TEXTURECOLORALPHATEST:"ShaderSpritePositionTextureColorAlphaTest",SHADER_POSITION_COLOR:"ShaderPositionColor",SHADER_SPRITE_POSITION_COLOR:"ShaderSpritePositionColor",SHADER_POSITION_TEXTURE:"ShaderPositionTexture",SHADER_POSITION_TEXTURE_UCOLOR:"ShaderPositionTexture_uColor",SHADER_POSITION_TEXTUREA8COLOR:"ShaderPositionTextureA8Color",SHADER_POSITION_UCOLOR:"ShaderPosition_uColor",SHADER_POSITION_LENGTHTEXTURECOLOR:"ShaderPositionLengthTextureColor",UNIFORM_PMATRIX_S:"CC_PMatrix",UNIFORM_MVMATRIX_S:"CC_MVMatrix",UNIFORM_MVPMATRIX_S:"CC_MVPMatrix",UNIFORM_TIME_S:"CC_Time",UNIFORM_SINTIME_S:"CC_SinTime",UNIFORM_COSTIME_S:"CC_CosTime",UNIFORM_RANDOM01_S:"CC_Random01",UNIFORM_SAMPLER_S:"CC_Texture0",UNIFORM_ALPHA_TEST_VALUE_S:"CC_alpha_value",ATTRIBUTE_NAME_COLOR:"a_color",ATTRIBUTE_NAME_POSITION:"a_position",ATTRIBUTE_NAME_TEX_COORD:"a_texCoord",ITEM_SIZE:32,CURRENT_ITEM:3233828865,ZOOM_ACTION_TAG:3233828866,NORMAL_TAG:8801,SELECTED_TAG:8802,DISABLE_TAG:8803,FIX_ARTIFACTS_BY_STRECHING_TEXEL:0,FIX_ARTIFACTS_BY_STRECHING_TEXEL_TMX:1,DIRECTOR_STATS_POSITION:cc.p(0,0),DIRECTOR_FPS_INTERVAL:.5,COCOSNODE_RENDER_SUBPIXEL:1,SPRITEBATCHNODE_RENDER_SUBPIXEL:1,AUTO_PREMULTIPLIED_ALPHA_FOR_PNG:0,OPTIMIZE_BLEND_FUNC_FOR_PREMULTIPLIED_ALPHA:0,TEXTURE_NPOT_SUPPORT:0,USE_LA88_LABELS:1,SPRITE_DEBUG_DRAW:0,LABELBMFONT_DEBUG_DRAW:0,LABELATLAS_DEBUG_DRAW:0,ENABLE_STACKABLE_ACTIONS:1,ENABLE_GL_STATE_CACHE:1,TOUCH_TIMEOUT:5e3,BATCH_VERTEX_COUNT:2e4,ENABLE_GC_FOR_NATIVE_OBJECTS:!0,ENABLE_TILEDMAP_CULLING:!0,DOWNLOAD_MAX_CONCURRENT:64,ENABLE_TRANSPARENT_CANVAS:!1,ENABLE_WEBGL_ANTIALIAS:!1};var n=!0;cc.defineGetterSetter(cc.macro,"ENABLE_CULLING",(function(){return n}),(function(t){n=t;var e=cc.director.getScene();e&&(e._sgNode._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.cullingDirty),cc.renderer.childrenOrderDirty=!0)})),cc.defineGetterSetter(cc.macro,"BLEND_SRC",(function(){return cc._renderType===cc.game.RENDER_TYPE_WEBGL&&cc.macro.OPTIMIZE_BLEND_FUNC_FOR_PREMULTIPLIED_ALPHA?cc.macro.ONE:cc.macro.SRC_ALPHA})),cc.lerp=function(t,e,i){return t+(e-t)*i},cc.rand=function(){return 16777215*Math.random()},cc.randomMinus1To1=function(){return 2*(Math.random()-.5)},cc.random0To1=Math.random,cc.degreesToRadians=function(t){return t*cc.macro.RAD},cc.radiansToDegrees=function(t){return t*cc.macro.DEG},cc.nodeDrawSetup=function(t){t._shaderProgram&&(t._shaderProgram.use(),t._shaderProgram.setUniformForModelViewAndProjectionMatrixWithMat4())},cc.incrementGLDraws=function(t){cc.g_NumberOfDraws+=t},cc.checkGLErrorDebug=function(){if(cc._renderType===cc.game.RENDER_TYPE_WEBGL){var t=cc._renderContext.getError();t&&cc.logID(2400,t)}},e.exports=cc.macro}),{"./_CCClass":168}],162:[(function(t,e,i){function n(){this._name="",this._objFlags=0}function r(){for(var t=c.length,e=0;e<t;++e){var i=c[e];i._objFlags&a||i._destroyImmediate()}t===c.length?c.length=0:c.splice(0,t)}var s=t("./js"),o=t("./CCClass"),a=1;o.fastDefine("cc.Object",n,{_name:"",_objFlags:0}),s.value(n,"Flags",{Destroyed:a,DontSave:8,EditorOnly:16,Dirty:32,DontDestroy:64,PersistentMask:-4192741,Destroying:128,Deactivating:256,IsPreloadStarted:8192,IsOnLoadStarted:32768,IsOnLoadCalled:16384,IsOnEnableCalled:2048,IsStartCalled:65536,IsEditorOnEnableCalled:4096,IsPositionLocked:1<<21,IsRotationLocked:1<<17,IsScaleLocked:1<<18,IsAnchorLocked:1<<19,IsSizeLocked:1<<20});var c=[];s.value(n,"_deferredDestroy",r);var h=n.prototype;s.getset(h,"name",(function(){return this._name}),(function(t){this._name=t})),s.get(h,"isValid",(function(){return!(this._objFlags&a)}));h.destroy=function(){return this._objFlags&a?(cc.warnID(5e3),!1):!(4&this._objFlags)&&(this._objFlags|=4,c.push(this),!0)},h._destruct=function(){var t=this.constructor,e=t.__destruct__;e||(e=(function(t,e){var i,n={};for(i in t)if(t.hasOwnProperty(i))switch(typeof t[i]){case"string":n[i]="";break;case"object":case"function":n[i]=null}if(cc.Class._isCCClass(e))for(var r=cc.Class.Attr.getClassAttrs(e),s=e.__props__,o=0;o<s.length;o++){var a=(i=s[o])+cc.Class.Attr.DELIMETER+"default";if(a in r)switch(typeof r[a]){case"string":n[i]="";break;case"object":case"function":n[i]=null;break;case"undefined":n[i]=void 0}}var c=t instanceof cc._BaseNode||t instanceof cc.Component;return function(t){for(i in n)c&&"_id"===i||(t[i]=n[i])}})(this,t),s.value(t,"__destruct__",e,!0)),e(this)},h._onPreDestroy=null,h._destroyImmediate=function(){this._objFlags&a?cc.errorID(5e3):(this._onPreDestroy&&this._onPreDestroy(),this._destruct(),this._objFlags|=a)},h._deserialize=null,cc.isValid=function(t,e){return"object"==typeof t?!(!t||t._objFlags&(e?4|a:a)):void 0!==t},cc.Object=e.exports=n}),{"./CCClass":156,"./js":177}],163:[(function(t,e,i){cc.SAXParser=cc._Class.extend({ctor:function(){window.DOMParser?(this._isSupportDOMParser=!0,this._parser=new DOMParser):(this._isSupportDOMParser=!1,this._parser=null)},parse:function(t){return this._parseXML(t)},_parseXML:function(t){var e;return this._isSupportDOMParser?e=this._parser.parseFromString(t,"text/xml"):((e=new ActiveXObject("Microsoft.XMLDOM")).async="false",e.loadXML(t)),e}}),cc.PlistParser=cc.SAXParser.extend({parse:function(t){var e=this._parseXML(t),i=e.documentElement;if("plist"!==i.tagName)return cc.warnID(5100),{};for(var n=null,r=0,s=i.childNodes.length;r<s&&1!==(n=i.childNodes[r]).nodeType;r++);return e=null,this._parseNode(n)},_parseNode:function(t){var e=null,i=t.tagName;if("dict"===i)e=this._parseDict(t);else if("array"===i)e=this._parseArray(t);else if("string"===i)if(1===t.childNodes.length)e=t.firstChild.nodeValue;else{e="";for(var n=0;n<t.childNodes.length;n++)e+=t.childNodes[n].nodeValue}else"false"===i?e=!1:"true"===i?e=!0:"real"===i?e=parseFloat(t.firstChild.nodeValue):"integer"===i&&(e=parseInt(t.firstChild.nodeValue,10));return e},_parseArray:function(t){for(var e=[],i=0,n=t.childNodes.length;i<n;i++){var r=t.childNodes[i];1===r.nodeType&&e.push(this._parseNode(r))}return e},_parseDict:function(t){for(var e={},i=null,n=0,r=t.childNodes.length;n<r;n++){var s=t.childNodes[n];1===s.nodeType&&("key"===s.tagName?i=s.firstChild.nodeValue:e[i]=this._parseNode(s))}return e}}),cc.saxParser=new cc.SAXParser,cc.plistParser=new cc.PlistParser}),{}],164:[(function(t,e,i){cc.screen={_supportsFullScreen:!1,_preOnFullScreenChange:null,_touchEvent:"",_fn:null,_fnMap:[["requestFullscreen","exitFullscreen","fullscreenchange","fullscreenEnabled","fullscreenElement"],["requestFullScreen","exitFullScreen","fullScreenchange","fullScreenEnabled","fullScreenElement"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitfullscreenchange","webkitIsFullScreen","webkitCurrentFullScreenElement"],["mozRequestFullScreen","mozCancelFullScreen","mozfullscreenchange","mozFullScreen","mozFullScreenElement"],["msRequestFullscreen","msExitFullscreen","MSFullscreenChange","msFullscreenEnabled","msFullscreenElement"]],init:function(){this._fn={};var t,e,i,n,r=this._fnMap;for(t=0,e=r.length;t<e;t++)if((i=r[t])&&void 0!==document[i[1]]){for(t=0,n=i.length;t<n;t++)this._fn[r[0][t]]=i[t];break}this._supportsFullScreen=void 0!==this._fn.requestFullscreen,this._touchEvent="ontouchstart"in window?"touchstart":"mousedown"},fullScreen:function(){return!!this._supportsFullScreen&&(void 0!==document[this._fn.fullscreenElement]&&null!==document[this._fn.fullscreenElement])},requestFullScreen:function(t,e){if(this._supportsFullScreen){if(t=t||document.documentElement,e){var i=this._fn.fullscreenchange;this._preOnFullScreenChange&&document.removeEventListener(i,this._preOnFullScreenChange),this._preOnFullScreenChange=e,document.addEventListener(i,e,!1)}return t[this._fn.requestFullscreen]()}},exitFullScreen:function(){return!this._supportsFullScreen||document[this._fn.exitFullscreen]()},autoFullScreen:function(t,e){function i(){n.removeEventListener(r._touchEvent,i),r.requestFullScreen(t,e)}t=t||document.body;var n=cc.game.canvas||t,r=this;this.requestFullScreen(t,e),n.addEventListener(this._touchEvent,i)}},cc.screen.init()}),{}],165:[(function(t,e,i){if(!cc.sys){cc.sys={};var n=cc.sys;n.LANGUAGE_ENGLISH="en",n.LANGUAGE_CHINESE="zh",n.LANGUAGE_FRENCH="fr",n.LANGUAGE_ITALIAN="it",n.LANGUAGE_GERMAN="de",n.LANGUAGE_SPANISH="es",n.LANGUAGE_DUTCH="du",n.LANGUAGE_RUSSIAN="ru",n.LANGUAGE_KOREAN="ko",n.LANGUAGE_JAPANESE="ja",n.LANGUAGE_HUNGARIAN="hu",n.LANGUAGE_PORTUGUESE="pt",n.LANGUAGE_ARABIC="ar",n.LANGUAGE_NORWEGIAN="no",n.LANGUAGE_POLISH="pl",n.LANGUAGE_TURKISH="tr",n.LANGUAGE_UKRAINIAN="uk",n.LANGUAGE_ROMANIAN="ro",n.LANGUAGE_BULGARIAN="bg",n.LANGUAGE_UNKNOWN="unknown",n.OS_IOS="iOS",n.OS_ANDROID="Android",n.OS_WINDOWS="Windows",n.OS_MARMALADE="Marmalade",n.OS_LINUX="Linux",n.OS_BADA="Bada",n.OS_BLACKBERRY="Blackberry",n.OS_OSX="OS X",n.OS_WP8="WP8",n.OS_WINRT="WINRT",n.OS_UNKNOWN="Unknown",n.UNKNOWN=-1,n.WIN32=0,n.LINUX=1,n.MACOS=2,n.ANDROID=3,n.IPHONE=4,n.IPAD=5,n.BLACKBERRY=6,n.NACL=7,n.EMSCRIPTEN=8,n.TIZEN=9,n.WINRT=10,n.WP8=11,n.MOBILE_BROWSER=100,n.DESKTOP_BROWSER=101,n.EDITOR_PAGE=102,n.EDITOR_CORE=103,n.WECHAT_GAME=104,n.QQ_PLAY=105,n.BROWSER_TYPE_WECHAT="wechat",n.BROWSER_TYPE_WECHAT_GAME="wechatgame",n.BROWSER_TYPE_WECHAT_GAME_SUB="wechatgamesub",n.BROWSER_TYPE_QQ_PLAY="qqplay",n.BROWSER_TYPE_ANDROID="androidbrowser",n.BROWSER_TYPE_IE="ie",n.BROWSER_TYPE_QQ="qqbrowser",n.BROWSER_TYPE_MOBILE_QQ="mqqbrowser",n.BROWSER_TYPE_UC="ucbrowser",n.BROWSER_TYPE_360="360browser",n.BROWSER_TYPE_BAIDU_APP="baiduboxapp",n.BROWSER_TYPE_BAIDU="baidubrowser",n.BROWSER_TYPE_MAXTHON="maxthon",n.BROWSER_TYPE_OPERA="opera",n.BROWSER_TYPE_OUPENG="oupeng",n.BROWSER_TYPE_MIUI="miuibrowser",n.BROWSER_TYPE_FIREFOX="firefox",n.BROWSER_TYPE_SAFARI="safari",n.BROWSER_TYPE_CHROME="chrome",n.BROWSER_TYPE_LIEBAO="liebao",n.BROWSER_TYPE_QZONE="qzone",n.BROWSER_TYPE_SOUGOU="sogou",n.BROWSER_TYPE_UNKNOWN="unknown",n.isNative=!1,n.isBrowser="object"==typeof window&&"object"==typeof document&&!1,cc.create3DContext=function(t,e,i){if(!i)return cc.create3DContext(t,e,"webgl")||cc.create3DContext(t,e,"experimental-webgl")||cc.create3DContext(t,e,"webkit-3d")||cc.create3DContext(t,e,"moz-webgl")||null;try{return t.getContext(i,e)}catch(t){return null}};var r=wx.getSystemInfoSync();if(n.isMobile=!0,n.platform=n.WECHAT_GAME,n.language=r.language.substr(0,2),"android"===r.platform)n.os=n.OS_ANDROID;else if("ios"===r.platform)n.os=n.OS_IOS;else if("devtools"===r.platform){var s=r.system.toLowerCase();s.indexOf("android")>-1?n.os=n.OS_ANDROID:s.indexOf("ios")>-1&&(n.os=n.OS_IOS)}var o=/[\d\.]+/.exec(r.system);n.osVersion=o[0],n.osMainVersion=parseInt(n.osVersion),wx.getFileSystemManager?n.browserType=n.BROWSER_TYPE_WECHAT_GAME:n.browserType=n.BROWSER_TYPE_WECHAT_GAME_SUB,n.browserVersion=r.version;var a=r.windowWidth,c=r.windowHeight,h=r.pixelRatio||1;n.windowPixelResolution={width:h*a,height:h*c},n.localStorage=window.localStorage,n.capabilities={canvas:!0,opengl:!0,webp:!1},n.__audioSupport={ONLY_ONE:!1,WEB_AUDIO:!1,DELAY_CREATE_CTX:!1,format:[".mp3"]},n.garbageCollect=function(){},n.dumpRoot=function(){},n.restartVM=function(){},n.cleanScript=function(t){},n.isObjectValid=function(t){return!!t},n.dump=function(){var t="";t+="isMobile : "+this.isMobile+"\r\n",t+="language : "+this.language+"\r\n",t+="browserType : "+this.browserType+"\r\n",t+="browserVersion : "+this.browserVersion+"\r\n",t+="capabilities : "+JSON.stringify(this.capabilities)+"\r\n",t+="os : "+this.os+"\r\n",t+="osVersion : "+this.osVersion+"\r\n",t+="platform : "+this.platform+"\r\n",t+="Using "+(cc._renderType===cc.game.RENDER_TYPE_WEBGL?"WEBGL":"CANVAS")+" renderer.\r\n",cc.log(t)},n.openURL=function(t){window.open(t)},n.now=function(){return Date.now?Date.now():+new Date},e.exports=n}}),{}],166:[(function(t,e,i){var n=t("../event-manager"),r={init:function(){0},availWidth:function(t){return t&&t!==this.html?t.clientWidth:window.innerWidth},availHeight:function(t){return t&&t!==this.html?t.clientHeight:window.innerHeight},meta:{width:"device-width"},adaptationType:cc.sys.browserType};switch(cc.sys.os===cc.sys.OS_IOS&&(r.adaptationType=cc.sys.BROWSER_TYPE_SAFARI),cc.sys.browserType===cc.sys.BROWSER_TYPE_WECHAT_GAME_SUB?r.adaptationType=cc.sys.BROWSER_TYPE_WECHAT_GAME_SUB:r.adaptationType=cc.sys.BROWSER_TYPE_WECHAT_GAME,r.adaptationType){case cc.sys.BROWSER_TYPE_SAFARI:r.meta["minimal-ui"]="true",r.availWidth=function(t){return t.clientWidth},r.availHeight=function(t){return t.clientHeight};break;case cc.sys.BROWSER_TYPE_CHROME:r.__defineGetter__("target-densitydpi",(function(){return cc.view._targetDensityDPI}));break;case cc.sys.BROWSER_TYPE_SOUGOU:case cc.sys.BROWSER_TYPE_UC:r.availWidth=function(t){return t.clientWidth},r.availHeight=function(t){return t.clientHeight};break;case cc.sys.BROWSER_TYPE_MIUI:r.init=function(t){if(!t.__resizeWithBrowserSize){var e=function(){t.setDesignResolutionSize(t._designResolutionSize.width,t._designResolutionSize.height,t._resolutionPolicy),window.removeEventListener("resize",e,!1)};window.addEventListener("resize",e,!1)}};break;case cc.sys.BROWSER_TYPE_WECHAT_GAME:r.availWidth=function(){return window.innerWidth},r.availHeight=function(){return window.innerHeight};break;case cc.sys.BROWSER_TYPE_WECHAT_GAME_SUB:var s=wx.getSharedCanvas();r.availWidth=function(){return s.width},r.availHeight=function(){return s.height}}var o=null,a=cc._Class.extend({ctor:function(){var t=cc.ContainerStrategy,e=cc.ContentStrategy;r.init(this),this._frameSize=cc.size(0,0),this._initFrameSize();var i=cc.game.canvas.width,n=cc.game.canvas.height;this._designResolutionSize=cc.size(i,n),this._originalDesignResolutionSize=cc.size(i,n),this._viewPortRect=cc.rect(0,0,i,n),this._visibleRect=cc.rect(0,0,i,n),this._contentTranslateLeftTop={left:0,top:0},this._autoFullScreen=!1,this._devicePixelRatio=1,this._viewName="Cocos2dHTML5",this._resizeCallback=null,this._orientationChanging=!0,this._resizing=!1,this._scaleX=1,this._originalScaleX=1,this._scaleY=1,this._originalScaleY=1,this._isRotated=!1,this._orientation=3;var s=cc.sys;this.enableRetina(s.os===s.OS_IOS||s.os===s.OS_OSX),cc.visibleRect&&cc.visibleRect.init(this._visibleRect),this._resolutionPolicy=null,this._rpExactFit=new cc.ResolutionPolicy(t.EQUAL_TO_FRAME,e.EXACT_FIT),this._rpShowAll=new cc.ResolutionPolicy(t.PROPORTION_TO_FRAME,e.SHOW_ALL),this._rpNoBorder=new cc.ResolutionPolicy(t.EQUAL_TO_FRAME,e.NO_BORDER),this._rpFixedHeight=new cc.ResolutionPolicy(t.EQUAL_TO_FRAME,e.FIXED_HEIGHT),this._rpFixedWidth=new cc.ResolutionPolicy(t.EQUAL_TO_FRAME,e.FIXED_WIDTH),this._initialized=!1,this._contentTranslateLeftTop=null,this._frameZoomFactor=1,this.__resizeWithBrowserSize=!1,this._isAdjustViewPort=!0,this._targetDensityDPI=cc.macro.DENSITYDPI_HIGH,this.enableAntiAlias(!0)},_resizeEvent:function(){var t,e=(t=this.setDesignResolutionSize?this:cc.view)._frameSize.width,i=t._frameSize.height,r=t._isRotated;if(cc.sys.isMobile){var s=cc.game.container.style,o=s.margin;s.margin="0",s.display="none",t._initFrameSize(),s.margin=o,s.display="block"}else t._initFrameSize();if(t._isRotated!==r||t._frameSize.width!==e||t._frameSize.height!==i){var a=t._originalDesignResolutionSize.width,c=t._originalDesignResolutionSize.height;t._resizing=!0,a>0&&t.setDesignResolutionSize(a,c,t._resolutionPolicy),t._resizing=!1,n.dispatchCustomEvent("canvas-resize"),t._resizeCallback&&t._resizeCallback.call()}},_orientationChange:function(){cc.view._orientationChanging=!0,cc.view._resizeEvent()},setTargetDensityDPI:function(t){this._targetDensityDPI=t,this._adjustViewportMeta()},getTargetDensityDPI:function(){return this._targetDensityDPI},resizeWithBrowserSize:function(t){t?this.__resizeWithBrowserSize||(this.__resizeWithBrowserSize=!0,window.addEventListener("resize",this._resizeEvent),window.addEventListener("orientationchange",this._orientationChange)):this.__resizeWithBrowserSize&&(this.__resizeWithBrowserSize=!1,window.removeEventListener("resize",this._resizeEvent),window.removeEventListener("orientationchange",this._orientationChange))},setResizeCallback:function(t){"function"!=typeof t&&null!=t||(this._resizeCallback=t)},setOrientation:function(t){if((t&=cc.macro.ORIENTATION_AUTO)&&this._orientation!==t){this._orientation=t;var e=this._originalDesignResolutionSize.width,i=this._originalDesignResolutionSize.height;this.setDesignResolutionSize(e,i,this._resolutionPolicy)}},_initFrameSize:function(){var t=this._frameSize,e=r.availWidth(cc.game.frame),i=r.availHeight(cc.game.frame),n=e>=i;!cc.sys.isMobile||n&&this._orientation&cc.macro.ORIENTATION_LANDSCAPE||!n&&this._orientation&cc.macro.ORIENTATION_PORTRAIT?(t.width=e,t.height=i,cc.container.style["-webkit-transform"]="rotate(0deg)",cc.container.style.transform="rotate(0deg)",this._isRotated=!1):(t.width=i,t.height=e,cc.container.style["-webkit-transform"]="rotate(90deg)",cc.container.style.transform="rotate(90deg)",cc.container.style["-webkit-transform-origin"]="0px 0px 0px",cc.container.style.transformOrigin="0px 0px 0px",this._isRotated=!0),this._orientationChanging&&setTimeout((function(){cc.view._orientationChanging=!1}),1e3)},_adjustSizeKeepCanvasSize:function(){var t=this._originalDesignResolutionSize.width,e=this._originalDesignResolutionSize.height;t>0&&this.setDesignResolutionSize(t,e,this._resolutionPolicy)},_setViewportMeta:function(t,e){var i=document.getElementById("cocosMetaElement");i&&e&&document.head.removeChild(i);var n,r,s,o=document.getElementsByName("viewport"),a=o?o[0]:null;n=a?a.content:"",(i=i||document.createElement("meta")).id="cocosMetaElement",i.name="viewport",i.content="";for(r in t)-1==n.indexOf(r)?n+=","+r+"="+t[r]:e&&(s=new RegExp(r+"s*=s*[^,]+"),n.replace(s,r+"="+t[r]));/^,/.test(n)&&(n=n.substr(1)),i.content=n,a&&(a.content=n),document.head.appendChild(i)},_adjustViewportMeta:function(){this._isAdjustViewPort,0},_resetScale:function(){this._scaleX=this._originalScaleX,this._scaleY=this._originalScaleY},_adjustSizeToBrowser:function(){},initialize:function(){this._initialized=!0},adjustViewPort:function(t){this._isAdjustViewPort=t},enableRetina:function(t){this._retinaEnabled=!!t},isRetinaEnabled:function(){return this._retinaEnabled},enableAntiAlias:function(t){if(this._antiAliasEnabled!==t)if(this._antiAliasEnabled=t,cc._renderType===cc.game.RENDER_TYPE_WEBGL){var e=cc.loader._cache;for(var i in e){var n=e[i],r=n&&n.content instanceof cc.Texture2D?n.content:null;r&&(t?r.setAntiAliasTexParameters():r.setAliasTexParameters())}}else if(cc._renderType===cc.game.RENDER_TYPE_CANVAS){var s=cc._canvas.getContext("2d");s.imageSmoothingEnabled=t,s.mozImageSmoothingEnabled=t;var o=cc.rendererCanvas._dirtyRegion;if(o){var a=new cc.Region;a.setTo(0,0,cc.visibleRect.width,cc.visibleRect.height),o.addRegion(a)}}},isAntiAliasEnabled:function(){return this._antiAliasEnabled},enableAutoFullScreen:function(t){t&&t!==this._autoFullScreen&&cc.sys.isMobile&&cc.sys.browserType!==cc.sys.BROWSER_TYPE_WECHAT?(this._autoFullScreen=!0,cc.screen.autoFullScreen(cc.game.frame)):this._autoFullScreen=!1},isAutoFullScreenEnabled:function(){return this._autoFullScreen},isViewReady:function(){return cc.game.canvas&&cc._renderContext},setFrameZoomFactor:function(t){this._frameZoomFactor=t,cc.director.setProjection(cc.director.getProjection())},setContentTranslateLeftTop:function(t,e){this._contentTranslateLeftTop={left:t,top:e}},getContentTranslateLeftTop:function(){return this._contentTranslateLeftTop},setCanvasSize:function(t,e){var i=cc.game.canvas,n=cc.game.container;i.width=t*this._devicePixelRatio,i.height=e*this._devicePixelRatio,i.style.width=t+"px",i.style.height=e+"px",n.style.width=t+"px",n.style.height=e+"px",this._resizeEvent()},getCanvasSize:function(){return cc.size(cc.game.canvas.width,cc.game.canvas.height)},getFrameSize:function(){return cc.size(this._frameSize.width,this._frameSize.height)},setFrameSize:function(t,e){this._frameSize.width=t,this._frameSize.height=e,cc.game.frame.style.width=t+"px",cc.game.frame.style.height=e+"px",this._resizeEvent(),cc.director.setProjection(cc.director.getProjection())},getVisibleSize:function(){return cc.size(this._visibleRect.width,this._visibleRect.height)},getVisibleSizeInPixel:function(){return cc.size(this._visibleRect.width*this._scaleX,this._visibleRect.height*this._scaleY)},getVisibleOrigin:function(){return cc.p(this._visibleRect.x,this._visibleRect.y)},getVisibleOriginInPixel:function(){return cc.p(this._visibleRect.x*this._scaleX,this._visibleRect.y*this._scaleY)},canSetContentScaleFactor:function(){return!0},getResolutionPolicy:function(){return this._resolutionPolicy},setResolutionPolicy:function(t){if(t instanceof cc.ResolutionPolicy)this._resolutionPolicy=t;else{var e=cc.ResolutionPolicy;t===e.EXACT_FIT&&(this._resolutionPolicy=this._rpExactFit),t===e.SHOW_ALL&&(this._resolutionPolicy=this._rpShowAll),t===e.NO_BORDER&&(this._resolutionPolicy=this._rpNoBorder),t===e.FIXED_HEIGHT&&(this._resolutionPolicy=this._rpFixedHeight),t===e.FIXED_WIDTH&&(this._resolutionPolicy=this._rpFixedWidth)}},setDesignResolutionSize:function(t,e,i){if(t>0||e>0){this.setResolutionPolicy(i);var n=this._resolutionPolicy;if(n&&n.preApply(this),cc.sys.isMobile&&this._adjustViewportMeta(),this._orientationChanging=!0,this._resizing||this._initFrameSize(),n){this._originalDesignResolutionSize.width=this._designResolutionSize.width=t,this._originalDesignResolutionSize.height=this._designResolutionSize.height=e;var r=n.apply(this,this._designResolutionSize);if(r.scale&&2===r.scale.length&&(this._scaleX=r.scale[0],this._scaleY=r.scale[1]),r.viewport){var s=this._viewPortRect,o=this._visibleRect,a=r.viewport;s.x=a.x,s.y=a.y,s.width=a.width,s.height=a.height,o.x=-s.x/this._scaleX,o.y=-s.y/this._scaleY,o.width=cc.game.canvas.width/this._scaleX,o.height=cc.game.canvas.height/this._scaleY,cc._renderContext.setOffset&&cc._renderContext.setOffset(s.x,-s.y)}var c=cc.director;c._winSizeInPoints.width=this._designResolutionSize.width,c._winSizeInPoints.height=this._designResolutionSize.height,n.postApply(this),cc.winSize.width=c._winSizeInPoints.width,cc.winSize.height=c._winSizeInPoints.height,cc._renderType===cc.game.RENDER_TYPE_WEBGL?c.setGLDefaultValues():cc._renderType===cc.game.RENDER_TYPE_CANVAS&&(cc.renderer._allNeedDraw=!0),this._originalScaleX=this._scaleX,this._originalScaleY=this._scaleY,cc.visibleRect&&cc.visibleRect.init(this._visibleRect)}else cc.logID(2201)}else cc.logID(2200)},getDesignResolutionSize:function(){return cc.size(this._designResolutionSize.width,this._designResolutionSize.height)},setRealPixelResolution:function(t,e,i){this.setDesignResolutionSize(t,e,i)},setViewPortInPoints:function(t,e,i,n){var r=this._frameZoomFactor,s=this._scaleX,o=this._scaleY;cc._renderContext.viewport(t*s*r+this._viewPortRect.x*r,e*o*r+this._viewPortRect.y*r,i*s*r,n*o*r)},setScissorInPoints:function(t,e,i,n){var r=this._frameZoomFactor,s=this._scaleX,a=this._scaleY,c=Math.ceil(t*s*r+this._viewPortRect.x*r),h=Math.ceil(e*a*r+this._viewPortRect.y*r),l=Math.ceil(i*s*r),_=Math.ceil(n*a*r);if(!o){var u=gl.getParameter(gl.SCISSOR_BOX);o=cc.rect(u[0],u[1],u[2],u[3])}o.x===c&&o.y===h&&o.width===l&&o.height===_||(o.x=c,o.y=h,o.width=l,o.height=_,cc._renderContext.scissor(c,h,l,_))},isScissorEnabled:function(){return cc._renderContext.isEnabled(gl.SCISSOR_TEST)},getScissorRect:function(){if(!o){var t=gl.getParameter(gl.SCISSOR_BOX);o=cc.rect(t[0],t[1],t[2],t[3])}var e=1/this._scaleX,i=1/this._scaleY;return cc.rect((o.x-this._viewPortRect.x)*e,(o.y-this._viewPortRect.y)*i,o.width*e,o.height*i)},setViewName:function(t){null!=t&&t.length>0&&(this._viewName=t)},getViewName:function(){return this._viewName},getViewPortRect:function(){return this._viewPortRect},getScaleX:function(){return this._scaleX},getScaleY:function(){return this._scaleY},getDevicePixelRatio:function(){return this._devicePixelRatio},convertToLocationInView:function(t,e,i){var n=this._devicePixelRatio*(t-i.left),r=this._devicePixelRatio*(i.top+i.height-e);return this._isRotated?{x:this._viewPortRect.width-r,y:n}:{x:n,y:r}},_convertMouseToLocationInView:function(t,e){var i=this._viewPortRect;t.x=(this._devicePixelRatio*(t.x-e.left)-i.x)/this._scaleX,t.y=(this._devicePixelRatio*(e.top+e.height-t.y)-i.y)/this._scaleY},_convertPointWithScale:function(t){var e=this._viewPortRect;t.x=(t.x-e.x)/this._scaleX,t.y=(t.y-e.y)/this._scaleY},_convertTouchesWithScale:function(t){for(var e,i,n,r=this._viewPortRect,s=this._scaleX,o=this._scaleY,a=0;a<t.length;a++)i=(e=t[a])._point,n=e._prevPoint,i.x=(i.x-r.x)/s,i.y=(i.y-r.y)/o,n.x=(n.x-r.x)/s,n.y=(n.y-r.y)/o}});a._getInstance=function(){return this._instance||(this._instance=this._instance||new a,this._instance.initialize()),this._instance},cc.ContainerStrategy=cc._Class.extend({preApply:function(t){},apply:function(t,e){},postApply:function(t){},_setupContainer:function(t,e,i){var n=cc.game.canvas,r=cc.game.container;cc.sys.platform!==cc.sys.WECHAT_GAME&&(cc.sys.os===cc.sys.OS_ANDROID&&(document.body.style.width=(t._isRotated?i:e)+"px",document.body.style.height=(t._isRotated?e:i)+"px"),r.style.width=n.style.width=e+"px",r.style.height=n.style.height=i+"px");var s=t._devicePixelRatio=1;if(t.isRetinaEnabled()&&(s=t._devicePixelRatio=Math.min(2,window.devicePixelRatio||1)),n.width=e*s,n.height=i*s,cc.sys.browserType===cc.sys.BROWSER_TYPE_WECHAT_GAME&&wx&&wx.getOpenDataContext){var o=wx.getOpenDataContext().canvas;o&&(o.width=n.width,o.height=n.height)}cc._renderContext.resetCache&&cc._renderContext.resetCache()},_fixContainer:function(){document.body.insertBefore(cc.container,document.body.firstChild);var t=document.body.style;t.width=window.innerWidth+"px",t.height=window.innerHeight+"px",t.overflow="hidden";var e=cc.container.style;e.position="fixed",e.left=e.top="0px",document.body.scrollTop=0}}),cc.ContentStrategy=cc._Class.extend({_result:{scale:[1,1],viewport:null},_buildResult:function(t,e,i,n,r,s){Math.abs(t-i)<2&&(i=t),Math.abs(e-n)<2&&(n=e);var o=cc.rect(Math.round((t-i)/2),Math.round((e-n)/2),i,n);return cc._renderType,cc.game.RENDER_TYPE_CANVAS,this._result.scale=[r,s],this._result.viewport=o,this._result},preApply:function(t){},apply:function(t,e){return{scale:[1,1]}},postApply:function(t){}}),(function(){var t=cc.ContainerStrategy.extend({apply:function(t){var e=t._frameSize.height,i=cc.container.style;this._setupContainer(t,t._frameSize.width,t._frameSize.height),t._isRotated?i.margin="0 0 0 "+e+"px":i.margin="0px",i.padding="0px"}}),e=cc.ContainerStrategy.extend({apply:function(t,e){var i,n,r=t._frameSize.width,s=t._frameSize.height,o=cc.container.style,a=e.width,c=e.height,h=r/a,l=s/c;h<l?(i=r,n=c*h):(i=a*l,n=s);var _=Math.round((r-i)/2),u=Math.round((s-n)/2);i=r-2*_,n=s-2*u,this._setupContainer(t,i,n),t._isRotated?o.margin="0 0 0 "+s+"px":o.margin="0px",o.paddingLeft=_+"px",o.paddingRight=_+"px",o.paddingTop=u+"px",o.paddingBottom=u+"px"}}),i=(t.extend({preApply:function(t){this._super(t),cc.game.frame=document.documentElement},apply:function(t){this._super(t),this._fixContainer()}}),e.extend({preApply:function(t){this._super(t),cc.game.frame=document.documentElement},apply:function(t,e){this._super(t,e),this._fixContainer()}}),cc.ContainerStrategy.extend({apply:function(t){this._setupContainer(t,cc.game.canvas.width,cc.game.canvas.height)}}));cc.ContainerStrategy.EQUAL_TO_FRAME=new t,cc.ContainerStrategy.PROPORTION_TO_FRAME=new e,cc.ContainerStrategy.ORIGINAL_CONTAINER=new i;var n=cc.ContentStrategy.extend({apply:function(t,e){var i=cc.game.canvas.width,n=cc.game.canvas.height,r=i/e.width,s=n/e.height;return this._buildResult(i,n,i,n,r,s)}}),r=cc.ContentStrategy.extend({apply:function(t,e){var i,n,r=cc.game.canvas.width,s=cc.game.canvas.height,o=e.width,a=e.height,c=r/o,h=s/a,l=0;return c<h?(l=c,i=r,n=a*l):(l=h,i=o*l,n=s),this._buildResult(r,s,i,n,l,l)}}),s=cc.ContentStrategy.extend({apply:function(t,e){var i,n,r,s=cc.game.canvas.width,o=cc.game.canvas.height,a=e.width,c=e.height,h=s/a,l=o/c;return h<l?(i=l,n=a*i,r=o):(i=h,n=s,r=c*i),this._buildResult(s,o,n,r,i,i)}}),o=cc.ContentStrategy.extend({apply:function(t,e){var i=cc.game.canvas.width,n=cc.game.canvas.height,r=n/e.height,s=i,o=n;return this._buildResult(i,n,s,o,r,r)},postApply:function(t){cc.director._winSizeInPoints=t.getVisibleSize()}}),a=cc.ContentStrategy.extend({apply:function(t,e){var i=cc.game.canvas.width,n=cc.game.canvas.height,r=i/e.width,s=i,o=n;return this._buildResult(i,n,s,o,r,r)},postApply:function(t){cc.director._winSizeInPoints=t.getVisibleSize()}});cc.ContentStrategy.EXACT_FIT=new n,cc.ContentStrategy.SHOW_ALL=new r,cc.ContentStrategy.NO_BORDER=new s,cc.ContentStrategy.FIXED_HEIGHT=new o,cc.ContentStrategy.FIXED_WIDTH=new a})(),cc.ResolutionPolicy=cc._Class.extend({_containerStrategy:null,_contentStrategy:null,ctor:function(t,e){this.setContainerStrategy(t),this.setContentStrategy(e)},preApply:function(t){this._containerStrategy.preApply(t),this._contentStrategy.preApply(t)},apply:function(t,e){return this._containerStrategy.apply(t,e),this._contentStrategy.apply(t,e)},postApply:function(t){this._containerStrategy.postApply(t),this._contentStrategy.postApply(t)},setContainerStrategy:function(t){t instanceof cc.ContainerStrategy&&(this._containerStrategy=t)},setContentStrategy:function(t){t instanceof cc.ContentStrategy&&(this._contentStrategy=t)}}),cc.js.get(cc.ResolutionPolicy.prototype,"canvasSize",(function(){return cc.v2(cc.game.canvas.width,cc.game.canvas.height)})),cc.ResolutionPolicy.EXACT_FIT=0,cc.ResolutionPolicy.NO_BORDER=1,cc.ResolutionPolicy.SHOW_ALL=2,cc.ResolutionPolicy.FIXED_HEIGHT=3,cc.ResolutionPolicy.FIXED_WIDTH=4,cc.ResolutionPolicy.UNKNOWN=5,e.exports=a}),{"../event-manager":90}],167:[(function(t,e,i){cc.visibleRect={topLeft:cc.p(0,0),topRight:cc.p(0,0),top:cc.p(0,0),bottomLeft:cc.p(0,0),bottomRight:cc.p(0,0),bottom:cc.p(0,0),center:cc.p(0,0),left:cc.p(0,0),right:cc.p(0,0),width:0,height:0,init:function(t){var e=this.width=t.width,i=this.height=t.height,n=t.x,r=t.y,s=r+i,o=n+e;this.topLeft.x=n,this.topLeft.y=s,this.topRight.x=o,this.topRight.y=s,this.top.x=n+e/2,this.top.y=s,this.bottomLeft.x=n,this.bottomLeft.y=r,this.bottomRight.x=o,this.bottomRight.y=r,this.bottom.x=n+e/2,this.bottom.y=r,this.center.x=n+e/2,this.center.y=r+i/2,this.left.x=n,this.left.y=r+i/2,this.right.x=o,this.right.y=r+i/2}}}),{}],168:[(function(t,e,i){var n=cc.ClassManager={instanceId:0|998*Math.random(),getNewInstanceId:function(){return this.instanceId++}},r=/\b_super\b/,s=function(){};s.extend=function(t){var e,i=this.prototype,o=Object.create(i),a={writable:!0,enumerable:!1,configurable:!0};(e=function(t,e,i,r,s){if(this.__instanceId=n.getNewInstanceId(),this.ctor)switch(arguments.length){case 0:this.ctor();break;case 1:this.ctor(t);break;case 2:this.ctor(t,e);break;case 3:this.ctor(t,e,i);break;case 4:this.ctor(t,e,i,r);break;case 5:this.ctor(t,e,i,r,s);break;default:this.ctor.apply(this,arguments)}}).prototype=o,a.value=e,Object.defineProperty(o,"constructor",a);for(var c in t){var h="function"==typeof t[c];h&&"function"==typeof i[c]&&r.test(t[c])?(a.value=(function(t,e){return function(){var n=this._super;this._super=i[t];var r=e.apply(this,arguments);return this._super=n,r}})(c,t[c]),Object.defineProperty(o,c,a)):h?(a.value=t[c],Object.defineProperty(o,c,a)):o[c]=t[c]}return e.extend=s.extend,e.implement=function(t){for(var e in t)o[e]=t[e]},e},cc.defineGetterSetter=function(t,e,i,n,r,s){if(t.__defineGetter__)i&&t.__defineGetter__(e,i),n&&t.__defineSetter__(e,n);else{if(!Object.defineProperty)throw new Error("browser does not support getters");var o={configurable:!0};i&&(o.get=i),n&&(o.set=n),Object.defineProperty(t,e,o)}},cc.clone=function(t){var e=t.constructor?new t.constructor:{};for(var i in t){var n=t[i];"object"!=typeof n||!n||n instanceof _ccsg.Node||n instanceof HTMLElement?e[i]=n:e[i]=cc.clone(n)}return e},cc._Class=e.exports=s}),{}],169:[(function(t,e,i){function n(t,e,i){var n;n=function(){},i&&c.extend(n,i.constructor);var r=new n;return c.value(t,"__attrs__",r),r}function r(t,e,i){var r,o,a;if("function"==typeof t)o=(r=s(t)).constructor.prototype;else{var c=t;if(!(r=c.__attrs__)){r=n(c,0,s(t=c.constructor))}o=r}if(void 0===i){var l=e+h,_={};for(a in r)a.startsWith(l)&&(_[a.slice(l.length)]=r[a]);return _}if("object"==typeof i)for(a in i)95!==a.charCodeAt(0)&&(o[e+h+a]=i[a]);else 0}function s(t){return t.hasOwnProperty("__attrs__")&&t.__attrs__||(function(t){for(var e,i=cc.Class.getInheritanceChain(t),r=i.length-1;r>=0;r--){var s=i[r];s.hasOwnProperty("__attrs__")&&s.__attrs__||n(s,0,(e=i[r+1])&&e.__attrs__)}return e=i[0],n(t,0,e&&e.__attrs__),t.__attrs__})(t)}function o(t){return s(t).constructor.prototype}function a(t,e){0}var c=t("./js"),h=(t("./utils").isPlainEmptyObj_DEV,"$_$");cc.Integer="Integer",cc.Float="Float",cc.Boolean="Boolean",cc.String="String",e.exports={attr:r,getClassAttrs:s,getClassAttrsProto:o,setClassAttr:function(t,e,i,n){o(t)[e+h+i]=n},DELIMETER:h,getTypeChecker:a,ObjectType:function(t){return{type:"Object",ctor:t,_onAfterProp:!1}},ScriptUuid:{}}}),{"./CCClass":156,"./js":177,"./utils":181}],170:[(function(t,e,i){function n(){this.callbacks=[],this.targets=[],this.isInvoking=!1,this.containCanceled=!1}function r(){this._callbackTable=s.createMap(!0)}var s=t("./js"),o=s.array.fastRemoveAt,a=n.prototype;a.removeBy=function(t,e){for(var i=this.callbacks,n=this.targets,r=0;r<t.length;++r)t[r]===e&&(o(i,r),o(n,r),--r)},a.cancel=function(t){this.callbacks[t]=this.targets[t]=null,this.containCanceled=!0},a.cancelAll=function(){for(var t=this.callbacks,e=this.targets,i=0;i<t.length;i++)t[i]=e[i]=null;this.containCanceled=!0},a.purgeCanceled=function(){this.removeBy(this.callbacks,null),this.containCanceled=!1};var c=new s.Pool(function(t){t.callbacks.length=0,t.targets.length=0,t.isInvoking=!1,t.containCanceled=!1},16);c.get=function(){return this._get()||new n},(a=r.prototype).add=function(t,e,i){var n=this._callbackTable[t];n||(n=this._callbackTable[t]=c.get()),n.callbacks.push(e),n.targets.push(i||null)},a.has=function(t,e,i){var n=this._callbackTable[t];if(!n)return!1;var r=n.callbacks;if(!e){for(var s=0;s<r.length;s++)if(r[s])return!0;return!1}i=i||null;for(var o=n.targets,a=0;a<r.length;++a)if(r[a]===e&&o[a]===i)return!0;return!1},a.removeAll=function(t){if("string"==typeof t){var e=this._callbackTable[t];e&&(e.isInvoking?e.cancelAll():(c.put(e),delete this._callbackTable[t]))}else if(t)for(var i in this._callbackTable){var n=this._callbackTable[i];if(n.isInvoking)for(var r=n.targets,s=0;s<r.length;++s)r[s]===t&&n.cancel(s);else n.removeBy(n.targets,t)}},a.remove=function(t,e,i){var n=this._callbackTable[t];if(n){i=i||null;for(var r=n.callbacks,s=n.targets,a=0;a<r.length;++a)if(r[a]===e&&s[a]===i){n.isInvoking?n.cancel(a):(o(r,a),o(s,a));break}}};var h=function(){r.call(this)};s.extend(h,r),h.prototype.invoke=function(t,e,i,n,r,s){var o=this._callbackTable[t];if(o){var a=!o.isInvoking;o.isInvoking=!0;for(var c=o.callbacks,h=o.targets,l=0,_=c.length;l<_;++l){var u=c[l];if(u){var d=h[l];d?u.call(d,e,i,n,r,s):u(e,i,n,r,s)}}a&&(o.isInvoking=!1,o.containCanceled&&o.purgeCanceled())}},h.CallbacksHandler=r,e.exports=h}),{"./js":177}],171:[(function(t,e,i){function n(t,e){for(var i=0;i<e.length;i++){var r=e[i];Array.isArray(r)?n(t,r):t.push(r)}}e.exports={flattenCodeArray:function(t){var e=[];return n(e,t),e.join("")}}}),{}],172:[(function(t,e,i){var n=t("./js"),r=(t("./CCObject"),t("./attribute")),s=t("./CCClass"),o=t("../utils/misc"),a=function(){this.uuidList=[],this.uuidObjList=[],this.uuidPropList=[],this.rawProp=""};a.prototype.reset=function(){this.uuidList.length=0,this.uuidObjList.length=0,this.uuidPropList.length=0,this.rawProp=""},a.prototype.getUuidOf=function(t,e){for(var i=0;i<this.uuidObjList.length;i++)if(this.uuidObjList[i]===t&&this.uuidPropList[i]===e)return this.uuidList[i];return""},a.prototype.push=function(t,e,i){this.uuidList.push(i),this.uuidObjList.push(t),this.uuidPropList.push(e)},(a.pool=new n.Pool(function(t){t.reset()},10)).get=function(){return this._get()||new a};var c=(function(){function t(t,e,i,n,r){this.result=t,this.customEnv=n,this.deserializedList=[],this.deserializedData=null,this._classFinder=i,this._idList=[],this._idObjList=[],this._idPropList=[]}function e(t,e,i,r,s){var o;r.hasOwnProperty("__deserialize__")?o=r.__deserialize__:(o=c(t,r),n.value(r,"__deserialize__",o,!0)),o(t,e,i,r,s)}var i=t.prototype;i.deserialize=function(t){if(Array.isArray(t)){var e=t,i=e.length;this.deserializedList.length=i;for(var n=0;n<i;n++)if(e[n]){this.deserializedList[n]=this._deserializeObject(e[n])}this.deserializedData=i>0?this.deserializedList[0]:[]}else this.deserializedList.length=1,this.deserializedData=t?this._deserializeObject(t):null,this.deserializedList[0]=this.deserializedData;return (function(t){var e,i,n,r=t.deserializedList,s=t._idPropList,o=t._idList,a=t._idObjList;for(t._classFinder&&t._classFinder.onDereferenced,e=0;e<o.length;e++)i=s[e],n=o[e],a[e][i]=r[n]})(this),this.deserializedData},i._deserializeObject=function(t,i,r,s){var o,a=null,c=null,h=t.__type__;if(h){if(!(c=this._classFinder(h,t,r,s))){return this._classFinder===n._getClassById&&cc.deserialize.reportMissingClass(h),null}if((a=new c)._deserialize)return a._deserialize(t.content,this),a;cc.Class._isCCClass(c)?e(this,a,t,c,i):this._deserializeTypedObject(a,t,c)}else if(Array.isArray(t)){a=new Array(t.length);for(var l=0;l<t.length;l++)"object"==typeof(o=t[l])&&o?this._deserializeObjField(a,o,""+l):a[l]=o}else a={},this._deserializePrimitiveObject(a,t);return a},i._deserializeObjField=function(t,e,i,n){var r=e.__id__;if(void 0===r){var s=e.__uuid__;s?(this.result.uuidList.push(s),this.result.uuidObjList.push(t),this.result.uuidPropList.push(i)):t[i]=this._deserializeObject(e)}else{var o=this.deserializedList[r];o?t[i]=o:(this._idList.push(r),this._idObjList.push(t),this._idPropList.push(i))}},i._deserializePrimitiveObject=function(t,e){for(var i in e)if(e.hasOwnProperty(i)){var n=e[i];"object"!=typeof n?"__type__"!==i&&(t[i]=n):n?this._deserializeObjField(t,n,i):t[i]=null}},i._deserializeTypedObject=function(t,e,i){if(i===cc.Vec2)return t.x=e.x||0,void(t.y=e.y||0);if(i!==cc.Color){if(i===cc.Size)return t.width=e.width||0,void(t.height=e.height||0);var n=i.__props__;n||(n=Object.keys(t));for(var r=0;r<n.length;r++){var s=n[r],o=e[s];void 0!==o&&e.hasOwnProperty(s)&&("object"!=typeof o?t[s]=o:o?this._deserializeObjField(t,o,s):t[s]=null)}}else{t.r=e.r||0,t.g=e.g||0,t.b=e.b||0;var a=e.a;t.a=void 0===a?255:a}};var a=function(t,e,i,n,r,s,o){if(r instanceof cc.ValueType){var a=r.constructor;o?t._deserializeTypedObject(e[s],n,a):n?t._deserializeTypedObject(e[s],n,a):e[s]=null}else n?t._deserializeObjField(e,n,s):e[s]=null},c=function(t,e){var i=r.DELIMETER+"rawType",c=(r.DELIMETER,r.DELIMETER+"serializable"),h=r.DELIMETER+"default",l=r.DELIMETER+"saveUrlAsAsset",_=r.DELIMETER+"formerlySerializedAs",u=r.getClassAttrs(e),d=e.__props__,m=o.BUILTIN_CLASSID_RE.test(n._getClassId(e));return function(t,e,n,r,o){for(var f,p=0;p<d.length;p++){var g=d[p];if(u[g+i])t.result.rawProp&&cc.error("not support multi raw object in a file"),t.result.rawProp=g;else{if(!1===u[g+c])continue;var v=g;if(u[g+_]&&(v=u[g+_]),void 0!==(f=n[v])){var y=s.getDefault(u[g+h]);if(m){var x=typeof y;"string"===x&&!u[g+l]||"number"===x||"boolean"===x?e[g]=f:a(t,e,o,f,y,g,!0)}else"object"!=typeof f?e[g]=f:a(t,e,o,f,y,g,!1)}}}"_$erialized"===d[d.length-1]&&(e._$erialized=JSON.parse(JSON.stringify(n)),t._deserializePrimitiveObject(e._$erialized,n))}};return t.pool=new n.Pool(function(t){t.result=null,t.customEnv=null,t.deserializedList.length=0,t.deserializedData=null,t._classFinder=null,t._idList.length=0,t._idObjList.length=0,t._idPropList.length=0},1),t.pool.get=function(e,i,n,r,s){var o=this._get();return o?(o.result=e,o.customEnv=r,o._classFinder=n,o):new t(e,i,n,r,s)},t})();cc.deserialize=function(t,e,i){var r=(i=i||{}).classFinder||n._getClassById,s=i.createAssetRefs||cc.sys.platform===cc.sys.EDITOR_CORE,o=i.customEnv,h=i.ignoreEditorOnly;"string"==typeof t&&(t=JSON.parse(t));var l=!e;e=e||a.pool.get();var _=c.pool.get(e,!1,r,o,h);cc.game._isCloning=!0;var u=_.deserialize(t);return cc.game._isCloning=!1,c.pool.put(_),s&&e.assignAssetsBy(Editor.serialize.asAsset),l&&a.pool.put(e),u},cc.deserialize.Details=a,cc.deserialize.reportMissingClass=function(t){cc.warnID(5302,t)}}),{"../utils/misc":206,"./CCClass":156,"./CCObject":162,"./attribute":169,"./js":177}],173:[(function(t,e,i){function n(t){this.id=0|998*Math.random(),this.prefix=t?t+r:""}var r=".";n.prototype.getNewId=function(){return this.prefix+ ++this.id},n.global=new n("global"),e.exports=n}),{}],174:[(function(t,e,i){t("./js"),t("./CCClass"),t("./CCClassDecorator"),t("./CCEnum"),t("./CCObject"),t("./callbacks-invoker"),t("./url"),t("./deserialize"),t("./instantiate"),t("./instantiate-jit"),t("./requiring-frame"),t("./CCSys"),t("./CCMacro"),t("./CCAssetLibrary"),t("./CCVisibleRect")}),{"./CCAssetLibrary":155,"./CCClass":156,"./CCClassDecorator":157,"./CCEnum":158,"./CCMacro":161,"./CCObject":162,"./CCSys":165,"./CCVisibleRect":167,"./callbacks-invoker":170,"./deserialize":172,"./instantiate":176,"./instantiate-jit":175,"./js":177,"./requiring-frame":179,"./url":180}],175:[(function(t,e,i){function n(t,e){this.varName=t,this.expression=e}function r(t,e){return e instanceof n?new n(e.varName,t+e.expression):t+e}function s(t,e,i){Array.isArray(i)?(i[0]=r(e,i[0]),t.push(i)):t.push(r(e,i)+";")}function o(t){this._exps=[],this._targetExp=t}function a(t,e){if("function"==typeof t)try{t=t()}catch(t){return!1}if(t===e)return!0;if(t&&e){if(t instanceof cc.ValueType&&t.equals(e))return!0;if(Array.isArray(t)&&Array.isArray(e)||t.constructor===Object&&e.constructor===Object)try{return JSON.stringify(t)===JSON.stringify(e)}catch(t){}}return!1}function c(t){return y.test(t)?"."+t:"["+x(t)+"]"}function h(t,e){this.parent=e,this.objsToClear_iN$t=[],this.codeArray=[],this.objs=[],this.funcs=[],this.funcModuleCache=m.createMap(),m.mixin(this.funcModuleCache,b),this.globalVariables=[],this.globalVariableId=0,this.localVariableId=0,this.codeArray.push(C+A+","+T+";","if(R){",A+"=R;","}else{",A+"=R=new "+this.getFuncModule(t.constructor,!0)+"();","}"),t._iN$t={globalVar:"R"},this.objsToClear_iN$t.push(t),this.enumerateObject(this.codeArray,t);var i;this.globalVariables.length>0&&(i=C+this.globalVariables.join(",")+";");var n=p.flattenCodeArray(["return (function(R){",i||[],this.codeArray,"return o;","})"]);this.result=Function("O","F",n)(this.objs,this.funcs);for(var r=0,s=this.objsToClear_iN$t.length;r<s;++r)this.objsToClear_iN$t[r]._iN$t=null;this.objsToClear_iN$t.length=0}var l=t("./CCObject"),_=l.Flags.Destroyed,u=l.Flags.PersistentMask,d=t("./attribute"),m=t("./js"),f=t("./CCClass"),p=t("./compiler"),g=d.DELIMETER+"serializable",v=d.DELIMETER+"default",y=f.IDENTIFIER_RE,x=f.escapeForJS,C="var ",A="o",T="t",b={"cc.Node":"cc.Node","cc.Sprite":"cc.Sprite","cc.Label":"cc.Label","cc.Button":"cc.Button","cc.Widget":"cc.Widget","cc.Animation":"cc.Animation","cc.ClickEvent":!1,"cc.PrefabInfo":!1};n.prototype.toString=function(){return C+this.varName+"="+this.expression+";"},o.prototype.append=function(t,e){this._exps.push([t,e])},o.prototype.writeCode=function(t){var e;if(this._exps.length>1)t.push(T+"="+this._targetExp+";"),e=T;else{if(1!==this._exps.length)return;e=this._targetExp}for(var i=0;i<this._exps.length;i++){var n=this._exps[i];s(t,e+c(n[0])+"=",n[1])}},(o.pool=new m.Pool(function(t){t._exps.length=0,t._targetExp=null},1)).get=function(t){var e=this._get()||new o;return e._targetExp=t,e};var w=h.prototype;w.getFuncModule=function(t,e){var i=m.getClassName(t);if(i){var n=this.funcModuleCache[i];if(n)return n;if(void 0===n){var r=-1!==i.indexOf(".");if(r)try{if(r=t===Function("return "+i)())return this.funcModuleCache[i]=i,i}catch(t){}}}var s=this.funcs.indexOf(t);s<0&&(s=this.funcs.length,this.funcs.push(t));var o="F["+s+"]";return e&&(o="("+o+")"),this.funcModuleCache[i]=o,o},w.getObjRef=function(t){var e=this.objs.indexOf(t);return e<0&&(e=this.objs.length,this.objs.push(t)),"O["+e+"]"},w.setValueType=function(t,e,i,n){var r=o.pool.get(n),s=e.constructor.__props__;s||(s=Object.keys(e));for(var a=0;a<s.length;a++){var c=s[a],h=i[c];if(e[c]!==h){var l=this.enumerateField(i,c,h);r.append(c,l)}}r.writeCode(t),o.pool.put(r)},w.enumerateCCClass=function(t,e,i){for(var n=i.__props__,r=d.getClassAttrs(i),s=0;s<n.length;s++){var o=n[s];if(!1!==r[o+g]){var h=e[o];if(a(l=r[o+v],h))continue;if("object"==typeof h&&h instanceof cc.ValueType){var l;if(((l=f.getDefault(l))&&l.constructor)===h.constructor){var _=A+c(o);this.setValueType(t,l,h,_);continue}}this.setObjProp(t,e,o,h)}}},w.instantiateArray=function(t){if(0===t.length)return"[]";var e="a"+ ++this.localVariableId,i=[new n(e,"new Array("+t.length+")")];t._iN$t={globalVar:"",source:i},this.objsToClear_iN$t.push(t);for(var r=0;r<t.length;++r){s(i,e+"["+r+"]=",this.enumerateField(t,r,t[r]))}return i},w.enumerateField=function(t,e,i){if("object"==typeof i&&i){var n=i._iN$t;if(n){var s=n.globalVar;if(!s){s=n.globalVar="v"+ ++this.globalVariableId,this.globalVariables.push(s);var o=n.source[0];n.source[0]=r(s+"=",o)}return s}return Array.isArray(i)?this.instantiateArray(i):this.instantiateObj(i)}return"function"==typeof i?this.getFuncModule(i):"string"==typeof i?x(i):("_objFlags"===e&&t instanceof l&&(i&=u),i)},w.setObjProp=function(t,e,i,n){s(t,A+c(i)+"=",this.enumerateField(e,i,n))},w.enumerateObject=function(t,e){var i=e.constructor;if(cc.Class._isCCClass(i))this.enumerateCCClass(t,e,i);else for(var n in e)if(e.hasOwnProperty(n)&&(95!==n.charCodeAt(0)||95!==n.charCodeAt(1)||"__type__"===n)){var r=e[n];"object"==typeof r&&r&&r===e._iN$t||this.setObjProp(t,e,n,r)}},w.instantiateObj=function(t){if(t instanceof cc.ValueType)return f.getNewValueTypeCode(t);if(t instanceof cc.Asset)return this.getObjRef(t);if(t._objFlags&_)return null;var e,i=t.constructor;if(cc.Class._isCCClass(i)){if(this.parent)if(this.parent instanceof cc.Component){if(t instanceof cc._BaseNode||t instanceof cc.Component)return this.getObjRef(t)}else if(this.parent instanceof cc._BaseNode)if(t instanceof cc._BaseNode){if(!t.isChildOf(this.parent))return this.getObjRef(t)}else if(t instanceof cc.Component&&!t.node.isChildOf(this.parent))return this.getObjRef(t);e=new n(A,"new "+this.getFuncModule(i,!0)+"()")}else if(i===Object)e=new n(A,"{}");else{if(i)return this.getObjRef(t);e=new n(A,"Object.create(null)")}var r=[e];return t._iN$t={globalVar:"",source:r},this.objsToClear_iN$t.push(t),this.enumerateObject(r,t),["(function(){",r,"return o;})();"]},e.exports={compile:function(t){return new h(t,t instanceof cc._BaseNode&&t).result},equalsToDefault:a}}),{"./CCClass":156,"./CCObject":162,"./attribute":169,"./compiler":171,"./js":177}],176:[(function(t,e,i){function n(t,e){if(!e){if("object"!=typeof t||Array.isArray(t))return null;if(!t)return null;if(!cc.isValid(t))return null;0}var i;if(t instanceof a){if(t._instantiate)return cc.game._isCloning=!0,i=t._instantiate(),cc.game._isCloning=!1,i;if(t instanceof cc.Asset)return null}return cc.game._isCloning=!0,i=r(t),cc.game._isCloning=!1,i}function r(t,e){if(Array.isArray(t))return null;if(_&&_(t))return null;var i;if(t._iN$t)i=t._iN$t;else if(t.constructor){i=new(0,t.constructor)}else i=Object.create(null);s(t,i,e);for(var n=0,r=u.length;n<r;++n)u[n]._iN$t=null;return u.length=0,i}function s(t,e,i){t._iN$t=e,u.push(t);var n=t.constructor;if(cc.Class._isCCClass(n))(function(t,e,i,n){for(var r=t.__props__,s=l.getClassAttrs(t),a=0;a<r.length;a++){var c=r[a];if(!1!==s[c+d]){var h=e[c];i[c]="object"==typeof h&&h?h._iN$t||o(h,n):h}}})(n,t,e,i);else for(var r in t)if(t.hasOwnProperty(r)&&(95!==r.charCodeAt(0)||95!==r.charCodeAt(1)||"__type__"===r)){var s=t[r];if("object"==typeof s&&s){if(s===e)continue;e[r]=s._iN$t||o(s,i)}else e[r]=s}t instanceof a&&(e._objFlags&=h)}function o(t,e){if(t instanceof cc.ValueType)return t.clone();if(t instanceof cc.Asset)return t;var i;if(Array.isArray(t)){var n=t.length;i=new Array(n),t._iN$t=i;for(var r=0;r<n;++r){var a=t[r];i[r]="object"==typeof a&&a?a._iN$t||o(a,e):a}return u.push(t),i}if(t._objFlags&c)return null;var h=t.constructor;if(cc.Class._isCCClass(h)){if(e)if(e instanceof cc.Component){if(t instanceof cc._BaseNode||t instanceof cc.Component)return t}else if(e instanceof cc._BaseNode)if(t instanceof cc._BaseNode){if(!t.isChildOf(e))return t}else if(t instanceof cc.Component&&!t.node.isChildOf(e))return t;i=new h}else if(h===Object)i={};else{if(h)return t;i=Object.create(null)}return s(t,i,e),i}var a=t("./CCObject"),c=a.Flags.Destroyed,h=a.Flags.PersistentMask,l=t("./attribute"),_=t("./utils").isDomNode,u=[],d=l.DELIMETER+"serializable";n._clone=r,cc.instantiate=n,e.exports=n}),{"./CCObject":162,"./attribute":169,"./utils":181}],177:[(function(t,e,i){function n(t,e){for(;t;){var i=Object.getOwnPropertyDescriptor(t,e);if(i)return i;t=Object.getPrototypeOf(t)}return null}function r(t,e,i){var r=n(e,t);Object.defineProperty(i,t,r)}function s(t,e){t.splice(e,1)}function o(t,e){var i=t.indexOf(e);return i>=0&&(s(t,i),!0)}function a(t,e){"number"==typeof t&&(e=t,t=null),this.get=null,this.count=0,this._pool=new Array(e),this._cleanup=t}var c=new(t("./id-generater"))("TmpCId."),h={isNumber:function(t){return"number"==typeof t||t instanceof Number},isString:function(t){return"string"==typeof t||t instanceof String},addon:function(t){"use strict";t=t||{};for(var e=1,i=arguments.length;e<i;e++){var n=arguments[e];if(n){if("object"!=typeof n){cc.errorID(5402,n);continue}for(var s in n)s in t||r(s,n,t)}}return t},mixin:function(t){"use strict";t=t||{};for(var e=1,i=arguments.length;e<i;e++){var n=arguments[e];if(n){if("object"!=typeof n){cc.errorID(5403,n);continue}for(var s in n)r(s,n,t)}}return t},extend:function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t.prototype=Object.create(e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),t},getSuper:function(t){var e=t.prototype,i=e&&Object.getPrototypeOf(e);return i&&i.constructor},clear:function(t){for(var e=Object.keys(t),i=0;i<e.length;i++)delete t[e[i]]},getPropertyDescriptor:n},l={value:void 0,enumerable:!1,writable:!1,configurable:!0};h.value=function(t,e,i,n,r){l.value=i,l.writable=n,l.enumerable=r,Object.defineProperty(t,e,l),l.value=void 0};var _={get:null,set:null,enumerable:!1};h.getset=function(t,e,i,n,r){"function"!=typeof n&&(r=n,n=void 0),_.get=i,_.set=n,_.enumerable=r,Object.defineProperty(t,e,_),_.get=null,_.set=null};var u={get:null,enumerable:!1,configurable:!1};h.get=function(t,e,i,n,r){u.get=i,u.enumerable=n,u.configurable=r,Object.defineProperty(t,e,u),u.get=null};var d={set:null,enumerable:!1,configurable:!1};h.set=function(t,e,i,n,r){d.set=i,d.enumerable=n,d.configurable=r,Object.defineProperty(t,e,d),d.set=null},h.getClassName=function(t){if("function"==typeof t){var e=t.prototype;if(e&&e.hasOwnProperty("__classname__")&&e.__classname__)return e.__classname__;var i="";if(t.name&&(i=t.name),t.toString){var n,r=t.toString();(n="["===r.charAt(0)?r.match(/\[\w+\s*(\w+)\]/):r.match(/function\s*(\w+)/))&&2===n.length&&(i=n[1])}return"Object"!==i?i:""}return t&&t.constructor?h.getClassName(t.constructor):""},(function(){function t(t,e){return function(i,n){if(n.prototype.hasOwnProperty(t)&&delete e[n.prototype[t]],h.value(n.prototype,t,i),i){var r=e[i];if(r&&r!==n){var s="A Class already exists with the same "+t+' : "'+i+'".';0,cc.error(s)}else e[i]=n}}}var e={},i={};h._setClassId=t("__cid__",e);var n=t("__classname__",i);h.setClassName=function(t,e){if(n(t,e),!e.prototype.hasOwnProperty("__cid__")){var i=t||c.getNewId();i&&h._setClassId(i,e)}},h.unregisterClass=function(){for(var t=0;t<arguments.length;t++){var n=arguments[t].prototype,r=n.__cid__;r&&delete e[r];var s=n.__classname__;s&&delete i[s]}},h._getClassById=function(t){return e[t]},h.getClassByName=function(t){return i[t]},h._getClassId=function(t,e){e=void 0===e||e;if("function"==typeof t&&t.prototype.hasOwnProperty("__cid__"))return t.prototype.__cid__;if(t&&t.constructor){var i=t.constructor.prototype;if(i&&i.hasOwnProperty("__cid__"))return t.__cid__}return""}})(),h.obsolete=function(t,e,i,n){function r(){return this[i]}var s=/([^.]+)$/.exec(e)[0];n?h.getset(t,s,r,(function(t){this[i]=t})):h.get(t,s,r)},h.obsoletes=function(t,e,i,n){for(var r in i){var s=i[r];h.obsolete(t,e+"."+r,s,n)}};var m=/(%d)|(%s)/,f=/%s/;h.formatStr=function(){var t=arguments.length;if(0===t)return"";var e=arguments[0];if(1===t)return""+e;if("string"==typeof e&&m.test(e))for(var i=1;i<t;++i){var n=arguments[i],r="number"==typeof n?m:f;r.test(e)?e=e.replace(r,n):e+=" "+n}else for(var s=1;s<t;++s)e+=" "+arguments[s];return e},h.shiftArguments=function(){for(var t=arguments.length-1,e=new Array(t),i=0;i<t;++i)e[i]=arguments[i+1];return e},h.createMap=function(t){var e=Object.create(null);if(t){e["."]=!0,e["/"]=!0,delete e["."],delete e["/"]}return e};var p=Array.prototype.indexOf;h.array={remove:o,fastRemove:function(t,e){var i=t.indexOf(e);i>=0&&(t[i]=t[t.length-1],--t.length)},removeAt:s,fastRemoveAt:function(t,e){var i=t.length;e<0||e>=i||(t[e]=t[i-1],t.length=i-1)},contains:function(t,e){return t.indexOf(e)>=0},verifyType:function(t,e){if(t&&t.length>0)for(var i=0;i<t.length;i++)if(!(t[i]instanceof e))return cc.logID(1300),!1;return!0},removeArray:function(t,e){for(var i=0,n=e.length;i<n;i++)o(t,e[i])},appendObjectsAt:function(t,e,i){return t.splice.apply(t,[i,0].concat(e)),t},copy:function(t){var e,i=t.length,n=new Array(i);for(e=0;e<i;e+=1)n[e]=t[e];return n},indexOf:p,MutableForwardIterator:t("../utils/mutable-forward-iterator")},a.prototype._get=function(){if(this.count>0){--this.count;var t=this._pool[this.count];return this._pool[this.count]=null,t}return null},a.prototype.put=function(t){var e=this._pool;if(this.count<e.length){if(this._cleanup&&!1===this._cleanup(t))return;e[this.count]=t,++this.count}},a.prototype.resize=function(t){t>=0&&(this._pool.length=t,this.count>t&&(this.count=t))},h.Pool=a,cc.js=h,e.exports=h}),{"../utils/mutable-forward-iterator":207,"./id-generater":173}],178:[(function(t,e,i){function n(t,e,i,n){if(!t.get&&!t.set)if(t.hasOwnProperty("default")){var r="_N$"+e;t.get=function(){return this[r]},t.set=function(t){var e=this[r];this[r]=t,i.call(this,e)};var s={};n[r]=s;for(var o in a){var c=a[o];t.hasOwnProperty(o)&&(s[o]=t[o],c.canUsedInGet||delete t[o])}}else 0}function r(t,e,i,n){Array.isArray(n)&&n.length>0&&(n=n[0]),t.type=n}function s(t,e,i,n){if(Array.isArray(e)){if(!(e.length>0))return cc.errorID(5508,i,n);if(cc.RawAsset.isRawAssetType(e[0]))return t.url=e[0],void delete t.type;t.type=e=e[0]}}function o(t,e,i,n){0}var a={url:{canUsedInGet:!0},default:{},serializable:{},editorOnly:{},rawType:{},formerlySerializedAs:{}};i.getFullFormOfProperty=function(t){if(!(t&&t.constructor===Object)){if(Array.isArray(t)&&t.length>0)return{default:[],type:t,_short:!0};if("function"==typeof t){var e=t;return cc.RawAsset.isRawAssetType(e)?{default:"",url:e,_short:!0}:{default:cc.isChildClassOf(e,cc.ValueType)?new e:null,type:e,_short:!0}}return{default:t,_short:!0}}return null},i.preprocessAttrs=function(t,e,a,c){for(var h in t){var l=t[h],_=i.getFullFormOfProperty(l);if(_&&(l=t[h]=_),l){var u=l.notify;u&&n(l,h,u,t),"type"in l&&s(l,l.type,e,h),"url"in l&&r(l,0,0,l.url),"type"in l&&o(0,l.type)}}},i.validateMethodWithProps=function(t,e,i,n,r){if("function"!=typeof t&&null!==t){return!1}return!0}}),{"./CCClass":156}],179:[(function(t,e,i){var n=[];cc._RF={push:function(t,e,i){void 0===i&&(i=e,e=""),n.push({uuid:e,script:i,module:t,exports:t.exports,beh:null})},pop:function(){var t=n.pop(),e=t.module,i=e.exports;if(i===t.exports){for(var r in i)return;e.exports=i=t.cls}},peek:function(){return n[n.length-1]}}}),{}],180:[(function(t,e,i){var n={};cc.url={_rawAssets:"",_builtinRawAssets:"",normalize:function(t){return 46===t.charCodeAt(0)&&47===t.charCodeAt(1)?t=t.slice(2):47===t.charCodeAt(0)&&(t=t.slice(1)),t},raw:function(t){return(t=this.normalize(t)).startsWith("resources/")||cc.errorID(7002,t),this._rawAssets+t},builtinRaw:!1,_init:function(t){for(var e in t){var i=t[e];i=cc.path.stripSep(i)+"/",n[e]=i}this._rawAssets=n.assets,this._builtinRawAssets=n.internal}},e.exports=cc.url}),{}],181:[(function(t,e,i){e.exports={contains:function(t,e){if("function"==typeof t.contains)return t.contains(e);if("function"==typeof t.compareDocumentPosition)return!!(16&t.compareDocumentPosition(e));var i=e.parentNode;if(i)do{if(i===t)return!0;i=i.parentNode}while(null!==i);return!1},isDomNode:"object"==typeof window&&("function"==typeof Node?function(t){return t instanceof Node}:function(t){return t&&"object"==typeof t&&"number"==typeof t.nodeType&&"string"==typeof t.nodeName}),callInNextTick:function(t,e,i){t&&setTimeout((function(){t(e,i)}),0)}}}),{}],182:[(function(t,e,i){t("./platform/js"),t("./value-types"),t("./utils"),t("./platform/CCInputManager"),t("./platform/CCInputExtension"),t("./event"),t("./platform/CCSys"),t("./platform/CCMacro"),t("./load-pipeline"),t("./textures"),t("./CCDirector"),t("./CCDirectorWebGL"),t("./CCDirectorCanvas"),t("./platform/CCSAXParser"),t("./platform/CCView"),t("./platform/CCScreen"),t("./CCScheduler"),t("./event-manager"),t("./renderer")}),{"./CCDirector":30,"./CCDirectorCanvas":31,"./CCDirectorWebGL":32,"./CCScheduler":39,"./event":94,"./event-manager":90,"./load-pipeline":116,"./platform/CCInputExtension":159,"./platform/CCInputManager":160,"./platform/CCMacro":161,"./platform/CCSAXParser":163,"./platform/CCScreen":164,"./platform/CCSys":165,"./platform/CCView":166,"./platform/js":177,"./renderer":186,"./textures":198,"./utils":205,"./value-types":219}],183:[(function(t,e,i){function n(){var t=c.pop();return t||(t=new o),t}function r(t){c.push(t)}function s(t,e){var i=t._minX<e._minX?t._minX:e._minX,n=t._minY<e._minY?t._minY:e._minY;return((t._maxX>e._maxX?t._maxX:e._maxX)-i)*((t._maxY>e._maxY?t._maxY:e._maxY)-n)}var o=function(){this._minX=0,this._minY=0,this._maxX=0,this._maxY=0,this._width=0,this._height=0,this._area=0},a=o.prototype,c=[];a.setTo=function(t,e,i,n){return this._minX=t,this._minY=e,this._maxX=i,this._maxY=n,this.updateArea(),this},a.intValues=function(){this._minX=Math.floor(this._minX),this._minY=Math.floor(this._minY),this._maxX=Math.ceil(this._maxX),this._maxY=Math.ceil(this._maxY),this.updateArea()},a.updateArea=function(){this._width=this._maxX-this._minX,this._height=this._maxY-this._minY,this._area=this._width*this._height},a.union=function(t){this.isEmpty()?this.setTo(t._minX,t._minY,t._maxX,t._maxY):(this._minX>t._minX&&(this._minX=t._minX),this._minY>t._minY&&(this._minY=t._minY),this._maxX<t._maxX&&(this._maxX=t._maxX),this._maxY<t._maxY&&(this._maxY=t._maxY),this.updateArea())},a.setEmpty=function(){this._minX=0,this._minY=0,this._maxX=0,this._maxY=0,this._width=0,this._height=0,this._area=0},a.isEmpty=function(){return this._width<=0||this._height<=0},a.intersects=function(t){if(this.isEmpty()||t.isEmpty())return!1;var e=this._minX>t._minX?this._minX:t._minX,i=this._maxX<t._maxX?this._maxX:t._maxX;return!(e>i)&&(e=this._minY>t._minY?this._minY:t._minY,i=this._maxY<t._maxY?this._maxY:t._maxY,e<=i)},a.updateRegion=function(t,e){if(0!==t.width&&0!==t.height){var i,n,r,s,o=e,a=o.a,c=o.b,h=o.c,l=o.d,_=o.tx,u=o.ty,d=t.x,m=t.y,f=d+t.width,p=m+t.height;if(1===a&&0===c&&0===h&&1===l)i=d+_-1,n=m+u-1,r=f+_+1,s=p+u+1;else{var g=a*d+h*m+_,v=c*d+l*m+u,y=a*f+h*m+_,x=c*f+l*m+u,C=a*f+h*p+_,A=c*f+l*p+u,T=a*d+h*p+_,b=c*d+l*p+u,w=0;g>y&&(w=g,g=y,y=w),C>T&&(w=C,C=T,T=w),i=(g<C?g:C)-1,r=(y>T?y:T)+1,v>x&&(w=v,v=x,x=w),A>b&&(w=A,A=b,b=w),n=(v<A?v:A)-1,s=(x>b?x:b)+1}this._minX=i,this._minY=n,this._maxX=r,this._maxY=s,this._width=r-i,this._height=s-n,this._area=this._width*this._height}else this.setEmpty()};var h=function(){this.dirtyList=[],this.hasClipRect=!1,this.clipWidth=0,this.clipHeight=0,this.clipArea=0,this.clipRectChanged=!1},l=h.prototype;l.setClipRect=function(t,e){this.hasClipRect=!0,this.clipRectChanged=!0,this.clipWidth=Math.ceil(t),this.clipHeight=Math.ceil(e),this.clipArea=this.clipWidth*this.clipHeight},l.addRegion=function(t){var e=t._minX,i=t._minY,r=t._maxX,s=t._maxY;if(this.hasClipRect&&(e<0&&(e=0),i<0&&(i=0),r>this.clipWidth&&(r=this.clipWidth),s>this.clipHeight&&(s=this.clipHeight)),e>=r||i>=s)return!1;if(this.clipRectChanged)return!0;var o=this.dirtyList,a=n();return o.push(a.setTo(e,i,r,s)),this.mergeDirtyList(o),!0},l.clear=function(){for(var t=this.dirtyList,e=t.length,i=0;i<e;i++)r(t[i]);t.length=0},l.getDirtyRegions=function(){var t=this.dirtyList;if(this.clipRectChanged){this.clipRectChanged=!1,this.clear();var e=n();t.push(e.setTo(0,0,this.clipWidth,this.clipHeight))}else for(;this.mergeDirtyList(t););var i=this.dirtyList.length;if(i>0)for(var r=0;r<i;r++)this.dirtyList[r].intValues();return this.dirtyList},l.mergeDirtyList=function(t){var e=t.length;if(e<2)return!1;for(var i=this.hasClipRect,n=e>3?Number.POSITIVE_INFINITY:0,o=0,a=0,c=0,h=0;h<e-1;h++){var l=t[h];i&&(c+=l.area);for(var _=h+1;_<e;_++){var u=t[_],d=s(l,u)-l.area-u.area;n>d&&(o=h,a=_,n=d)}}if(i&&c/this.clipArea>.95&&(this.clipRectChanged=!0),o!==a){var m=t[a];return t[o].union(m),r(m),t.splice(a,1),!0}return!1},cc.Region=o,cc.DirtyRegion=h}),{}],184:[(function(t,e,i){cc.rendererCanvas={childrenOrderDirty:!0,assignedZ:0,assignedZStep:1e-4,_transformNodePool:[],_renderCmds:[],_isCacheToCanvasOn:!1,_cacheToCanvasCmds:{},_cacheInstanceIds:[],_currentID:0,_clearColor:cc.color(),_clearFillStyle:"rgb(0, 0, 0)",_dirtyRegion:null,_allNeedDraw:!0,_enableDirtyRegion:!1,_debugDirtyRegion:!1,_dirtyRegionCountThreshold:10,init:function(){cc.sys.browserType!==cc.sys.BROWSER_TYPE_IE&&cc.sys.browserType!==cc.sys.BROWSER_TYPE_UC||this.enableDirtyRegion(!1)},getRenderCmd:function(t){return t._createRenderCmd()},enableDirtyRegion:function(t){this._enableDirtyRegion=t},isDirtyRegionEnabled:function(){return this._enableDirtyRegion},setDirtyRegionCountThreshold:function(t){this._dirtyRegionCountThreshold=t},_collectDirtyRegion:function(){var t,e,i=this._renderCmds,n=this._dirtyRegion,r=_ccsg.Node.CanvasRenderCmd.RegionStatus,s=0,o=!0;for(t=0,e=i.length;t<e;t++){var a=i[t],c=a._regionFlag,h=a._oldRegion,l=a._currentRegion;c>r.NotDirty&&(++s>this._dirtyRegionCountThreshold&&(o=!1),o&&(!l.isEmpty()&&n.addRegion(l),a._regionFlag>r.Dirty&&!h.isEmpty()&&n.addRegion(h)),a._regionFlag=r.NotDirty)}return o},_beginDrawDirtyRegion:function(t){var e=t.getContext(),i=this._dirtyRegion.getDirtyRegions();e.save(),t.setTransform({a:1,b:0,c:0,d:1,tx:0,ty:0},1,1),e.beginPath();for(var n=0,r=0,s=0,o=0,a=t._scaleX,c=t._scaleY,h=0,l=i.length;h<l;++h){var _=i[h];n=(_._minX*a|0)-1,r=(-_._maxY*a|0)-1,s=2+(_._width*a|0),o=2+(_._height*c|0),e.rect(n,r,s,o)}e.clip()},_endDrawDirtyRegion:function(t){t.restore()},_debugDrawDirtyRegion:function(t){if(this._debugDirtyRegion){var e=t.getContext(),i=this._dirtyRegion.getDirtyRegions();t.setTransform({a:1,b:0,c:0,d:1,tx:0,ty:0},1,1),e.beginPath();for(var n=0,r=0,s=0,o=0,a=t._scaleX,c=t._scaleY,h=0,l=i.length;h<l;++h){var _=i[h];n=(_._minX*a|0)-1,r=(-_._maxY*a|0)-1,s=2+(_._width*a|0),o=2+(_._height*c|0),e.rect(n,r,s,o)}var u=e.fillStyle;e.fillStyle="green",e.fill(),e.fillStyle=u}},rendering:function(t){var e=this._dirtyRegion=this._dirtyRegion||new cc.DirtyRegion,i=cc._canvas,n=t||cc._renderContext,r=n.getContext(),s=cc.view.getScaleX(),o=cc.view.getScaleY();n.setViewScale(s,o),n.computeRealOffsetY();var a,c,h=this._dirtyRegion.getDirtyRegions(),l=this._renderCmds,_=this._allNeedDraw||!this._enableDirtyRegion;for(_||(_=_||!this._collectDirtyRegion()),_||this._beginDrawDirtyRegion(n),r.setTransform(1,0,0,1,0,0),r.clearRect(0,0,i.width,i.height),0===this._clearColor.r&&0===this._clearColor.g&&0===this._clearColor.b||(n.setFillStyle(this._clearFillStyle),n.setGlobalAlpha(this._clearColor.a),r.fillRect(0,0,i.width,i.height)),a=0,c=l.length;a<c;a++){var u=l[a];if(u._needDraw){var d=!1,m=u._currentRegion;if(!m||_)d=!0;else for(var f=0,p=h.length;f<p;++f)if(h[f].intersects(m)){d=!0;break}d&&u.rendering(n,s,o)}}_||(this._debugDrawDirtyRegion(n),this._endDrawDirtyRegion(r)),e.clear(),this._allNeedDraw=!1},_renderingToCacheCanvas:function(t,e,i,n){t||cc.logID(7600),i=void 0===i?1:i,n=void 0===n?1:n,e=e||this._currentID;var r,s,o=this._cacheToCanvasCmds[e];for(t.computeRealOffsetY(),r=0,s=o.length;r<s;r++)o[r].rendering(t,i,n);this._removeCache(e);var a=this._cacheInstanceIds;0===a.length?this._isCacheToCanvasOn=!1:this._currentID=a[a.length-1]},_turnToCacheMode:function(t){this._isCacheToCanvasOn=!0,t=t||0,this._cacheToCanvasCmds[t]=[],-1===this._cacheInstanceIds.indexOf(t)&&this._cacheInstanceIds.push(t),this._currentID=t},_turnToNormalMode:function(){this._isCacheToCanvasOn=!1},_removeCache:function(t){t=t||this._currentID;var e=this._cacheToCanvasCmds[t];e&&(e.length=0,delete this._cacheToCanvasCmds[t]);var i=this._cacheInstanceIds;cc.js.array.remove(i,t)},resetFlag:function(){this.childrenOrderDirty=!1,this._transformNodePool.length=0},transform:function(){var t=this._transformNodePool;t.sort(this._sortNodeByLevelAsc);for(var e=0,i=t.length;e<i;e++)t[e].updateStatus();t.length=0},transformDirty:function(){return this._transformNodePool.length>0},_sortNodeByLevelAsc:function(t,e){return t._curLevel-e._curLevel},pushDirtyNode:function(t){this._transformNodePool.push(t)},clear:function(){},clearRenderCommands:function(){this._renderCmds.length=0,this._cacheInstanceIds.length=0,this._isCacheToCanvasOn=!1,this._allNeedDraw=!0},pushRenderCommand:function(t){if(t.rendering)if(this._isCacheToCanvasOn){var e=this._currentID,i=this._cacheToCanvasCmds[e];-1===i.indexOf(t)&&i.push(t)}else-1===this._renderCmds.indexOf(t)&&this._renderCmds.push(t)}},(function(){cc.CanvasContextWrapper=function(t){this._context=t,this._saveCount=0,this._currentAlpha=t.globalAlpha,this._currentCompositeOperation=t.globalCompositeOperation,this._currentFillStyle=t.fillStyle,this._currentStrokeStyle=t.strokeStyle,this._offsetX=0,this._offsetY=0,this._realOffsetY=this.height,this._armatureMode=0};var t=cc.CanvasContextWrapper.prototype;t.resetCache=function(){var t=this._context;this._currentAlpha=t.globalAlpha,this._currentCompositeOperation=t.globalCompositeOperation,this._currentFillStyle=t.fillStyle,this._currentStrokeStyle=t.strokeStyle,this._realOffsetY=this._context.canvas.height+this._offsetY},t.setOffset=function(t,e){this._offsetX=t,this._offsetY=e,this._realOffsetY=this._context.canvas.height+this._offsetY},t.computeRealOffsetY=function(){this._realOffsetY=this._context.canvas.height+this._offsetY},t.setViewScale=function(t,e){this._scaleX=t,this._scaleY=e},t.getContext=function(){return this._context},t.save=function(){this._context.save(),this._saveCount++},t.restore=function(){this._context.restore(),this._currentAlpha=this._context.globalAlpha,this._saveCount--},t.setGlobalAlpha=function(t){this._saveCount>0?this._context.globalAlpha=t:this._currentAlpha!==t&&(this._currentAlpha=t,this._context.globalAlpha=t)},t.setCompositeOperation=function(t){this._saveCount>0?this._context.globalCompositeOperation=t:this._currentCompositeOperation!==t&&(this._currentCompositeOperation=t,this._context.globalCompositeOperation=t)},t.setFillStyle=function(t){this._context.fillStyle=t},t.setStrokeStyle=function(t){this._saveCount>0?this._context.strokeStyle=t:this._currentStrokeStyle!==t&&(this._currentStrokeStyle=t,this._context.strokeStyle=t)},t.setTransform=function(t,e,i){this._armatureMode>0?(this.restore(),this.save(),this._context.transform(t.a,-t.b,-t.c,t.d,t.tx*e,-t.ty*i)):this._context.setTransform(t.a*e,-t.b*i,-t.c*e,t.d*i,this._offsetX+t.tx*e,this._realOffsetY-t.ty*i)},t._switchToArmatureMode=function(t,e,i,n){t?(this._armatureMode++,this._context.setTransform(e.a,e.c,e.b,e.d,this._offsetX+e.tx*i,this._realOffsetY-e.ty*n),this.save()):(this._armatureMode--,this.restore())}})()}),{}],185:[(function(t,e,i){function n(t){var e=cc._renderContext;null===o&&(a=e.createBuffer(),o=e.createBuffer()),(function(t){var e=cc._renderContext;if(o){var i=6*Math.ceil(t/4);e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,o),f=new Uint16Array(i);for(var n=0,r=0,s=i;r<s;r+=6)f[r]=n+0,f[r+1]=n+1,f[r+2]=n+2,f[r+3]=n+1,f[r+4]=n+2,f[r+5]=n+3,n+=4;e.bufferData(e.ELEMENT_ARRAY_BUFFER,f,e.DYNAMIC_DRAW)}if(a){var h=4*(t*_);u=new ArrayBuffer(h),d=new Float32Array(u),m=new Uint32Array(u),e.bindBuffer(e.ARRAY_BUFFER,a),e.bufferData(e.ARRAY_BUFFER,d,e.DYNAMIC_DRAW)}c=t-200})(t)}var r={texture:null,blendSrc:null,blendDst:null,shader:null},s=!1,o=null,a=null,c=0,h=0,l=0,_=6,u=null,d=null,m=null,f=null,p=0,g=!0,v=cc.Enum({QUAD:0,TRIANGLE:1,CUSTOM:2});cc.rendererWebGL={mat4Identity:null,childrenOrderDirty:!0,assignedZ:0,assignedZStep:.01,VertexType:v,_transformNodePool:[],_renderCmds:[],_isCacheToBufferOn:!1,_cacheToBufferCmds:{},_cacheInstanceIds:[],_currentID:0,_clearColor:{r:0,g:0,b:0,a:1},init:function(){var t=cc._renderContext;t.disable(t.CULL_FACE),t.disable(t.DEPTH_TEST),this._initExtensions(["OES_element_index_uint"]),this.mat4Identity=new cc.math.Matrix4,this.mat4Identity.identity(),n(cc.macro.BATCH_VERTEX_COUNT),cc.sys.os===cc.sys.OS_IOS&&!0},_initExtensions:function(t){this._extensions=this._extensions||{};for(var e=0;e<t.length;++e){var i=t[e];try{var n=gl.getExtension(i);n&&(this._extensions[i]=n)}catch(t){cc.error(t)}}},getVertexSize:function(){return c},getRenderCmd:function(t){return t._createRenderCmd()},_turnToCacheMode:function(t){this._isCacheToBufferOn=!0,t=t||0,this._cacheToBufferCmds[t]?this._cacheToBufferCmds[t].length=0:this._cacheToBufferCmds[t]=[],-1===this._cacheInstanceIds.indexOf(t)&&this._cacheInstanceIds.push(t),this._currentID=t},_turnToNormalMode:function(){this._isCacheToBufferOn=!1},_removeCache:function(t){t=t||this._currentID;var e=this._cacheToBufferCmds[t];e&&(e.length=0,delete this._cacheToBufferCmds[t]);var i=this._cacheInstanceIds;cc.js.array.remove(i,t)},_renderingToBuffer:function(t){t=t||this._currentID;var e=this._cacheToBufferCmds[t],i=cc._renderContext;this.rendering(i,e),this._removeCache(t);var n=this._cacheInstanceIds;0===n.length?this._isCacheToBufferOn=!1:this._currentID=n[n.length-1]},resetFlag:function(){this.childrenOrderDirty&&(this.childrenOrderDirty=!1),this._transformNodePool.length=0},transform:function(){var t=this._transformNodePool;t.sort(this._sortNodeByLevelAsc);var e,i;for(e=0,i=t.length;e<i;e++)t[e].updateStatus();t.length=0},transformDirty:function(){return this._transformNodePool.length>0},_sortNodeByLevelAsc:function(t,e){return t._curLevel-e._curLevel},pushDirtyNode:function(t){this._transformNodePool.push(t)},clearRenderCommands:function(){this._renderCmds.length=0},clear:function(){var t=cc._renderContext;t.clearColor(this._clearColor.r,this._clearColor.g,this._clearColor.b,this._clearColor.a),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT)},setDepthTest:function(t){var e=cc._renderContext;t?(e.clearDepth(1),e.enable(e.DEPTH_TEST),e.depthFunc(e.LEQUAL)):e.disable(e.DEPTH_TEST)},pushRenderCommand:function(t){if(t.rendering||t.uploadData)if(this._isCacheToBufferOn){var e=this._currentID,i=this._cacheToBufferCmds[e];-1===i.indexOf(t)&&i.push(t)}else this._renderCmds.push(t)},_increaseBatchingSize:function(t,e,i){var n,r;switch(e=e||v.QUAD){case v.QUAD:for(n=0;n<t;n+=4)r=h+n,f[l++]=r+0,f[l++]=r+1,f[l++]=r+2,f[l++]=r+1,f[l++]=r+2,f[l++]=r+3;break;case v.TRIANGLE:for(g=!1,n=0;n<t;n+=3)r=h+n,f[l++]=r+0,f[l++]=r+1,f[l++]=r+2;break;case v.CUSTOM:g=!1;var s=i.length;for(n=0;n<s;n++)f[l++]=h+i[n];break;default:return}h+=t},_updateBatchedInfo:function(t,e,i){return(t!==r.texture||e.src!==r.blendSrc||e.dst!==r.blendDst||i!==r.shader)&&(this._batchRendering(),r.texture=t,r.blendSrc=e.src,r.blendDst=e.dst,r.shader=i,!0)},_breakBatch:function(){s=!0},_uploadBufferData:function(t){h>=c&&this._batchRendering();var e=t._node,i=t._texture||e._texture||e._spriteFrame&&e._spriteFrame._texture,n=e._blendFunc.src,o=e._blendFunc.dst,a=t._shaderProgram;(s||r.texture!==i||r.blendSrc!==n||r.blendDst!==o||r.shader!==a)&&(this._batchRendering(),r.texture=i,r.blendSrc=n,r.blendDst=o,r.shader=a,s=!1);var u=t.uploadData(d,m,h*_);if(u>0){var p,y;switch(t.vertexType||v.QUAD){case v.QUAD:for(p=0;p<u;p+=4)y=h+p,f[l++]=y+0,f[l++]=y+1,f[l++]=y+2,f[l++]=y+1,f[l++]=y+2,f[l++]=y+3;break;case v.TRIANGLE:for(g=!1,p=0;p<u;p+=3)y=h+p,f[l++]=y+0,f[l++]=y+1,f[l++]=y+2;break;case v.CUSTOM:g=!1,t.uploadIndexData&&(l+=t.uploadIndexData(f,l,h));break;default:return}h+=u}},_batchRendering:function(){if(0!==h&&r.texture){var t=cc._renderContext,e=r.texture,i=r.shader,n=h>.5*c;if(i&&(i.use(),i._updateProjectionUniform()),cc.gl.blendFunc(r.blendSrc,r.blendDst),cc.gl.bindTexture2DN(0,e),t.bindBuffer(t.ARRAY_BUFFER,a),n)t.bufferData(t.ARRAY_BUFFER,d,t.DYNAMIC_DRAW);else{var s=d.subarray(0,h*_);t.bufferData(t.ARRAY_BUFFER,s,t.DYNAMIC_DRAW)}t.enableVertexAttribArray(cc.macro.VERTEX_ATTRIB_POSITION),t.enableVertexAttribArray(cc.macro.VERTEX_ATTRIB_COLOR),t.enableVertexAttribArray(cc.macro.VERTEX_ATTRIB_TEX_COORDS),t.vertexAttribPointer(cc.macro.VERTEX_ATTRIB_POSITION,3,t.FLOAT,!1,24,0),t.vertexAttribPointer(cc.macro.VERTEX_ATTRIB_COLOR,4,t.UNSIGNED_BYTE,!0,24,12),t.vertexAttribPointer(cc.macro.VERTEX_ATTRIB_TEX_COORDS,2,t.FLOAT,!1,24,16),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,o),(!p||!g||l>p)&&(n?t.bufferData(t.ELEMENT_ARRAY_BUFFER,f,t.DYNAMIC_DRAW):t.bufferData(t.ELEMENT_ARRAY_BUFFER,f.subarray(0,l),t.DYNAMIC_DRAW)),t.drawElements(t.TRIANGLES,l,t.UNSIGNED_SHORT,0),cc.g_NumberOfDraws++,g?p=l:(p=0,g=!0),h=0,l=0}},rendering:function(t,e){var i,n,s,o=e||this._renderCmds,a=t||cc._renderContext;for(a.bindBuffer(a.ARRAY_BUFFER,null),cc.gl.bindTexture2DN(0,null),i=0,n=o.length;i<n;++i)(s=o[i])._needDraw&&(s.uploadData?this._uploadBufferData(s):(h>0&&this._batchRendering(),s.rendering(a)));this._batchRendering(),r.texture=null}}}),{}],186:[(function(t,e,i){t("./RendererCanvas"),t("./RendererWebGL"),t("./DirtyRegion")}),{"./DirtyRegion":183,"./RendererCanvas":184,"./RendererWebGL":185}],187:[(function(t,e,i){_ccsg.Scene=_ccsg.Node.extend({_className:"Scene",ctor:function(){_ccsg.Node.prototype.ctor.call(this),this._ignoreAnchorPointForPosition=!0,this.setAnchorPoint(.5,.5),this.setContentSize(cc.director.getWinSize())}})}),{}],188:[(function(t,e,i){var n=t("../event/event-target"),r=t("../utils/misc");_ccsg.Sprite=_ccsg.Node.extend({dirty:!1,_recursiveDirty:null,_shouldBeHidden:!1,_transformToBatch:null,_blendFunc:null,_texture:null,_rect:null,_rectRotated:!1,_offsetPosition:null,_unflippedOffsetPositionFromCenter:null,_opacityModifyRGB:!1,_flippedX:!1,_flippedY:!1,_textureLoaded:!1,_className:"Sprite",ctor:function(t,e,i){_ccsg.Node.prototype.ctor.call(this),n.call(this),this._shouldBeHidden=!1,this._offsetPosition=cc.p(0,0),this._unflippedOffsetPositionFromCenter=cc.p(0,0),this._blendFunc={src:cc.macro.BLEND_SRC,dst:cc.macro.BLEND_DST},this._rect=cc.rect(0,0,0,0),this._softInit(t,e,i)},textureLoaded:function(){return this._textureLoaded},addLoadedEventListener:function(t,e){this.once("load",t,e)},isDirty:function(){return this.dirty},setDirty:function(t){this.dirty=t},isTextureRectRotated:function(){return this._rectRotated},getTextureRect:function(){return cc.rect(this._rect)},getOffsetPosition:function(){return cc.p(this._offsetPosition)},_getOffsetX:function(){return this._offsetPosition.x},_getOffsetY:function(){return this._offsetPosition.y},getBlendFunc:function(){return this._blendFunc},initWithSpriteFrame:function(t){cc.assertID(t,2606),t.textureLoaded()||(this._textureLoaded=!1,t.once("load",this._renderCmd._spriteFrameLoadedCallback,this._renderCmd));var e=cc._renderType!==cc.game.RENDER_TYPE_CANVAS&&t._rotated,i=this.initWithTexture(t.getTexture(),t.getRect(),e);return this.setSpriteFrame(t),i},initWithSpriteFrameName:function(){cc.warnID(2608)},setVertexRect:function(t){var e=this._rect;e.x=t.x,e.y=t.y,e.width=t.width,e.height=t.height},setFlippedX:function(t){this._flippedX!==t&&(this._flippedX=t,this.setTextureRect(this._rect,this._rectRotated,this._contentSize),this.setNodeDirty(!0))},setFlippedY:function(t){this._flippedY!==t&&(this._flippedY=t,this.setTextureRect(this._rect,this._rectRotated,this._contentSize),this.setNodeDirty(!0))},isFlippedX:function(){return this._flippedX},isFlippedY:function(){return this._flippedY},setOpacityModifyRGB:function(t){this._opacityModifyRGB!==t&&(this._opacityModifyRGB=t,this._renderCmd._setColorDirty())},isOpacityModifyRGB:function(){return this._opacityModifyRGB},setDisplayFrameWithAnimationName:function(t,e){cc.assertID(t,2610);var i=cc.spriteFrameAnimationCache.getAnimation(t);if(i){var n=i.getFrames()[e];n?this.setSpriteFrame(n.getSpriteFrame()):cc.logID(2603)}else cc.logID(2602)},getTexture:function(){return this._texture},_softInit:function(t,e,i){if(void 0===t)_ccsg.Sprite.prototype.init.call(this);else if(cc.js.isString(t))"#"===t[0]?cc.logID(2728,t):_ccsg.Sprite.prototype.init.call(this,t,e);else if("object"==typeof t)if(t instanceof cc.Texture2D)this.initWithTexture(t,e,i);else if(t instanceof cc.SpriteFrame)this.initWithSpriteFrame(t);else if(t instanceof HTMLImageElement||t instanceof HTMLCanvasElement){var n=new cc.Texture2D;n.initWithElement(t),n.handleLoadedTexture(),this.initWithTexture(n)}},getQuad:function(){return null},setBlendFunc:function(t,e){var i=this._blendFunc;void 0===e?(i.src=t.src,i.dst=t.dst):(i.src=t,i.dst=e),this._renderCmd.updateBlendFunc(i)},init:function(){return arguments.length>0?this.initWithFile(arguments[0],arguments[1]):(this.dirty=this._recursiveDirty=!1,this._blendFunc.src=cc.macro.BLEND_SRC,this._blendFunc.dst=cc.macro.BLEND_DST,this.texture=null,this._flippedX=this._flippedY=!1,this.anchorX=.5,this.anchorY=.5,this._offsetPosition.x=0,this._offsetPosition.y=0,this.setTextureRect(cc.rect(0,0,0,0),!1,cc.size(0,0)),!0)},initWithFile:function(t,e){cc.assertID(t,2609);var i=cc.textureCache.getTextureForKey(t);if(i){if(!e){var n=i.getContentSize();e=cc.rect(0,0,n.width,n.height)}return this.initWithTexture(i,e)}return i=cc.textureCache.addImage(t),this.initWithTexture(i,e||cc.rect(0,0,i.width,i.height))},initWithTexture:function(t,e,i,n){cc.assertID(0!==arguments.length,2710),i=i||!1,t=this._renderCmd._handleTextureForRotatedTexture(t,e,i,n),this._recursiveDirty=!1,this.dirty=!1,this._opacityModifyRGB=!0,this._blendFunc.src=cc.macro.BLEND_SRC,this._blendFunc.dst=cc.macro.BLEND_DST,this._flippedX=this._flippedY=!1,this.setAnchorPoint(.5,.5),this._offsetPosition.x=0,this._offsetPosition.y=0;var r=t.loaded;return this._textureLoaded=r,r?(e||(e=cc.rect(0,0,t.width,t.height)),this._renderCmd._checkTextureBoundary(t,e,i),this.setTexture(t),this.setTextureRect(e,i),this.emit("load"),!0):(this._rectRotated=i,e&&(this._rect.x=e.x,this._rect.y=e.y,this._rect.width=e.width,this._rect.height=e.height),this.texture&&this.texture.off("load",this._renderCmd._textureLoadedCallback,this._renderCmd),t.once("load",this._renderCmd._textureLoadedCallback,this._renderCmd),this.setTexture(t),!0)},setTextureRect:function(t,e,i,n){this._rectRotated=e||!1,this.setContentSize(i||t),this.setVertexRect(t),this._renderCmd._setTextureCoords(t,n);var r=this._unflippedOffsetPositionFromCenter.x,s=this._unflippedOffsetPositionFromCenter.y;this._flippedX&&(r=-r),this._flippedY&&(s=-s);var o=this._rect;this._offsetPosition.x=r+(this._contentSize.width-o.width)/2,this._offsetPosition.y=s+(this._contentSize.height-o.height)/2},setSpriteFrame:function(t){var e=this;cc.assertID(t,2712),this.setNodeDirty(!0);var i=t.getOffset();e._unflippedOffsetPositionFromCenter.x=i.x,e._unflippedOffsetPositionFromCenter.y=i.y;var n=t.getTexture();t.textureLoaded()?(e._textureLoaded=!0,n!==e._texture&&(e._setTexture(n),e.setColor(e._realColor)),e.setTextureRect(t.getRect(),t.isRotated(),t.getOriginalSize())):(e._textureLoaded=!1,t.once("load",(function(t){var i=t.currentTarget;e._textureLoaded=!0;var n=i.getTexture();n!==e._texture&&e._setTexture(n),e.setTextureRect(i.getRect(),i.isRotated(),i.getOriginalSize()),e.emit("load"),e.setColor(e._realColor)}),e)),this._renderCmd._updateForSetSpriteFrame(n)},setDisplayFrame:function(t){cc.logID(2604),this.setSpriteFrame(t)},isFrameDisplayed:function(t){return this._renderCmd.isFrameDisplayed(t)},displayFrame:function(){return this.getSpriteFrame()},getSpriteFrame:function(){return new cc.SpriteFrame(this._texture,this._rect,this._rectRotated,this._unflippedOffsetPositionFromCenter,this._contentSize)},setTexture:function(t){if(!t)return this._renderCmd._setTexture(null);var e=cc.js.isString(t);e&&(t=cc.textureCache.addImage(t)),t.loaded?(this._setTexture(t,e),this.setColor(this._realColor),this._textureLoaded=!0,this.emit("load")):(this._renderCmd._setTexture(t),t.once("load",(function(i){this._setTexture(t,e),this.setColor(this._realColor),this._textureLoaded=!0,this.emit("load")}),this))},_setTexture:function(t,e){this._renderCmd._setTexture(t),e&&this._changeRectWithTexture(t)},_changeRectWithTexture:function(t){var e=cc.rect(0,0,t.width,t.height);this.setTextureRect(e)},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_CANVAS?new _ccsg.Sprite.CanvasRenderCmd(this):new _ccsg.Sprite.WebGLRenderCmd(this)}}),cc.js.addon(_ccsg.Sprite.prototype,n.prototype);r.propertyDefine(_ccsg.Sprite,["opacity","color","texture","quad"],{opacityModifyRGB:["isOpacityModifyRGB","setOpacityModifyRGB"],flippedX:["isFlippedX","setFlippedX"],flippedY:["isFlippedY","setFlippedY"],offsetX:["_getOffsetX"],offsetY:["_getOffsetY"],textureRectRotated:["isTextureRectRotated"]})}),{"../event/event-target":92,"../utils/misc":206}],189:[(function(t,e,i){_ccsg.Sprite.CanvasRenderCmd=function(t){this._rootCtor(t),this._needDraw=!0,this._textureCoord={renderX:0,renderY:0,x:0,y:0,width:0,height:0,validRect:!1},this._blendFuncStr="source-over",this._colorized=!1,this._textureToRender=null};var n=_ccsg.Sprite.CanvasRenderCmd.prototype=Object.create(_ccsg.Node.CanvasRenderCmd.prototype);n.constructor=_ccsg.Sprite.CanvasRenderCmd,n.setDirtyRecursively=function(t){},n._setTexture=function(t){var e=this._node;if(e._texture!==t){e._textureLoaded=!!t&&t.loaded,e._texture=t;var i=cc.rect(0,0,t.width,t.height);e.setTextureRect(i),this._updateColor()}},n._setColorDirty=function(){this.setDirtyFlag(_ccsg.Node._dirtyFlags.colorDirty|_ccsg.Node._dirtyFlags.opacityDirty)},n.isFrameDisplayed=function(t){var e=this._node;return t.getTexture()===e._texture&&cc.rectEqualToRect(t.getRect(),e._rect)},n.updateBlendFunc=function(t){this._blendFuncStr=_ccsg.Node.CanvasRenderCmd._getCompositeOperationByBlendFunc(t)},n._handleTextureForRotatedTexture=function(t,e,i,n){if(i&&t.isLoaded()){var r=t.getHtmlElementObj();r=_ccsg.Sprite.CanvasRenderCmd._cutRotateImageToCanvas(r,e,n);var s=new cc.Texture2D;s.initWithElement(r),s.handleLoadedTexture(),t=s,e.x=e.y=0,this._node._rect=cc.rect(0,0,e.width,e.height)}return t},n._checkTextureBoundary=function(t,e,i){if(t&&t.url){var n=e.x+e.width,r=e.y+e.height;n>t.width&&cc.errorID(3300,t.url),r>t.height&&cc.errorID(3400,t.url)}},n.rendering=function(t,e,i){var n=this._node,r=this._textureCoord,s=this._displayedOpacity/255,o=this._textureToRender||n._texture;if((!o||0!==r.width&&0!==r.height&&o.loaded)&&0!==s){var a,c=t||cc._renderContext,h=c.getContext(),l=n._offsetPosition.x,_=n._rect.height,u=n._rect.width,d=-n._offsetPosition.y-_;c.setTransform(this._worldTransform,e,i),c.setCompositeOperation(this._blendFuncStr),c.setGlobalAlpha(s),(n._flippedX||n._flippedY)&&c.save(),n._flippedX&&(l=-l-u,h.scale(-1,1)),n._flippedY&&(d=n._offsetPosition.y,h.scale(1,-1));var m,f,p,g,v,y,x,C;if(this._colorized?(m=0,f=0):(m=r.renderX,f=r.renderY),p=r.width,g=r.height,v=l,y=d,x=u,C=_,o&&o._image)a=o._image,""!==o._pattern?(c.setFillStyle(h.createPattern(a,o._pattern)),h.fillRect(v,y,x,C)):h.drawImage(a,m,f,p,g,v,y,x,C);else{var A=n._contentSize;if(r.validRect){var T=this._displayedColor;c.setFillStyle("rgba("+T.r+","+T.g+","+T.b+",1)"),h.fillRect(v,y,A.width,A.height)}}(n._flippedX||n._flippedY)&&c.restore(),cc.g_NumberOfDraws++}},n._updateColor=function(){var t=this._node._texture,e=this._textureCoord,i=this._displayedColor;t&&(255!==i.r||255!==i.g||255!==i.b?(this._textureToRender=t._generateColorTexture(i.r,i.g,i.b,e),this._colorized=!0):t&&(this._textureToRender=t,this._colorized=!1))},n._updateForSetSpriteFrame=function(t,e){if(this._colorized=!1,this._textureCoord.renderX=this._textureCoord.x,this._textureCoord.renderY=this._textureCoord.y,e=e||t.loaded){var i=this._node.getColor();255===i.r&&255===i.g&&255===i.b||this._updateColor()}},n._spriteFrameLoadedCallback=function(t){var e=this._node,i=t.currentTarget;e.setTextureRect(i.getRect(),i.isRotated(),i.getOriginalSize()),this._updateColor(),e.emit("load")},n._textureLoadedCallback=function(t){var e=this._node,i=t.currentTarget;if(!e._textureLoaded){e._textureLoaded=!0;var n=e._rect;n?cc._rectEqualToZero(n)&&(n.width=i.width,n.height=i.height):n=cc.rect(0,0,i.width,i.height),e.texture=i,e.setTextureRect(n,e._rectRotated);var r=this._displayedColor;255===r.r&&255===r.g&&255===r.b||this._updateColor(),e.emit("load")}},n._setTextureCoords=function(t){var e=this._textureCoord;e.renderX=e.x=0|t.x,e.renderY=e.y=0|t.y,e.width=0|t.width,e.height=0|t.height,e.validRect=!(0===e.width||0===e.height||e.x<0||e.y<0)},_ccsg.Sprite.CanvasRenderCmd._cutRotateImageToCanvas=function(t,e,i){if(!t)return null;if(!e)return t;i=null==i||i;var n=document.createElement("canvas");n.width=e.width,n.height=e.height;var r=n.getContext("2d");return r.translate(n.width/2,n.height/2),i?r.rotate(-1.5707963267948966):r.rotate(1.5707963267948966),r.drawImage(t,e.x,e.y,e.height,e.width,-e.height/2,-e.width/2,e.height,e.width),n}}),{}],190:[(function(t,e,i){var n=cc.macro;_ccsg.Sprite.WebGLRenderCmd=function(t){this._rootCtor(t),this._needDraw=!0,this._vertices=[{x:0,y:0,u:0,v:0},{x:0,y:0,u:0,v:0},{x:0,y:0,u:0,v:0},{x:0,y:0,u:0,v:0}],this._dirty=!1,this._recursiveDirty=!1,this._shaderProgram=cc.shaderCache.programForKey(n.SHADER_SPRITE_POSITION_TEXTURECOLOR)};var r=_ccsg.Sprite.WebGLRenderCmd.prototype=Object.create(_ccsg.Node.WebGLRenderCmd.prototype);r.constructor=_ccsg.Sprite.WebGLRenderCmd,r.updateBlendFunc=function(t){},r.setDirtyFlag=function(t){_ccsg.Node.WebGLRenderCmd.prototype.setDirtyFlag.call(this,t),this._dirty=!0},r.setDirtyRecursively=function(t){this._recursiveDirty=t,this._dirty=t;for(var e,i=this._node._children,n=i?i.length:0,r=0;r<n;r++)(e=i[r])instanceof _ccsg.Sprite&&e._renderCmd.setDirtyRecursively(t)},r._handleTextureForRotatedTexture=function(t){return t},r.isFrameDisplayed=function(t){var e=this._node;return cc.rectEqualToRect(t.getRect(),e._rect)&&t.getTexture().url===e._texture.url&&cc.pointEqualToPoint(t.getOffset(),e._unflippedOffsetPositionFromCenter)},r._updateForSetSpriteFrame=function(){},r._spriteFrameLoadedCallback=function(t){var e=t.currentTarget;this._node.setTextureRect(e.getRect(),e.isRotated(),e.getOriginalSize()),this._node.emit("load")},r._textureLoadedCallback=function(t){var e=this._node,i=t.currentTarget;if(!e._textureLoaded){e._textureLoaded=!0;var n=e._rect;n?cc._rectEqualToZero(n)&&(n.width=i.width,n.height=i.height):n=cc.rect(0,0,i.width,i.height),e.texture=i,e.setTextureRect(n,e._rectRotated),e.emit("load"),cc.renderer.childrenOrderDirty=!0}},r._setTextureCoords=function(t){var e=this._node,i=e._texture,r=this._vertices;if(i){var s,o,a,c,h,l=i.pixelWidth,_=i.pixelHeight;e._rectRotated?(n.FIX_ARTIFACTS_BY_STRECHING_TEXEL?(o=(s=(2*t.x+1)/(2*l))+(2*t.height-2)/(2*l),c=(a=(2*t.y+1)/(2*_))+(2*t.width-2)/(2*_)):(s=t.x/l,o=(t.x+t.height)/l,a=t.y/_,c=(t.y+t.width)/_),e._flippedX&&(h=a,a=c,c=h),e._flippedY&&(h=s,s=o,o=h),r[0].u=o,r[0].v=a,r[1].u=s,r[1].v=a,r[2].u=o,r[2].v=c,r[3].u=s,r[3].v=c):(n.FIX_ARTIFACTS_BY_STRECHING_TEXEL?(o=(s=(2*t.x+1)/(2*l))+(2*t.width-2)/(2*l),c=(a=(2*t.y+1)/(2*_))+(2*t.height-2)/(2*_)):(s=t.x/l,o=(t.x+t.width)/l,a=t.y/_,c=(t.y+t.height)/_),e._flippedX&&(h=s,s=o,o=h),e._flippedY&&(h=a,a=c,c=h),r[0].u=s,r[0].v=a,r[1].u=s,r[1].v=c,r[2].u=o,r[2].v=a,r[3].u=o,r[3].v=c)}},r._setColorDirty=function(){},r._updateBlendFunc=function(){var t=this._node;t._texture&&t._texture.hasPremultipliedAlpha()?(t._blendFunc.src=n.BLEND_SRC,t._blendFunc.dst=n.BLEND_DST,t.opacityModifyRGB=!0):(t._blendFunc.src=n.SRC_ALPHA,t._blendFunc.dst=n.ONE_MINUS_SRC_ALPHA,t.opacityModifyRGB=!1)},r._setTexture=function(t){var e=this._node;e._texture!==t&&(e._textureLoaded=!!t&&t.loaded,e._texture=t,this._updateBlendFunc(),e._textureLoaded&&(cc.renderer.childrenOrderDirty=!0))},r._checkTextureBoundary=function(t,e,i){if(t&&t.url){var n,r;i?(n=e.x+e.height,r=e.y+e.width):(n=e.x+e.width,r=e.y+e.height),n>t.width&&cc.errorID(3300,t.url),r>t.height&&cc.errorID(3400,t.url)}},r.transform=function(t,e){this.originTransform(t,e);var i=this._node,n=i._offsetPosition.x,r=n+i._rect.width,s=i._offsetPosition.y,o=s+i._rect.height,a=this._worldTransform,c=this._vertices;c[0].x=n*a.a+o*a.c+a.tx,c[0].y=n*a.b+o*a.d+a.ty,c[1].x=n*a.a+s*a.c+a.tx,c[1].y=n*a.b+s*a.d+a.ty,c[2].x=r*a.a+o*a.c+a.tx,c[2].y=r*a.b+o*a.d+a.ty,c[3].x=r*a.a+s*a.c+a.tx,c[3].y=r*a.b+s*a.d+a.ty},r.needDraw=function(){var t=this._node._texture;return this._needDraw&&t},r.uploadData=function(t,e,i){var n=this._node,r=n._texture;if(!(r&&r.loaded&&n._rect.width&&n._rect.height&&this._displayedOpacity))return 0;var s,o=this._displayedOpacity,a=this._displayedColor._val;if(n._opacityModifyRGB){var c=o/255,h=this._displayedColor.r*c,l=this._displayedColor.g*c;s=(o<<24>>>0)+(this._displayedColor.b*c<<16)+(l<<8)+h}else s=(o<<24>>>0)+((65280&a)<<8)+((16711680&a)>>8)+(a>>>24);var _,u,d=n._vertexZ,m=this._vertices,f=m.length,p=i;for(_=0;_<f;++_)u=m[_],t[p]=u.x,t[p+1]=u.y,t[p+2]=d,e[p+3]=s,t[p+4]=u.u,t[p+5]=u.v,p+=6;return f}}),{}],191:[(function(t,e,i){function n(t,e){return t-e}var r,s=t("../event/event-target"),o={_pool:{},_lengths:[],put:function(t){var e=t.length;this._pool[e]?this._pool[e].push(t):(this._pool[e]=[t],this._lengths.push(e),this._lengths.sort(n))},get:function(t){for(var e,i=0;i<this._lengths.length;i++)if(this._lengths[i]>=t){e=this._lengths[i];break}return e?this._pool[e].pop():void 0}},a=cc.macro,c={_rebuildQuads_base:function(t){var e,i,n,s,a=t._spriteFrame,c=t._contentSize,h=t._isTrimmedContentSize,l=t._vertices,_=t._corner;if(h)e=0,i=0,n=c.width,s=c.height;else{var u=a._originalSize,d=a._rect,m=a._offset,f=c.width,p=c.height,g=u.width,v=u.height,y=d.width,x=d.height,C=f/g,A=p/v,T=m.x+(g-y)/2,b=m.x-(g-y)/2;e=T*C,i=(m.y+(v-x)/2)*A,n=f+b*C,s=p+(m.y-(v-x)/2)*A}if(l.length<8&&(o.put(l),l=o.get(8)||new Float32Array(8),t._vertices=l),r){var w=t._renderCmd._worldTransform,S=w.a,E=w.b,I=w.c,R=w.d,P=w.tx,B=w.ty,L=e*S,O=e*E,D=n*S,N=n*E,M=s*I+P,F=s*R+B,z=i*I+P,G=i*R+B;l[0]=L+z,l[1]=O+G,l[2]=D+z,l[3]=N+G,l[4]=L+M,l[5]=O+F,l[6]=D+M,l[7]=N+F}else l[0]=e,l[1]=i,l[2]=n,l[3]=i,l[4]=e,l[5]=s,l[6]=n,l[7]=s;_[0]=0,_[1]=2,_[2]=4,_[3]=6,t._uvsDirty&&this._calculateUVs(t,a),t._vertCount=4},_calculateUVs:function(t,e){var i=t._uvs,n=e._texture.width,r=e._texture.height,s=e._rect;i.length<8&&(o.put(i),i=o.get(8)||new Float32Array(8),t._uvs=i);var c,h,l,_,u=a.FIX_ARTIFACTS_BY_STRECHING_TEXEL?.5:0;e._rotated?(c=(s.x+u)/n,h=(s.y+s.width-u)/r,l=(s.x+s.height-u)/n,_=(s.y+u)/r,i[0]=c,i[1]=_,i[2]=c,i[3]=h,i[4]=l,i[5]=_,i[6]=l,i[7]=h):(c=(s.x+u)/n,h=(s.y+s.height-u)/r,l=(s.x+s.width-u)/n,_=(s.y+u)/r,i[0]=c,i[1]=h,i[2]=l,i[3]=h,i[4]=c,i[5]=_,i[6]=l,i[7]=_)}},h={x:new Array(4),y:new Array(4),_rebuildQuads_base:function(t){var e,i,n,s,a=t._spriteFrame,c=t._contentSize,h=t._insetLeft,l=t._insetRight,_=t._insetTop,u=t._insetBottom,d=t._vertices,m=t._renderCmd._worldTransform,f=a._rect,p=t._corner;e=h,i=l,f.width,n=_,s=u,f.height;var g=c,v=g.width-e-i,y=g.height-n-s,x=g.width/(e+i),C=g.height/(n+s);x=isNaN(x)||x>1?1:x,C=isNaN(C)||C>1?1:C,v=v<0?0:v,y=y<0?0:y;var A=this.x,T=this.y;A[0]=0,A[1]=e*x,A[2]=A[1]+v,A[3]=g.width,T[0]=0,T[1]=s*C,T[2]=T[1]+y,T[3]=g.height,d.length<32&&(o.put(d),d=o.get(32)||new Float32Array(32),t._vertices=d);var b,w,S=0;if(r)for(b=0;b<4;b++)for(w=0;w<4;w++)d[S]=A[w]*m.a+T[b]*m.c+m.tx,d[S+1]=A[w]*m.b+T[b]*m.d+m.ty,S+=2;else for(b=0;b<4;b++)for(w=0;w<4;w++)d[S]=A[w],d[S+1]=T[b],S+=2;p[0]=0,p[1]=6,p[2]=24,p[3]=30,t._uvsDirty&&this._calculateUVs(t,a,h,l,_,u)},_calculateUVs:function(t,e,i,n,r,s){var c,h,l,_,u,d,m=t._uvs,f=e._rect,p=e._texture.width,g=e._texture.height,v=e._rect;c=i,l=n,h=f.width-c-l,_=r,d=s,u=f.height-_-d,m.length<32&&(o.put(m),m=o.get(32)||new Float32Array(32),t._uvs=m);var y,x,C=this.x,A=this.y,T=a.FIX_ARTIFACTS_BY_STRECHING_TEXEL?.5:0,b=0;if(e._rotated)for(C[0]=(v.x+T)/p,C[1]=(d+v.x)/p,C[2]=(d+u+v.x)/p,C[3]=(v.x+v.height-T)/p,A[3]=(v.y+T)/g,A[2]=(c+v.y)/g,A[1]=(c+h+v.y)/g,A[0]=(v.y+v.width-T)/g,y=0;y<4;y++)for(x=0;x<4;x++)m[b]=C[y],m[b+1]=A[3-x],b+=2;else for(C[0]=(v.x+T)/p,C[1]=(c+v.x)/p,C[2]=(c+h+v.x)/p,C[3]=(v.x+v.width-T)/p,A[3]=(v.y+T)/g,A[2]=(_+v.y)/g,A[1]=(_+u+v.y)/g,A[0]=(v.y+v.height-T)/g,y=0;y<4;y++)for(x=0;x<4;x++)m[b]=C[x],m[b+1]=A[y],b+=2}},l={_rebuildQuads_base:function(t,e,i){e=t._spriteFrame,i=t._contentSize;var n,s,c,h,l=t._vertices,_=t._corner,u=t._renderCmd._worldTransform,d=t._uvs,m=e._texture.width,f=e._texture.height,p=e._rect,g=a.FIX_ARTIFACTS_BY_STRECHING_TEXEL?.5:0;e._rotated?(n=(p.x+g)/m,c=(p.x+p.height-g)/m,s=(p.y+p.width-g)/f,h=(p.y+g)/f):(n=(p.x+g)/m,c=(p.x+p.width-g)/m,s=(p.y+p.height-g)/f,h=(p.y+g)/f);var v=p.width,y=p.height,x=i.width/v,C=i.height/y,A=Math.ceil(C),T=Math.ceil(x);A*T>16384&&cc.errorID(2625);var b=A*T*4*2;l.length<b&&(o.put(l),l=o.get(b)||new Float32Array(b),t._vertices=l),d.length<b&&(o.put(d),d=o.get(b)||new Float32Array(b),t._uvs=d);var w,S,E,I,R=0;t._vertCount=0;for(var P=0;P<A;++P)for(var B=0;B<T;++B){if(w=v*B,S=y*P,E=v*Math.min(B+1,x),I=y*Math.min(P+1,C),r){var L=w*u.a,O=w*u.b,D=E*u.a,N=E*u.b,M=I*u.c+u.tx,F=I*u.d+u.ty,z=S*u.c+u.tx,G=S*u.d+u.ty;l[R]=L+z,l[R+1]=O+G,l[R+2]=D+z,l[R+3]=N+G,l[R+4]=L+M,l[R+5]=O+F,l[R+6]=D+M,l[R+7]=N+F}else l[R]=w,l[R+1]=S,l[R+2]=E,l[R+3]=S,l[R+4]=w,l[R+5]=I,l[R+6]=E,l[R+7]=I;if(e._rotated?(d[R]=n,d[R+1]=h,d[R+2]=n,d[R+3]=I=h+(s-h)*Math.min(1,x-B),d[R+4]=E=n+(c-n)*Math.min(1,C-P),d[R+5]=h,d[R+6]=E,d[R+7]=I):(d[R]=n,d[R+1]=s,d[R+2]=E=n+(c-n)*Math.min(1,x-B),d[R+3]=s,d[R+4]=n,d[R+5]=I=s+(h-s)*Math.min(1,C-P),d[R+6]=E,d[R+7]=I),R+=8,t._vertCount+=4,R>b)return}_[0]=0,_[1]=8*(T-1)+2,_[2]=(A-1)*T*8+4,_[3]=b-2}},_={_rebuildQuads_base:function(t){var e=t._spriteFrame,i=t._contentSize,n=t._fillStart,s=t._fillRange;s<0&&(n+=s,s=-s),s=n+s,n=(n=n>1?1:n)<0?0:n,s=(s=s>1?1:s)<0?0:s,s-=n;var c,h,l,_,u,d=t._fillType,m=t._vertices,f=t._corner,g=t._renderCmd._worldTransform,v=t._uvs,y=0,x=0,C=i.width,A=i.height,T=e._texture.width,b=e._texture.height,w=e._rect,S=a.FIX_ARTIFACTS_BY_STRECHING_TEXEL?.5:0;e._rotated?(h=(w.x+S)/T,l=(w.y+w.width-S)/b,_=(w.x+w.height-S)/T,u=(w.y+S)/b):(h=(w.x+S)/T,l=(w.y+w.height-S)/b,_=(w.x+w.width-S)/T,u=(w.y+S)/b),m.length<8&&(o.put(m),m=o.get(8)||new Float32Array(8),t._vertices=m),v.length<8&&(o.put(v),v=o.get(8)||new Float32Array(8),t._uvs=v);var E=new Array(8);e._rotated?(E[0]=E[2]=h,E[4]=E[6]=_,E[3]=E[7]=l,E[1]=E[5]=u):(E[0]=E[4]=h,E[2]=E[6]=_,E[1]=E[3]=l,E[5]=E[7]=u),c=(c=(n=(n=n>1?1:n)<0?0:n)+(s=s<0?0:s))>1?1:c;var I;switch(d){case p.HORIZONTAL:I=y+(C-y)*c,y=y+(C-y)*n,C=I,v[0]=E[0]+(E[2]-E[0])*n,v[1]=E[1],v[2]=E[0]+(E[2]-E[0])*c,v[3]=E[3],v[4]=E[4]+(E[6]-E[4])*n,v[5]=E[5],v[6]=E[4]+(E[6]-E[4])*c,v[7]=E[7];break;case p.VERTICAL:I=x+(A-x)*c,x=x+(A-x)*n,A=I,v[0]=E[0],v[1]=E[1]+(E[5]-E[1])*n,v[2]=E[2],v[3]=E[3]+(E[7]-E[3])*n,v[4]=E[4],v[5]=E[1]+(E[5]-E[1])*c,v[6]=E[6],v[7]=E[3]+(E[7]-E[3])*c;break;default:cc.errorID(2626)}if(r){var R=y*g.a,P=y*g.b,B=C*g.a,L=C*g.b,O=A*g.c+g.tx,D=A*g.d+g.ty,N=x*g.c+g.tx,M=x*g.d+g.ty;m[0]=R+N,m[1]=P+M,m[2]=B+N,m[3]=L+M,m[4]=R+O,m[5]=P+D,m[6]=B+O,m[7]=L+D}else m[0]=y,m[1]=x,m[2]=C,m[3]=x,m[4]=y,m[5]=A,m[6]=C,m[7]=A;t._vertCount=4,f[0]=0,f[1]=2,f[2]=4,f[3]=6}},u={_vertPos:[cc.v2(0,0),cc.v2(0,0),cc.v2(0,0),cc.v2(0,0)],_vertices:[cc.v2(0,0),cc.v2(0,0)],_uvs:[cc.v2(0,0),cc.v2(0,0)],_intersectPoint_1:[cc.v2(0,0),cc.v2(0,0),cc.v2(0,0),cc.v2(0,0)],_intersectPoint_2:[cc.v2(0,0),cc.v2(0,0),cc.v2(0,0),cc.v2(0,0)],outVerts:null,outUvs:null,rawVerts:null,rawUvs:null,_rebuildQuads_base:function(t){var e=t._spriteFrame,i=t._contentSize,n=t._fillStart,r=t._fillRange;r<0&&(n+=r,r=-r),t._isTriangle=!0,t._rawVerts||(t._rawVerts=o.get(8)||new Float32Array(8),t._rawUvs=o.get(8)||new Float32Array(8));for(var s=t._fillCenter,a=t._vertices,c=t._corner,h=t._uvs,l=t._rawVerts,_=t._rawUvs,u=t._renderCmd._worldTransform;n>=1;)n-=1;for(;n<0;)n+=1;var d=s.x*i.width,m=s.y*i.height,f=cc.v2(d,m),p=(n*=2*Math.PI)+(r*=2*Math.PI);this.outVerts=a,this.outUvs=h,this.rawVerts=l,this.rawUvs=_,this._calculateVertices(u,e,i),this._calculateUVs(e);var g=this._vertPos,v=this._vertices;g[0].x=g[3].x=v[0].x,g[1].x=g[2].x=v[1].x,g[0].y=g[1].y=v[0].y,g[2].y=g[3].y=v[1].y,f.x>v[1].x&&(f.x=v[1].x),f.x<v[0].x&&(f.x=v[0].x),f.y<v[0].y&&(f.y=v[0].y),f.y>v[1].y&&(f.y=v[1].y),l[0]=l[4]=this._vertices[0].x,l[2]=l[6]=this._vertices[1].x,l[1]=l[3]=this._vertices[0].y,l[5]=l[7]=this._vertices[1].y,e._rotated?(_[0]=_[2]=this._uvs[0].x,_[4]=_[6]=this._uvs[1].x,_[3]=_[7]=this._uvs[0].y,_[1]=_[5]=this._uvs[1].y):(_[0]=_[4]=this._uvs[0].x,_[2]=_[6]=this._uvs[1].x,_[1]=_[3]=this._uvs[0].y,_[5]=_[7]=this._uvs[1].y);var y=[null,null,null,null];f.x!==this._vertices[0].x&&(y[0]=[3,0]),f.x!==this._vertices[1].x&&(y[2]=[1,2]),f.y!==this._vertices[0].y&&(y[1]=[0,1]),f.y!==this._vertices[1].y&&(y[3]=[2,3]),this._getInsectedPoints(this._vertices[0].x,this._vertices[1].x,this._vertices[0].y,this._vertices[1].y,f,n,this._intersectPoint_1),this._getInsectedPoints(this._vertices[0].x,this._vertices[1].x,this._vertices[0].y,this._vertices[1].y,f,n+r,this._intersectPoint_2);a.length<30&&(o.put(a),a=o.get(30)||new Float32Array(30),this.outVerts=t._vertices=a),h.length<30&&(o.put(h),h=o.get(30)||new Float32Array(30),this.outUvs=t._uvs=h);for(var x=0,C=0,A=0;A<4;++A){var T=y[A];if(null!==T)if(r>=2*Math.PI)this._generateTriangle(u,x,f,this._vertPos[T[0]],this._vertPos[T[1]]),x+=6,C+=3;else{var b=this._getVertAngle(f,this._vertPos[T[0]]),w=this._getVertAngle(f,this._vertPos[T[1]]);w<b&&(w+=2*Math.PI),b-=2*Math.PI,w-=2*Math.PI;for(var S=0;S<3;++S)b>=p||(b>=n?(w>=p?this._generateTriangle(u,x,f,this._vertPos[T[0]],this._intersectPoint_2[A]):this._generateTriangle(u,x,f,this._vertPos[T[0]],this._vertPos[T[1]]),x+=6,C+=3):w<=n||(w<=p?(this._generateTriangle(u,x,f,this._intersectPoint_1[A],this._vertPos[T[1]]),x+=6,C+=3):(this._generateTriangle(u,x,f,this._intersectPoint_1[A],this._intersectPoint_2[A]),x+=6,C+=3))),b+=2*Math.PI,w+=2*Math.PI}}t._vertCount=C;for(var E,I,R=1/0,P=1/0,B=-1/0,L=-1/0,O=0,D=x;O<D;O+=2)E=a[O],I=a[O+1],E<=R?(R=E,c[0]=O):E>=B&&(B=E,c[1]=O),I<=P?(P=I,c[2]=O):I>=L&&(L=I,c[3]=O)},_generateTriangle:function(t,e,i,n,s){var o,a,c=this.rawVerts,h=this.rawUvs,l=this.outVerts,_=c[0],u=c[1],d=c[6],m=c[7];r?(l[e]=i.x*t.a+i.y*t.c+t.tx,l[e+1]=i.x*t.b+i.y*t.d+t.ty,l[e+2]=n.x*t.a+n.y*t.c+t.tx,l[e+3]=n.x*t.b+n.y*t.d+t.ty,l[e+4]=s.x*t.a+s.y*t.c+t.tx,l[e+5]=s.x*t.b+s.y*t.d+t.ty):(l[e]=i.x,l[e+1]=i.y,l[e+2]=n.x,l[e+3]=n.y,l[e+4]=s.x,l[e+5]=s.y),o=(i.x-_)/(d-_),a=(i.y-u)/(m-u),this._generateUV(o,a,h,e),o=(n.x-_)/(d-_),a=(n.y-u)/(m-u),this._generateUV(o,a,h,e+2),o=(s.x-_)/(d-_),a=(s.y-u)/(m-u),this._generateUV(o,a,h,e+4)},_generateUV:function(t,e,i,n){var r=this.outUvs,s=i[0]+(i[2]-i[0])*t,o=i[4]+(i[6]-i[4])*t,a=i[1]+(i[3]-i[1])*t,c=i[5]+(i[7]-i[5])*t;r[n]=s+(o-s)*e,r[n+1]=a+(c-a)*e},_isAngleIn:function(t,e,i){for(var n=2*Math.PI;t<e||t>=e+n;)t<e&&(t+=n),t>=e+n&&(t-=n);return t<=e+i},_getVertAngle:function(t,e){var i,n;if(i=e.x-t.x,n=e.y-t.y,0!==i||0!==n){if(0===i)return n>0?.5*Math.PI:1.5*Math.PI;var r=Math.atan(n/i);return i<0&&(r+=Math.PI),r}},_getInsectedPoints:function(t,e,i,n,r,s,o){var a,c,h=Math.sin(s),l=Math.cos(s);if(0!==Math.cos(s)){if(a=h/l,(t-r.x)*l>0){var _=r.y+a*(t-r.x);o[0].x=t,o[0].y=_}if((e-r.x)*l>0){var u=r.y+a*(e-r.x);o[2].x=e,o[2].y=u}}if(0!==Math.sin(s)){if(c=l/h,(n-r.y)*h>0){var d=r.x+c*(n-r.y);o[3].x=d,o[3].y=n}if((i-r.y)*h>0){var m=r.x+c*(i-r.y);o[1].x=m,o[1].y=i}}return[null,null,null,null]},_calculateVertices:function(t,e,i){var n,r;n=i.width,r=i.height,this._vertices[0].x=0,this._vertices[0].y=0,this._vertices[1].x=n,this._vertices[1].y=r},_calculateUVs:function(t){var e,i,n,r,s=t._texture.width,o=t._texture.height,c=t._rect,h=a.FIX_ARTIFACTS_BY_STRECHING_TEXEL?.5:0;t._rotated?(e=(c.x+h)/s,i=(c.x+c.height-h)/s,n=(c.y+h)/o,r=(c.y+c.width-h)/o):(e=(c.x+h)/s,i=(c.x+c.width-h)/s,n=(c.y+h)/o,r=(c.y+c.height-h)/o),this._uvs[0].x=e,this._uvs[0].y=r,this._uvs[1].x=i,this._uvs[1].y=n}},d={_rebuildQuads_base:function(t,e,i){if(cc._renderType!==cc.game.RENDER_TYPE_CANVAS){t._spriteFrame;if(i=t._meshPolygonInfo){var n=t._renderCmd._worldTransform,r=i.triangles.verts,s=t._vertices,a=t._uvs,c=r.length,h=t._corner,l=2*c;s.length<l&&(o.put(s),s=o.get(l)||new Float32Array(l),t._vertices=s),a.length<l&&(o.put(a),a=o.get(l)||new Float32Array(l),t._uvs=a);for(var _=1/0,u=1/0,d=-1/0,m=-1/0,f=0;f<c;f++){var p=r[f].x*n.a+r[f].y*n.c+n.tx,g=r[f].x*n.b+r[f].y*n.d+n.ty;s[2*f]=p,s[2*f+1]=g,a[2*f]=r[f].u,a[2*f+1]=r[f].v,p<_&&(_=p,h[0]=2*f),p>d&&(d=p,h[1]=2*f),g<u&&(u=g,h[2]=2*f),g>m&&(m=g,h[3]=2*f)}t._vertCount=c}}}};cc.Scale9Sprite=_ccsg.Node.extend({_spriteFrame:null,_insetLeft:0,_insetRight:0,_insetTop:0,_insetBottom:0,_blendFunc:null,_renderingType:1,_brightState:0,_rawVerts:null,_rawUvs:null,_vertices:null,_uvs:null,_vertCount:0,_quadsDirty:!0,_uvsDirty:!0,_isTriangle:!1,_isTrimmedContentSize:!0,_fillType:0,_fillCenter:null,_fillStart:0,_fillRange:2*Math.PI,_distortionOffset:null,_distortionTiling:null,_meshPolygonInfo:null,ctor:function(t){_ccsg.Node.prototype.ctor.call(this),this._renderCmd.setState(this._brightState),this._blendFunc=cc.BlendFunc._alphaNonPremultiplied(),this._fillCenter=cc.v2(0,0),this.setAnchorPoint(cc.p(.5,.5)),this._rawVerts=null,this._rawUvs=null,this._vertices=o.get(8)||new Float32Array(8),this._uvs=o.get(8)||new Float32Array(8),"string"==typeof t||t instanceof cc.Texture2D?this.initWithTexture(t):t instanceof cc.SpriteFrame&&this.initWithSpriteFrame(t),void 0===r&&(r=cc._renderType===cc.game.RENDER_TYPE_WEBGL),this._corner=[]},loaded:function(){return null!==this._spriteFrame&&this._spriteFrame.textureLoaded()},initWithTexture:function(t){this.setTexture(t)},initWithSpriteFrame:function(t){this.setSpriteFrame(t)},setTexture:function(t){var e=new cc.SpriteFrame(t);this.setSpriteFrame(e)},setSpriteFrame:function(t){if(t){this._spriteFrame=t,this._quadsDirty=!0,this._uvsDirty=!0,this._renderCmd._needDraw=!1;var e=this,i=function(){e._spriteFrame&&cc.sizeEqualToSize(e._contentSize,cc.size(0,0))&&e.setContentSize(e._spriteFrame._rect),e._renderCmd._needDraw=!0,e._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.contentDirty)};t.textureLoaded()?i():t.once("load",i,this)}},setBlendFunc:function(t,e){void 0===e?(this._blendFunc.src=t.src,this._blendFunc.dst=t.dst):(this._blendFunc.src=t,this._blendFunc.dst=e),this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.contentDirty)},getBlendFunc:function(){return new cc.BlendFunc(this._blendFunc.src,this._blendFunc.dst)},setContentSize:function(t,e){void 0===e&&(e=t.height,t=t.width),t===this._contentSize.width&&e===this._contentSize.height||(_ccsg.Node.prototype.setContentSize.call(this,t,e),this._quadsDirty=!0)},enableTrimmedContentSize:function(t){this._isTrimmedContentSize!==t&&(this._isTrimmedContentSize=t,this._quadsDirty=!0,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.contentDirty))},isTrimmedContentSizeEnabled:function(){return this._isTrimmedContentSize},setState:function(t){this._brightState=t,this._renderCmd.setState(t),this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.contentDirty)},getState:function(){return this._brightState},setRenderingType:function(t){this._renderingType!==t&&(this._renderingType=t,this._quadsDirty=!0,this._uvsDirty=!0,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.contentDirty))},getRenderingType:function(){return this._renderingType},setInsetLeft:function(t){this._insetLeft=t,this._quadsDirty=!0,this._uvsDirty=!0,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.contentDirty)},getInsetLeft:function(){return this._insetLeft},setInsetTop:function(t){this._insetTop=t,this._quadsDirty=!0,this._uvsDirty=!0,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.contentDirty)},getInsetTop:function(){return this._insetTop},setInsetRight:function(t){this._insetRight=t,this._quadsDirty=!0,this._uvsDirty=!0,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.contentDirty)},getInsetRight:function(){return this._insetRight},setInsetBottom:function(t){this._insetBottom=t,this._quadsDirty=!0,this._uvsDirty=!0,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.contentDirty)},getInsetBottom:function(){return this._insetBottom},setFillType:function(t){this._fillType!==t&&(this._fillType=t,this._renderingType===f.FILLED&&(this._quadsDirty=!0,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.contentDirty)))},getFillType:function(){return this._fillType},setFillCenter:function(t,e){this._fillCenter=cc.v2(t,e),this._renderingType===f.FILLED&&this._fillType===p.RADIAL&&(this._quadsDirty=!0,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.contentDirty))},setDistortionTiling:function(t,e){void 0===e&&(e=t.y,t=t.x),this._distortionTiling=this._distortionTiling||cc.v2(0,0),this._distortionTiling.x=t,this._distortionTiling.y=e},setDistortionOffset:function(t,e){void 0===e&&(e=t.y,t=t.x),this._distortionOffset=this._distortionOffset||cc.v2(0,0),this._distortionOffset.x=t,this._distortionOffset.y=e},getFillCenter:function(){return cc.v2(this._fillCenter)},setFillStart:function(t){this._fillStart!==t&&(this._fillStart=t,this._renderingType===f.FILLED&&(this._quadsDirty=!0,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.contentDirty)))},getFillStart:function(){return this._fillStart},setFillRange:function(t){this._fillRange!==t&&(this._fillRange=t,this._renderingType===f.FILLED&&(this._quadsDirty=!0,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.contentDirty)))},getFillRange:function(){return this._fillRange},_rebuildQuads:function(){if(this._spriteFrame&&this._spriteFrame._textureLoaded){this._isTriangle=!1;var t;switch(this._renderingType){case f.SIMPLE:t=c;break;case f.SLICED:t=h;break;case f.TILED:t=l;break;case f.FILLED:t=this._fillType===p.RADIAL?u:_;break;case f.MESH:t=d}t?t._rebuildQuads_base(this):(this._quadsDirty=!1,this._uvsDirty=!1,this._renderCmd._needDraw=!1,cc.errorID(2627)),this._quadsDirty=!1,this._uvsDirty=!1}else this._renderCmd._needDraw=!1},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_CANVAS?new cc.Scale9Sprite.CanvasRenderCmd(this):new cc.Scale9Sprite.WebGLRenderCmd(this)},setMeshPolygonInfo:function(t){this.setRenderingType(f.MESH),this._meshPolygonInfo=t,this._quadsDirty=!0,this._uvsDirty=!0},getMeshPolygonInfo:function(){return this._meshPolygonInfo}});var m=cc.Scale9Sprite.prototype;cc.js.addon(m,s.prototype),cc.defineGetterSetter(m,"insetLeft",m.getInsetLeft,m.setInsetLeft),cc.defineGetterSetter(m,"insetTop",m.getInsetTop,m.setInsetTop),cc.defineGetterSetter(m,"insetRight",m.getInsetRight,m.setInsetRight),cc.defineGetterSetter(m,"insetBottom",m.getInsetBottom,m.setInsetBottom),cc.Scale9Sprite.state={NORMAL:0,GRAY:1,DISTORTION:2};var f=cc.Scale9Sprite.RenderingType=cc.Enum({SIMPLE:0,SLICED:1,TILED:2,FILLED:3,MESH:4}),p=cc.Scale9Sprite.FillType=cc.Enum({HORIZONTAL:0,VERTICAL:1,RADIAL:2})}),{"../event/event-target":92}],192:[(function(t,e,i){cc.Scale9Sprite.CanvasRenderCmd=function(t){this._rootCtor(t),this._node.loaded()?this._needDraw=!0:this._needDraw=!1,this._state=cc.Scale9Sprite.state.NORMAL,this._originalTexture=this._textureToRender=null};var n=cc.Scale9Sprite.CanvasRenderCmd.prototype=Object.create(_ccsg.Node.CanvasRenderCmd.prototype);n.constructor=cc.Scale9Sprite.CanvasRenderCmd,n.updateTransform=function(t){this.originUpdateTransform(t),this._node._rebuildQuads()},n._doCulling=function(){var t=cc.visibleRect,e=this._currentRegion,i=e._minX,n=e._maxX,r=e._minY,s=e._maxY,o=t.left.x,a=t.right.x,c=t.top.y,h=t.bottom.y;this._needDraw=!(n<o||i>a||s<h||r>c)},n._updateDisplayColor=function(t){_ccsg.Node.WebGLRenderCmd.prototype._updateDisplayColor.call(this,t),this._originalTexture=this._textureToRender=null},n._syncDisplayColor=function(t){_ccsg.Node.WebGLRenderCmd.prototype._syncDisplayColor.call(this,t),this._originalTexture=this._textureToRender=null},n.setState=function(t){this._state!==t&&(this._state=t,this._originalTexture=this._textureToRender=null)},n.rendering=function(t,e,i){var n=this._node,r=this._displayedOpacity,s=r/255,o=null;if(n._spriteFrame&&(o=n._spriteFrame._texture),n.loaded()&&0!==r){if((null===this._textureToRender||this._originalTexture!==o)&&(this._textureToRender=this._originalTexture=o,cc.Scale9Sprite.state.GRAY===this._state&&(this._textureToRender=this._textureToRender._generateGrayTexture()),cc.sys.browserType!==cc.sys.BROWSER_TYPE_WECHAT_GAME_SUB)){var a=n.getDisplayedColor();!o||255===a.r&&255===a.g&&255===a.b||(this._textureToRender=this._textureToRender._generateColorTexture(a.r,a.g,a.b))}var c=t||cc._renderContext,h=c.getContext();if(c.setTransform(this._worldTransform,e,i),c.setCompositeOperation(_ccsg.Node.CanvasRenderCmd._getCompositeOperationByBlendFunc(n._blendFunc)),c.setGlobalAlpha(s),this._textureToRender){n._quadsDirty&&n._rebuildQuads();var l,_,u,d,m,f,p,g,v=this._textureToRender.width,y=this._textureToRender.height,x=this._textureToRender._image,C=n._vertices,A=n._uvs,T=0,b=0;if(n._isTriangle){var w=n._rawVerts,S=n._rawUvs;m=w[0],f=w[1],p=w[6]-m,f=-f-(g=w[7]-f),l=S[4]*v,_=S[5]*y,u=(S[6]-S[0])*v,d=(S[1]-S[7])*y,c.save(),h.beginPath();var E=Math.floor(n._vertCount/3);for(T=0,b=0;T<E;T++)h.moveTo(C[b++],-C[b++]),h.lineTo(C[b++],-C[b++]),h.lineTo(C[b++],-C[b++]);h.clip(),""!==this._textureToRender._pattern?(c.setFillStyle(h.createPattern(x,this._textureToRender._pattern)),h.fillRect(m,f,p,g)):u>0&&d>0&&p>0&&g>0&&h.drawImage(x,l,_,u,d,m,f,p,g),c.restore(),cc.g_NumberOfDraws+=E}else if(n._renderingType===cc.Scale9Sprite.RenderingType.SLICED){for(var I=0;I<3;++I)for(var R=0;R<3;++R)m=C[b=8*I+2*R],f=C[b+1],p=C[b+10]-m,f=-f-(g=C[b+11]-f),l=A[b]*v,_=A[b+11]*y,u=(A[b+10]-A[b])*v,d=(A[b+1]-A[b+11])*y,u>0&&d>0&&p>0&&g>0&&h.drawImage(x,l,_,u,d,m,f,p,g);cc.g_NumberOfDraws+=9}else{var P=Math.floor(n._vertCount/4);for(T=0,b=0;T<P;T++)m=C[b],f=C[b+1],p=C[b+6]-m,f=-f-(g=C[b+7]-f),l=A[b]*v,_=A[b+7]*y,u=(A[b+6]-A[b])*v,d=(A[b+1]-A[b+7])*y,""!==this._textureToRender._pattern?(c.setFillStyle(h.createPattern(x,this._textureToRender._pattern)),h.fillRect(m,f,p,g)):u>0&&d>0&&p>0&&g>0&&h.drawImage(x,l,_,u,d,m,f,p,g),b+=8;cc.g_NumberOfDraws+=P}}}}}),{}],193:[(function(t,e,i){cc.gl;cc.Scale9Sprite.WebGLRenderCmd=function(t){this._rootCtor(t),this._node.loaded()?this._needDraw=!0:this._needDraw=!1,this.vertexType=cc.renderer.VertexType.QUAD,this._dirty=!1,this._shaderProgram=cc.shaderCache.programForKey(cc.macro.SHADER_SPRITE_POSITION_TEXTURECOLOR)};var n=cc.Scale9Sprite,r=n.WebGLRenderCmd.prototype=Object.create(_ccsg.Node.WebGLRenderCmd.prototype);r.constructor=n.WebGLRenderCmd,r._uploadSliced=function(t,e,i,n,r,s,o){for(var a,c=0;c<3;++c)for(var h=0;h<3;++h)a=8*c+2*h,r[o]=t[a],r[o+1]=t[a+1],r[o+2]=n,s[o+3]=i,r[o+4]=e[a],r[o+5]=e[a+1],r[o+=6]=t[a+2],r[o+1]=t[a+3],r[o+2]=n,s[o+3]=i,r[o+4]=e[a+2],r[o+5]=e[a+3],r[o+=6]=t[a+8],r[o+1]=t[a+9],r[o+2]=n,s[o+3]=i,r[o+4]=e[a+8],r[o+5]=e[a+9],r[o+=6]=t[a+10],r[o+1]=t[a+11],r[o+2]=n,s[o+3]=i,r[o+4]=e[a+10],r[o+5]=e[a+11],o+=6;return 36},r.updateTransform=function(t){this.originUpdateTransform(t),this._node._rebuildQuads()},r._doCulling=function(){var t=this._node,e=cc.visibleRect;this._cameraFlag>0&&(e=cc.Camera.main.visibleRect);var i=e.left.x,n=e.right.x,r=e.top.y,s=e.bottom.y,o=t._vertices,a=t._corner,c=a[0],h=a[1],l=a[2],_=a[3],u=o[c],d=o[h],m=o[l],f=o[_],p=o[c+1],g=o[h+1],v=o[l+1],y=o[_+1];this._needDraw=!((u-i&d-i&m-i&f-i)>>31||(n-u&n-d&n-m&n-f)>>31||(p-s&g-s&v-s&y-s)>>31||(r-p&r-g&r-v&r-y)>>31)},r.uploadData=function(t,e,i){var r=this._node;if(0===this._displayedOpacity)return 0;r._quadsDirty&&r._rebuildQuads(),r._distortionOffset&&this._shaderProgram===n.WebGLRenderCmd._distortionProgram&&(this._shaderProgram.use(),this._shaderProgram.setUniformLocationWith2f(n.WebGLRenderCmd._distortionOffset,r._distortionOffset.x,r._distortionOffset.y),this._shaderProgram.setUniformLocationWith2f(n.WebGLRenderCmd._distortionTiling,r._distortionTiling.x,r._distortionTiling.y),cc.renderer._breakBatch());var s,o=this._displayedOpacity,a=this._displayedColor._val;if(r._opacityModifyRGB){var c=o/255,h=this._displayedColor.r*c,l=this._displayedColor.g*c;s=(o<<24>>>0)+(this._displayedColor.b*c<<16)+(l<<8)+h}else s=(o<<24>>>0)+((65280&a)<<8)+((16711680&a)>>8)+(a>>>24);var _=r._vertexZ,u=r._vertices,d=r._uvs,m=n.RenderingType,f=i,p=0;switch(r._renderingType){case m.SIMPLE:case m.TILED:case m.FILLED:case m.MESH:p=this._node._vertCount;for(var g=0,v=0;g<p;g++,v+=2)t[f]=u[v],t[f+1]=u[v+1],t[f+2]=_,e[f+3]=s,t[f+4]=d[v],t[f+5]=d[v+1],f+=6;break;case m.SLICED:p=this._uploadSliced(u,d,s,_,t,e,f)}return r._renderingType===m.MESH?this.vertexType=cc.renderer.VertexType.CUSTOM:r._renderingType===m.FILLED&&r._fillType===n.FillType.RADIAL?this.vertexType=cc.renderer.VertexType.TRIANGLE:this.vertexType=cc.renderer.VertexType.QUAD,p},r.uploadIndexData=function(t,e,i){var n=this._node._meshPolygonInfo;if(!n)return 0;for(var r=n.triangles.indices,s=r.length,o=0;o<s;o++)t[e+o]=i+r[o];return s},r.setState=function(t){t===n.state.NORMAL?this._shaderProgram=cc.shaderCache.programForKey(cc.macro.SHADER_SPRITE_POSITION_TEXTURECOLOR):t===n.state.GRAY?this._shaderProgram=cc.Scale9Sprite.WebGLRenderCmd._getGrayShaderProgram():t===n.state.DISTORTION&&(this._shaderProgram=cc.Scale9Sprite.WebGLRenderCmd._getDistortionProgram())},n.WebGLRenderCmd._grayShaderProgram=null,n.WebGLRenderCmd._getGrayShaderProgram=function(){var t=n.WebGLRenderCmd._grayShaderProgram;return t||((t=new cc.GLProgram).initWithVertexShaderByteArray(cc.PresetShaders.SPRITE_POSITION_TEXTURE_COLOR_VERT,cc.Scale9Sprite.WebGLRenderCmd._grayShaderFragment),t.addAttribute(cc.macro.ATTRIBUTE_NAME_POSITION,cc.macro.VERTEX_ATTRIB_POSITION),t.addAttribute(cc.macro.ATTRIBUTE_NAME_COLOR,cc.macro.VERTEX_ATTRIB_COLOR),t.addAttribute(cc.macro.ATTRIBUTE_NAME_TEX_COORD,cc.macro.VERTEX_ATTRIB_TEX_COORDS),t.link(),t.updateUniforms(),n.WebGLRenderCmd._grayShaderProgram=t,t)},n.WebGLRenderCmd._grayShaderFragment="precision lowp float;\nvarying vec4 v_fragmentColor;\nvarying vec2 v_texCoord;\nvoid main()\n{\nvec4 c = v_fragmentColor * texture2D(CC_Texture0, v_texCoord);\nfloat gray = 0.2126*c.r + 0.7152*c.g + 0.0722*c.b;\ngl_FragColor = vec4(gray, gray, gray, c.a);\n}",n.WebGLRenderCmd._distortionProgram=null,n.WebGLRenderCmd._getDistortionProgram=function(){var t=n.WebGLRenderCmd._distortionProgram;return t||((t=new cc.GLProgram).initWithVertexShaderByteArray(cc.PresetShaders.SPRITE_POSITION_TEXTURE_COLOR_VERT,s.fShader),t.addAttribute(cc.macro.ATTRIBUTE_NAME_POSITION,cc.macro.VERTEX_ATTRIB_POSITION),t.addAttribute(cc.macro.ATTRIBUTE_NAME_COLOR,cc.macro.VERTEX_ATTRIB_COLOR),t.addAttribute(cc.macro.ATTRIBUTE_NAME_TEX_COORD,cc.macro.VERTEX_ATTRIB_TEX_COORDS),t.link(),t.updateUniforms(),n.WebGLRenderCmd._distortionProgram=t,n.WebGLRenderCmd._distortionOffset=t.getUniformLocationForName("u_offset"),n.WebGLRenderCmd._distortionTiling=t.getUniformLocationForName("u_offset_tiling"),t)};var s={shaderKey:"cc.Sprite.Shader.Distortion",fShader:"precision lowp float;\nvarying vec4 v_fragmentColor;\nvarying vec2 v_texCoord;\nuniform vec2 u_offset;\nuniform vec2 u_offset_tiling;\nconst float PI = 3.14159265359;\nvoid main()\n{\nfloat halfPI = 0.5 * PI;\nfloat maxFactor = sin(halfPI);\nvec2 uv = v_texCoord;\nvec2 xy = 2.0 * uv.xy - 1.0;\nfloat d = length(xy);\nif (d < (2.0-maxFactor)) {\nd = length(xy * maxFactor);\nfloat z = sqrt(1.0 - d * d);\nfloat r = atan(d, z) / PI;\nfloat phi = atan(xy.y, xy.x);\nuv.x = r * cos(phi) + 0.5;\nuv.y = r * sin(phi) + 0.5;\n} else {\ndiscard;\n}\nuv = uv * u_offset_tiling + u_offset;\nuv = fract(uv);\ngl_FragColor = v_fragmentColor * texture2D(CC_Texture0, uv);\n}"}}),{}],194:[(function(t,e,i){cc.SpriteBatchNode=_ccsg.Node.extend({_blendFunc:null,_texture:null,_className:"SpriteBatchNode",ctor:function(t){_ccsg.Node.prototype.ctor.call(this),this._blendFunc=new cc.BlendFunc(cc.macro.BLEND_SRC,cc.macro.BLEND_DST);var e;cc.js.isString(t)?(e=cc.textureCache.getTextureForKey(t))||(e=cc.textureCache.addImage(t)):t instanceof cc.Texture2D&&(e=t),e&&this.initWithTexture(e)},initWithFile:function(t){var e=cc.textureCache.getTextureForKey(t)||cc.textureCache.addImage(t);return this.initWithTexture(e)},removeChildAtIndex:function(t,e){this.removeChild(this._children[t],e)},setBlendFunc:function(t,e){this._blendFunc=void 0===e?t:{src:t,dst:e}},getBlendFunc:function(){return new cc.BlendFunc(this._blendFunc.src,this._blendFunc.dst)},updateQuadFromSprite:function(t,e){cc.assertID(t,2623),t instanceof _ccsg.Sprite?(t.dirty=!0,t._renderCmd.transform(this._renderCmd,!0)):cc.log(2616)},appendChild:function(t){this.sortAllChildren();this._children[this._children.length-1]._localZOrder;this.addChild(t.lastLocalZOrder+1)},initWithTexture:function(t){return this.setTexture(t),!0},getTexture:function(){return this._texture},setTexture:function(t){if(this._texture=t,t.loaded){var e,i=this._children,n=i.length;for(e=0;e<n;++e)i[e].setTexture(t)}else t.addEventListener("load",(function(){var e,i=this._children,n=i.length;for(e=0;e<n;++e)i[e].setTexture(t)}),this)},setShaderProgram:function(t){this._renderCmd.setShaderProgram(t);var e,i=this._children,n=i.length;for(e=0;e<n;++e)i[e].setShaderProgram(t)},addChild:function(t,e,i){cc.assertID(void 0!==t,2614),this._isValidChild(t)&&(e=void 0===e?t.zIndex:e,i=void 0===i?t.tag:i,_ccsg.Node.prototype.addChild.call(this,t,e,i),this._renderCmd._shaderProgram&&(t.shaderProgram=this._renderCmd._shaderProgram))},_isValidChild:function(t){return t instanceof _ccsg.Sprite?t.texture===this._texture||(cc.logID(2619),!1):(cc.logID(2618),!1)}});var n=cc.SpriteBatchNode.prototype;cc.defineGetterSetter(n,"texture",n.getTexture,n.setTexture),cc.defineGetterSetter(n,"shaderProgram",n.getShaderProgram,n.setShaderProgram)}),{}],195:[(function(t,e,i){var n=t("../event/event-target");cc.SpriteFrame=cc.Class({name:"cc.SpriteFrame",extends:t("../assets/CCAsset"),mixins:[n],properties:{_textureFilenameSetter:{set:function(t){this._textureFilename=t,t&&this._loadTexture()}}},ctor:function(){var t=arguments[0],e=arguments[1],i=arguments[2],n=arguments[3],r=arguments[4];this._rect=null,this._offset=null,this._originalSize=null,this._rotated=!1,this.insetTop=0,this.insetBottom=0,this.insetLeft=0,this.insetRight=0,this._texture=null,this._textureFilename="",this._textureLoaded=!1,void 0!==t&&this.initWithTexture(t,e,i,n,r)},textureLoaded:function(){return this._textureLoaded},addLoadedEventListener:function(t,e){this.once("load",t,e)},isRotated:function(){return this._rotated},setRotated:function(t){this._rotated=t},getRect:function(){return cc.rect(this._rect)},setRect:function(t){this._rect=t},getOriginalSize:function(){return cc.size(this._originalSize)},setOriginalSize:function(t){this._originalSize?(this._originalSize.width=t.width,this._originalSize.height=t.height):this._originalSize=cc.size(t)},getTexture:function(){return this._texture},_refreshTexture:function(t){var e=this;if(e._texture!==t){var i=t.loaded;this._textureLoaded=i,this._texture=t;function n(){if(e._texture){e._textureLoaded=!0;var i=t.width,n=t.height;if(e._rotated&&cc._renderType===cc.game.RENDER_TYPE_CANVAS){var r=t.getHtmlElementObj();r=_ccsg.Sprite.CanvasRenderCmd._cutRotateImageToCanvas(r,e.getRect());var s=new cc.Texture2D;s.initWithElement(r),s.handleLoadedTexture(),e._texture=s,e._rotated=!1,i=e._texture.width,n=e._texture.height,e.setRect(cc.rect(0,0,i,n))}e._rect?e._checkRect(e._texture):e.setRect(cc.rect(0,0,i,n)),e._originalSize||e.setOriginalSize(cc.size(i,n)),e._offset||e.setOffset(cc.v2(0,0)),e.emit("load")}}i?n():t.once("load",n)}},getOffset:function(){return cc.v2(this._offset)},setOffset:function(t){this._offset=cc.v2(t)},clone:function(){return new cc.SpriteFrame(this._texture||this._textureFilename,this._rect,this._rotated,this._offset,this._originalSize)},setTexture:function(t,e,i,n,r){e?this.setRect(e):this._rect=null,n?this.setOffset(n):this._offset=null,r?this.setOriginalSize(r):this._originalSize=null,this._rotated=i||!1;var s=t;return cc.js.isString(s)?(this._textureFilename=s,this._loadTexture()):s instanceof cc.Texture2D&&this._refreshTexture(s),!0},_loadTexture:function(){if(this._textureFilename){var t=cc.textureCache.addImage(this._textureFilename);this._refreshTexture(t)}},ensureLoadTexture:function(){this._texture||this._loadTexture()},clearTexture:function(){this._textureLoaded=!1,this._texture=null},_checkRect:function(t){var e=this._rect,i=e.x,n=e.y;this._rotated?(i+=e.height,n+=e.width):(i+=e.width,n+=e.height),i>t.getPixelWidth()&&cc.errorID(3300,t.url+"/"+this.name),n>t.getPixelHeight()&&cc.errorID(3400,t.url+"/"+this.name)},_serialize:!1,_deserialize:function(t,e){var i=t.rect;i&&this.setRect(new cc.Rect(i[0],i[1],i[2],i[3])),t.offset&&this.setOffset(new cc.Vec2(t.offset[0],t.offset[1])),t.originalSize&&this.setOriginalSize(new cc.Size(t.originalSize[0],t.originalSize[1])),this._rotated=1===t.rotated,this._name=t.name;var n=t.capInsets;n&&(this.insetLeft=n[0],this.insetTop=n[1],this.insetRight=n[2],this.insetBottom=n[3]);var r=t.texture;if(r){var s=e.customEnv&&e.customEnv.deferredLoadRaw?"_textureFilename":"_textureFilenameSetter";e.result.push(this,s,r)}}});var r=cc.SpriteFrame.prototype;r.copyWithZone=r.clone,r.copy=r.clone,r.initWithTexture=r.setTexture}),{"../assets/CCAsset":40,"../event/event-target":92}],196:[(function(t,e,i){var n=t("../event/event-target"),r=t("../platform/CCSys"),s=(t("../platform/js"),t("../utils/misc"),t("../CCGame"));t("../platform/_CCClass"),t("../platform/CCClass");var o=[{format:6407,internalFormat:6407,pixelType:33635},{format:6408,internalFormat:6408,pixelType:32820},{format:6408,internalFormat:6408,pixelType:32819},{format:6407,internalFormat:6407,pixelType:5121},{format:6408,internalFormat:6408,pixelType:5121},{format:6406,internalFormat:6406,pixelType:5121},{format:6409,internalFormat:6409,pixelType:5121},{format:6410,internalFormat:6410,pixelType:5121}],a=cc.Enum({RGB565:0,RGB5A1:1,RGBA4444:2,RGB888:3,RGBA8888:4,A8:5,I8:6,AI8:7}),c=cc.Enum({REPEAT:10497,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648}),h=cc.Enum({LINEAR:9729,NEAREST:9728}),l=cc.Class({name:"cc.Texture2D",extends:t("../assets/CCRawAsset"),mixins:[n],properties:{_hasMipmap:!1,_format:a.RGBA8888,_compressed:!1,_premultiplyAlpha:!1,_minFilter:h.LINEAR,_magFilter:h.LINEAR,_wrapS:c.CLAMP_TO_EDGE,_wrapT:c.CLAMP_TO_EDGE},statics:{PixelFormat:a,WrapMode:c,Filter:h},ctor:function(t){this.url=null,this.loaded=!1,this.width=0,this.height=0,this._image=null,cc._renderType===s.RENDER_TYPE_CANVAS?(this._pattern="",this._grayElementObj=null,this._backupElement=null,this._isGray=!1):cc._renderType===s.RENDER_TYPE_WEBGL&&(this._gl=t||cc._renderContext,this._glID=null)},update:function(t){},getPixelWidth:function(){return this.width},getPixelHeight:function(){return this.height},getContentSize:function(){return cc.size(this.width,this.height)},getContentSizeInPixels:function(){return this.getContentSize()},initWithElement:function(t){t&&(this._image=t,this.width=t.width,this.height=t.height,this.loaded=!0)},initWithData:function(t,e,i,n,r){return!1},initWithImage:function(t){return!1},getHtmlElementObj:function(){return this._image},isLoaded:function(){return this.loaded},handleLoadedTexture:function(){if(this._image&&this._image.width&&this._image.height){var t=this._image;this.width=t.width,this.height=t.height,this.loaded=!0,this.emit("load")}},description:function(){return"<cc.Texture2D | Name = "+this.url+" | Dimensions = "+this.width+" x "+this.height+">"},releaseTexture:function(){this._gl&&null!==this._glID&&(this._gl.deleteTexture(this._glID),this._glID=null)},getPixelFormat:function(){return this._format},hasPremultipliedAlpha:function(){return this._premultiplyAlpha||!1},hasMipmaps:function(){return this._hasMipmap||!1},setTexParameters:function(t,e,i,n){void 0!==e&&(t={minFilter:t,magFilter:e,wrapS:i,wrapT:n}),t.wrapS!==c.REPEAT||t.wrapT!==c.REPEAT?t.wrapS!==c.REPEAT?t.wrapT!==c.REPEAT?this._pattern="":this._pattern="repeat-y":this._pattern="repeat-x":this._pattern="repeat"},setAntiAliasTexParameters:function(){},setAliasTexParameters:function(){}}),_=l.prototype;_.pixelFormat,cc.defineGetterSetter(_,"pixelFormat",_.getPixelFormat),_.pixelWidth,cc.defineGetterSetter(_,"pixelWidth",_.getPixelWidth),_.pixelHeight,cc.defineGetterSetter(_,"pixelHeight",_.getPixelHeight),s.once(s.EVENT_RENDERER_INITED,(function(){if(cc._renderType===s.RENDER_TYPE_CANVAS){var t=function(t,e,i){if(null===t)return null;i=i||document.createElement("canvas"),e=e||cc.rect(0,0,t.width,t.height),i.width=e.width,i.height=e.height;var n=i.getContext("2d");n.drawImage(t,e.x,e.y,e.width,e.height,0,0,e.width,e.height);for(var r=n.getImageData(0,0,e.width,e.height),s=r.data,o=0,a=s.length;o<a;o+=4)s[o]=s[o+1]=s[o+2]=.34*s[o]+.5*s[o+1]+.16*s[o+2];return n.putImageData(r,0,0),i};_._generateTextureCacheForColor=function(){if(this.channelCache)return this.channelCache;var t=[document.createElement("canvas"),document.createElement("canvas"),document.createElement("canvas"),document.createElement("canvas")];return (function(t,e){var i=t.width,n=t.height;e[0].width=i,e[0].height=n,e[1].width=i,e[1].height=n,e[2].width=i,e[2].height=n,e[3].width=i,e[3].height=n;var r=e[3].getContext("2d");r.drawImage(t,0,0);for(var s,o=r.getImageData(0,0,i,n).data,a=0;a<4;a++){for(var c=(s=e[a].getContext("2d")).getImageData(0,0,i,n),h=c.data,l=0;l<o.length;l+=4)h[l]=0===a?o[l]:0,h[l+1]=1===a?o[l+1]:0,h[l+2]=2===a?o[l+2]:0,h[l+3]=o[l+3];s.putImageData(c,0,0)}t.onload=null})(this._image,t),this.channelCache=t},_._switchToGray=function(e){this.loaded&&this._isGray!==e&&(this._isGray=e,this._isGray?(this._backupElement=this._image,this._grayElementObj||(this._grayElementObj=t(this._image)),this._image=this._grayElementObj):null!==this._backupElement&&(this._image=this._backupElement))},_._generateGrayTexture=function(){if(!this.loaded)return null;var e=t(this._image),i=new l;return i.initWithElement(e),i.handleLoadedTexture(),i},_._generateColorTexture=r._supportCanvasNewBlendModes?function(t,e,i,n,r){var s=!1;r?s=!0:r=document.createElement("canvas");var o=this._image;if(n||(n=cc.rect(0,0,o.width,o.height)),r.width=n.width,r.height=n.height,n.width&&n.height){var a=r.getContext("2d");a.globalCompositeOperation="source-over",a.fillStyle="rgb("+(0|t)+","+(0|e)+","+(0|i)+")",a.fillRect(0,0,n.width,n.height),a.globalCompositeOperation="multiply",a.drawImage(o,n.x,n.y,n.width,n.height,0,0,n.width,n.height),a.globalCompositeOperation="destination-atop",a.drawImage(o,n.x,n.y,n.width,n.height,0,0,n.width,n.height)}if(s)return r;var c=new l;return c.initWithElement(r),c.handleLoadedTexture(),c}:function(t,e,i,n,r){var s=!1;r?s=!0:r=document.createElement("canvas");var o=this._image;if(n||(n=cc.rect(0,0,o.width,o.height)),r.width=n.width,r.height=n.height,n.width&&n.height){var a=r.getContext("2d");a.drawImage(o,n.x,n.y,n.width,n.height,0,0,n.width,n.height);var c=a.getImageData(0,0,r.width,r.height),h=c.data;t/=255,e/=255,i/=255;for(var _=0;_<h.length;_+=4)h[_]=h[_]*t,h[_+1]=h[_+1]*e,h[_+2]=h[_+2]*i;a.putImageData(c,0,0)}if(s)return r;var u=new l;return u.initWithElement(r),u.handleLoadedTexture(),u}}else if(cc._renderType===s.RENDER_TYPE_WEBGL){var e;(function(){function t(t){return!(t&t-1||!t)}function i(){for(var t in e)e[t]=void 0;return e}e={width:void 0,height:void 0,minFilter:void 0,magFilter:void 0,wrapS:void 0,wrapT:void 0,format:void 0,mipmap:void 0,image:void 0,premultiplyAlpha:void 0},_.update=function(e){var i=this._hasMipmap,n=this._gl,r=!1;e&&(void 0!==e.width&&(this.width=e.width),void 0!==e.height&&(this.height=e.height),void 0!==e.minFilter&&(this._minFilter=e.minFilter),void 0!==e.magFilter&&(this._magFilter=e.magFilter),void 0!==e.wrapS&&(this._wrapS=e.wrapS),void 0!==e.wrapT&&(this._wrapT=e.wrapT),void 0!==e.format&&(this._format=e.format,r=!0),void 0!==e.premultiplyAlpha&&(this._premultiplyAlpha=e.premultiplyAlpha,r=!0),void 0!==e.image&&(this._image=e.image,r=!0),void 0!==e.mipmap&&(i=this._hasMipmap=e.mipmap)),this._image&&(r?(this.releaseTexture(),this._glID=n.createTexture(),n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,this._glID),this._setImage(this._image,this.width,this.height,(function(t){var e=o[t];return cc.assertID(e,3113),e})(this._format),this._premultiplyAlpha)):(n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,this._glID)),this._setTexInfo(),i&&(cc.assertID(t(this.width)&&t(this.height),3117),n.hint(n.GENERATE_MIPMAP_HINT,n.NICEST),n.generateMipmap(n.TEXTURE_2D)),n.bindTexture(n.TEXTURE_2D,null))},_._setImage=function(t,e,i,n,s){var o=this._gl;o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s),r.platform===r.QQ_PLAY||t instanceof HTMLCanvasElement&&!(t instanceof Uint8Array)||t instanceof HTMLImageElement||t instanceof HTMLVideoElement?o.texImage2D(o.TEXTURE_2D,0,n.internalFormat,n.format,n.pixelType,t):o.texImage2D(o.TEXTURE_2D,0,n.internalFormat,e,i,0,n.format,n.pixelType,t)},_._setTexInfo=function(){var e=this._gl;t(this.width)&&t(this.height)||this._wrapS===c.CLAMP_TO_EDGE&&this._wrapT===c.CLAMP_TO_EDGE||(cc.warnID(3116),this._wrapS=c.CLAMP_TO_EDGE,this._wrapT=c.CLAMP_TO_EDGE),this._minFilter===h.LINEAR?e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,this._hasMipmap?e.LINEAR_MIPMAP_NEAREST:e.LINEAR):e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,this._hasMipmap?e.NEAREST_MIPMAP_NEAREST:e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,this._magFilter),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,this._wrapS),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,this._wrapT)},_.initWithData=function(t,e,n,r,s){s&&cc.warnID(3118);var o=i();return o.image=t,o.format=e,o.width=n,o.height=r,this.update(o),this.width=n,this.height=r,this.loaded=!0,this.emit("load"),!0},_.initWithElement=function(t){if(t&&0!==t.width&&0!==t.height)return this._image=t,!0},_.handleLoadedTexture=function(t){if(this._image&&this._image.width&&this._image.height){var e=i();e.image=this._image,e.format=a.RGBA8888,e.width=this._image.width,e.height=this._image.height,e.premultiplyAlpha=!!t;var n=cc.view._antiAliasEnabled?h.LINEAR:h.NEAREST;e.minFilter=e.magFilter=n,this.update(e),this.loaded=!0,this.emit("load")}},_.setTexParameters=function(t,e,i,n){void 0!==e&&(t={minFilter:t,magFilter:e,wrapS:i,wrapT:n}),this.update(t)},_.setAntiAliasTexParameters=function(){var t=i();t.minFilter=h.LINEAR,t.magFilter=h.LINEAR,this.update(t)},_.setAliasTexParameters=function(){var t=i();t.minFilter=h.NEAREST,t.magFilter=h.NEAREST,this.update(t)}})()}})),cc.Texture2D=e.exports=l}),{"../CCGame":36,"../assets/CCRawAsset":46,"../event/event-target":92,"../platform/CCClass":156,"../platform/CCSys":165,"../platform/_CCClass":168,"../platform/js":177,"../utils/misc":206}],197:[(function(t,e,i){var n=t("../CCGame"),r=t("./CCTexture2D"),s={_textures:{},_textureColorsCache:{},_textureKeySeq:0|1e3*Math.random(),handleLoadedTexture:null,description:function(){return"<TextureCache | Number of textures = "+this._textures.length+">"},textureForKey:function(t){return cc.logID(3002),this.getTextureForKey(t)},getTextureForKey:function(t){return this._textures[t]},getKeyByTexture:function(t){for(var e in this._textures)if(this._textures[e]===t)return e;return null},_generalTextureKey:function(t){return"_textureKey_"+t},getTextureColors:function(t){var e=t._image,i=this.getKeyByTexture(e);return i||(i=e instanceof HTMLImageElement?e.src:this._generalTextureKey(t.__instanceId)),this._textureColorsCache[i]||(this._textureColorsCache[i]=t._generateTextureCacheForColor()),this._textureColorsCache[i]},getAllTextures:function(){var t=[];for(var e in this._textures){var i=this._textures[e];t.push(i)}return t},removeAllTextures:function(){var t=this._textures;for(var e in t)t[e]&&t[e].releaseTexture();this._textures={}},removeTexture:function(t){if(t){var e=this._textures;for(var i in e)e[i]===t&&(e[i].releaseTexture(),delete e[i])}},removeTextureForKey:function(t){if("string"==typeof t){var e=this._textures;e[t]&&(e[t].releaseTexture(),delete e[t])}},addImage:null,addImageAsync:null,cacheImage:function(t,e){if(cc.assertID(t,3009),e instanceof r)this._textures[t]=e;else{var i=new r;i.initWithElement(e),i.handleLoadedTexture(),this._textures[t]=i}},dumpCachedTextureInfo:function(){var t=0,e=0,i=this._textures;for(var n in i){var r=i[n];t++,r.getHtmlElementObj()instanceof HTMLImageElement?cc.logID(3005,n,r.getHtmlElementObj().src,r.getPixelWidth(),r.getPixelHeight()):cc.logID(3006,n,r.getPixelWidth(),r.getPixelHeight()),e+=r.getPixelWidth()*r.getPixelHeight()*4}var s=this._textureColorsCache;for(n in s){var o=s[n];for(var a in o){var c=o[a];t++,cc.logID(3006,n,c.width,c.height),e+=c.width*c.height*4}}cc.logID(3007,t,e/1024,(e/1048576).toFixed(2))},_clear:function(){this._textures={},this._textureColorsCache={},this._textureKeySeq=0|1e3*Math.random()}};n.once(n.EVENT_RENDERER_INITED,(function(){var t=s;cc._renderType===n.RENDER_TYPE_CANVAS?(t.handleLoadedTexture=function(t){var e=this._textures,i=e[t];i||(cc.assertID(t,3009),(i=e[t]=new r).url=t),i.handleLoadedTexture()},t.addImage=function(t,e,i){cc.assertID(t,3103);var n=this._textures,o=n[t];return o?o.isLoaded()?(e&&e.call(i,o),o):(o.once("load",(function(){e&&e.call(i,o)}),i),o):(o=n[t]=new r,o.url=t,cc.loader.load(t,(function(n,r){if(n)return e&&e.call(i,n||new Error("Unknown error"));s.handleLoadedTexture(t),e&&e.call(i,o)})),o)},t.addImageAsync=t.addImage):cc._renderType===n.RENDER_TYPE_WEBGL&&(t.handleLoadedTexture=function(t){var e,i=this._textures;(e=i[t])||(cc.assertID(t,3009),(e=i[t]=new r).url=t),e.handleLoadedTexture()},t.addImage=function(t,e,i){cc.assertID(t,3112);var n=this._textures,o=n[t];return o?o.isLoaded()?(e&&e.call(i,o),o):(o.once("load",(function(){e&&e.call(i,o)}),i),o):(o=n[t]=new r,o.url=t,cc.loader.load(t,(function(n,r){if(n)return e&&e.call(i,n||new Error("Unknown error"));s.handleLoadedTexture(t),e&&e.call(i,o)})),o)},t.addImageAsync=t.addImage)})),cc.textureCache=e.exports=s}),{"../CCGame":36,"./CCTexture2D":196}],198:[(function(t,e,i){t("./CCTexture2D"),t("./CCTextureCache")}),{"./CCTexture2D":196,"./CCTextureCache":197}],199:[(function(t,e,i){t("../platform/CCSys");var n=/(\.[^\.\/\?\\]*)(\?.*)?$/,r=/((.*)(\/|\\|\\\\))?(.*?\..*$)?/,s=/[^\.\/]+\/\.\.\//;cc.path={join:function(){for(var t=arguments.length,e="",i=0;i<t;i++)e=(e+(""===e?"":"/")+arguments[i]).replace(/(\/|\\\\)$/,"");return e},extname:function(t){var e=n.exec(t);return e?e[1]:""},mainFileName:function(t){if(t){var e=t.lastIndexOf(".");if(-1!==e)return t.substring(0,e)}return t},basename:function(t,e){var i=t.indexOf("?");i>0&&(t=t.substring(0,i));var n=/(\/|\\\\)([^(\/|\\\\)]+)$/g.exec(t.replace(/(\/|\\\\)$/,""));if(!n)return null;var r=n[2];return e&&t.substring(t.length-e.length).toLowerCase()===e.toLowerCase()?r.substring(0,r.length-e.length):r},dirname:function(t){var e=r.exec(t);return e?e[2]:""},changeExtname:function(t,e){e=e||"";var i=t.indexOf("?"),n="";return i>0&&(n=t.substring(i),t=t.substring(0,i)),(i=t.lastIndexOf("."))<0?t+e+n:t.substring(0,i)+e+n},changeBasename:function(t,e,i){if(0===e.indexOf("."))return this.changeExtname(t,e);var n=t.indexOf("?"),r="",s=i?this.extname(t):"";return n>0&&(r=t.substring(n),t=t.substring(0,n)),n=t.lastIndexOf("/"),n=n<=0?0:n+1,t.substring(0,n)+e+s+r},_normalize:function(t){var e=t=String(t);do{e=t,t=t.replace(s,"")}while(e.length!==t.length);return t},sep:cc.sys.os===cc.sys.OS_WINDOWS?"\\":"/",stripSep:function(t){return t.replace(/[\/\\]$/,"")}},e.exports=cc.path}),{"../platform/CCSys":165}],200:[(function(t,e,i){function n(){h("frame").start(),h("logic").start()}function r(){cc.director.isPaused()?h("frame").start():h("logic").end(),h("render").start()}function s(){h("render").end(),h("draws").value=cc.g_NumberOfDraws,h("frame").end(),h("fps").frame(),h().tick()}var o=t("../../../external/pstats/pstats"),a=t("../platform/CCMacro"),c=document.createElement("div");c.id="fps";var h=null,l=!1;cc.profiler=e.exports={isShowingStats:function(){return l},hideStats:function(){l&&(c.parentElement===document.body&&document.body.removeChild(c),cc.director.off(cc.Director.EVENT_BEFORE_UPDATE,n),cc.director.off(cc.Director.EVENT_AFTER_VISIT,r),cc.director.off(cc.Director.EVENT_AFTER_DRAW,s),l=!1)},showStats:function(){l||(h||(h=o.new(c,{showGraph:!1,values:{frame:{desc:"Frame time (ms)",min:0,max:50,average:500},fps:{desc:"Framerate (FPS)",below:30,average:500},draws:{desc:"Draw call"},logic:{desc:"Game Logic (ms)",min:0,max:50,average:500,color:"#080"},render:{desc:"Renderer (ms)",min:0,max:50,average:500,color:"#f90"},mode:{desc:cc._renderType===cc.game.RENDER_TYPE_WEBGL?"WebGL":"Canvas",min:1}},css:".pstats {left: "+a.DIRECTOR_STATS_POSITION.x+"px; bottom: "+a.DIRECTOR_STATS_POSITION.y+"px;}"})),null===c.parentElement&&document.body.appendChild(c),cc.director.on(cc.Director.EVENT_BEFORE_UPDATE,n),cc.director.on(cc.Director.EVENT_AFTER_VISIT,r),cc.director.on(cc.Director.EVENT_AFTER_DRAW,s),l=!0)}}}),{"../../../external/pstats/pstats":248,"../platform/CCMacro":161}],201:[(function(t,e,i){function n(t){return t?"string"==typeof t?u.getClassByName(t):t:(cc.errorID(3804),null)}function r(t,e){if(e._sealed)for(var i=0;i<t._components.length;++i){var n=t._components[i];if(n.constructor===e)return n}else for(var r=0;r<t._components.length;++r){var s=t._components[r];if(s instanceof e)return s}return null}function s(t,e,i){if(e._sealed)for(var n=0;n<t._components.length;++n){var r=t._components[n];r.constructor===e&&i.push(r)}else for(var s=0;s<t._components.length;++s){var o=t._components[s];o instanceof e&&i.push(o)}}function o(t,e){for(var i=0;i<t.length;++i){var n=t[i],s=r(n,e);if(s)return s;if(n._children.length>0&&(s=o(n._children,e)))return s}return null}function a(t,e,i){for(var n=0;n<t.length;++n){var r=t[n];s(r,e,i),r._children.length>0&&a(r._children,e,i)}}var c=t("../platform/CCObject").Flags,h=t("./misc"),l=t("../platform/id-generater"),_=t("../event-manager"),u=cc.js,d=c.Destroying,m=c.DontDestroy,f=new l("Node"),p=cc.Class({name:"cc._BaseNode",extends:cc.Object,mixins:[cc.EventTarget],properties:{_parent:null,_children:[],_tag:cc.macro.NODE_TAG_INVALID,_active:!0,_components:[],_prefab:null,_persistNode:{get:function(){return(this._objFlags&m)>0},set:function(t){t?this._objFlags|=m:this._objFlags&=~m}},name:{get:function(){return this._name},set:function(t){this._name=t}},_id:{default:"",editorOnly:!0},uuid:{get:function(){var t=this._id;return t||(t=this._id=f.getNewId()),t}},children:{get:function(){return this._children}},childrenCount:{get:function(){return this._children.length}},active:{get:function(){return this._active},set:function(t){if(t=!!t,this._active!==t){this._active=t;var e=this._parent;if(e){e._activeInHierarchy&&cc.director._nodeActivator.activateNode(this,t)}}}},activeInHierarchy:{get:function(){return this._activeInHierarchy}}},ctor:function(t){this._name=void 0!==t?t:"New Node",this._activeInHierarchy=!1,this.__instanceId=this._id||cc.ClassManager.getNewInstanceId(),this.__eventTargets=[]},getTag:function(){return this._tag},setTag:function(t){this._tag=t},getParent:function(){return this._parent},setParent:function(t){if(this._parent!==t){0;var e=this._parent;if(this._parent=t||null,this._onSetParent(t),t&&(_._setDirtyForNode(this),t._children.push(this),t.emit("child-added",this)),e){if(!(e._objFlags&d)){var i=e._children.indexOf(this);0,e._children.splice(i,1),e.emit("child-removed",this),this._onHierarchyChanged(e)}}else t&&this._onHierarchyChanged(null)}},init:function(){return!0},attr:function(t){u.mixin(this,t)},getChildByTag:function(t){var e=this._children;if(null!==e)for(var i=0;i<e.length;i++){var n=e[i];if(n&&n._tag===t)return n}return null},getChildByUuid:function(t){if(!t)return cc.log("Invalid uuid"),null;for(var e=this._children,i=0,n=e.length;i<n;i++)if(e[i]._id===t)return e[i];return null},getChildByName:function(t){if(!t)return cc.log("Invalid name"),null;for(var e=this._children,i=0,n=e.length;i<n;i++)if(e[i]._name===t)return e[i];return null},addChild:function(t){cc.assertID(t,1606),cc.assertID(null===t._parent,1605),t.setParent(this)},insertChild:function(t,e){t.parent=this,t.setSiblingIndex(e)},getSiblingIndex:function(){return this._parent?this._parent._children.indexOf(this):0},setSiblingIndex:function(t){if(this._parent){var e=this._parent._children;t=-1!==t?t:e.length-1;var i=e.indexOf(this);t!==i&&(e.splice(i,1),t<e.length?e.splice(t,0,this):e.push(this),this._onSiblingIndexChanged&&this._onSiblingIndexChanged(t))}},cleanup:function(){},removeFromParent:function(t){this._parent&&(void 0===t&&(t=!0),this._parent.removeChild(this,t))},removeChild:function(t,e){this._children.indexOf(t)>-1&&((e||void 0===e)&&t.cleanup(),t.parent=null)},removeChildByTag:function(t,e){t===cc.macro.NODE_TAG_INVALID&&cc.logID(1609);var i=this.getChildByTag(t);i?this.removeChild(i,e):cc.logID(1610,t)},removeAllChildren:function(t){var e=this._children;void 0===t&&(t=!0);for(var i=e.length-1;i>=0;i--){var n=e[i];n&&(t&&n.cleanup(),n.parent=null)}this._children.length=0},isChildOf:function(t){var e=this;do{if(e===t)return!0;e=e._parent}while(e);return!1},getComponent:function(t){var e=n(t);return e?r(this,e):null},getComponents:function(t){var e=n(t),i=[];return e&&s(this,e,i),i},getComponentInChildren:function(t){var e=n(t);return e?o(this._children,e):null},getComponentsInChildren:function(t){var e=n(t),i=[];return e&&(s(this,e,i),a(this._children,e,i)),i},_checkMultipleComp:!1,addComponent:function(t){var e;if("string"==typeof t){if(!(e=u.getClassByName(t)))return cc.errorID(3807,t),cc._RFpeek()&&cc.errorID(3808,t),null}else{if(!t)return cc.errorID(3804),null;e=t}if("function"!=typeof e)return cc.errorID(3809),null;if(!cc.isChildClassOf(e,cc.Component))return cc.errorID(3810),null;var i=e._requireComponent;if(i&&!this.getComponent(i)){if(!this.addComponent(i))return null}var n=new e;return n.node=this,this._components.push(n),this._activeInHierarchy&&cc.director._nodeActivator.activateComp(n),n},_addComponentAt:!1,removeComponent:function(t){t?(t instanceof cc.Component||(t=this.getComponent(t)),t&&t.destroy()):cc.errorID(3813)},_getDependComponent:!1,_removeComponent:function(t){if(t){if(!(this._objFlags&d)){var e=this._components.indexOf(t);-1!==e?this._components.splice(e,1):t.node!==this&&cc.errorID(3815)}}else cc.errorID(3814)},_disableChildComps:function(){var t,e=this._components.length;for(t=0;t<e;++t){var i=this._components[t];i._enabled&&cc.director._compScheduler.disableComp(i)}for(t=0,e=this._children.length;t<e;++t){var n=this._children[t];n._active&&n._disableChildComps()}},destroy:function(){cc.Object.prototype.destroy.call(this)&&this._activeInHierarchy&&this._disableChildComps()},destroyAllChildren:function(){for(var t=this._children,e=0;e<t.length;++e)t[e].destroy()},_onSetParent:function(t){},_onPostActivated:function(){},_onHierarchyChanged:function(t){var e=this._parent;!this._persistNode||e instanceof cc.Scene||cc.game.removePersistRootNode(this);var i=this._active&&!(!e||!e._activeInHierarchy);this._activeInHierarchy!==i&&cc.director._nodeActivator.activateNode(this,i)},_onBatchCreated:function(){var t=this._prefab;t&&t.sync&&!t._synced&&t.root===this&&PrefabHelper.syncWithPrefab(this);for(var e=this._children,i=0,n=e.length;i<n;i++)e[i]._onBatchCreated()},_instantiate:function(t){t||(t=cc.instantiate._clone(this,this));var e=this._prefab;return e&&this===e.root&&e.sync&&(t._prefab._synced=e._synced),t._parent=null,t._onBatchCreated(),t},_registerIfAttached:!1,_onPreDestroy:function(){var t,e;this._objFlags|=d;var i=this._parent,n=i&&i._objFlags&d;var r=this._children;for(t=0,e=r.length;t<e;++t)r[t]._destroyImmediate();for(t=0,e=this._components.length;t<e;++t){this._components[t]._destroyImmediate()}var s=this.__eventTargets;for(t=0,e=s.length;t<e;++t){var o=s[t];o&&o.targetOff(this)}if(s.length=0,this._persistNode&&cc.game.removePersistRootNode(this),!n&&i){var a=i._children.indexOf(this);i._children.splice(a,1),i.emit("child-removed",this)}return n},onRestore:!1});p.prototype._onPreDestroyBase=p.prototype._onPreDestroy,p.prototype._onHierarchyChangedBase=p.prototype._onHierarchyChanged;h.propertyDefine(p,["name","children","childrenCount"],{}),cc._BaseNode=e.exports=p}),{"../event-manager":90,"../platform/CCObject":162,"../platform/id-generater":173,"./misc":206}],202:[(function(t,e,i){var n=1e-6;e.exports={binarySearchEpsilon:function(t,e){for(var i=0,r=t.length-1,s=r>>>1;i<=r;s=i+r>>>1){var o=t[s];if(o>e+n)r=s-1;else{if(!(o<e-n))return s;i=s+1}}return~i}}}),{}],203:[(function(t,e,i){var n=t("./misc").BASE64_VALUES,r="0123456789abcdef".split(""),s=["","","",""],o=s.concat(s,"-",s,"-",s,"-",s,"-",s,s,s),a=o.map((function(t,e){return"-"===t?NaN:e})).filter(isFinite);e.exports=function(t){if(22!==t.length)return t;o[0]=t[0],o[1]=t[1];for(var e=2,i=2;e<22;e+=2){var s=n[t.charCodeAt(e)],c=n[t.charCodeAt(e+1)];o[a[i++]]=r[s>>2],o[a[i++]]=r[(3&s)<<2|c>>4],o[a[i++]]=r[15&c]}return o.join("")}}),{"./misc":206}],204:[(function(t,e,i){cc.find=e.exports=function(t,e){if(null==t)return cc.errorID(5600),null;if(e)0;else{var i=cc.director.getScene();if(!i)return null;e=i}for(var n=e,r="/"!==t[0]?0:1,s=t.split("/"),o=r;o<s.length;o++){var a=s[o],c=n._children;n=null;for(var h=0,l=c.length;h<l;++h){var _=c[h];if(_.name===a){n=_;break}}if(!n)return null}return n}}),{}],205:[(function(t,e,i){t("./CCPath"),t("./find"),t("./mutable-forward-iterator")}),{"./CCPath":199,"./CCProfiler":200,"./find":204,"./mutable-forward-iterator":207}],206:[(function(t,e,i){var n=t("../platform/js"),r=t("../platform/CCSys"),s=i;s.propertyDefine=function(t,e,i){function n(t,e,i,n){var r=Object.getOwnPropertyDescriptor(t,e);if(r)r.get&&(t[i]=r.get),r.set&&n&&(t[n]=r.set);else{var s=t[i];cc.js.getset(t,e,s,t[n])}}for(var r,s=t.prototype,o=0;o<e.length;o++){var a=(r=e[o])[0].toUpperCase()+r.slice(1);n(s,r,"get"+a,"set"+a)}for(r in i){var c=i[r];n(s,r,c[0],c[1])}},s.NextPOT=function(t){return t-=1,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,(t|=t>>16)+1},s.imagePool=new n.Pool(function(t){return t instanceof HTMLImageElement&&(t.src=this._smallImg,!0)},10),s.imagePool.get=function(){return this._get()||new Image},s.imagePool._smallImg="data:image/gif;base64,R0lGODlhAQABAAAAACwAAAAAAQABAAA=",r.os!==r.OS_WINDOWS&&r.os!==r.OS_LINUX||r.browserType===r.BROWSER_TYPE_CHROME||s.imagePool.resize(0),s.BUILTIN_CLASSID_RE=/^(?:cc|dragonBones|sp|ccsg)\..+/;for(var o=new Array(123),a=0;a<123;++a)o[a]=64;for(var c=0;c<64;++c)o["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charCodeAt(c)]=c;s.BASE64_VALUES=o,s.pushToMap=function(t,e,i,n){var r=t[e];r?Array.isArray(r)?n?(r.push(r[0]),r[0]=i):r.push(i):t[e]=n?[i,r]:[r,i]:t[e]=i}}),{"../platform/CCSys":165,"../platform/js":177}],207:[(function(t,e,i){function n(t){this.i=0,this.array=t}var r=n.prototype;r.remove=function(t){var e=this.array.indexOf(t);e>=0&&this.removeAt(e)},r.removeAt=function(t){this.array.splice(t,1),t<=this.i&&--this.i},r.fastRemove=function(t){var e=this.array.indexOf(t);e>=0&&this.fastRemoveAt(e)},r.fastRemoveAt=function(t){var e=this.array;e[t]=e[e.length-1],--e.length,t<=this.i&&--this.i},r.push=function(t){this.array.push(t)},e.exports=n}),{}],208:[(function(t,e,i){cc._PrefabInfo=cc.Class({name:"cc.PrefabInfo",properties:{root:null,asset:null,fileId:"",sync:!1,_synced:{default:!1,serializable:!1}}}),e.exports={syncWithPrefab:function(t){var e=t._prefab;if(e._synced=!0,!e.asset)return cc.errorID(3701,t.name),void(t._prefab=null);var i=t._objFlags,n=t._parent,r=t._id,s=t._name,o=t._active,a=t._position.x,c=t._position.y,h=t._rotationX,l=t._rotationY,_=t._localZOrder,u=t._globalZOrder;cc.game._isCloning=!0;var d=e.asset.data;d._prefab._synced=!0,d._iN$t=t,cc.instantiate._clone(d,d),cc.game._isCloning=!1,t._objFlags=i,t._parent=n,t._id=r,t._prefab=e,t._name=s,t._active=o,t._position.x=a,t._position.y=c,t._rotationX=h,t._rotationY=l,t._localZOrder=_,t._globalZOrder=u}}}),{}],209:[(function(t,e,i){var n={removeSgNode:function(){var t=this._sgNode;if(t){var e=t._parent;e?e.removeChild(t):t.performRecursive(_ccsg.Node.performType.cleanup),t._entity&&(t._entity=null)}}};e.exports=n}),{}],210:[(function(t,e,i){cc.AffineTransform=function(t,e,i,n,r,s){this.a=t,this.b=e,this.c=i,this.d=n,this.tx=r,this.ty=s},cc.affineTransformMake=function(t,e,i,n,r,s){return{a:t,b:e,c:i,d:n,tx:r,ty:s}},cc.affineTransformClone=function(t){return{a:t.a,b:t.b,c:t.c,d:t.d,tx:t.tx,ty:t.ty}},cc.pointApplyAffineTransform=function(t,e,i){var n,r;return void 0===i?(i=e,n=t.x,r=t.y):(n=t,r=e),{x:i.a*n+i.c*r+i.tx,y:i.b*n+i.d*r+i.ty}},cc._pointApplyAffineTransformIn=function(t,e,i,n){var r,s,o;void 0===n?(o=e,r=t.x,s=t.y,n=i):(r=t,s=e,o=i),n.x=o.a*r+o.c*s+o.tx,n.y=o.b*r+o.d*s+o.ty},cc._pointApplyAffineTransform=function(t,e,i){return cc.pointApplyAffineTransform(t,e,i)},cc.sizeApplyAffineTransform=function(t,e){return{width:e.a*t.width+e.c*t.height,height:e.b*t.width+e.d*t.height}},cc.affineTransformMakeIdentity=function(){return{a:1,b:0,c:0,d:1,tx:0,ty:0}},cc.affineTransformIdentity=function(){return{a:1,b:0,c:0,d:1,tx:0,ty:0}},cc.rectApplyAffineTransform=function(t,e){var i=t.x,n=t.y,r=i+t.width,s=n+t.height,o=e.a*i+e.c*n+e.tx,a=e.b*i+e.d*n+e.ty,c=e.a*r+e.c*n+e.tx,h=e.b*r+e.d*n+e.ty,l=e.a*i+e.c*s+e.tx,_=e.b*i+e.d*s+e.ty,u=e.a*r+e.c*s+e.tx,d=e.b*r+e.d*s+e.ty,m=Math.min(o,c,l,u),f=Math.max(o,c,l,u),p=Math.min(a,h,_,d),g=Math.max(a,h,_,d);return cc.rect(m,p,f-m,g-p)},cc._rectApplyAffineTransformIn=function(t,e){var i=t.x,n=t.y,r=i+t.width,s=n+t.height,o=e.a*i+e.c*n+e.tx,a=e.b*i+e.d*n+e.ty,c=e.a*r+e.c*n+e.tx,h=e.b*r+e.d*n+e.ty,l=e.a*i+e.c*s+e.tx,_=e.b*i+e.d*s+e.ty,u=e.a*r+e.c*s+e.tx,d=e.b*r+e.d*s+e.ty,m=Math.min(o,c,l,u),f=Math.max(o,c,l,u),p=Math.min(a,h,_,d),g=Math.max(a,h,_,d);return t.x=m,t.y=p,t.width=f-m,t.height=g-p,t},cc.obbApplyAffineTransform=function(t,e,i,n,r,s){var o=t.x,a=t.y,c=t.width,h=t.height,l=e.a*o+e.c*a+e.tx,_=e.b*o+e.d*a+e.ty,u=e.a*c,d=e.b*c,m=e.c*h,f=e.d*h;n.x=l,n.y=_,r.x=u+l,r.y=d+_,i.x=m+l,i.y=f+_,s.x=u+m+l,s.y=d+f+_},cc.affineTransformTranslate=function(t,e,i){return{a:t.a,b:t.b,c:t.c,d:t.d,tx:t.tx+t.a*e+t.c*i,ty:t.ty+t.b*e+t.d*i}},cc.affineTransformScale=function(t,e,i){return{a:t.a*e,b:t.b*e,c:t.c*i,d:t.d*i,tx:t.tx,ty:t.ty}},cc.affineTransformRotate=function(t,e){var i=Math.sin(e),n=Math.cos(e);return{a:t.a*n+t.c*i,b:t.b*n+t.d*i,c:t.c*n-t.a*i,d:t.d*n-t.b*i,tx:t.tx,ty:t.ty}},cc.affineTransformConcat=function(t,e){return{a:t.a*e.a+t.b*e.c,b:t.a*e.b+t.b*e.d,c:t.c*e.a+t.d*e.c,d:t.c*e.b+t.d*e.d,tx:t.tx*e.a+t.ty*e.c+e.tx,ty:t.tx*e.b+t.ty*e.d+e.ty}},cc.affineTransformConcatIn=function(t,e){var i=t.a,n=t.b,r=t.c,s=t.d,o=t.tx,a=t.ty;return t.a=i*e.a+n*e.c,t.b=i*e.b+n*e.d,t.c=r*e.a+s*e.c,t.d=r*e.b+s*e.d,t.tx=o*e.a+a*e.c+e.tx,t.ty=o*e.b+a*e.d+e.ty,t},cc.affineTransformEqualToTransform=function(t,e){return t.a===e.a&&t.b===e.b&&t.c===e.c&&t.d===e.d&&t.tx===e.tx&&t.ty===e.ty},cc.affineTransformInvert=function(t){var e=1/(t.a*t.d-t.b*t.c);return{a:e*t.d,b:-e*t.b,c:-e*t.c,d:e*t.a,tx:e*(t.c*t.ty-t.d*t.tx),ty:e*(t.b*t.tx-t.a*t.ty)}},cc.affineTransformInvertIn=function(t){var e=t.a,i=t.b,n=t.c,r=t.d,s=1/(e*r-i*n),o=t.tx,a=t.ty;return t.a=s*r,t.b=-s*i,t.c=-s*n,t.d=s*e,t.tx=s*(n*a-r*o),t.ty=s*(i*o-e*a),t},cc.affineTransformInvertOut=function(t,e){var i=t.a,n=t.b,r=t.c,s=t.d,o=1/(i*s-n*r);e.a=o*s,e.b=-o*n,e.c=-o*r,e.d=o*i,e.tx=o*(r*t.ty-s*t.tx),e.ty=o*(n*t.tx-i*t.ty)}}),{}],211:[(function(t,e,i){var n=t("./CCValueType"),r=t("../platform/js"),s=(function(){function e(t,e,i,n){"object"==typeof t&&(e=t.g,i=t.b,n=t.a,t=t.r),t=t||0,e=e||0,i=i||0,n="number"==typeof n?n:255,this._val=(~~t<<24>>>0)+(~~e<<16)+(~~i<<8)+~~n}r.extend(e,n),t("../platform/CCClass").fastDefine("cc.Color",e,{r:0,g:0,b:0,a:255});var i={WHITE:[255,255,255,255],BLACK:[0,0,0,255],TRANSPARENT:[0,0,0,0],GRAY:[127.5,127.5,127.5],RED:[255,0,0],GREEN:[0,255,0],BLUE:[0,0,255],YELLOW:[255,235,4],ORANGE:[255,127,0],CYAN:[0,255,255],MAGENTA:[255,0,255]};for(var s in i)r.get(e,s,(function(t){return function(){return new e(t[0],t[1],t[2],t[3])}})(i[s]));var o=e.prototype;return o.clone=function(){var t=new e;return t._val=this._val,t},o.equals=function(t){return t&&this._val===t._val},o.lerp=function(t,i,n){n=n||new e;var r=this.r,s=this.g,o=this.b,a=this.a;return n.r=r+(t.r-r)*i,n.g=s+(t.g-s)*i,n.b=o+(t.b-o)*i,n.a=a+(t.a-a)*i,n},o.toString=function(){return"rgba("+this.r.toFixed()+", "+this.g.toFixed()+", "+this.b.toFixed()+", "+this.a.toFixed()+")"},o.getR=function(){return(4278190080&this._val)>>>24},o.setR=function(t){return this._val=(16777215&this._val|~~t<<24>>>0)>>>0,this},o.getG=function(){return(16711680&this._val)>>16},o.setG=function(t){return this._val=(4278255615&this._val|~~t<<16)>>>0,this},o.getB=function(){return(65280&this._val)>>8},o.setB=function(t){return this._val=(4294902015&this._val|~~t<<8)>>>0,this},o.getA=function(){return 255&this._val},o.setA=function(t){return this._val=(4294967040&this._val|~~t)>>>0,this},r.getset(o,"r",o.getR,o.setR,!0),r.getset(o,"g",o.getG,o.setG,!0),r.getset(o,"b",o.getB,o.setB,!0),r.getset(o,"a",o.getA,o.setA,!0),o.toCSS=function(t){return"rgba"===t?"rgba("+(0|this.r)+","+(0|this.g)+","+(0|this.b)+","+(this.a/255).toFixed(2)+")":"rgb"===t?"rgb("+(0|this.r)+","+(0|this.g)+","+(0|this.b)+")":"#"+this.toHEX(t)},o.clamp=function(){},o.fromHEX=function(t){t.length<8&&(t+="FF");var e=parseInt(t.indexOf("#")>-1?t.substring(1):t,16);return this._val=(0&this._val|e)>>>0,this},o.toHEX=function(t){var e=[(0|this.r).toString(16),(0|this.g).toString(16),(0|this.b).toString(16)],i=-1;if("#rgb"===t)for(i=0;i<e.length;++i)e[i].length>1&&(e[i]=e[i][0]);else if("#rrggbb"===t)for(i=0;i<e.length;++i)1===e[i].length&&(e[i]="0"+e[i]);return e.join("")},o.toRGBValue=function(){return 16777215&this._val},o.fromHSV=function(t,i,n){var r=e.hsv2rgb(t,i,n);return this._val=(r.r<<24>>>0)+(r.g<<16)+(r.b<<8)+this.a,this},o.toHSV=function(){return e.rgb2hsv(this.r,this.g,this.b)},o.fromColor=function(t){t._val?this._val=t._val:(this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a)},e})();s.rgb2hsv=function(t,e,i){t/=255,e/=255,i/=255;var n={h:0,s:0,v:0},r=Math.max(t,e,i),s=Math.min(t,e,i),o=0;return n.v=r,n.s=r?(r-s)/r:0,n.s?(o=r-s,n.h=t===r?(e-i)/o:e===r?2+(i-t)/o:4+(t-e)/o,n.h/=6,n.h<0&&(n.h+=1)):n.h=0,n},s.hsv2rgb=function(t,e,i){var n={r:0,g:0,b:0};if(0===e)n.r=n.g=n.b=i;else if(0===i)n.r=n.g=n.b=0;else{1===t&&(t=0),t*=6,e=e,i=i;var r=Math.floor(t),s=t-r,o=i*(1-e),a=i*(1-e*s),c=i*(1-e*(1-s));switch(r){case 0:n.r=i,n.g=c,n.b=o;break;case 1:n.r=a,n.g=i,n.b=o;break;case 2:n.r=o,n.g=i,n.b=c;break;case 3:n.r=o,n.g=a,n.b=i;break;case 4:n.r=c,n.g=o,n.b=i;break;case 5:n.r=i,n.g=o,n.b=a}}return n.r*=255,n.g*=255,n.b*=255,n},cc.Color=s,cc.color=function(t,e,i,n){if("string"==typeof t){return(new cc.Color).fromHEX(t)}return"object"==typeof t?new cc.Color(t.r,t.g,t.b,t.a):new cc.Color(t,e,i,n)},cc.colorEqual=function(t,e){return void 0!==t._val&&void 0!==e._val?t._val===e._val:t.r===e.r&&t.g===e.g&&t.b===e.b},cc.hexToColor=function(t){t=t.replace(/^#?/,"0x");var e=parseInt(t),i=e>>16,n=(65280&e)>>8,r=255&e;return cc.color(i,n,r)},cc.colorToHex=function(t){var e=t.r.toString(16),i=t.g.toString(16),n=t.b.toString(16);return"#"+(t.r<16?"0"+e:e)+(t.g<16?"0"+i:i)+(t.b<16?"0"+n:n)},e.exports=cc.Color}),{"../platform/CCClass":156,"../platform/js":177,"./CCValueType":217}],212:[(function(t,e,i){var n=parseFloat("1.192092896e-07F");cc.pNeg=function(t){return cc.p(-t.x,-t.y)},cc.pAdd=function(t,e){return cc.p(t.x+e.x,t.y+e.y)},cc.pSub=function(t,e){return cc.p(t.x-e.x,t.y-e.y)},cc.pMult=function(t,e){return cc.p(t.x*e,t.y*e)},cc.pMidpoint=function(t,e){return cc.pMult(cc.pAdd(t,e),.5)},cc.pDot=function(t,e){return t.x*e.x+t.y*e.y},cc.pCross=function(t,e){return t.x*e.y-t.y*e.x},cc.pPerp=function(t){return cc.p(-t.y,t.x)},cc.pRPerp=function(t){return cc.p(t.y,-t.x)},cc.pProject=function(t,e){return cc.pMult(e,cc.pDot(t,e)/cc.pDot(e,e))},cc.pLengthSQ=function(t){return cc.pDot(t,t)},cc.pDistanceSQ=function(t,e){return cc.pLengthSQ(cc.pSub(t,e))},cc.pLength=function(t){return Math.sqrt(cc.pLengthSQ(t))},cc.pDistance=function(t,e){return cc.pLength(cc.pSub(t,e))},cc.pNormalize=function(t){var e=cc.pLength(t);return 0===e?cc.p(t):cc.pMult(t,1/e)},cc.pForAngle=function(t){return cc.p(Math.cos(t),Math.sin(t))},cc.pToAngle=function(t){return Math.atan2(t.y,t.x)},cc.clampf=function(t,e,i){if(e>i){var n=e;e=i,i=n}return t<e?e:t<i?t:i},cc.clamp01=function(t){return t<0?0:t<1?t:1},cc.pClamp=function(t,e,i){return cc.p(cc.clampf(t.x,e.x,i.x),cc.clampf(t.y,e.y,i.y))},cc.pFromSize=function(t){return cc.p(t.width,t.height)},cc.pCompOp=function(t,e){return cc.p(e(t.x),e(t.y))},cc.pLerp=function(t,e,i){return cc.pAdd(cc.pMult(t,1-i),cc.pMult(e,i))},cc.pFuzzyEqual=function(t,e,i){return t.x-i<=e.x&&e.x<=t.x+i&&t.y-i<=e.y&&e.y<=t.y+i},cc.pCompMult=function(t,e){return cc.p(t.x*e.x,t.y*e.y)},cc.pAngleSigned=function(t,e){var i=cc.pNormalize(t),r=cc.pNormalize(e),s=Math.atan2(i.x*r.y-i.y*r.x,cc.pDot(i,r));return Math.abs(s)<n?0:s},cc.pAngle=function(t,e){var i=Math.acos(cc.pDot(cc.pNormalize(t),cc.pNormalize(e)));return Math.abs(i)<n?0:i},cc.pRotateByAngle=function(t,e,i){var n=cc.pSub(t,e),r=Math.cos(i),s=Math.sin(i),o=n.x;return n.x=o*r-n.y*s+e.x,n.y=o*s+n.y*r+e.y,n},cc.pLineIntersect=function(t,e,i,n,r){if(t.x===e.x&&t.y===e.y||i.x===n.x&&i.y===n.y)return!1;var s=e.x-t.x,o=e.y-t.y,a=n.x-i.x,c=n.y-i.y,h=t.x-i.x,l=t.y-i.y,_=c*s-a*o;return r.x=a*l-c*h,r.y=s*l-o*h,0===_?0===r.x||0===r.y:(r.x=r.x/_,r.y=r.y/_,!0)},cc.pSegmentIntersect=function(t,e,i,n){var r=cc.p(0,0);return!!(cc.pLineIntersect(t,e,i,n,r)&&r.x>=0&&r.x<=1&&r.y>=0&&r.y<=1)},cc.pIntersectPoint=function(t,e,i,n){var r=cc.p(0,0);if(cc.pLineIntersect(t,e,i,n,r)){var s=cc.p(0,0);return s.x=t.x+r.x*(e.x-t.x),s.y=t.y+r.x*(e.y-t.y),s}return cc.p(0,0)},cc.pSameAs=function(t,e){return null!=t&&null!=e&&(t.x===e.x&&t.y===e.y)},cc.pZeroIn=function(t){t.x=0,t.y=0},cc.pIn=function(t,e){t.x=e.x,t.y=e.y},cc.pMultIn=function(t,e){t.x*=e,t.y*=e},cc.pSubIn=function(t,e){t.x-=e.x,t.y-=e.y},cc.pAddIn=function(t,e){t.x+=e.x,t.y+=e.y},cc.pNormalizeIn=function(t){cc.pMultIn(t,1/Math.sqrt(t.x*t.x+t.y*t.y))}}),{}],213:[(function(t,e,i){function n(t,e,i,n){t&&"object"==typeof t&&(e=t.y,i=t.width,n=t.height,t=t.x),this.x=t||0,this.y=e||0,this.width=i||0,this.height=n||0}var r=t("./CCValueType"),s=t("../platform/js");s.extend(n,r),t("../platform/CCClass").fastDefine("cc.Rect",n,{x:0,y:0,width:0,height:0}),n.fromMinMax=function(t,e){var i=Math.min(t.x,e.x),r=Math.min(t.y,e.y);return new n(i,r,Math.max(t.x,e.x)-i,Math.max(t.y,e.y)-r)},n.contain=function(t,e){return t.x<e.x&&t.x+t.width>e.x+e.width&&t.y<e.y&&t.y+t.height>e.y+e.height?1:e.x<t.x&&e.x+e.width>t.x+t.width&&e.y<t.y&&e.y+e.height>t.y+t.height?-1:0};var o=n.prototype;o.clone=function(){return new n(this.x,this.y,this.width,this.height)},o.equals=function(t){return t&&this.x===t.x&&this.y===t.y&&this.width===t.width&&this.height===t.height},o.lerp=function(t,e,i){i=i||new n;var r=this.x,s=this.y,o=this.width,a=this.height;return i.x=r+(t.x-r)*e,i.y=s+(t.y-s)*e,i.width=o+(t.width-o)*e,i.height=a+(t.height-a)*e,i},o.toString=function(){return"("+this.x.toFixed(2)+", "+this.y.toFixed(2)+", "+this.width.toFixed(2)+", "+this.height.toFixed(2)+")"},s.getset(o,"xMin",(function(){return this.x}),(function(t){this.width+=this.x-t,this.x=t})),s.getset(o,"yMin",(function(){return this.y}),(function(t){this.height+=this.y-t,this.y=t})),s.getset(o,"xMax",(function(){return this.x+this.width}),(function(t){this.width=t-this.x})),s.getset(o,"yMax",(function(){return this.y+this.height}),(function(t){this.height=t-this.y})),s.getset(o,"center",(function(){return new cc.Vec2(this.x+.5*this.width,this.y+.5*this.height)}),(function(t){this.x=t.x-.5*this.width,this.y=t.y-.5*this.height})),s.getset(o,"origin",(function(){return new cc.Vec2(this.x,this.y)}),(function(t){this.x=t.x,this.y=t.y})),s.getset(o,"size",(function(){return new cc.Size(this.width,this.height)}),(function(t){this.width=t.width,this.height=t.height})),o.intersects=function(t){return cc.rectIntersectsRect(this,t)},o.contains=function(t){return this.x<=t.x&&this.x+this.width>=t.x&&this.y<=t.y&&this.y+this.height>=t.y},o.containsRect=function(t){return this.x<=t.x&&this.x+this.width>=t.x+t.width&&this.y<=t.y&&this.y+this.height>=t.y+t.height},cc.Rect=n,cc.rect=function(t,e,i,r){return new n(t,e,i,r)},cc.rectEqualToRect=function(t,e){return t&&e&&t.x===e.x&&t.y===e.y&&t.width===e.width&&t.height===e.height},cc._rectEqualToZero=function(t){return t&&0===t.x&&0===t.y&&0===t.width&&0===t.height},cc.rectContainsRect=function(t,e){return!(!t||!e)&&!(t.x>=e.x||t.y>=e.y||t.x+t.width<=e.x+e.width||t.y+t.height<=e.y+e.height)},cc.rectGetMaxX=function(t){return t.x+t.width},cc.rectGetMidX=function(t){return t.x+t.width/2},cc.rectGetMinX=function(t){return t.x},cc.rectGetMaxY=function(t){return t.y+t.height},cc.rectGetMidY=function(t){return t.y+t.height/2},cc.rectGetMinY=function(t){return t.y},cc.rectContainsPoint=function(t,e){return e.x>=cc.rectGetMinX(t)&&e.x<=cc.rectGetMaxX(t)&&e.y>=cc.rectGetMinY(t)&&e.y<=cc.rectGetMaxY(t)},cc.rectIntersectsRect=function(t,e){var i=t.x+t.width,n=t.y+t.height,r=e.x+e.width,s=e.y+e.height;return!(i<e.x||r<t.x||n<e.y||s<t.y)},cc.rectOverlapsRect=function(t,e){return!(t.x+t.width<e.x||e.x+e.width<t.x||t.y+t.height<e.y||e.y+e.height<t.y)},cc.rectUnion=function(t,e){var i=cc.rect(0,0,0,0);return i.x=Math.min(t.x,e.x),i.y=Math.min(t.y,e.y),i.width=Math.max(t.x+t.width,e.x+e.width)-i.x,i.height=Math.max(t.y+t.height,e.y+e.height)-i.y,i},cc.rectIntersection=function(t,e){var i=cc.rect(Math.max(cc.rectGetMinX(t),cc.rectGetMinX(e)),Math.max(cc.rectGetMinY(t),cc.rectGetMinY(e)),0,0);return i.width=Math.min(cc.rectGetMaxX(t),cc.rectGetMaxX(e))-cc.rectGetMinX(i),i.height=Math.min(cc.rectGetMaxY(t),cc.rectGetMaxY(e))-cc.rectGetMinY(i),i},e.exports=cc.Rect}),{"../platform/CCClass":156,"../platform/js":177,"./CCValueType":217}],214:[(function(t,e,i){function n(t,e){t&&"object"==typeof t&&(e=t.height,t=t.width),this.width=t||0,this.height=e||0}var r=t("./CCValueType"),s=t("../platform/js");s.extend(n,r),t("../platform/CCClass").fastDefine("cc.Size",n,{width:0,height:0}),s.get(n,"ZERO",(function(){return new n(0,0)}));var o=n.prototype;o.clone=function(){return new n(this.width,this.height)},o.equals=function(t){return t&&this.width===t.width&&this.height===t.height},o.lerp=function(t,e,i){i=i||new n;var r=this.width,s=this.height;return i.width=r+(t.width-r)*e,i.height=s+(t.height-s)*e,i},o.toString=function(){return"("+this.width.toFixed(2)+", "+this.height.toFixed(2)+")"},cc.size=function(t,e){return new n(t,e)},cc.sizeEqualToSize=function(t,e){return t&&e&&t.width===e.width&&t.height===e.height},cc.Size=e.exports=n}),{"../platform/CCClass":156,"../platform/js":177,"./CCValueType":217}],215:[(function(t,e,i){cc.Acceleration=function(t,e,i,n){this.x=t||0,this.y=e||0,this.z=i||0,this.timestamp=n||0},cc.BlendFunc=function(t,e){this.src=t,this.dst=e};var n=cc.Enum({ONE:1,ZERO:0,SRC_ALPHA:770,SRC_COLOR:768,DST_ALPHA:772,DST_COLOR:774,ONE_MINUS_SRC_ALPHA:771,ONE_MINUS_SRC_COLOR:769,ONE_MINUS_DST_ALPHA:773,ONE_MINUS_DST_COLOR:775});cc.BlendFunc._disable=function(){return new cc.BlendFunc(n.ONE,n.ZERO)},cc.BlendFunc._alphaPremultiplied=function(){return new cc.BlendFunc(n.ONE,n.ONE_MINUS_SRC_ALPHA)},cc.BlendFunc._alphaNonPremultiplied=function(){return new cc.BlendFunc(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA)},cc.BlendFunc._additive=function(){return new cc.BlendFunc(n.SRC_ALPHA,n.ONE)},cc.BlendFunc.BlendFactor=n,cc.BlendFunc.DISABLE,cc.js.get(cc.BlendFunc,"DISABLE",cc.BlendFunc._disable),cc.BlendFunc.ALPHA_PREMULTIPLIED,cc.js.get(cc.BlendFunc,"ALPHA_PREMULTIPLIED",cc.BlendFunc._alphaPremultiplied),cc.BlendFunc.ALPHA_NON_PREMULTIPLIED,cc.js.get(cc.BlendFunc,"ALPHA_NON_PREMULTIPLIED",cc.BlendFunc._alphaNonPremultiplied),cc.BlendFunc.ADDITIVE,cc.js.get(cc.BlendFunc,"ADDITIVE",cc.BlendFunc._additive),cc.blendFuncDisable=cc.BlendFunc._disable,cc.TextAlignment=cc.Enum({LEFT:0,CENTER:1,RIGHT:2}),cc.VerticalTextAlignment=cc.Enum({TOP:0,CENTER:1,BOTTOM:2})}),{}],216:[(function(t,e,i){cc.WebGLColor=function(t,e,i,n,r,s){this._arrayBuffer=r||new ArrayBuffer(cc.WebGLColor.BYTES_PER_ELEMENT),this._offset=s||0;var o=this._arrayBuffer,a=this._offset;this._view=new Uint8Array(o,a,4),this._view[0]=t||0,this._view[1]=e||0,this._view[2]=i||0,"number"==typeof n?this._view[3]=n:(this._view[3]=255,this.a_undefined=!0)},cc.WebGLColor.BYTES_PER_ELEMENT=4;(n=cc.WebGLColor.prototype)._getR=function(){return this._view[0]},n._setR=function(t){this._view[0]=t<0?0:t},n._getG=function(){return this._view[1]},n._setG=function(t){this._view[1]=t<0?0:t},n._getB=function(){return this._view[2]},n._setB=function(t){this._view[2]=t<0?0:t},n._getA=function(){return this._view[3]},n._setA=function(t){this._view[3]=t<0?0:t},n.r,cc.js.getset(n,"r",n._getR,n._setR),n.g,cc.js.getset(n,"g",n._getG,n._setG),n.b,cc.js.getset(n,"b",n._getB,n._setB),n.a,cc.js.getset(n,"a",n._getA,n._setA),cc.Vertex2F=function(t,e,i,n){this._arrayBuffer=i||new ArrayBuffer(cc.Vertex2F.BYTES_PER_ELEMENT),this._offset=n||0,this._view=new Float32Array(this._arrayBuffer,this._offset,2),this._view[0]=t||0,this._view[1]=e||0},cc.Vertex2F.BYTES_PER_ELEMENT=8;var n;(n=cc.Vertex2F.prototype)._getX=function(){return this._view[0]},n._setX=function(t){this._view[0]=t},n._getY=function(){return this._view[1]},n._setY=function(t){this._view[1]=t},cc.js.getset(n,"x",n._getX,n._setX),cc.js.getset(n,"y",n._getY,n._setY),cc.Vertex3F=function(t,e,i,n,r){this._arrayBuffer=n||new ArrayBuffer(cc.Vertex3F.BYTES_PER_ELEMENT),this._offset=r||0;var s=this._arrayBuffer,o=this._offset;this._view=new Float32Array(s,o,3),this._view[0]=t||0,this._view[1]=e||0,this._view[2]=i||0},cc.Vertex3F.BYTES_PER_ELEMENT=12,(n=cc.Vertex3F.prototype)._getX=function(){return this._view[0]},n._setX=function(t){this._view[0]=t},n._getY=function(){return this._view[1]},n._setY=function(t){this._view[1]=t},n._getZ=function(){return this._view[2]},n._setZ=function(t){this._view[2]=t},cc.js.getset(n,"x",n._getX,n._setX),cc.js.getset(n,"y",n._getY,n._setY),cc.js.getset(n,"z",n._getZ,n._setZ),cc.Tex2F=function(t,e,i,n){this._arrayBuffer=i||new ArrayBuffer(cc.Tex2F.BYTES_PER_ELEMENT),this._offset=n||0,this._view=new Float32Array(this._arrayBuffer,this._offset,2),this._view[0]=t||0,this._view[1]=e||0},cc.Tex2F.BYTES_PER_ELEMENT=8,(n=cc.Tex2F.prototype)._getU=function(){return this._view[0]},n._setU=function(t){this._view[0]=t},n._getV=function(){return this._view[1]},n._setV=function(t){this._view[1]=t},cc.js.getset(n,"u",n._getU,n._setU),cc.js.getset(n,"v",n._getV,n._setV),cc.Quad2=function(t,e,i,n,r,s){this._arrayBuffer=r||new ArrayBuffer(cc.Quad2.BYTES_PER_ELEMENT),this._offset=s||0;var o=this._arrayBuffer,a=this._offset,c=cc.Vertex2F.BYTES_PER_ELEMENT;this._tl=t?new cc.Vertex2F(t.x,t.y,o,a):new cc.Vertex2F(0,0,o,a),a+=c,this._tr=e?new cc.Vertex2F(e.x,e.y,o,a):new cc.Vertex2F(0,0,o,a),a+=c,this._bl=i?new cc.Vertex2F(i.x,i.y,o,a):new cc.Vertex2F(0,0,o,a),a+=c,this._br=n?new cc.Vertex2F(n.x,n.y,o,a):new cc.Vertex2F(0,0,o,a)},cc.Quad2.BYTES_PER_ELEMENT=32,(n=cc.Quad2.prototype)._getTL=function(){return this._tl},n._setTL=function(t){this._tl._view[0]=t.x,this._tl._view[1]=t.y},n._getTR=function(){return this._tr},n._setTR=function(t){this._tr._view[0]=t.x,this._tr._view[1]=t.y},n._getBL=function(){return this._bl},n._setBL=function(t){this._bl._view[0]=t.x,this._bl._view[1]=t.y},n._getBR=function(){return this._br},n._setBR=function(t){this._br._view[0]=t.x,this._br._view[1]=t.y},cc.js.getset(n,"tl",n._getTL,n._setTL),cc.js.getset(n,"tr",n._getTR,n._setTR),cc.js.getset(n,"bl",n._getBL,n._setBL),cc.js.getset(n,"br",n._getBR,n._setBR),cc.Quad3=function(t,e,i,n,r,s){this._arrayBuffer=r||new ArrayBuffer(cc.Quad3.BYTES_PER_ELEMENT),this._offset=s||0;var o=this._arrayBuffer,a=this._offset,c=cc.Vertex3F.BYTES_PER_ELEMENT;this.bl=bl?new cc.Vertex3F(bl.x,bl.y,bl.z,o,a):new cc.Vertex3F(0,0,0,o,a),a+=c,this.br=br?new cc.Vertex3F(br.x,br.y,br.z,o,a):new cc.Vertex3F(0,0,0,o,a),a+=c,this.tl=tl?new cc.Vertex3F(tl.x,tl.y,tl.z,o,a):new cc.Vertex3F(0,0,0,o,a),a+=c,this.tr=tr?new cc.Vertex3F(tr.x,tr.y,tr.z,o,a):new cc.Vertex3F(0,0,0,o,a)},cc.Quad3.BYTES_PER_ELEMENT=48,cc.V3F_C4B_T2F=function(t,e,i,n,r){this._arrayBuffer=n||new ArrayBuffer(cc.V3F_C4B_T2F.BYTES_PER_ELEMENT),this._offset=r||0;var s=this._arrayBuffer,o=this._offset;this._vertices=t?new cc.Vertex3F(t.x,t.y,t.z,s,o):new cc.Vertex3F(0,0,0,s,o),o+=cc.Vertex3F.BYTES_PER_ELEMENT,this._colors=e?new cc.WebGLColor(e.r,e.g,e.b,e.a,s,o):new cc.WebGLColor(0,0,0,0,s,o),o+=cc.WebGLColor.BYTES_PER_ELEMENT,this._texCoords=i?new cc.Tex2F(i.u,i.v,s,o):new cc.Tex2F(0,0,s,o)},cc.V3F_C4B_T2F.BYTES_PER_ELEMENT=24,(n=cc.V3F_C4B_T2F.prototype)._getVertices=function(){return this._vertices},n._setVertices=function(t){var e=this._vertices;e._view[0]=t.x,e._view[1]=t.y,e._view[2]=t.z},n._getColor=function(){return this._colors},n._setColor=function(t){var e=this._colors;e._view[0]=t.r,e._view[1]=t.g,e._view[2]=t.b,e._view[3]=t.a},n._getTexCoords=function(){return this._texCoords},n._setTexCoords=function(t){this._texCoords._view[0]=t.u,this._texCoords._view[1]=t.v},cc.js.getset(n,"vertices",n._getVertices,n._setVertices),cc.js.getset(n,"colors",n._getColor,n._setColor),cc.js.getset(n,"texCoords",n._getTexCoords,n._setTexCoords),cc.V3F_C4B_T2F_Quad=function(t,e,i,n,r,s){this._arrayBuffer=r||new ArrayBuffer(cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT),this._offset=s||0;var o=this._arrayBuffer,a=this._offset,c=cc.V3F_C4B_T2F.BYTES_PER_ELEMENT;this._tl=t?new cc.V3F_C4B_T2F(t.vertices,t.colors,t.texCoords,o,a):new cc.V3F_C4B_T2F(null,null,null,o,a),a+=c,this._bl=e?new cc.V3F_C4B_T2F(e.vertices,e.colors,e.texCoords,o,a):new cc.V3F_C4B_T2F(null,null,null,o,a),a+=c,this._tr=i?new cc.V3F_C4B_T2F(i.vertices,i.colors,i.texCoords,o,a):new cc.V3F_C4B_T2F(null,null,null,o,a),a+=c,this._br=n?new cc.V3F_C4B_T2F(n.vertices,n.colors,n.texCoords,o,a):new cc.V3F_C4B_T2F(null,null,null,o,a)},cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT=96,(n=cc.V3F_C4B_T2F_Quad.prototype)._getTL=function(){return this._tl},n._setTL=function(t){var e=this._tl;e.vertices=t.vertices,e.colors=t.colors,e.texCoords=t.texCoords},n._getBL=function(){return this._bl},n._setBL=function(t){var e=this._bl;e.vertices=t.vertices,e.colors=t.colors,e.texCoords=t.texCoords},n._getTR=function(){return this._tr},n._setTR=function(t){var e=this._tr;e.vertices=t.vertices,e.colors=t.colors,e.texCoords=t.texCoords},n._getBR=function(){return this._br},n._setBR=function(t){var e=this._br;e.vertices=t.vertices,e.colors=t.colors,e.texCoords=t.texCoords},n._getArrayBuffer=function(){return this._arrayBuffer},cc.js.getset(n,"tl",n._getTL,n._setTL),cc.js.getset(n,"tr",n._getTR,n._setTR),cc.js.getset(n,"bl",n._getBL,n._setBL),cc.js.getset(n,"br",n._getBR,n._setBR),cc.js.get(n,"arrayBuffer",n._getArrayBuffer),cc.V3F_C4B_T2F_QuadZero=function(){return new cc.V3F_C4B_T2F_Quad},cc.V3F_C4B_T2F_QuadCopy=function(t){if(!t)return cc.V3F_C4B_T2F_QuadZero();var e=t.tl,i=t.bl,n=t.tr,r=t.br;return{tl:{vertices:{x:e.vertices.x,y:e.vertices.y,z:e.vertices.z},colors:{r:e.colors.r,g:e.colors.g,b:e.colors.b,a:e.colors.a},texCoords:{u:e.texCoords.u,v:e.texCoords.v}},bl:{vertices:{x:i.vertices.x,y:i.vertices.y,z:i.vertices.z},colors:{r:i.colors.r,g:i.colors.g,b:i.colors.b,a:i.colors.a},texCoords:{u:i.texCoords.u,v:i.texCoords.v}},tr:{vertices:{x:n.vertices.x,y:n.vertices.y,z:n.vertices.z},colors:{r:n.colors.r,g:n.colors.g,b:n.colors.b,a:n.colors.a},texCoords:{u:n.texCoords.u,v:n.texCoords.v}},br:{vertices:{x:r.vertices.x,y:r.vertices.y,z:r.vertices.z},colors:{r:r.colors.r,g:r.colors.g,b:r.colors.b,a:r.colors.a},texCoords:{u:r.texCoords.u,v:r.texCoords.v}}}},cc.V3F_C4B_T2F_QuadsCopy=function(t){if(!t)return[];for(var e=[],i=0;i<t.length;i++)e.push(cc.V3F_C4B_T2F_QuadCopy(t[i]));return e},cc.V2F_C4B_T2F=function(t,e,i,n,r){this._arrayBuffer=n||new ArrayBuffer(cc.V2F_C4B_T2F.BYTES_PER_ELEMENT),this._offset=r||0;var s=this._arrayBuffer,o=this._offset;this._vertices=t?new cc.Vertex2F(t.x,t.y,s,o):new cc.Vertex2F(0,0,s,o),o+=cc.Vertex2F.BYTES_PER_ELEMENT,this._colors=e?new cc.WebGLColor(e.r,e.g,e.b,e.a,s,o):new cc.WebGLColor(0,0,0,0,s,o),o+=cc.WebGLColor.BYTES_PER_ELEMENT,this._texCoords=i?new cc.Tex2F(i.u,i.v,s,o):new cc.Tex2F(0,0,s,o)},cc.V2F_C4B_T2F.BYTES_PER_ELEMENT=20,(n=cc.V2F_C4B_T2F.prototype)._getVertices=function(){return this._vertices},n._setVertices=function(t){this._vertices._view[0]=t.x,this._vertices._view[1]=t.y},n._getColor=function(){return this._colors},n._setColor=function(t){var e=this._colors;e._view[0]=t.r,e._view[1]=t.g,e._view[2]=t.b,e._view[3]=t.a},n._getTexCoords=function(){return this._texCoords},n._setTexCoords=function(t){this._texCoords._view[0]=t.u,this._texCoords._view[1]=t.v},cc.js.getset(n,"vertices",n._getVertices,n._setVertices),cc.js.getset(n,"colors",n._getColor,n._setColor),cc.js.getset(n,"texCoords",n._getTexCoords,n._setTexCoords),cc.V2F_C4B_T2F_Triangle=function(t,e,i,n,r){this._arrayBuffer=n||new ArrayBuffer(cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT),this._offset=r||0;var s=this._arrayBuffer,o=this._offset,a=cc.V2F_C4B_T2F.BYTES_PER_ELEMENT;this._a=t?new cc.V2F_C4B_T2F(t.vertices,t.colors,t.texCoords,s,o):new cc.V2F_C4B_T2F(null,null,null,s,o),o+=a,this._b=e?new cc.V2F_C4B_T2F(e.vertices,e.colors,e.texCoords,s,o):new cc.V2F_C4B_T2F(null,null,null,s,o),o+=a,this._c=i?new cc.V2F_C4B_T2F(i.vertices,i.colors,i.texCoords,s,o):new cc.V2F_C4B_T2F(null,null,null,s,o)},cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT=60,(n=cc.V2F_C4B_T2F_Triangle.prototype)._getA=function(){return this._a},n._setA=function(t){var e=this._a;e.vertices=t.vertices,e.colors=t.colors,e.texCoords=t.texCoords},n._getB=function(){return this._b},n._setB=function(t){var e=this._b;e.vertices=t.vertices,e.colors=t.colors,e.texCoords=t.texCoords},n._getC=function(){return this._c},n._setC=function(t){var e=this._c;e.vertices=t.vertices,e.colors=t.colors,e.texCoords=t.texCoords},cc.js.getset(n,"a",n._getA,n._setA),cc.js.getset(n,"b",n._getB,n._setB),cc.js.getset(n,"c",n._getC,n._setC)}),{}],217:[(function(t,e,i){function n(){}var r=t("../platform/js");r.setClassName("cc.ValueType",n);var s=n.prototype;s.toString=function(){return""+{}},cc.ValueType=n,e.exports=n}),{"../platform/js":177}],218:[(function(t,e,i){function n(t,e){t&&"object"==typeof t&&(e=t.y,t=t.x),this.x=t||0,this.y=e||0}var r=t("./CCValueType"),s=t("../platform/js"),o=t("../platform/CCClass");s.extend(n,r),o.fastDefine("cc.Vec2",n,{x:0,y:0});var a=n.prototype;a.clone=function(){return new n(this.x,this.y)},a.set=function(t){return this.x=t.x,this.y=t.y,this},a.equals=function(t){return t&&this.x===t.x&&this.y===t.y},a.toString=function(){return"("+this.x.toFixed(2)+", "+this.y.toFixed(2)+")"},a.lerp=function(t,e,i){i=i||new n;var r=this.x,s=this.y;return i.x=r+(t.x-r)*e,i.y=s+(t.y-s)*e,i},a.addSelf=function(t){return this.x+=t.x,this.y+=t.y,this},a.add=function(t,e){return e=e||new n,e.x=this.x+t.x,e.y=this.y+t.y,e},a.subSelf=function(t){return this.x-=t.x,this.y-=t.y,this},a.sub=function(t,e){return e=e||new n,e.x=this.x-t.x,e.y=this.y-t.y,e},a.mulSelf=function(t){return this.x*=t,this.y*=t,this},a.mul=function(t,e){return e=e||new n,e.x=this.x*t,e.y=this.y*t,e},a.scaleSelf=function(t){return this.x*=t.x,this.y*=t.y,this},a.scale=function(t,e){return e=e||new n,e.x=this.x*t.x,e.y=this.y*t.y,e},a.divSelf=function(t){return this.x/=t,this.y/=t,this},a.div=function(t,e){return e=e||new n,e.x=this.x/t,e.y=this.y/t,e},a.negSelf=function(){return this.x=-this.x,this.y=-this.y,this},a.neg=function(t){return t=t||new n,t.x=-this.x,t.y=-this.y,t},a.dot=function(t){return this.x*t.x+this.y*t.y},a.cross=function(t){return this.y*t.x-this.x*t.y},a.mag=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},a.magSqr=function(){return this.x*this.x+this.y*this.y},a.normalizeSelf=function(){var t=this.x*this.x+this.y*this.y;if(1===t)return this;if(0===t)return console.warn("Can't normalize zero vector"),this;var e=1/Math.sqrt(t);return this.x*=e,this.y*=e,this},a.normalize=function(t){return t=t||new n,t.x=this.x,t.y=this.y,t.normalizeSelf(),t},a.angle=function(t){var e=this.magSqr(),i=t.magSqr();if(0===e||0===i)return console.warn("Can't get angle between zero vector"),0;var n=this.dot(t)/Math.sqrt(e*i);return n=cc.clampf(n,-1,1),Math.acos(n)},a.signAngle=function(t){return Math.atan2(this.y,this.x)-Math.atan2(t.y,t.x)},a.rotate=function(t,e){return e=e||new n,e.x=this.x,e.y=this.y,e.rotateSelf(t)},a.rotateSelf=function(t){var e=Math.sin(t),i=Math.cos(t),n=this.x;return this.x=i*n-e*this.y,this.y=e*n+i*this.y,this},s.get(n,"ONE",(function(){return new n(1,1)})),s.get(n,"ZERO",(function(){return new n(0,0)})),s.get(n,"UP",(function(){return new n(0,1)})),s.get(n,"RIGHT",(function(){return new n(1,0)})),cc.Vec2=n,cc.v2=function(t,e){return new n(t,e)},cc.p=cc.v2,cc.pointEqualToPoint=function(t,e){return t&&e&&t.x===e.x&&t.y===e.y},e.exports=cc.Vec2}),{"../platform/CCClass":156,"../platform/js":177,"./CCValueType":217}],219:[(function(t,e,i){t("./CCValueType"),t("./CCVec2"),t("./CCPointExtension"),t("./CCSize"),t("./CCRect"),t("./CCColor"),t("./CCTypes"),t("./CCAffineTransform"),t("./CCTypesWebGL")}),{"./CCAffineTransform":210,"./CCColor":211,"./CCPointExtension":212,"./CCRect":213,"./CCSize":214,"./CCTypes":215,"./CCTypesWebGL":216,"./CCValueType":217,"./CCVec2":218}],220:[(function(t,e,i){var n=t("../platform/utils"),r=t("../platform/CCSys"),s=t("../event-manager");_ccsg.VideoPlayer=_ccsg.Node.extend({ctor:function(){_ccsg.Node.prototype.ctor.call(this),this._EventList={}},_createRenderCmd:function(){return new _ccsg.VideoPlayer.RenderCmd(this)},setURL:function(t){this._renderCmd.updateURL(t)},getURL:function(){return this._renderCmd._url},play:function(){this._renderCmd.play()},pause:function(){this._renderCmd.pause()},_resume:function(){this._renderCmd.play()},stop:function(){this._renderCmd.stop()},seekTo:function(t){this._renderCmd.seekTo(t)},isPlaying:function(){return this._renderCmd.isPlaying()},duration:function(){return this._renderCmd.duration()||-1},currentTime:function(){return this._renderCmd.currentTime()||-1},createDomElementIfNeeded:function(){this._renderCmd._video||this._renderCmd.createDom()},setKeepAspectRatioEnabled:function(){cc.logID(7700)},isKeepAspectRatioEnabled:function(){return!0},setFullScreenEnabled:function(t){var e=this._renderCmd._video;e&&(t?cc.screen.requestFullScreen(e):cc.screen.exitFullScreen(e))},isFullScreenEnabled:function(){cc.logID(7701)},setEventListener:function(t,e){this._EventList[t]=e},removeEventListener:function(t){this._EventList[t]=null},_dispatchEvent:function(t){var e=this._EventList[t];e&&e.call(this,this,this._renderCmd._video.src)},onPlayEvent:function(){this._EventList[_ccsg.VideoPlayer.EventType.PLAYING].call(this,this,this._renderCmd._video.src)},setContentSize:function(t,e){void 0!==t.width&&void 0!==t.height&&(e=t.height,t=t.width),_ccsg.Node.prototype.setContentSize.call(this,t,e),this._renderCmd.updateSize(t,e)},onEnter:function(){_ccsg.Node.prototype.onEnter.call(this);var t=_ccsg.VideoPlayer.elements;-1===t.indexOf(this)&&t.push(this)},cleanup:function(){this._super(),this._renderCmd.removeDom()},onExit:function(){_ccsg.Node.prototype.onExit.call(this);var t=_ccsg.VideoPlayer.elements,e=t.indexOf(this);-1!==e&&t.splice(e,1)},setVisible:function(t){_ccsg.Node.prototype.setVisible.call(this,t),this._renderCmd.updateVisibility()}}),_ccsg.VideoPlayer.elements=[],_ccsg.VideoPlayer.pauseElements=[],s.addCustomListener(cc.game.EVENT_HIDE,(function(){for(var t,e=_ccsg.VideoPlayer.elements,i=0;i<e.length;i++)t=e[i],e[i]._playing&&(t.pause(),_ccsg.VideoPlayer.pauseElements.push(t))})),cc.game.on(cc.game.EVENT_SHOW,(function(){for(var t=_ccsg.VideoPlayer.pauseElements,e=t.pop();e;)e.play(),e=t.pop()})),_ccsg.VideoPlayer.EventType={PLAYING:0,PAUSED:1,STOPPED:2,COMPLETED:3,META_LOADED:4,CLICKED:5,READY_TO_PLAY:6},(function(t){t._polyfill={devicePixelRatio:!1,event:"canplay",canPlayType:[]},(function(){var e=document.createElement("video");r.platform!==r.WECHAT_GAME&&r.platform!==r.QQ_PLAY&&(e.canPlayType("video/ogg")&&(t._polyfill.canPlayType.push(".ogg"),t._polyfill.canPlayType.push(".ogv")),e.canPlayType("video/mp4")&&t._polyfill.canPlayType.push(".mp4"),e.canPlayType("video/webm")&&t._polyfill.canPlayType.push(".webm"))})(),cc.sys.browserType===cc.sys.BROWSER_TYPE_FIREFOX&&(t._polyfill.autoplayAfterOperation=!0),cc.sys.OS_ANDROID!==cc.sys.os||cc.sys.browserType!==cc.sys.BROWSER_TYPE_SOUGOU&&cc.sys.browserType!==cc.sys.BROWSER_TYPE_360||(t._polyfill.zoomInvalid=!0);var e=document.createElement("style");e.innerHTML=".cocosVideo:-moz-full-screen{transform:matrix(1,0,0,1,0,0) !important;}.cocosVideo:full-screen{transform:matrix(1,0,0,1,0,0) !important;}.cocosVideo:-webkit-full-screen{transform:matrix(1,0,0,1,0,0) !important;}",document.head.appendChild(e)})(_ccsg.VideoPlayer),(function(t){_ccsg.VideoPlayer.RenderCmd=function(t){this._rootCtor(t),this._video=null,this._url="",this._played=!1,this._playing=!1,this._ignorePause=!1};var e=_ccsg.VideoPlayer.RenderCmd.prototype=Object.create(_ccsg.Node.CanvasRenderCmd.prototype);e.constructor=_ccsg.VideoPlayer.RenderCmd,e.transform=function(t,e){this.originTransform(t,e),this.updateMatrix()},e.updateMatrix=function(){if(this._video){var e=this._node,i=cc.view._scaleX,n=cc.view._scaleY,r=cc.view._devicePixelRatio,s=this._worldTransform;i/=r,n/=r;var o=cc.game.container,a=s.a*i,c=s.b,h=s.c,l=s.d*n,_=o&&o.style.paddingLeft&&parseInt(o.style.paddingLeft),u=o&&o.style.paddingBottom&&parseInt(o.style.paddingBottom),d=s.tx*i+_,m=s.ty*n+u;t.zoomInvalid&&(this.updateSize(e._contentSize.width*a,e._contentSize.height*l),a=1,l=1);var f="matrix("+a+","+-c+","+-h+","+l+","+d+","+-m+")";this._video.style.transform=f,this._video.style["-webkit-transform"]=f,this._video.style["transform-origin"]="0px 100% 0px",this._video.style["-webkit-transform-origin"]="0px 100% 0px"}},e.updateURL=function(e){cc.loader.md5Pipe&&(e=cc.loader.md5Pipe.transformURL(e));var i,n,r,s=this._node;if(this._url!==e){this._url=e,cc.loader.resPath&&!/^http/.test(e)&&(e=cc.path.join(cc.loader.resPath,e)),this.removeDom(),this.createDom(),this.bindEvent(),n=this._video;var o=function(){this._loaded||(this._loaded=!0,s.setContentSize(s._contentSize.width,s._contentSize.height),n.currentTime=0,s._dispatchEvent(_ccsg.VideoPlayer.EventType.READY_TO_PLAY),this.updateVisibility(),this.updateMatrix())}.bind(this);n.oncanplay=o,n.style.visibility="hidden",this._loaded=!1,this._played=!1,this._playing=!1,(i=document.createElement("source")).src=e,n.appendChild(i),r=cc.path.extname(e);for(var a=0;a<t.canPlayType.length;a++)r!==t.canPlayType[a]&&((i=document.createElement("source")).src=e.replace(r,t.canPlayType[a]),n.appendChild(i))}},e.bindEvent=function(){var t=this._node,e=this._video,i=this;e.onloadedmetadata=function(){t._dispatchEvent(_ccsg.VideoPlayer.EventType.META_LOADED)},e.addEventListener("ended",function(){i._video===e&&(this._playing=!1,t._dispatchEvent(_ccsg.VideoPlayer.EventType.COMPLETED))}.bind(this)),e.addEventListener("play",(function(){i._video===e&&t._dispatchEvent(_ccsg.VideoPlayer.EventType.PLAYING)})),e.addEventListener("pause",(function(){i._ignorePause||i._video!==e||t._dispatchEvent(_ccsg.VideoPlayer.EventType.PAUSED)})),e.addEventListener("click",(function(){t._dispatchEvent(_ccsg.VideoPlayer.EventType.CLICKED)}))},e.updateVisibility=function(){var t=this._node;if(this._video){var e=this._video;t.visible?e.style.visibility="visible":(e.style.visibility="hidden",e.pause(),this._playing=!1)}},e.createDom=function(){var t=document.createElement("video");t.style.position="absolute",t.style.bottom="0px",t.style.left="0px",t.className="cocosVideo",t.setAttribute("preload",!0),t.setAttribute("webkit-playsinline",""),t.setAttribute("playsinline",""),this._video=t,cc.game.container.appendChild(t)},e.removeDom=function(){var t=this._video;if(t){n.contains(cc.game.container,t)&&cc.game.container.removeChild(t)}this._video=null,this._url=""},e.updateSize=function(t,e){var i=this._video;i&&(i.style.width=t+"px",i.style.height=e+"px")},e.play=function(){var t=this._video;if(t&&this._node.isVisible()&&(this._played=!0,!this._playing))if(_ccsg.VideoPlayer._polyfill.autoplayAfterOperation){var e=this;setTimeout((function(){t.play(),e._playing=!0}),20)}else t.play(),this._playing=!0},e.pause=function(){var t=this._video;this._playing&&(this._playing=!1,t&&t.pause())},e.stop=function(){var t=this._video;if(t&&this._node.isVisible()){this._ignorePause=!0,t.pause();var e=this._node;setTimeout(function(){e._dispatchEvent(_ccsg.VideoPlayer.EventType.STOPPED),this._ignorePause=!1}.bind(this),0),t.currentTime=0,this._playing=!1}},e.seekTo=function(e){var i=this._video;if(i){if(this._loaded)i.currentTime=e;else{var n=function(){i.currentTime=e,i.removeEventListener(t.event,n)};i.addEventListener(t.event,n)}_ccsg.VideoPlayer._polyfill.autoplayAfterOperation&&this.isPlaying()&&setTimeout((function(){i.play()}),20)}},e.isPlaying=function(){var t=this._video;return _ccsg.VideoPlayer._polyfill.autoplayAfterOperation&&this._playing&&setTimeout((function(){t.play()}),20),this._playing},e.duration=function(){var t=this._video,e=-1;return t?((e=t.duration)<=0&&cc.logID(7702),e):e},e.currentTime=function(){var t=this._video;return t?t.currentTime:-1}})(_ccsg.VideoPlayer._polyfill)}),{"../event-manager":90,"../platform/CCSys":165,"../platform/utils":181}],221:[(function(t,e,i){cc.js}),{}],222:[(function(t,e,i){t("./core/CCGame"),t("./actions"),t("./core/base-nodes/CCSGNode"),t("./core/base-nodes/CCSGNodeBaseRenderCmd"),t("./core/base-nodes/CCSGNodeCanvasRenderCmd"),t("./core/base-nodes/CCSGNodeWebGLRenderCmd"),t("./core/scenes/CCSGScene"),t("./core/CCConfiguration"),t("./core/sprites/CCSGSprite"),t("./core/sprites/CCSGSpriteCanvasRenderCmd"),t("./core/sprites/CCSGSpriteWebGLRenderCmd"),t("./core/sprites/CCScale9Sprite"),t("./core/sprites/CCScale9SpriteCanvasRenderCmd"),t("./core/sprites/CCScale9SpriteWebGLRenderCmd"),t("./core/sprites/CCSpriteBatchNode"),t("./render-texture/CCRenderTexture"),t("./render-texture/CCRenderTextureCanvasRenderCmd"),t("./render-texture/CCRenderTextureWebGLRenderCmd")}),{"./actions":11,"./core/CCConfiguration":29,"./core/CCGame":36,"./core/base-nodes/CCSGNode":52,"./core/base-nodes/CCSGNodeBaseRenderCmd":53,"./core/base-nodes/CCSGNodeCanvasRenderCmd":54,"./core/base-nodes/CCSGNodeWebGLRenderCmd":55,"./core/scenes/CCSGScene":187,"./core/sprites/CCSGSprite":188,"./core/sprites/CCSGSpriteCanvasRenderCmd":189,"./core/sprites/CCSGSpriteWebGLRenderCmd":190,"./core/sprites/CCScale9Sprite":191,"./core/sprites/CCScale9SpriteCanvasRenderCmd":192,"./core/sprites/CCScale9SpriteWebGLRenderCmd":193,"./core/sprites/CCSpriteBatchNode":194,"./render-texture/CCRenderTexture":1,"./render-texture/CCRenderTextureCanvasRenderCmd":1,"./render-texture/CCRenderTextureWebGLRenderCmd":1}],223:[(function(t,e,i){cc.math.AABB=function(t,e){this.min=t||new cc.math.Vec3,this.max=e||new cc.math.Vec3},cc.math.AABB.prototype.containsPoint=function(t){return t.x>=this.min.x&&t.x<=this.max.x&&t.y>=this.min.y&&t.y<=this.max.y&&t.z>=this.min.z&&t.z<=this.max.z},cc.math.AABB.containsPoint=function(t,e){return t.x>=e.min.x&&t.x<=e.max.x&&t.y>=e.min.y&&t.y<=e.max.y&&t.z>=e.min.z&&t.z<=e.max.z},cc.math.AABB.prototype.assignFrom=function(t){this.min.assignFrom(t.min),this.max.assignFrom(t.max)},cc.math.AABB.assign=function(t,e){return t.min.assignFrom(e.min),t.max.assignFrom(e.max),t}}),{}],224:[(function(t,e,i){cc.math.Matrix4Stack=function(t,e){this.top=t,this.stack=e||[],this.lastUpdated=0};var n=cc.math.Matrix4Stack.prototype;n.initialize=function(){this.stack.length=0,this.top=null},n.push=function(t){t=t||this.top,this.stack.push(this.top),this.top=new cc.math.Matrix4(t),this.update()},n.pop=function(){this.top=this.stack.pop(),this.update()},n.update=function(){this.lastUpdated++},n.release=function(){this.stack=null,this.top=null,this._matrixPool=null},n._getFromPool=function(t){var e=this._matrixPool;if(0===e.length)return new cc.math.Matrix4(t);var i=e.pop();return i.assignFrom(t),i},n._putInPool=function(t){this._matrixPool.push(t)}}),{}],225:[(function(t,e,i){var n=cc.math;n.KM_GL_MODELVIEW=5888,n.KM_GL_PROJECTION=5889,n.KM_GL_TEXTURE=5890,n.modelview_matrix_stack=new n.Matrix4Stack,n.projection_matrix_stack=new n.Matrix4Stack,n.texture_matrix_stack=new n.Matrix4Stack,cc.current_stack=null;var r=!1;(function(){if(!r){var t=new n.Matrix4;n.modelview_matrix_stack.initialize(),n.projection_matrix_stack.initialize(),n.texture_matrix_stack.initialize(),cc.current_stack=n.modelview_matrix_stack,r=!0,t.identity(),n.modelview_matrix_stack.push(t),n.projection_matrix_stack.push(t),n.texture_matrix_stack.push(t)}})(),n.glFreeAll=function(){n.modelview_matrix_stack.release(),n.modelview_matrix_stack=null,n.projection_matrix_stack.release(),n.projection_matrix_stack=null,n.texture_matrix_stack.release(),n.texture_matrix_stack=null,r=!1,cc.current_stack=null},n.glPushMatrix=function(){cc.current_stack.push(cc.current_stack.top),cc.current_stack.update()},n.glPushMatrixWitMat4=function(t){cc.current_stack.stack.push(cc.current_stack.top),t.assignFrom(cc.current_stack.top),cc.current_stack.top=t,cc.current_stack.update()},n.glPopMatrix=function(){cc.current_stack.top=cc.current_stack.stack.pop(),cc.current_stack.update()},n.glMatrixMode=function(t){switch(t){case n.KM_GL_MODELVIEW:cc.current_stack=n.modelview_matrix_stack;break;case n.KM_GL_PROJECTION:cc.current_stack=n.projection_matrix_stack;break;case n.KM_GL_TEXTURE:cc.current_stack=n.texture_matrix_stack;break;default:throw new Error("Invalid matrix mode specified")}},n.glLoadIdentity=function(){cc.current_stack.top.identity(),cc.current_stack.update()},n.glLoadMatrix=function(t){cc.current_stack.top.assignFrom(t),cc.current_stack.update()},n.glMultMatrix=function(t){cc.current_stack.top.multiply(t),cc.current_stack.update()};var s=new n.Matrix4;n.glTranslatef=function(t,e,i){var r=n.Matrix4.createByTranslation(t,e,i,s);cc.current_stack.top.multiply(r),cc.current_stack.update()};var o=new n.Vec3;n.glRotatef=function(t,e,i,r){o.fill(e,i,r);var a=n.Matrix4.createByAxisAndAngle(o,cc.degreesToRadians(t),s);cc.current_stack.top.multiply(a),cc.current_stack.update()},n.glScalef=function(t,e,i){var r=n.Matrix4.createByScale(t,e,i,s);cc.current_stack.top.multiply(r),cc.current_stack.update()},n.glGetMatrix=function(t,e){switch(t){case n.KM_GL_MODELVIEW:e.assignFrom(n.modelview_matrix_stack.top);break;case n.KM_GL_PROJECTION:e.assignFrom(n.projection_matrix_stack.top);break;case n.KM_GL_TEXTURE:e.assignFrom(n.texture_matrix_stack.top);break;default:throw new Error("Invalid matrix mode specified")}}}),{}],226:[(function(t,e,i){t("./utility"),t("./vec2"),t("./vec3"),t("./vec4"),t("./ray2"),t("./mat3"),t("./mat4"),t("./plane"),t("./quaternion"),t("./aabb"),t("./gl/mat4stack"),t("./gl/matrix")}),{"./aabb":223,"./gl/mat4stack":224,"./gl/matrix":225,"./mat3":227,"./mat4":228,"./plane":229,"./quaternion":230,"./ray2":231,"./utility":232,"./vec2":233,"./vec3":234,"./vec4":235}],227:[(function(t,e,i){window.Uint16Array=window.Uint16Array||window.Array,window.Float32Array=window.Float32Array||window.Array,cc.math.Matrix3=function(t){t&&t.mat?this.mat=new Float32Array(t.mat):this.mat=new Float32Array(9)};var n=cc.math.Matrix3.prototype;n.fill=function(t){var e=this.mat,i=t.mat;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],this},n.adjugate=function(){var t=this.mat,e=t[0],i=t[1],n=t[2],r=t[3],s=t[4],o=t[5],a=t[6],c=t[7],h=t[8];return t[0]=s*h-o*c,t[1]=n*c-i*h,t[2]=i*o-n*s,t[3]=o*a-r*h,t[4]=e*h-n*a,t[5]=n*r-e*o,t[6]=r*c-s*a,t[8]=e*s-i*r,this},n.identity=function(){var t=this.mat;return t[1]=t[2]=t[3]=t[5]=t[6]=t[7]=0,t[0]=t[4]=t[8]=1,this};var r=new cc.math.Matrix3;n.inverse=function(t){if(0===t)return this;r.assignFrom(this);var e=1/t;return this.adjugate(),this.multiplyScalar(e),this},n.isIdentity=function(){var t=this.mat;return 1===t[0]&&0===t[1]&&0===t[2]&&0===t[3]&&1===t[4]&&0===t[5]&&0===t[6]&&0===t[7]&&1===t[8]},n.transpose=function(){var t=this.mat,e=t[1],i=t[2],n=t[3],r=t[5],s=t[6],o=t[7];return t[1]=n,t[2]=s,t[3]=e,t[5]=o,t[6]=i,t[7]=r,this},n.determinant=function(){var t=this.mat,e=t[0]*t[4]*t[8]+t[1]*t[5]*t[6]+t[2]*t[3]*t[7];return e-=t[2]*t[4]*t[6]+t[0]*t[5]*t[7]+t[1]*t[3]*t[8]},n.multiply=function(t){var e=this.mat,i=t.mat,n=e[0],r=e[1],s=e[2],o=e[3],a=e[4],c=e[5],h=e[6],l=e[7],_=e[8],u=i[0],d=i[1],m=i[2],f=i[3],p=i[4],g=i[5],v=i[6],y=i[7],x=i[8];return e[0]=n*u+o*d+h*m,e[1]=r*u+a*d+l*m,e[2]=s*u+c*d+_*m,e[3]=s*u+c*d+_*m,e[4]=r*f+a*p+l*g,e[5]=s*f+c*p+_*g,e[6]=n*v+o*y+h*x,e[7]=r*v+a*y+l*x,e[8]=s*v+c*y+_*x,this},n.multiplyScalar=function(t){var e=this.mat;return e[0]*=t,e[1]*=t,e[2]*=t,e[3]*=t,e[4]*=t,e[5]*=t,e[6]*=t,e[7]*=t,e[8]*=t,this},cc.math.Matrix3.rotationAxisAngle=function(t,e){var i=Math.cos(e),n=Math.sin(e),r=new cc.math.Matrix3,s=r.mat;return s[0]=i+t.x*t.x*(1-i),s[1]=t.z*n+t.y*t.x*(1-i),s[2]=-t.y*n+t.z*t.x*(1-i),s[3]=-t.z*n+t.x*t.y*(1-i),s[4]=i+t.y*t.y*(1-i),s[5]=t.x*n+t.z*t.y*(1-i),s[6]=t.y*n+t.x*t.z*(1-i),s[7]=-t.x*n+t.y*t.z*(1-i),s[8]=i+t.z*t.z*(1-i),r},n.assignFrom=function(t){if(this===t)return cc.logID(7900),this;var e=this.mat,i=t.mat;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],this},n.equals=function(t){if(this===t)return!0;for(var e=cc.math.EPSILON,i=this.mat,n=t.mat,r=0;r<9;++r)if(!(i[r]+e>n[r]&&i[r]-e<n[r]))return!1;return!0},cc.math.Matrix3.createByRotationX=function(t){var e=new cc.math.Matrix3,i=e.mat;return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=Math.cos(t),i[5]=Math.sin(t),i[6]=0,i[7]=-Math.sin(t),i[8]=Math.cos(t),e},cc.math.Matrix3.createByRotationY=function(t){var e=new cc.math.Matrix3,i=e.mat;return i[0]=Math.cos(t),i[1]=0,i[2]=-Math.sin(t),i[3]=0,i[4]=1,i[5]=0,i[6]=Math.sin(t),i[7]=0,i[8]=Math.cos(t),e},cc.math.Matrix3.createByRotationZ=function(t){var e=new cc.math.Matrix3,i=e.mat;return i[0]=Math.cos(t),i[1]=-Math.sin(t),i[2]=0,i[3]=Math.sin(t),i[4]=Math.cos(t),i[5]=0,i[6]=0,i[7]=0,i[8]=1,e},cc.math.Matrix3.createByRotation=function(t){var e=new cc.math.Matrix3,i=e.mat;return i[0]=Math.cos(t),i[1]=Math.sin(t),i[2]=0,i[3]=-Math.sin(t),i[4]=Math.cos(t),i[5]=0,i[6]=0,i[7]=0,i[8]=1,e},cc.math.Matrix3.createByScale=function(t,e){var i=new cc.math.Matrix3;return i.identity(),i.mat[0]=t,i.mat[4]=e,i},cc.math.Matrix3.createByTranslation=function(t,e){var i=new cc.math.Matrix3;return i.identity(),i.mat[6]=t,i.mat[7]=e,i},cc.math.Matrix3.createByQuaternion=function(t){if(!t)return null;var e=new cc.math.Matrix3,i=e.mat;return i[0]=1-2*(t.y*t.y+t.z*t.z),i[1]=2*(t.x*t.y-t.w*t.z),i[2]=2*(t.x*t.z+t.w*t.y),i[3]=2*(t.x*t.y+t.w*t.z),i[4]=1-2*(t.x*t.x+t.z*t.z),i[5]=2*(t.y*t.z-t.w*t.x),i[6]=2*(t.x*t.z-t.w*t.y),i[7]=2*(t.y*t.z+t.w*t.x),i[8]=1-2*(t.x*t.x+t.y*t.y),e},n.rotationToAxisAngle=function(){return cc.math.Quaternion.rotationMatrix(this).toAxisAndAngle()}}),{}],228:[(function(t,e,i){cc.math.Matrix4=function(t){t&&t.mat?this.mat=new Float32Array(t.mat):this.mat=new Float32Array(16)};var n=cc.math.Matrix4.prototype;n.fill=function(t){for(var e=this.mat,i=0;i<16;i++)e[i]=t[i];return this},cc.math.mat4Identity=function(t){var e=t.mat;return e[1]=e[2]=e[3]=e[4]=e[6]=e[7]=e[8]=e[9]=e[11]=e[12]=e[13]=e[14]=0,e[0]=e[5]=e[10]=e[15]=1,t},n.identity=function(){var t=this.mat;return t[1]=t[2]=t[3]=t[4]=t[6]=t[7]=t[8]=t[9]=t[11]=t[12]=t[13]=t[14]=0,t[0]=t[5]=t[10]=t[15]=1,this},n.get=function(t,e){return this.mat[t+4*e]},n.set=function(t,e,i){this.mat[t+4*e]=i},n.swap=function(t,e,i,n){var r=this.mat,s=r[t+4*e];r[t+4*e]=r[i+4*n],r[i+4*n]=s},cc.math.Matrix4._gaussj=function(t,e){var i,n,r,s,o,a,c,h,l,_=0,u=0,d=[0,0,0,0],m=[0,0,0,0],f=[0,0,0,0];for(i=0;i<4;i++){for(c=0,n=0;n<4;n++)if(1!==f[n])for(r=0;r<4;r++)0===f[r]&&(a=Math.abs(t.get(n,r)))>=c&&(c=a,u=n,_=r);if(++f[_],u!==_){for(s=0;s<4;s++)t.swap(u,s,_,s);for(s=0;s<4;s++)e.swap(u,s,_,s)}if(m[i]=u,d[i]=_,0===t.get(_,_))return!1;for(l=1/t.get(_,_),t.set(_,_,1),s=0;s<4;s++)t.set(_,s,t.get(_,s)*l);for(s=0;s<4;s++)e.set(_,s,e.get(_,s)*l);for(o=0;o<4;o++)if(o!==_){for(h=t.get(o,_),t.set(o,_,0),s=0;s<4;s++)t.set(o,s,t.get(o,s)-t.get(_,s)*h);for(s=0;s<4;s++)e.set(o,s,t.get(o,s)-e.get(_,s)*h)}}for(s=3;s>=0;s--)if(m[s]!==d[s])for(r=0;r<4;r++)t.swap(r,m[s],r,d[s]);return!0};var r=(new cc.math.Matrix4).identity();cc.math.mat4Inverse=function(t,e){var i=new cc.math.Matrix4(e),n=new cc.math.Matrix4(r);return!1===cc.math.Matrix4._gaussj(i,n)?null:(t.assignFrom(i),t)},n.inverse=function(){var t=new cc.math.Matrix4(this),e=new cc.math.Matrix4(r);return!1===cc.math.Matrix4._gaussj(t,e)?null:t},n.isIdentity=function(){var t=this.mat;return 1===t[0]&&0===t[1]&&0===t[2]&&0===t[3]&&0===t[4]&&1===t[5]&&0===t[6]&&0===t[7]&&0===t[8]&&0===t[9]&&1===t[10]&&0===t[11]&&0===t[12]&&0===t[13]&&0===t[14]&&1===t[15]},n.transpose=function(){var t=this.mat,e=t[1],i=t[2],n=t[3],r=t[4],s=t[6],o=t[7],a=t[8],c=t[9],h=t[11],l=t[12],_=t[13],u=t[14];return t[1]=r,t[2]=a,t[3]=l,t[4]=e,t[6]=c,t[7]=_,t[8]=i,t[9]=s,t[11]=u,t[12]=n,t[13]=o,t[14]=h,this},cc.math.mat4Multiply=function(t,e,i){var n=t.mat,r=e.mat,s=i.mat,o=r[0],a=r[1],c=r[2],h=r[3],l=r[4],_=r[5],u=r[6],d=r[7],m=r[8],f=r[9],p=r[10],g=r[11],v=r[12],y=r[13],x=r[14],C=r[15],A=s[0],T=s[1],b=s[2],w=s[3],S=s[4],E=s[5],I=s[6],R=s[7],P=s[8],B=s[9],L=s[10],O=s[11],D=s[12],N=s[13],M=s[14],F=s[15];return n[0]=A*o+T*l+b*m+w*v,n[1]=A*a+T*_+b*f+w*y,n[2]=A*c+T*u+b*p+w*x,n[3]=A*h+T*d+b*g+w*C,n[4]=S*o+E*l+I*m+R*v,n[5]=S*a+E*_+I*f+R*y,n[6]=S*c+E*u+I*p+R*x,n[7]=S*h+E*d+I*g+R*C,n[8]=P*o+B*l+L*m+O*v,n[9]=P*a+B*_+L*f+O*y,n[10]=P*c+B*u+L*p+O*x,n[11]=P*h+B*d+L*g+O*C,n[12]=D*o+N*l+M*m+F*v,n[13]=D*a+N*_+M*f+F*y,n[14]=D*c+N*u+M*p+F*x,n[15]=D*h+N*d+M*g+F*C,t},n.multiply=function(t){var e=this.mat,i=t.mat,n=e[0],r=e[1],s=e[2],o=e[3],a=e[4],c=e[5],h=e[6],l=e[7],_=e[8],u=e[9],d=e[10],m=e[11],f=e[12],p=e[13],g=e[14],v=e[15],y=i[0],x=i[1],C=i[2],A=i[3],T=i[4],b=i[5],w=i[6],S=i[7],E=i[8],I=i[9],R=i[10],P=i[11],B=i[12],L=i[13],O=i[14],D=i[15];return e[0]=y*n+x*a+C*_+A*f,e[1]=y*r+x*c+C*u+A*p,e[2]=y*s+x*h+C*d+A*g,e[3]=y*o+x*l+C*m+A*v,e[4]=T*n+b*a+w*_+S*f,e[5]=T*r+b*c+w*u+S*p,e[6]=T*s+b*h+w*d+S*g,e[7]=T*o+b*l+w*m+S*v,e[8]=E*n+I*a+R*_+P*f,e[9]=E*r+I*c+R*u+P*p,e[10]=E*s+I*h+R*d+P*g,e[11]=E*o+I*l+R*m+P*v,e[12]=B*n+L*a+O*_+D*f,e[13]=B*r+L*c+O*u+D*p,e[14]=B*s+L*h+O*d+D*g,e[15]=B*o+L*l+O*m+D*v,this},cc.math.getMat4MultiplyValue=function(t,e){var i=t.mat,n=e.mat,r=new Float32Array(16);return r[0]=i[0]*n[0]+i[4]*n[1]+i[8]*n[2]+i[12]*n[3],r[1]=i[1]*n[0]+i[5]*n[1]+i[9]*n[2]+i[13]*n[3],r[2]=i[2]*n[0]+i[6]*n[1]+i[10]*n[2]+i[14]*n[3],r[3]=i[3]*n[0]+i[7]*n[1]+i[11]*n[2]+i[15]*n[3],r[4]=i[0]*n[4]+i[4]*n[5]+i[8]*n[6]+i[12]*n[7],r[5]=i[1]*n[4]+i[5]*n[5]+i[9]*n[6]+i[13]*n[7],r[6]=i[2]*n[4]+i[6]*n[5]+i[10]*n[6]+i[14]*n[7],r[7]=i[3]*n[4]+i[7]*n[5]+i[11]*n[6]+i[15]*n[7],r[8]=i[0]*n[8]+i[4]*n[9]+i[8]*n[10]+i[12]*n[11],r[9]=i[1]*n[8]+i[5]*n[9]+i[9]*n[10]+i[13]*n[11],r[10]=i[2]*n[8]+i[6]*n[9]+i[10]*n[10]+i[14]*n[11],r[11]=i[3]*n[8]+i[7]*n[9]+i[11]*n[10]+i[15]*n[11],r[12]=i[0]*n[12]+i[4]*n[13]+i[8]*n[14]+i[12]*n[15],r[13]=i[1]*n[12]+i[5]*n[13]+i[9]*n[14]+i[13]*n[15],r[14]=i[2]*n[12]+i[6]*n[13]+i[10]*n[14]+i[14]*n[15],r[15]=i[3]*n[12]+i[7]*n[13]+i[11]*n[14]+i[15]*n[15],r},cc.math.mat4Assign=function(t,e){if(t===e)return cc.logID(7901),t;var i=t.mat,n=e.mat;return i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i[4]=n[4],i[5]=n[5],i[6]=n[6],i[7]=n[7],i[8]=n[8],i[9]=n[9],i[10]=n[10],i[11]=n[11],i[12]=n[12],i[13]=n[13],i[14]=n[14],i[15]=n[15],t},n.assignFrom=function(t){if(this===t)return cc.logID(7902),this;var e=this.mat,i=t.mat;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],this},n.equals=function(t){if(this===t)return cc.logID(7903),!0;for(var e=this.mat,i=t.mat,n=cc.math.EPSILON,r=0;r<16;r++)if(!(e[r]+n>i[r]&&e[r]-n<i[r]))return!1;return!0},cc.math.Matrix4.createByRotationX=function(t,e){var i=(e=e||new cc.math.Matrix4).mat;return i[0]=1,i[3]=i[2]=i[1]=0,i[4]=0,i[5]=Math.cos(t),i[6]=Math.sin(t),i[7]=0,i[8]=0,i[9]=-Math.sin(t),i[10]=Math.cos(t),i[11]=0,i[14]=i[13]=i[12]=0,i[15]=1,e},cc.math.Matrix4.createByRotationY=function(t,e){var i=(e=e||new cc.math.Matrix4).mat;return i[0]=Math.cos(t),i[1]=0,i[2]=-Math.sin(t),i[3]=0,i[7]=i[6]=i[4]=0,i[5]=1,i[8]=Math.sin(t),i[9]=0,i[10]=Math.cos(t),i[11]=0,i[14]=i[13]=i[12]=0,i[15]=1,e},cc.math.Matrix4.createByRotationZ=function(t,e){var i=(e=e||new cc.math.Matrix4).mat;return i[0]=Math.cos(t),i[1]=Math.sin(t),i[3]=i[2]=0,i[4]=-Math.sin(t),i[5]=Math.cos(t),i[7]=i[6]=0,i[11]=i[9]=i[8]=0,i[10]=1,i[14]=i[13]=i[12]=0,i[15]=1,e},cc.math.Matrix4.createByPitchYawRoll=function(t,e,i,n){n=n||new cc.math.Matrix4;var r=Math.cos(t),s=Math.sin(t),o=Math.cos(e),a=Math.sin(e),c=Math.cos(i),h=Math.sin(i),l=s*a,_=r*a,u=n.mat;return u[0]=o*c,u[4]=o*h,u[8]=-a,u[1]=l*c-r*h,u[5]=l*h+r*c,u[9]=s*o,u[2]=_*c+s*h,u[6]=_*h-s*c,u[10]=r*o,u[3]=u[7]=u[11]=0,u[15]=1,n},cc.math.Matrix4.createByQuaternion=function(t,e){var i=(e=e||new cc.math.Matrix4).mat;return i[0]=1-2*(t.y*t.y+t.z*t.z),i[1]=2*(t.x*t.y+t.z*t.w),i[2]=2*(t.x*t.z-t.y*t.w),i[3]=0,i[4]=2*(t.x*t.y-t.z*t.w),i[5]=1-2*(t.x*t.x+t.z*t.z),i[6]=2*(t.z*t.y+t.x*t.w),i[7]=0,i[8]=2*(t.x*t.z+t.y*t.w),i[9]=2*(t.y*t.z-t.x*t.w),i[10]=1-2*(t.x*t.x+t.y*t.y),i[11]=0,i[14]=i[13]=i[12]=0,i[15]=1,e},cc.math.Matrix4.createByRotationTranslation=function(t,e,i){var n=(i=i||new cc.math.Matrix4).mat,r=t.mat;return n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=0,n[4]=r[3],n[5]=r[4],n[6]=r[5],n[7]=0,n[8]=r[6],n[9]=r[7],n[10]=r[8],n[11]=0,n[12]=e.x,n[13]=e.y,n[14]=e.z,n[15]=1,i},cc.math.Matrix4.createByScale=function(t,e,i,n){var r=(n=n||new cc.math.Matrix4).mat;return r[0]=t,r[5]=e,r[10]=i,r[15]=1,r[1]=r[2]=r[3]=r[4]=r[6]=r[7]=r[8]=r[9]=r[11]=r[12]=r[13]=r[14]=0,n},cc.math.mat4Translation=function(t,e,i,n){return t.mat[0]=t.mat[5]=t.mat[10]=t.mat[15]=1,t.mat[1]=t.mat[2]=t.mat[3]=t.mat[4]=t.mat[6]=t.mat[7]=t.mat[8]=t.mat[9]=t.mat[11]=0,t.mat[12]=e,t.mat[13]=i,t.mat[14]=n,t},cc.math.Matrix4.createByTranslation=function(t,e,i,n){return(n=n||new cc.math.Matrix4).identity(),n.mat[12]=t,n.mat[13]=e,n.mat[14]=i,n},n.getUpVec3=function(){var t=this.mat;return new cc.math.Vec3(t[4],t[5],t[6]).normalize()},n.getRightVec3=function(){var t=this.mat;return new cc.math.Vec3(t[0],t[1],t[2]).normalize()},n.getForwardVec3=function(){var t=this.mat;return new cc.math.Vec3(t[8],t[9],t[10]).normalize()},cc.math.mat4PerspectiveProjection=function(t,e,i,n,r){var s=cc.degreesToRadians(e/2),o=r-n,a=Math.sin(s);if(0===o||0===a||0===i)return null;var c=Math.cos(s)/a;return t.identity(),t.mat[0]=c/i,t.mat[5]=c,t.mat[10]=-(r+n)/o,t.mat[11]=-1,t.mat[14]=-2*n*r/o,t.mat[15]=0,t},cc.math.Matrix4.createPerspectiveProjection=function(t,e,i,n){var r=cc.degreesToRadians(t/2),s=n-i,o=Math.sin(r);if(0===s||0===o||0===e)return null;var a=Math.cos(r)/o,c=new cc.math.Matrix4,h=c.mat;return c.identity(),h[0]=a/e,h[5]=a,h[10]=-(n+i)/s,h[11]=-1,h[14]=-2*i*n/s,h[15]=0,c},cc.math.mat4OrthographicProjection=function(t,e,i,n,r,s,o){return t.identity(),t.mat[0]=2/(i-e),t.mat[5]=2/(r-n),t.mat[10]=-2/(o-s),t.mat[12]=-(i+e)/(i-e),t.mat[13]=-(r+n)/(r-n),t.mat[14]=-(o+s)/(o-s),t},cc.math.Matrix4.createOrthographicProjection=function(t,e,i,n,r,s){var o=new cc.math.Matrix4,a=o.mat;return o.identity(),a[0]=2/(e-t),a[5]=2/(n-i),a[10]=-2/(s-r),a[12]=-(e+t)/(e-t),a[13]=-(n+i)/(n-i),a[14]=-(s+r)/(s-r),o},cc.math.mat4LookAt=function(t,e,i,n){var r=new cc.math.Vec3(i),s=new cc.math.Vec3(n);r.subtract(e),r.normalize(),s.normalize();var o=new cc.math.Vec3(r);o.cross(s),o.normalize();var a=new cc.math.Vec3(o);a.cross(r),o.normalize(),t.identity(),t.mat[0]=o.x,t.mat[4]=o.y,t.mat[8]=o.z,t.mat[1]=a.x,t.mat[5]=a.y,t.mat[9]=a.z,t.mat[2]=-r.x,t.mat[6]=-r.y,t.mat[10]=-r.z;var c=cc.math.Matrix4.createByTranslation(-e.x,-e.y,-e.z);return t.multiply(c),t};var s=new cc.math.Matrix4;n.lookAt=function(t,e,i){var n=new cc.math.Vec3(e),r=new cc.math.Vec3(i),o=this.mat;n.subtract(t),n.normalize(),r.normalize();var a=new cc.math.Vec3(n);a.cross(r),a.normalize();var c=new cc.math.Vec3(a);return c.cross(n),a.normalize(),this.identity(),o[0]=a.x,o[4]=a.y,o[8]=a.z,o[1]=c.x,o[5]=c.y,o[9]=c.z,o[2]=-n.x,o[6]=-n.y,o[10]=-n.z,s=cc.math.Matrix4.createByTranslation(-t.x,-t.y,-t.z,s),this.multiply(s),this},cc.math.mat4RotationAxisAngle=function(t,e,i){var n=Math.cos(i),r=Math.sin(i),s=new cc.math.Vec3(e);return s.normalize(),t.mat[0]=n+s.x*s.x*(1-n),t.mat[1]=s.z*r+s.y*s.x*(1-n),t.mat[2]=-s.y*r+s.z*s.x*(1-n),t.mat[3]=0,t.mat[4]=-s.z*r+s.x*s.y*(1-n),t.mat[5]=n+s.y*s.y*(1-n),t.mat[6]=s.x*r+s.z*s.y*(1-n),t.mat[7]=0,t.mat[8]=s.y*r+s.x*s.z*(1-n),t.mat[9]=-s.x*r+s.y*s.z*(1-n),t.mat[10]=n+s.z*s.z*(1-n),t.mat[11]=0,t.mat[12]=0,t.mat[13]=0,t.mat[14]=0,t.mat[15]=1,t},cc.math.Matrix4.createByAxisAndAngle=function(t,e,i){i=i||new cc.math.Matrix4;var n=this.mat,r=Math.cos(e),s=Math.sin(e),o=new cc.math.Vec3(t);return o.normalize(),n[0]=r+o.x*o.x*(1-r),n[1]=o.z*s+o.y*o.x*(1-r),n[2]=-o.y*s+o.z*o.x*(1-r),n[3]=0,n[4]=-o.z*s+o.x*o.y*(1-r),n[5]=r+o.y*o.y*(1-r),n[6]=o.x*s+o.z*o.y*(1-r),n[7]=0,n[8]=o.y*s+o.x*o.z*(1-r),n[9]=-o.x*s+o.y*o.z*(1-r),n[10]=r+o.z*o.z*(1-r),n[11]=0,n[12]=n[13]=n[14]=0,n[15]=1,i},n.extractRotation=function(){var t=new cc.math.Matrix3,e=this.mat,i=t.mat;return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[4],i[4]=e[5],i[5]=e[6],i[6]=e[8],i[7]=e[9],i[8]=e[10],t},n.extractPlane=function(t){var e=new cc.math.Plane,i=this.mat;switch(t){case cc.math.Plane.RIGHT:e.a=i[3]-i[0],e.b=i[7]-i[4],e.c=i[11]-i[8],e.d=i[15]-i[12];break;case cc.math.Plane.LEFT:e.a=i[3]+i[0],e.b=i[7]+i[4],e.c=i[11]+i[8],e.d=i[15]+i[12];break;case cc.math.Plane.BOTTOM:e.a=i[3]+i[1],e.b=i[7]+i[5],e.c=i[11]+i[9],e.d=i[15]+i[13];break;case cc.math.Plane.TOP:e.a=i[3]-i[1],e.b=i[7]-i[5],e.c=i[11]-i[9],e.d=i[15]-i[13];break;case cc.math.Plane.FAR:e.a=i[3]-i[2],e.b=i[7]-i[6],e.c=i[11]-i[10],e.d=i[15]-i[14];break;case cc.math.Plane.NEAR:e.a=i[3]+i[2],e.b=i[7]+i[6],e.c=i[11]+i[10],e.d=i[15]+i[14];break;default:cc.logID(7904)}var n=Math.sqrt(e.a*e.a+e.b*e.b+e.c*e.c);return e.a/=n,e.b/=n,e.c/=n,e.d/=n,e},n.toAxisAndAngle=function(){var t=this.extractRotation();return cc.math.Quaternion.rotationMatrix(t).toAxisAndAngle()}}),{}],229:[(function(t,e,i){cc.math.Plane=function(t,e,i,n){t&&void 0===e?(this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d):(this.a=t||0,this.b=e||0,this.c=i||0,this.d=n||0)};var n=cc.math.Plane.prototype;cc.math.Plane.LEFT=0,cc.math.Plane.RIGHT=1,cc.math.Plane.BOTTOM=2,cc.math.Plane.TOP=3,cc.math.Plane.NEAR=4,cc.math.Plane.FAR=5,cc.math.Plane.POINT_INFRONT_OF_PLANE=0,cc.math.Plane.POINT_BEHIND_PLANE=1,cc.math.Plane.POINT_ON_PLANE=2,n.dot=function(t){return this.a*t.x+this.b*t.y+this.c*t.z+this.d*t.w},n.dotCoord=function(t){return this.a*t.x+this.b*t.y+this.c*t.z+this.d},n.dotNormal=function(t){return this.a*t.x+this.b*t.y+this.c*t.z},cc.math.Plane.fromPointNormal=function(t,e){return new cc.math.Plane(e.x,e.y,e.z,-e.dot(t))},cc.math.Plane.fromPoints=function(t,e,i){var n=new cc.math.Vec3(e),r=new cc.math.Vec3(i),s=new cc.math.Plane;return n.subtract(t),r.subtract(t),n.cross(r),n.normalize(),s.a=n.x,s.b=n.y,s.c=n.z,s.d=n.scale(-1).dot(t),s},n.normalize=function(){var t=new cc.math.Vec3(this.a,this.b,this.c),e=1/t.length();return t.normalize(),this.a=t.x,this.b=t.y,this.c=t.z,this.d=this.d*e,this},n.classifyPoint=function(t){var e=this.a*t.x+this.b*t.y+this.c*t.z+this.d;return e>.001?cc.math.Plane.POINT_INFRONT_OF_PLANE:e<-.001?cc.math.Plane.POINT_BEHIND_PLANE:cc.math.Plane.POINT_ON_PLANE}}),{}],230:[(function(t,e,i){cc.math.Quaternion=function(t,e,i,n){t&&void 0===e?(this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w):(this.x=t||0,this.y=e||0,this.z=i||0,this.w=n||0)};var n=cc.math.Quaternion.prototype;n.conjugate=function(t){return this.x=-t.x,this.y=-t.y,this.z=-t.z,this.w=t.w,this},n.dot=function(t){return this.w*t.w+this.x*t.x+this.y*t.y+this.z*t.z},n.exponential=function(){return this},n.identity=function(){return this.x=0,this.y=0,this.z=0,this.w=1,this},n.inverse=function(){var t=this.length();return Math.abs(t)>cc.math.EPSILON?(this.x=0,this.y=0,this.z=0,this.w=0,this):(this.conjugate(this).scale(1/t),this)},n.isIdentity=function(){return 0===this.x&&0===this.y&&0===this.z&&1===this.w},n.length=function(){return Math.sqrt(this.lengthSq())},n.lengthSq=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},n.multiply=function(t){var e=this.x,i=this.y,n=this.z,r=this.w;return this.w=r*t.w-e*t.x-i*t.y-n*t.z,this.x=r*t.x+e*t.w+i*t.z-n*t.y,this.y=r*t.y+i*t.w+n*t.x-e*t.z,this.z=r*t.z+n*t.w+e*t.y-i*t.x,this},n.normalize=function(){var t=this.length();if(Math.abs(t)<=cc.math.EPSILON)throw new Error("current quaternion is an invalid value");return this.scale(1/t),this},n.rotationAxis=function(t,e){var i=.5*e,n=Math.sin(i);return this.w=Math.cos(i),this.x=t.x*n,this.y=t.y*n,this.z=t.z*n,this},cc.math.Quaternion.rotationMatrix=function(t){if(!t)return null;var e,i,n,r,s=[],o=t.mat,a=0;s[0]=o[0],s[1]=o[3],s[2]=o[6],s[4]=o[1],s[5]=o[4],s[6]=o[7],s[8]=o[2],s[9]=o[5],s[10]=o[8],s[15]=1;var c=s[0],h=c[0]+c[5]+c[10]+1;return h>cc.math.EPSILON?(a=2*Math.sqrt(h),e=(c[9]-c[6])/a,i=(c[2]-c[8])/a,n=(c[4]-c[1])/a,r=.25*a):c[0]>c[5]&&c[0]>c[10]?(e=.25*(a=2*Math.sqrt(1+c[0]-c[5]-c[10])),i=(c[4]+c[1])/a,n=(c[2]+c[8])/a,r=(c[9]-c[6])/a):c[5]>c[10]?(a=2*Math.sqrt(1+c[5]-c[0]-c[10]),e=(c[4]+c[1])/a,i=.25*a,n=(c[9]+c[6])/a,r=(c[2]-c[8])/a):(a=2*Math.sqrt(1+c[10]-c[0]-c[5]),e=(c[2]+c[8])/a,i=(c[9]+c[6])/a,n=.25*a,r=(c[4]-c[1])/a),new cc.math.Quaternion(e,i,n,r)},cc.math.Quaternion.rotationYawPitchRoll=function(t,e,i){var n,r,s,o,a,c,h,l,_,u,d;n=cc.degreesToRadians(e)/2,r=cc.degreesToRadians(t)/2,s=cc.degreesToRadians(i)/2,o=Math.cos(n),a=Math.cos(r),c=Math.cos(s),h=Math.sin(n),u=a*c,d=(l=Math.sin(r))*(_=Math.sin(s));var m=new cc.math.Quaternion;return m.w=o*u+h*d,m.x=h*u-o*d,m.y=o*l*c+h*a*_,m.z=o*a*_-h*l*c,m.normalize(),m},n.slerp=function(t,e){if(this.x===t.x&&this.y===t.y&&this.z===t.z&&this.w===t.w)return this;var i=this.dot(t),n=Math.acos(i),r=Math.sqrt(1-cc.math.square(i)),s=Math.sin(e*n)/r,o=Math.sin((1-e)*n)/r,a=new cc.math.Quaternion(t);return this.scale(o),a.scale(s),this.add(a),this},n.toAxisAndAngle=function(){var t,e,i,n=new cc.math.Vec3;return t=Math.acos(this.w),(e=Math.sqrt(cc.math.square(this.x)+cc.math.square(this.y)+cc.math.square(this.z)))>-cc.math.EPSILON&&e<cc.math.EPSILON||e<2*Math.PI+cc.math.EPSILON&&e>2*Math.PI-cc.math.EPSILON?(i=0,n.x=0,n.y=0,n.z=1):(i=2*t,n.x=this.x/e,n.y=this.y/e,n.z=this.z/e,n.normalize()),{axis:n,angle:i}},n.scale=function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},n.assignFrom=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},n.add=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this},cc.math.Quaternion.rotationBetweenVec3=function(t,e,i){var n=new cc.math.Vec3(t),r=new cc.math.Vec3(e);n.normalize(),r.normalize();var s=n.dot(r),o=new cc.math.Quaternion;if(s>=1)return o.identity(),o;if(s<1e-6-1)if(Math.abs(i.lengthSq())<cc.math.EPSILON)o.rotationAxis(i,Math.PI);else{var a=new cc.math.Vec3(1,0,0);a.cross(t),Math.abs(a.lengthSq())<cc.math.EPSILON&&(a.fill(0,1,0),a.cross(t)),a.normalize(),o.rotationAxis(a,Math.PI)}else{var c=Math.sqrt(2*(1+s)),h=1/c;n.cross(r),o.x=n.x*h,o.y=n.y*h,o.z=n.z*h,o.w=.5*c,o.normalize()}return o},n.multiplyVec3=function(t){var e=this.x,i=this.y,n=this.z,r=new cc.math.Vec3(t),s=new cc.math.Vec3(e,i,n),o=new cc.math.Vec3(e,i,n);return s.cross(t),o.cross(s),s.scale(2*q.w),o.scale(2),r.add(s),r.add(o),r}}),{}],231:[(function(t,e,i){function n(t,e,i){var n=new cc.math.Vec2(e);n.subtract(t),i.x=-n.y,i.y=n.x,i.normalize()}cc.math.Ray2=function(t,e){this.start=t||new cc.math.Vec2,this.dir=e||new cc.math.Vec2},cc.math.Ray2.prototype.fill=function(t,e,i,n){this.start.x=t,this.start.y=e,this.dir.x=i,this.dir.y=n},cc.math.Ray2.prototype.intersectLineSegment=function(t,e,i){var n,r,s,o=this.start.x,a=this.start.y,c=this.start.x+this.dir.x,h=this.start.y+this.dir.y,l=t.x,_=t.y,u=e.x,d=e.y,m=(d-_)*(c-o)-(u-l)*(h-a);return!(m>-cc.math.EPSILON&&m<cc.math.EPSILON)&&(n=((u-l)*(a-_)-(d-_)*(o-l))/m,r=o+n*(c-o),s=a+n*(h-a),!(r<Math.min(t.x,e.x)-cc.math.EPSILON||r>Math.max(t.x,e.x)+cc.math.EPSILON||s<Math.min(t.y,e.y)-cc.math.EPSILON||s>Math.max(t.y,e.y)+cc.math.EPSILON)&&(!(r<Math.min(o,c)-cc.math.EPSILON||r>Math.max(o,c)+cc.math.EPSILON||s<Math.min(a,h)-cc.math.EPSILON||s>Math.max(a,h)+cc.math.EPSILON)&&(i.x=r,i.y=s,!0)))},cc.math.Ray2.prototype.intersectTriangle=function(t,e,i,r,s){var o,a=new cc.math.Vec2,c=new cc.math.Vec2,h=new cc.math.Vec2,l=1e4,_=!1;return this.intersectLineSegment(t,e,a)&&(_=!0,(o=a.subtract(this.start).length())<l&&(c.x=a.x,c.y=a.y,l=o,n(t,e,h))),this.intersectLineSegment(e,i,a)&&(_=!0,(o=a.subtract(this.start).length())<l&&(c.x=a.x,c.y=a.y,l=o,n(e,i,h))),this.intersectLineSegment(i,t,a)&&(_=!0,(o=a.subtract(this.start).length())<l&&(c.x=a.x,c.y=a.y,l=o,n(i,t,h))),_&&(r.x=c.x,r.y=c.y,s&&(s.x=h.x,s.y=h.y)),_}}),{}],232:[(function(t,e,i){cc.math=cc.math||{},cc.math.EPSILON=1/64,cc.math.square=function(t){return t*t},cc.math.almostEqual=function(t,e){return t+cc.math.EPSILON>e&&t-cc.math.EPSILON<e}}),{}],233:[(function(t,e,i){cc.math.Vec2=function(t,e){void 0===e?(this.x=t.x,this.y=t.y):(this.x=t||0,this.y=e||0)};var n=cc.math.Vec2.prototype;n.fill=function(t,e){this.x=t,this.y=e},n.length=function(){return Math.sqrt(cc.math.square(this.x)+cc.math.square(this.y))},n.lengthSq=function(){return cc.math.square(this.x)+cc.math.square(this.y)},n.normalize=function(){var t=1/this.length();return this.x*=t,this.y*=t,this},cc.math.Vec2.add=function(t,e,i){return t.x=e.x+i.x,t.y=e.y+i.y,t},n.add=function(t){return this.x+=t.x,this.y+=t.y,this},n.dot=function(t){return this.x*t.x+this.y*t.y},cc.math.Vec2.subtract=function(t,e,i){return t.x=e.x-i.x,t.y=e.y-i.y,t},n.subtract=function(t){return this.x-=t.x,this.y-=t.y,this},n.transform=function(t){var e=this.x,i=this.y;return this.x=e*t.mat[0]+i*t.mat[3]+t.mat[6],this.y=e*t.mat[1]+i*t.mat[4]+t.mat[7],this},cc.math.Vec2.scale=function(t,e,i){return t.x=e.x*i,t.y=e.y*i,t},n.scale=function(t){return this.x*=t,this.y*=t,this},n.equals=function(t){return this.x<t.x+cc.math.EPSILON&&this.x>t.x-cc.math.EPSILON&&this.y<t.y+cc.math.EPSILON&&this.y>t.y-cc.math.EPSILON}}),{}],234:[(function(t,e,i){cc.math.Vec3=cc.math.Vec3=function(t,e,i){t&&void 0===e?(this.x=t.x,this.y=t.y,this.z=t.z):(this.x=t||0,this.y=e||0,this.z=i||0)},cc.math.vec3=function(t,e,i){return new cc.math.Vec3(t,e,i)};var n=cc.math.Vec3.prototype;n.fill=function(t,e,i){return t&&void 0===e?(this.x=t.x,this.y=t.y,this.z=t.z):(this.x=t,this.y=e,this.z=i),this},n.length=function(){return Math.sqrt(cc.math.square(this.x)+cc.math.square(this.y)+cc.math.square(this.z))},n.lengthSq=function(){return cc.math.square(this.x)+cc.math.square(this.y)+cc.math.square(this.z)},n.normalize=function(){var t=1/this.length();return this.x*=t,this.y*=t,this.z*=t,this},n.cross=function(t){var e=this.x,i=this.y,n=this.z;return this.x=i*t.z-n*t.y,this.y=n*t.x-e*t.z,this.z=e*t.y-i*t.x,this},n.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z},n.add=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},n.subtract=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},n.transform=function(t){var e=this.x,i=this.y,n=this.z,r=t.mat;return this.x=e*r[0]+i*r[4]+n*r[8]+r[12],this.y=e*r[1]+i*r[5]+n*r[9]+r[13],this.z=e*r[2]+i*r[6]+n*r[10]+r[14],this},n.transformNormal=function(t){var e=this.x,i=this.y,n=this.z,r=t.mat;return this.x=e*r[0]+i*r[4]+n*r[8],this.y=e*r[1]+i*r[5]+n*r[9],this.z=e*r[2]+i*r[6]+n*r[10],this},n.transformCoord=function(t){var e=new cc.math.Vec4(this.x,this.y,this.z,1);return e.transform(t),this.x=e.x/e.w,this.y=e.y/e.w,this.z=e.z/e.w,this},n.scale=function(t){return this.x*=t,this.y*=t,this.z*=t,this},n.equals=function(t){var e=cc.math.EPSILON;return this.x<t.x+e&&this.x>t.x-e&&this.y<t.y+e&&this.y>t.y-e&&this.z<t.z+e&&this.z>t.z-e},n.inverseTransform=function(t){var e=t.mat,i=new cc.math.Vec3(this.x-e[12],this.y-e[13],this.z-e[14]);return this.x=i.x*e[0]+i.y*e[1]+i.z*e[2],this.y=i.x*e[4]+i.y*e[5]+i.z*e[6],this.z=i.x*e[8]+i.y*e[9]+i.z*e[10],this},n.inverseTransformNormal=function(t){var e=this.x,i=this.y,n=this.z,r=t.mat;return this.x=e*r[0]+i*r[1]+n*r[2],this.y=e*r[4]+i*r[5]+n*r[6],this.z=e*r[8]+i*r[9]+n*r[10],this},n.assignFrom=function(t){return t?(this.x=t.x,this.y=t.y,this.z=t.z,this):this},cc.math.Vec3.zero=function(t){return t.x=t.y=t.z=0,t},n.toTypeArray=function(){var t=new Float32Array(3);return t[0]=this.x,t[1]=this.y,t[2]=this.z,t}}),{}],235:[(function(t,e,i){cc.math.Vec4=function(t,e,i,n){t&&void 0===e?(this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w):(this.x=t||0,this.y=e||0,this.z=i||0,this.w=n||0)};var n=cc.math.Vec4.prototype;n.fill=function(t,e,i,n){t&&void 0===e?(this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w):(this.x=t,this.y=e,this.z=i,this.w=n)},n.add=function(t){return t?(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this):this},n.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},n.length=function(){return Math.sqrt(cc.math.square(this.x)+cc.math.square(this.y)+cc.math.square(this.z)+cc.math.square(this.w))},n.lengthSq=function(){return cc.math.square(this.x)+cc.math.square(this.y)+cc.math.square(this.z)+cc.math.square(this.w)},n.lerp=function(t,e){return this},n.normalize=function(){var t=1/this.length();return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},n.scale=function(t){return this.normalize(),this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},n.subtract=function(t){this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w},n.transform=function(t){var e=this.x,i=this.y,n=this.z,r=this.w,s=t.mat;return this.x=e*s[0]+i*s[4]+n*s[8]+r*s[12],this.y=e*s[1]+i*s[5]+n*s[9]+r*s[13],this.z=e*s[2]+i*s[6]+n*s[10]+r*s[14],this.w=e*s[3]+i*s[7]+n*s[11]+r*s[15],this},cc.math.Vec4.transformArray=function(t,e){for(var i=[],n=0;n<t.length;n++){var r=new cc.math.Vec4(t[n]);r.transform(e),i.push(r)}return i},n.equals=function(t){var e=cc.math.EPSILON;return this.x<t.x+e&&this.x>t.x-e&&this.y<t.y+e&&this.y>t.y-e&&this.z<t.z+e&&this.z>t.z-e&&this.w<t.w+e&&this.w>t.w-e},n.assignFrom=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},n.toTypeArray=function(){var t=new Float32Array(4);return t[0]=this.x,t[1]=this.y,t[2]=this.z,t[3]=this.w,t}}),{}],236:[(function(t,e,i){var n=cc.macro,r=cc.math;cc.GLProgram=cc._Class.extend({_updateUniformLocation:function(t){if(!t)return!1;var e,i=this._hashForUniforms[t];if(i){e=!1;for(var n=arguments.length-1,r=0;r<n;++r)arguments[r+1]!==i[r]&&(i[r]=arguments[r+1],e=!0)}else i=[arguments[1],arguments[2],arguments[3],arguments[4]],this._hashForUniforms[t]=i,e=!0;return e},_description:function(){return"<CCGLProgram = "+this.toString()+" | Program = "+this._programObj.toString()+", VertexShader = "+this._vertShader.toString()+", FragmentShader = "+this._fragShader.toString()+">"},_compileShader:function(t,e,i){if(!i||!t)return!1;i=(cc.GLProgram._isHighpSupported()?"precision highp float;\n":"precision mediump float;\n")+"uniform mat4 CC_PMatrix;\nuniform mat4 CC_MVMatrix;\nuniform mat4 CC_MVPMatrix;\nuniform vec4 CC_Time;\nuniform vec4 CC_SinTime;\nuniform vec4 CC_CosTime;\nuniform vec4 CC_Random01;\nuniform sampler2D CC_Texture0;\n//CC INCLUDES END\n"+i,this._glContext.shaderSource(t,i),this._glContext.compileShader(t);var n=this._glContext.getShaderParameter(t,this._glContext.COMPILE_STATUS);return n||(cc.logID(8100,this._glContext.getShaderSource(t)),e===this._glContext.VERTEX_SHADER?cc.log("cocos2d: \n"+this.vertexShaderLog()):cc.log("cocos2d: \n"+this.fragmentShaderLog())),!!n},ctor:function(t,e,i){this._uniforms={},this._hashForUniforms={},this._glContext=i||cc._renderContext,this._programObj=null,this._vertShader=null,this._fragShader=null,this._usesTime=!1,this._projectionUpdated=-1,t&&e&&this.init(t,e)},destroyProgram:function(){this._vertShader=null,this._fragShader=null,this._uniforms=null,this._hashForUniforms=null,this._glContext.deleteProgram(this._programObj)},initWithVertexShaderByteArray:function(t,e){var i=this._glContext;this._programObj=i.createProgram(),this._projectionUpdated=-1,this._vertShader=null,this._fragShader=null,t&&(this._vertShader=i.createShader(i.VERTEX_SHADER),this._compileShader(this._vertShader,i.VERTEX_SHADER,t)||cc.logID(8101)),e&&(this._fragShader=i.createShader(i.FRAGMENT_SHADER),this._compileShader(this._fragShader,i.FRAGMENT_SHADER,e)||cc.logID(8102)),this._vertShader&&i.attachShader(this._programObj,this._vertShader),this._fragShader&&i.attachShader(this._programObj,this._fragShader);for(var n in this._hashForUniforms)delete this._hashForUniforms[n];return!0},initWithString:function(t,e){return this.initWithVertexShaderByteArray(t,e)},initWithVertexShaderFilename:function(t,e){var i=cc.loader.getRes(t);if(!i)throw new Error("Please load the resource firset : "+t);var n=cc.loader.getRes(e);if(!n)throw new Error("Please load the resource firset : "+e);return this.initWithVertexShaderByteArray(i,n)},init:function(t,e){return this.initWithVertexShaderFilename(t,e)},addAttribute:function(t,e){this._glContext.bindAttribLocation(this._programObj,e,t)},link:function(){if(!this._programObj)return cc.logID(8103),!1;if(this._glContext.linkProgram(this._programObj),this._vertShader&&this._glContext.deleteShader(this._vertShader),this._fragShader&&this._glContext.deleteShader(this._fragShader),this._vertShader=null,this._fragShader=null,cc.game.config[cc.game.CONFIG_KEY.debugMode]){if(!this._glContext.getProgramParameter(this._programObj,this._glContext.LINK_STATUS))return cc.logID(8104,this._glContext.getProgramInfoLog(this._programObj)),cc.gl.deleteProgram(this._programObj),this._programObj=null,!1}return!0},use:function(){cc.gl.useProgram(this._programObj)},updateUniforms:function(){this._uniforms[n.UNIFORM_PMATRIX]=this._glContext.getUniformLocation(this._programObj,n.UNIFORM_PMATRIX_S),this._uniforms[n.UNIFORM_MVMATRIX]=this._glContext.getUniformLocation(this._programObj,n.UNIFORM_MVMATRIX_S),this._uniforms[n.UNIFORM_MVPMATRIX]=this._glContext.getUniformLocation(this._programObj,n.UNIFORM_MVPMATRIX_S),this._uniforms[n.UNIFORM_TIME]=this._glContext.getUniformLocation(this._programObj,n.UNIFORM_TIME_S),this._uniforms[n.UNIFORM_SINTIME]=this._glContext.getUniformLocation(this._programObj,n.UNIFORM_SINTIME_S),this._uniforms[n.UNIFORM_COSTIME]=this._glContext.getUniformLocation(this._programObj,n.UNIFORM_COSTIME_S),this._usesTime=null!=this._uniforms[n.UNIFORM_TIME]||null!=this._uniforms[n.UNIFORM_SINTIME]||null!=this._uniforms[n.UNIFORM_COSTIME],this._uniforms[n.UNIFORM_RANDOM01]=this._glContext.getUniformLocation(this._programObj,n.UNIFORM_RANDOM01_S),this._uniforms[n.UNIFORM_SAMPLER]=this._glContext.getUniformLocation(this._programObj,n.UNIFORM_SAMPLER_S),this.use(),this.setUniformLocationWith1i(this._uniforms[n.UNIFORM_SAMPLER],0)},_addUniformLocation:function(t){var e=this._glContext.getUniformLocation(this._programObj,t);this._uniforms[t]=e},getUniformLocationForName:function(t){if(!t)throw new Error("cc.GLProgram.getUniformLocationForName(): uniform name should be non-null");if(!this._programObj)throw new Error("cc.GLProgram.getUniformLocationForName(): Invalid operation. Cannot get uniform location when program is not initialized");return this._uniforms[t]||this._glContext.getUniformLocation(this._programObj,t)},getUniformMVPMatrix:function(){return this._uniforms[n.UNIFORM_MVPMATRIX]},getUniformSampler:function(){return this._uniforms[n.UNIFORM_SAMPLER]},setUniformLocationWith1i:function(t,e){var i=this._glContext;if("string"==typeof t){if(this._updateUniformLocation(t,e)){var n=this.getUniformLocationForName(t);i.uniform1i(n,e)}}else i.uniform1i(t,e)},setUniformLocationWith2i:function(t,e,i){var n=this._glContext;if("string"==typeof t){if(this._updateUniformLocation(t,e,i)){var r=this.getUniformLocationForName(t);n.uniform2i(r,e,i)}}else n.uniform2i(t,e,i)},setUniformLocationWith3i:function(t,e,i,n){var r=this._glContext;if("string"==typeof t){if(this._updateUniformLocation(t,e,i,n)){var s=this.getUniformLocationForName(t);r.uniform3i(s,e,i,n)}}else r.uniform3i(t,e,i,n)},setUniformLocationWith4i:function(t,e,i,n,r){var s=this._glContext;if("string"==typeof t){if(this._updateUniformLocation(t,e,i,n,r)){var o=this.getUniformLocationForName(t);s.uniform4i(o,e,i,n,r)}}else s.uniform4i(t,e,i,n,r)},setUniformLocationWith2iv:function(t,e){var i="string"==typeof t?this.getUniformLocationForName(t):t;this._glContext.uniform2iv(i,e)},setUniformLocationWith3iv:function(t,e){var i="string"==typeof t?this.getUniformLocationForName(t):t;this._glContext.uniform3iv(i,e)},setUniformLocationWith4iv:function(t,e){var i="string"==typeof t?this.getUniformLocationForName(t):t;this._glContext.uniform4iv(i,e)},setUniformLocationI32:function(t,e){this.setUniformLocationWith1i(t,e)},setUniformLocationWith1f:function(t,e){var i=this._glContext;if("string"==typeof t){if(this._updateUniformLocation(t,e)){var n=this.getUniformLocationForName(t);i.uniform1f(n,e)}}else i.uniform1f(t,e)},setUniformLocationWith2f:function(t,e,i){var n=this._glContext;if("string"==typeof t){if(this._updateUniformLocation(t,e,i)){var r=this.getUniformLocationForName(t);n.uniform2f(r,e,i)}}else n.uniform2f(t,e,i)},setUniformLocationWith3f:function(t,e,i,n){var r=this._glContext;if("string"==typeof t){if(this._updateUniformLocation(t,e,i,n)){var s=this.getUniformLocationForName(t);r.uniform3f(s,e,i,n)}}else r.uniform3f(t,e,i,n)},setUniformLocationWith4f:function(t,e,i,n,r){var s=this._glContext;if("string"==typeof t){if(this._updateUniformLocation(t,e,i,n,r)){var o=this.getUniformLocationForName(t);s.uniform4f(o,e,i,n,r)}}else s.uniform4f(t,e,i,n,r)},setUniformLocationWith2fv:function(t,e){var i="string"==typeof t?this.getUniformLocationForName(t):t;this._glContext.uniform2fv(i,e)},setUniformLocationWith3fv:function(t,e){var i="string"==typeof t?this.getUniformLocationForName(t):t;this._glContext.uniform3fv(i,e)},setUniformLocationWith4fv:function(t,e){var i="string"==typeof t?this.getUniformLocationForName(t):t;this._glContext.uniform4fv(i,e)},setUniformLocationWithMatrix3fv:function(t,e){var i="string"==typeof t?this.getUniformLocationForName(t):t;this._glContext.uniformMatrix3fv(i,!1,e)},setUniformLocationWithMatrix4fv:function(t,e){var i="string"==typeof t?this.getUniformLocationForName(t):t;this._glContext.uniformMatrix4fv(i,!1,e)},setUniformLocationF32:function(t,e,i,n,r){"use strict";switch(arguments.length){case 0:case 1:return;case 2:this.setUniformLocationWith1f(t,e);break;case 3:this.setUniformLocationWith2f(t,e,i);break;case 4:this.setUniformLocationWith3f(t,e,i,n);break;case 5:this.setUniformLocationWith4f(t,e,i,n,r)}},setUniformsForBuiltins:function(){var t=new r.Matrix4,e=new r.Matrix4,i=new r.Matrix4;if(r.glGetMatrix(r.KM_GL_PROJECTION,t),r.glGetMatrix(r.KM_GL_MODELVIEW,e),r.mat4Multiply(i,t,e),this.setUniformLocationWithMatrix4fv(this._uniforms[n.UNIFORM_PMATRIX],t.mat,1),this.setUniformLocationWithMatrix4fv(this._uniforms[n.UNIFORM_MVMATRIX],e.mat,1),this.setUniformLocationWithMatrix4fv(this._uniforms[n.UNIFORM_MVPMATRIX],i.mat,1),this._usesTime){var s=cc.director,o=s.getTotalFrames()*s.getAnimationInterval();this.setUniformLocationWith4f(this._uniforms[n.UNIFORM_TIME],o/10,o,2*o,4*o),this.setUniformLocationWith4f(this._uniforms[n.UNIFORM_SINTIME],o/8,o/4,o/2,Math.sin(o)),this.setUniformLocationWith4f(this._uniforms[n.UNIFORM_COSTIME],o/8,o/4,o/2,Math.cos(o))}-1!==this._uniforms[n.UNIFORM_RANDOM01]&&this.setUniformLocationWith4f(this._uniforms[n.UNIFORM_RANDOM01],Math.random(),Math.random(),Math.random(),Math.random())},_setUniformsForBuiltinsForRenderer:function(t){if(t&&t._renderCmd){var e=new r.Matrix4,i=new r.Matrix4;if(r.glGetMatrix(r.KM_GL_PROJECTION,e),r.mat4Multiply(i,e,t._renderCmd._stackMatrix),this.setUniformLocationWithMatrix4fv(this._uniforms[n.UNIFORM_PMATRIX],e.mat,1),this.setUniformLocationWithMatrix4fv(this._uniforms[n.UNIFORM_MVMATRIX],t._renderCmd._stackMatrix.mat,1),this.setUniformLocationWithMatrix4fv(this._uniforms[n.UNIFORM_MVPMATRIX],i.mat,1),this._usesTime){var s=cc.director,o=s.getTotalFrames()*s.getAnimationInterval();this.setUniformLocationWith4f(this._uniforms[n.UNIFORM_TIME],o/10,o,2*o,4*o),this.setUniformLocationWith4f(this._uniforms[n.UNIFORM_SINTIME],o/8,o/4,o/2,Math.sin(o)),this.setUniformLocationWith4f(this._uniforms[n.UNIFORM_COSTIME],o/8,o/4,o/2,Math.cos(o))}-1!==this._uniforms[n.UNIFORM_RANDOM01]&&this.setUniformLocationWith4f(this._uniforms[n.UNIFORM_RANDOM01],Math.random(),Math.random(),Math.random(),Math.random())}},setUniformForModelViewProjectionMatrix:function(){this._glContext.uniformMatrix4fv(this._uniforms[n.UNIFORM_MVPMATRIX],!1,r.getMat4MultiplyValue(r.projection_matrix_stack.top,r.modelview_matrix_stack.top))},setUniformForModelViewProjectionMatrixWithMat4:function(t){r.mat4Multiply(t,r.projection_matrix_stack.top,r.modelview_matrix_stack.top),this._glContext.uniformMatrix4fv(this._uniforms[n.UNIFORM_MVPMATRIX],!1,t.mat)},setUniformForModelViewAndProjectionMatrixWithMat4:function(){this._glContext.uniformMatrix4fv(this._uniforms[n.UNIFORM_MVMATRIX],!1,r.modelview_matrix_stack.top.mat),this._glContext.uniformMatrix4fv(this._uniforms[n.UNIFORM_PMATRIX],!1,r.projection_matrix_stack.top.mat)},_setUniformForMVPMatrixWithMat4:function(t){if(!t)throw new Error("modelView matrix is undefined.");this._glContext.uniformMatrix4fv(this._uniforms[n.UNIFORM_MVMATRIX],!1,t.mat),this._glContext.uniformMatrix4fv(this._uniforms[n.UNIFORM_PMATRIX],!1,r.projection_matrix_stack.top.mat)},_updateProjectionUniform:function(){var t=r.projection_matrix_stack;t.lastUpdated!==this._projectionUpdated&&(this._glContext.uniformMatrix4fv(this._uniforms[n.UNIFORM_PMATRIX],!1,t.top.mat),this._projectionUpdated=t.lastUpdated)},vertexShaderLog:function(){return this._glContext.getShaderInfoLog(this._vertShader)},getVertexShaderLog:function(){return this._glContext.getShaderInfoLog(this._vertShader)},getFragmentShaderLog:function(){return this._glContext.getShaderInfoLog(this._vertShader)},fragmentShaderLog:function(){return this._glContext.getShaderInfoLog(this._fragShader)},programLog:function(){return this._glContext.getProgramInfoLog(this._programObj)},getProgramLog:function(){return this._glContext.getProgramInfoLog(this._programObj)},reset:function(){this._vertShader=null,this._fragShader=null,this._uniforms.length=0,this._glContext.deleteProgram(this._programObj),this._programObj=null;for(var t in this._hashForUniforms)this._hashForUniforms[t].length=0,delete this._hashForUniforms[t]},getProgram:function(){return this._programObj},retain:function(){},release:function(){}}),cc.GLProgram._highpSupported=null,cc.GLProgram._isHighpSupported=function(){var t=cc._renderContext;if(t.getShaderPrecisionFormat&&null==cc.GLProgram._highpSupported){var e=t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT);cc.GLProgram._highpSupported=0!==e.precision}return cc.GLProgram._highpSupported}}),{}],237:[(function(t,e,i){var n=cc.macro.ENABLE_GL_STATE_CACHE,r=0,s=0,o=null,a=0,c=0;n&&(r=16,s=-1,o=new Array(r),a=-1,c=-1),cc.gl={},cc.gl.invalidateStateCache=function(){if(cc.math.glFreeAll(),-1,n){s=-1;for(var t=0;t<r;t++)o[t]=null;a=-1,c=-1,0}},cc.gl.useProgram=n?function(t){t!==s&&(s=t,cc._renderContext.useProgram(t))}:function(t){cc._renderContext.useProgram(t)},cc.gl.deleteProgram=function(t){n&&t===s&&(s=-1),gl.deleteProgram(t)},cc.gl.setBlending=function(t,e){var i=cc._renderContext;t===i.ONE&&e===i.ZERO?i.disable(i.BLEND):(i.enable(i.BLEND),i.blendFunc(t,e))},cc.gl.blendFunc=n?function(t,e){t===a&&e===c||(a=t,c=e,cc.gl.setBlending(t,e))}:cc.gl.setBlending,cc.gl.blendFuncForParticle=function(t,e){if(t!==a||e!==c){a=t,c=e;var i=cc._renderContext;t===i.ONE&&e===i.ZERO?i.disable(i.BLEND):(i.enable(i.BLEND),i.blendFuncSeparate(i.SRC_ALPHA,e,t,e))}},cc.gl.blendResetToCache=function(){var t=cc._renderContext;t.blendEquation(t.FUNC_ADD),n?cc.gl.setBlending(a,c):cc.gl.setBlending(t.BLEND_SRC,t.BLEND_DST)},cc.gl.setProjectionMatrixDirty=function(){-1},cc.gl.bindTexture2D=function(t){cc.gl.bindTexture2DN(0,t)},cc.gl.bindTexture2DN=n?function(t,e){if(o[t]!==e){o[t]=e;var i=cc._renderContext;i.activeTexture(i.TEXTURE0+t),e?i.bindTexture(i.TEXTURE_2D,e._glID):i.bindTexture(i.TEXTURE_2D,null)}}:function(t,e){var i=cc._renderContext;i.activeTexture(i.TEXTURE0+t),e?i.bindTexture(i.TEXTURE_2D,e._glID):i.bindTexture(i.TEXTURE_2D,null)},cc.gl.deleteTexture2D=function(t){cc.gl.deleteTexture2DN(0,t)},cc.gl.deleteTexture2DN=function(t,e){n&&e===o[t]&&(o[t]=null),cc._renderContext.deleteTexture(e._glID)},cc.gl.enable=function(t){}}),{}],238:[(function(t,e,i){var n=cc.PresetShaders,r=cc.macro;cc.shaderCache={TYPE_POSITION_TEXTURECOLOR:0,TYPE_POSITION_TEXTURECOLOR_ALPHATEST:1,TYPE_POSITION_COLOR:2,TYPE_POSITION_TEXTURE:3,TYPE_POSITION_TEXTURE_UCOLOR:4,TYPE_POSITION_TEXTURE_A8COLOR:5,TYPE_POSITION_UCOLOR:6,TYPE_POSITION_LENGTH_TEXTURECOLOR:7,TYPE_SPRITE_POSITION_TEXTURECOLOR:8,TYPE_SPRITE_POSITION_TEXTURECOLOR_ALPHATEST:9,TYPE_SPRITE_POSITION_COLOR:10,TYPE_MAX:10,_programs:{},_init:function(){return this.loadDefaultShaders(),!0},_loadDefaultShader:function(t,e){switch(e){case r.SHADER_POSITION_TEXTURECOLOR:t.initWithVertexShaderByteArray(n.POSITION_TEXTURE_COLOR_VERT,n.POSITION_TEXTURE_COLOR_FRAG),t.addAttribute(r.ATTRIBUTE_NAME_POSITION,r.VERTEX_ATTRIB_POSITION),t.addAttribute(r.ATTRIBUTE_NAME_COLOR,r.VERTEX_ATTRIB_COLOR),t.addAttribute(r.ATTRIBUTE_NAME_TEX_COORD,r.VERTEX_ATTRIB_TEX_COORDS);break;case r.SHADER_SPRITE_POSITION_TEXTURECOLOR:t.initWithVertexShaderByteArray(n.SPRITE_POSITION_TEXTURE_COLOR_VERT,n.POSITION_TEXTURE_COLOR_FRAG),t.addAttribute(r.ATTRIBUTE_NAME_POSITION,r.VERTEX_ATTRIB_POSITION),t.addAttribute(r.ATTRIBUTE_NAME_COLOR,r.VERTEX_ATTRIB_COLOR),t.addAttribute(r.ATTRIBUTE_NAME_TEX_COORD,r.VERTEX_ATTRIB_TEX_COORDS);break;case r.SHADER_POSITION_TEXTURECOLORALPHATEST:t.initWithVertexShaderByteArray(n.POSITION_TEXTURE_COLOR_VERT,n.POSITION_TEXTURE_COLOR_ALPHATEST_FRAG),t.addAttribute(r.ATTRIBUTE_NAME_POSITION,r.VERTEX_ATTRIB_POSITION),t.addAttribute(r.ATTRIBUTE_NAME_COLOR,r.VERTEX_ATTRIB_COLOR),t.addAttribute(r.ATTRIBUTE_NAME_TEX_COORD,r.VERTEX_ATTRIB_TEX_COORDS);break;case r.SHADER_SPRITE_POSITION_TEXTURECOLORALPHATEST:t.initWithVertexShaderByteArray(n.SPRITE_POSITION_TEXTURE_COLOR_VERT,n.POSITION_TEXTURE_COLOR_ALPHATEST_FRAG),t.addAttribute(r.ATTRIBUTE_NAME_POSITION,r.VERTEX_ATTRIB_POSITION),t.addAttribute(r.ATTRIBUTE_NAME_COLOR,r.VERTEX_ATTRIB_COLOR),t.addAttribute(r.ATTRIBUTE_NAME_TEX_COORD,r.VERTEX_ATTRIB_TEX_COORDS);break;case r.SHADER_POSITION_COLOR:t.initWithVertexShaderByteArray(n.POSITION_COLOR_VERT,n.POSITION_COLOR_FRAG),t.addAttribute(r.ATTRIBUTE_NAME_POSITION,r.VERTEX_ATTRIB_POSITION),t.addAttribute(r.ATTRIBUTE_NAME_COLOR,r.VERTEX_ATTRIB_COLOR);break;case r.SHADER_SPRITE_POSITION_COLOR:t.initWithVertexShaderByteArray(n.SPRITE_POSITION_COLOR_VERT,n.POSITION_COLOR_FRAG),t.addAttribute(r.ATTRIBUTE_NAME_POSITION,r.VERTEX_ATTRIB_POSITION),t.addAttribute(r.ATTRIBUTE_NAME_COLOR,r.VERTEX_ATTRIB_COLOR);break;case r.SHADER_POSITION_TEXTURE:t.initWithVertexShaderByteArray(n.POSITION_TEXTURE_VERT,n.POSITION_TEXTURE_FRAG),t.addAttribute(r.ATTRIBUTE_NAME_POSITION,r.VERTEX_ATTRIB_POSITION),t.addAttribute(r.ATTRIBUTE_NAME_TEX_COORD,r.VERTEX_ATTRIB_TEX_COORDS);break;case r.SHADER_POSITION_TEXTURE_UCOLOR:t.initWithVertexShaderByteArray(n.POSITION_TEXTURE_UCOLOR_VERT,n.POSITION_TEXTURE_UCOLOR_FRAG),t.addAttribute(r.ATTRIBUTE_NAME_POSITION,r.VERTEX_ATTRIB_POSITION),t.addAttribute(r.ATTRIBUTE_NAME_TEX_COORD,r.VERTEX_ATTRIB_TEX_COORDS);break;case r.SHADER_POSITION_TEXTUREA8COLOR:t.initWithVertexShaderByteArray(n.POSITION_TEXTURE_A8COLOR_VERT,n.POSITION_TEXTURE_A8COLOR_FRAG),t.addAttribute(r.ATTRIBUTE_NAME_POSITION,r.VERTEX_ATTRIB_POSITION),t.addAttribute(r.ATTRIBUTE_NAME_COLOR,r.VERTEX_ATTRIB_COLOR),t.addAttribute(r.ATTRIBUTE_NAME_TEX_COORD,r.VERTEX_ATTRIB_TEX_COORDS);break;case r.SHADER_POSITION_UCOLOR:t.initWithVertexShaderByteArray(n.POSITION_UCOLOR_VERT,n.POSITION_UCOLOR_FRAG),t.addAttribute("aVertex",r.VERTEX_ATTRIB_POSITION);break;case r.SHADER_POSITION_LENGTHTEXTURECOLOR:t.initWithVertexShaderByteArray(n.POSITION_COLOR_LENGTH_TEXTURE_VERT,n.POSITION_COLOR_LENGTH_TEXTURE_FRAG),t.addAttribute(r.ATTRIBUTE_NAME_POSITION,r.VERTEX_ATTRIB_POSITION),t.addAttribute(r.ATTRIBUTE_NAME_TEX_COORD,r.VERTEX_ATTRIB_TEX_COORDS),t.addAttribute(r.ATTRIBUTE_NAME_COLOR,r.VERTEX_ATTRIB_COLOR);break;default:return void cc.logID(8105)}t.link(),t.updateUniforms()},_reloadShader:function(t){var e=this.programForKey(t);e.reset(),this._loadDefaultShader(e,t)},loadDefaultShaders:function(){},reloadDefaultShaders:function(){this._reloadShader(r.SHADER_POSITION_TEXTURECOLOR),this._reloadShader(r.SHADER_SPRITE_POSITION_TEXTURECOLOR),this._reloadShader(r.SHADER_POSITION_TEXTURECOLORALPHATEST),this._reloadShader(r.SHADER_SPRITE_POSITION_TEXTURECOLORALPHATEST),this._reloadShader(r.SHADER_POSITION_COLOR),this._reloadShader(r.SHADER_POSITION_TEXTURE),this._reloadShader(r.SHADER_POSITION_TEXTURE_UCOLOR),this._reloadShader(r.SHADER_POSITION_TEXTUREA8COLOR),this._reloadShader(r.SHADER_POSITION_UCOLOR)},programForKey:function(t){if(!this._programs[t]){var e=new cc.GLProgram;this._loadDefaultShader(e,t),this._programs[t]=e}return this._programs[t]},getProgram:function(t){return this.programForKey(t)},addProgram:function(t,e){this._programs[e]=t}}}),{}],239:[(function(t,e,i){cc.PresetShaders={POSITION_UCOLOR_FRAG:"precision lowp float;\nvarying vec4 v_fragmentColor;\nvoid main()\n{\ngl_FragColor = v_fragmentColor;\n}",POSITION_UCOLOR_VERT:"attribute vec4 a_position;\nuniform vec4 u_color;\nuniform float u_pointSize;\nvarying lowp vec4 v_fragmentColor;\nvoid main(void)\n{\ngl_Position = (CC_PMatrix * CC_MVMatrix) * a_position;\ngl_PointSize = u_pointSize;\nv_fragmentColor = u_color;\n}",POSITION_COLOR_FRAG:"precision lowp float;\nvarying vec4 v_fragmentColor;\nvoid main()\n{\ngl_FragColor = v_fragmentColor;\n}",POSITION_COLOR_VERT:"attribute vec4 a_position;\nattribute vec4 a_color;\nvarying lowp vec4 v_fragmentColor;\nvoid main()\n{\ngl_Position = (CC_PMatrix * CC_MVMatrix) * a_position;\nv_fragmentColor = a_color;\n}",SPRITE_POSITION_COLOR_VERT:"attribute vec4 a_position;\nattribute vec4 a_color;\nvarying lowp vec4 v_fragmentColor;\nvoid main()\n{\ngl_Position = CC_PMatrix * a_position;\nv_fragmentColor = a_color;\n}",POSITION_COLOR_LENGTH_TEXTURE_FRAG:"//#extension GL_OES_standard_derivatives : enable\nvarying mediump vec4 v_color;\nvarying mediump vec2 v_texcoord;\nvoid main()\n{\n//#if defined GL_OES_standard_derivatives\n//gl_FragColor=v_color*smoothstep(0.0, length(fwidth(v_texcoord)), 1.0-length(v_texcoord));\n//#else\ngl_FragColor = v_color * step(0.0, 1.0 - length(v_texcoord));\n//#endif\n}",POSITION_COLOR_LENGTH_TEXTURE_VERT:"attribute mediump vec4 a_position;\nattribute mediump vec2 a_texcoord;\nattribute mediump vec4 a_color;\nvarying mediump vec4 v_color;\nvarying mediump vec2 v_texcoord;\nvoid main()\n{\nv_color = a_color;\nv_texcoord = a_texcoord;\ngl_Position = (CC_PMatrix * CC_MVMatrix) * a_position;\n}",POSITION_TEXTURE_FRAG:"precision lowp float;\nvarying vec2 v_texCoord;\nvoid main()\n{\ngl_FragColor = texture2D(CC_Texture0, v_texCoord);\n}",POSITION_TEXTURE_VERT:"attribute vec4 a_position;\nattribute vec2 a_texCoord;\nvarying mediump vec2 v_texCoord;\nvoid main()\n{\ngl_Position = (CC_PMatrix * CC_MVMatrix) * a_position;\nv_texCoord = a_texCoord;\n}",POSITION_TEXTURE_UCOLOR_FRAG:"precision lowp float;\nuniform vec4 u_color;\nvarying vec2 v_texCoord;\nvoid main()\n{\ngl_FragColor=texture2D(CC_Texture0, v_texCoord) * u_color;\n}",POSITION_TEXTURE_UCOLOR_VERT:"attribute vec4 a_position;\nattribute vec2 a_texCoord;\nvarying mediump vec2 v_texCoord;\nvoid main()\n{\ngl_Position = (CC_PMatrix * CC_MVMatrix) * a_position;\nv_texCoord = a_texCoord;\n}",POSITION_TEXTURE_A8COLOR_FRAG:"precision lowp float;\nvarying vec4 v_fragmentColor;\nvarying vec2 v_texCoord;\nvoid main()\n{\ngl_FragColor = vec4(v_fragmentColor.rgb,\nv_fragmentColor.a * texture2D(CC_Texture0, v_texCoord).a);\n}",POSITION_TEXTURE_A8COLOR_VERT:"attribute vec4 a_position;\nattribute vec2 a_texCoord;\nattribute vec4 a_color;\nvarying lowp vec4 v_fragmentColor;\nvarying mediump vec2 v_texCoord;\nvoid main()\n{\ngl_Position = (CC_PMatrix * CC_MVMatrix) * a_position;\nv_fragmentColor = a_color;\nv_texCoord = a_texCoord;\n}",POSITION_TEXTURE_COLOR_FRAG:"precision lowp float;\nvarying vec4 v_fragmentColor;\nvarying vec2 v_texCoord;\nvoid main()\n{\ngl_FragColor = v_fragmentColor * texture2D(CC_Texture0, v_texCoord);\n}",POSITION_TEXTURE_COLOR_VERT:"attribute vec4 a_position;\nattribute vec2 a_texCoord;\nattribute vec4 a_color;\nvarying lowp vec4 v_fragmentColor;\nvarying mediump vec2 v_texCoord;\nvoid main()\n{\ngl_Position = (CC_PMatrix * CC_MVMatrix) * a_position;\nv_fragmentColor = a_color;\nv_texCoord = a_texCoord;\n}",SPRITE_POSITION_TEXTURE_COLOR_VERT:"attribute vec4 a_position;\nattribute vec2 a_texCoord;\nattribute vec4 a_color;\nvarying lowp vec4 v_fragmentColor;\nvarying mediump vec2 v_texCoord;\nvoid main()\n{\ngl_Position = CC_PMatrix * a_position;\nv_fragmentColor = a_color;\nv_texCoord = a_texCoord;\n}",POSITION_TEXTURE_COLOR_ALPHATEST_FRAG:"precision lowp float;\nvarying vec4 v_fragmentColor;\nvarying vec2 v_texCoord;\nuniform float CC_alpha_value;\nvoid main()\n{\nvec4 texColor=texture2D(CC_Texture0, v_texCoord);\nif(texColor.a <= CC_alpha_value)\n discard; \ngl_FragColor=texColor*v_fragmentColor;\n}",EX_SWITCHMASK_FRAG:"precision lowp float;\nvarying vec4 v_fragmentColor;\nvarying vec2 v_texCoord;\nuniform sampler2D u_texture;\nuniform sampler2D u_mask;\nvoid main()\n{\nvec4 texColorc=texture2D(u_texture, v_texCoord);\nvec4 maskColor=texture2D(u_mask, v_texCoord);\nvec4 finalColor=vec4(texColor.r, texColor.g, texColor.b, maskColor.a*texColor.a);\ngl_FragColor=v_fragmentColor*finalColor;\n}"}}),{}],240:[(function(t,e,i){t("./CCShaders"),t("./CCShaderCache"),t("./CCGLProgram"),t("./CCGLStateCache")}),{"./CCGLProgram":236,"./CCGLStateCache":237,"./CCShaderCache":238,"./CCShaders":239}],241:[(function(t,e,i){var n=function(t){return{u:t.x,v:t.y}};cc.DrawNode=_ccsg.Node.extend({_buffer:null,_blendFunc:null,_lineWidth:1,_drawColor:null,getBlendFunc:function(){return this._blendFunc},setBlendFunc:function(t,e){void 0===e?(this._blendFunc.src=t.src,this._blendFunc.dst=t.dst):(this._blendFunc.src=t,this._blendFunc.dst=e)},setLineWidth:function(t){this._lineWidth=t},getLineWidth:function(){return this._lineWidth},setDrawColor:function(t){var e=this._drawColor;e.r=t.r,e.g=t.g,e.b=t.b,e.a=null==t.a?255:t.a},getDrawColor:function(){return cc.color(this._drawColor.r,this._drawColor.g,this._drawColor.b,this._drawColor.a)}}),cc.DrawNode.TYPE_DOT=0,cc.DrawNode.TYPE_SEGMENT=1,cc.DrawNode.TYPE_POLY=2,cc.game.once(cc.game.EVENT_RENDERER_INITED,(function(){var e=cc.DrawNode.prototype;cc._renderType===cc.game.RENDER_TYPE_CANVAS?(cc._DrawNodeElement=function(t,e,i,n,r,s,o,a,c){this.type=t,this.verts=e||null,this.fillColor=i||null,this.lineWidth=n||0,this.lineColor=r||null,this.lineCap=s||"butt",this.isClosePolygon=o||!1,this.isFill=a||!1,this.isStroke=c||!1},e._className="DrawNodeCanvas",e.ctor=function(){_ccsg.Node.prototype.ctor.call(this);var t=this._renderCmd;t._buffer=this._buffer=[],t._drawColor=this._drawColor=cc.color(255,255,255,255),t._blendFunc=this._blendFunc=new cc.BlendFunc(cc.macro.SRC_ALPHA,cc.macro.ONE_MINUS_SRC_ALPHA),this.init()},e.drawRect=function(t,e,i,n,r){n=null==n?this._lineWidth:n,null==(r=r||this.getDrawColor()).a&&(r.a=255);var s=[t,cc.p(e.x,t.y),e,cc.p(t.x,e.y)],o=new cc._DrawNodeElement(cc.DrawNode.TYPE_POLY);o.verts=s,o.lineWidth=n,o.lineColor=r,o.isClosePolygon=!0,o.isStroke=!0,o.lineCap="butt",o.fillColor=i,i&&(null==i.a&&(i.a=255),o.isFill=!0),this._buffer.push(o)},e.drawCircle=function(t,e,i,n,r,s,o){s=s||this._lineWidth,null==(o=o||this.getDrawColor()).a&&(o.a=255);for(var a=2*Math.PI/n,c=[],h=0;h<=n;h++){var l=h*a,_=e*Math.cos(l+i)+t.x,u=e*Math.sin(l+i)+t.y;c.push(cc.p(_,u))}r&&c.push(cc.p(t.x,t.y));var d=new cc._DrawNodeElement(cc.DrawNode.TYPE_POLY);d.verts=c,d.lineWidth=s,d.lineColor=o,d.isClosePolygon=!0,d.isStroke=!0,this._buffer.push(d)},e.drawQuadBezier=function(t,e,i,n,r,s){r=r||this._lineWidth,null==(s=s||this.getDrawColor()).a&&(s.a=255);for(var o=[],a=0,c=0;c<n;c++){var h=Math.pow(1-a,2)*t.x+2*(1-a)*a*e.x+a*a*i.x,l=Math.pow(1-a,2)*t.y+2*(1-a)*a*e.y+a*a*i.y;o.push(cc.p(h,l)),a+=1/n}o.push(cc.p(i.x,i.y));var _=new cc._DrawNodeElement(cc.DrawNode.TYPE_POLY);_.verts=o,_.lineWidth=r,_.lineColor=s,_.isStroke=!0,_.lineCap="round",this._buffer.push(_)},e.drawCubicBezier=function(t,e,i,n,r,s,o){s=s||this._lineWidth,null==(o=o||this.getDrawColor()).a&&(o.a=255);for(var a=[],c=0,h=0;h<r;h++){var l=Math.pow(1-c,3)*t.x+3*Math.pow(1-c,2)*c*e.x+3*(1-c)*c*c*i.x+c*c*c*n.x,_=Math.pow(1-c,3)*t.y+3*Math.pow(1-c,2)*c*e.y+3*(1-c)*c*c*i.y+c*c*c*n.y;a.push(cc.p(l,_)),c+=1/r}a.push(cc.p(n.x,n.y));var u=new cc._DrawNodeElement(cc.DrawNode.TYPE_POLY);u.verts=a,u.lineWidth=s,u.lineColor=o,u.isStroke=!0,u.lineCap="round",this._buffer.push(u)},e.drawCatmullRom=function(t,e,i,n){this.drawCardinalSpline(t,.5,e,i,n)},e.drawCardinalSpline=function(t,e,i,n,r){n=n||this._lineWidth,null==(r=r||this.getDrawColor()).a&&(r.a=255);for(var s,o,a=[],c=1/t.length,h=0;h<i+1;h++){var l=h/i;1===l?(s=t.length-1,o=1):o=(l-c*(s=0|l/c))/c;var _=cc.cardinalSplineAt(cc.getControlPointAt(t,s-1),cc.getControlPointAt(t,s-0),cc.getControlPointAt(t,s+1),cc.getControlPointAt(t,s+2),e,o);a.push(_)}var u=new cc._DrawNodeElement(cc.DrawNode.TYPE_POLY);u.verts=a,u.lineWidth=n,u.lineColor=r,u.isStroke=!0,u.lineCap="round",this._buffer.push(u)},e.drawDot=function(t,e,i){null==(i=i||this.getDrawColor()).a&&(i.a=255);var n=new cc._DrawNodeElement(cc.DrawNode.TYPE_DOT);n.verts=[t],n.lineWidth=e,n.fillColor=i,this._buffer.push(n)},e.drawDots=function(t,e,i){if(t&&0!=t.length){null==(i=i||this.getDrawColor()).a&&(i.a=255);for(var n=0,r=t.length;n<r;n++)this.drawDot(t[n],e,i)}},e.drawSegment=function(t,e,i,n){i=i||this._lineWidth,null==(n=n||this.getDrawColor()).a&&(n.a=255);var r=new cc._DrawNodeElement(cc.DrawNode.TYPE_POLY);r.verts=[t,e],r.lineWidth=2*i,r.lineColor=n,r.isStroke=!0,r.lineCap="round",this._buffer.push(r)},e.drawPoly_=function(t,e,i,n,r){i=null==i?this._lineWidth:i,null==(n=n||this.getDrawColor()).a&&(n.a=255);var s=new cc._DrawNodeElement(cc.DrawNode.TYPE_POLY);s.verts=t,s.fillColor=e,s.lineWidth=i,s.lineColor=n,s.isClosePolygon=!r,s.isStroke=!0,s.lineCap="round",e&&(s.isFill=!0),this._buffer.push(s)},e.drawPoly=function(t,e,i,n,r){for(var s=[],o=0;o<t.length;o++)s.push(cc.p(t[o].x,t[o].y));return this.drawPoly_(s,e,i,n,r)},e.clear=function(){this._buffer.length=0},t("./CCDrawNodeCanvasRenderCmd"),e._createRenderCmd=function(){return new cc.DrawNode.CanvasRenderCmd(this)}):cc._renderType===cc.game.RENDER_TYPE_WEBGL&&(e._bufferCapacity=0,e._trianglesArrayBuffer=null,e._trianglesWebBuffer=null,e._trianglesReader=null,e._dirty=!1,e._className="DrawNodeWebGL",e.ctor=function(){_ccsg.Node.prototype.ctor.call(this),this._buffer=[],this._blendFunc=new cc.BlendFunc(cc.macro.SRC_ALPHA,cc.macro.ONE_MINUS_SRC_ALPHA),this._drawColor=cc.color(255,255,255,255),this.init()},e.init=function(){return!!_ccsg.Node.prototype.init.call(this)&&(this.shaderProgram=cc.shaderCache.programForKey(cc.macro.SHADER_POSITION_LENGTHTEXTURECOLOR),this._ensureCapacity(64),this._trianglesWebBuffer=cc._renderContext.createBuffer(),this._dirty=!0,!0)},e.drawRect=function(t,e,i,n,r){n=null==n?this._lineWidth:n,null==(r=r||this.getDrawColor()).a&&(r.a=255);var s=[t,cc.p(e.x,t.y),e,cc.p(t.x,e.y)];null==i?this._drawSegments(s,n,r,!0):this.drawPoly(s,i,n,r)},e.drawCircle=function(t,e,i,n,r,s,o){s=s||this._lineWidth,null==(o=o||this.getDrawColor()).a&&(o.a=255);var a,c,h=2*Math.PI/n,l=[];for(a=0;a<=n;a++){var _=a*h,u=e*Math.cos(_+i)+t.x,d=e*Math.sin(_+i)+t.y;l.push(cc.p(u,d))}for(r&&l.push(cc.p(t.x,t.y)),s*=.5,a=0,c=l.length;a<c-1;a++)this.drawSegment(l[a],l[a+1],s,o)},e.drawQuadBezier=function(t,e,i,n,r,s){r=r||this._lineWidth,null==(s=s||this.getDrawColor()).a&&(s.a=255);for(var o=[],a=0,c=0;c<n;c++){var h=Math.pow(1-a,2)*t.x+2*(1-a)*a*e.x+a*a*i.x,l=Math.pow(1-a,2)*t.y+2*(1-a)*a*e.y+a*a*i.y;o.push(cc.p(h,l)),a+=1/n}o.push(cc.p(i.x,i.y)),this._drawSegments(o,r,s,!1)},e.drawCubicBezier=function(t,e,i,n,r,s,o){s=s||this._lineWidth,null==(o=o||this.getDrawColor()).a&&(o.a=255);for(var a=[],c=0,h=0;h<r;h++){var l=Math.pow(1-c,3)*t.x+3*Math.pow(1-c,2)*c*e.x+3*(1-c)*c*c*i.x+c*c*c*n.x,_=Math.pow(1-c,3)*t.y+3*Math.pow(1-c,2)*c*e.y+3*(1-c)*c*c*i.y+c*c*c*n.y;a.push(cc.p(l,_)),c+=1/r}a.push(cc.p(n.x,n.y)),this._drawSegments(a,s,o,!1)},e.drawCatmullRom=function(t,e,i,n){this.drawCardinalSpline(t,.5,e,i,n)},e.drawCardinalSpline=function(t,e,i,n,r){n=n||this._lineWidth,null==(r=r||this.getDrawColor()).a&&(r.a=255);for(var s,o,a=[],c=1/t.length,h=0;h<i+1;h++){var l=h/i;1===l?(s=t.length-1,o=1):o=(l-c*(s=0|l/c))/c;var _=cc.cardinalSplineAt(cc.getControlPointAt(t,s-1),cc.getControlPointAt(t,s-0),cc.getControlPointAt(t,s+1),cc.getControlPointAt(t,s+2),e,o);a.push(_)}n*=.5;for(var u=0,d=a.length;u<d-1;u++)this.drawSegment(a[u],a[u+1],n,r)},e._render=function(){var t=cc._renderContext;t.bindBuffer(t.ARRAY_BUFFER,this._trianglesWebBuffer),this._dirty&&(t.bufferData(t.ARRAY_BUFFER,this._trianglesArrayBuffer,t.STREAM_DRAW),this._dirty=!1);var e=cc.V2F_C4B_T2F.BYTES_PER_ELEMENT;t.enableVertexAttribArray(cc.macro.VERTEX_ATTRIB_POSITION),t.enableVertexAttribArray(cc.macro.VERTEX_ATTRIB_COLOR),t.enableVertexAttribArray(cc.macro.VERTEX_ATTRIB_TEX_COORDS),t.vertexAttribPointer(cc.macro.VERTEX_ATTRIB_POSITION,2,t.FLOAT,!1,e,0),t.vertexAttribPointer(cc.macro.VERTEX_ATTRIB_COLOR,4,t.UNSIGNED_BYTE,!0,e,8),t.vertexAttribPointer(cc.macro.VERTEX_ATTRIB_TEX_COORDS,2,t.FLOAT,!1,e,12),t.drawArrays(t.TRIANGLES,0,3*this._buffer.length),cc.incrementGLDraws(1)},e._ensureCapacity=function(t){var e=this._buffer;if(e.length+t>this._bufferCapacity){var i=cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT;if(this._bufferCapacity+=Math.max(this._bufferCapacity,t),null==e||0===e.length)this._buffer=[],this._trianglesArrayBuffer=new ArrayBuffer(i*this._bufferCapacity),this._trianglesReader=new Uint8Array(this._trianglesArrayBuffer);else{for(var n=[],r=new ArrayBuffer(i*this._bufferCapacity),s=0;s<e.length;s++)n[s]=new cc.V2F_C4B_T2F_Triangle(e[s].a,e[s].b,e[s].c,r,s*i);this._trianglesReader=new Uint8Array(r),this._trianglesArrayBuffer=r,this._buffer=n}}},e.drawDot=function(t,e,i){null==(i=i||this.getDrawColor()).a&&(i.a=255);var n={r:0|i.r,g:0|i.g,b:0|i.b,a:0|i.a},r={vertices:{x:t.x-e,y:t.y-e},colors:n,texCoords:{u:-1,v:-1}},s={vertices:{x:t.x-e,y:t.y+e},colors:n,texCoords:{u:-1,v:1}},o={vertices:{x:t.x+e,y:t.y+e},colors:n,texCoords:{u:1,v:1}},a={vertices:{x:t.x+e,y:t.y-e},colors:n,texCoords:{u:1,v:-1}};this._ensureCapacity(6),this._buffer.push(new cc.V2F_C4B_T2F_Triangle(r,s,o,this._trianglesArrayBuffer,this._buffer.length*cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT)),this._buffer.push(new cc.V2F_C4B_T2F_Triangle(r,o,a,this._trianglesArrayBuffer,this._buffer.length*cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT)),this._dirty=!0},e.drawDots=function(t,e,i){if(t&&0!==t.length){null==(i=i||this.getDrawColor()).a&&(i.a=255);for(var n=0,r=t.length;n<r;n++)this.drawDot(t[n],e,i)}},e.drawSegment=function(t,e,i,r){null==(r=r||this.getDrawColor()).a&&(r.a=255),i=i||.5*this._lineWidth;this._ensureCapacity(18);var s={r:0|r.r,g:0|r.g,b:0|r.b,a:0|r.a},o=cc.v2(t),a=cc.v2(e),c=cc.pNormalize(cc.pPerp(cc.pSub(a,o))),h=cc.pPerp(c),l=cc.pMult(c,i),_=cc.pMult(h,i),u=cc.pSub(a,cc.pAdd(l,_)),d=cc.pAdd(a,cc.pSub(l,_)),m=cc.pSub(a,l),f=cc.pAdd(a,l),p=cc.pSub(o,l),g=cc.pAdd(o,l),v=cc.pSub(o,cc.pSub(l,_)),y=cc.pAdd(o,cc.pAdd(l,_)),x=cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT,C=this._trianglesArrayBuffer,A=this._buffer;A.push(new cc.V2F_C4B_T2F_Triangle({vertices:u,colors:s,texCoords:n(cc.pNeg(cc.pAdd(c,h)))},{vertices:d,colors:s,texCoords:n(cc.pSub(c,h))},{vertices:m,colors:s,texCoords:n(cc.pNeg(c))},C,A.length*x)),A.push(new cc.V2F_C4B_T2F_Triangle({vertices:f,colors:s,texCoords:n(c)},{vertices:d,colors:s,texCoords:n(cc.pSub(c,h))},{vertices:m,colors:s,texCoords:n(cc.pNeg(c))},C,A.length*x)),A.push(new cc.V2F_C4B_T2F_Triangle({vertices:f,colors:s,texCoords:n(c)},{vertices:p,colors:s,texCoords:n(cc.pNeg(c))},{vertices:m,colors:s,texCoords:n(cc.pNeg(c))},C,A.length*x)),A.push(new cc.V2F_C4B_T2F_Triangle({vertices:f,colors:s,texCoords:n(c)},{vertices:p,colors:s,texCoords:n(cc.pNeg(c))},{vertices:g,colors:s,texCoords:n(c)},C,A.length*x)),A.push(new cc.V2F_C4B_T2F_Triangle({vertices:v,colors:s,texCoords:n(cc.pSub(h,c))},{vertices:p,colors:s,texCoords:n(cc.pNeg(c))},{vertices:g,colors:s,texCoords:n(c)},C,A.length*x)),A.push(new cc.V2F_C4B_T2F_Triangle({vertices:v,colors:s,texCoords:n(cc.pSub(h,c))},{vertices:y,colors:s,texCoords:n(cc.pAdd(c,h))},{vertices:g,colors:s,texCoords:n(c)},C,A.length*x)),this._dirty=!0},e.drawPoly=function(t,e,i,r,s){if(null!=e){null==e.a&&(e.a=255),null==r.a&&(r.a=255),i=null==i?this._lineWidth:i,i*=.5;var o,a,c,h,l={r:0|e.r,g:0|e.g,b:0|e.b,a:0|e.a},_={r:0|r.r,g:0|r.g,b:0|r.b,a:0|r.a},u=[],d=t.length;for(o=0;o<d;o++){a=cc.v2(t[(o-1+d)%d]),c=cc.v2(t[o]),h=cc.v2(t[(o+1)%d]);var m=cc.pNormalize(cc.pPerp(cc.pSub(c,a))),f=cc.pNormalize(cc.pPerp(cc.pSub(h,c))),p=cc.pMult(cc.pAdd(m,f),1/(cc.pDot(m,f)+1));u[o]={offset:p,n:f}}var g=i>0,v=3*(3*d-2);this._ensureCapacity(v);var y,x,C,A=cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT,T=this._trianglesArrayBuffer,b=this._buffer;for(o=0;o<d-2;o++)y={vertices:t[0],colors:l,texCoords:n(cc.v2())},x={vertices:t[o+1],colors:l,texCoords:n(cc.v2())},C={vertices:t[o+2],colors:l,texCoords:n(cc.v2())},b.push(new cc.V2F_C4B_T2F_Triangle(y,x,C,T,b.length*A));if(g)for(o=0;o<d;o++){var w=(o+1)%d;a=cc.v2(t[o]),c=cc.v2(t[w]);var S=u[o].n,E=u[o].offset,I=u[w].offset,R=cc.pSub(a,cc.pMult(E,i)),P=cc.pSub(c,cc.pMult(I,i)),B=cc.pAdd(a,cc.pMult(E,i)),L=cc.pAdd(c,cc.pMult(I,i));y={vertices:R,colors:_,texCoords:n(cc.pNeg(S))},x={vertices:P,colors:_,texCoords:n(cc.pNeg(S))},C={vertices:L,colors:_,texCoords:n(S)},b.push(new cc.V2F_C4B_T2F_Triangle(y,x,C,T,b.length*A)),y={vertices:R,colors:_,texCoords:n(cc.pNeg(S))},x={vertices:B,colors:_,texCoords:n(S)},C={vertices:L,colors:_,texCoords:n(S)},b.push(new cc.V2F_C4B_T2F_Triangle(y,x,C,T,b.length*A))}u=null,this._dirty=!0}else this._drawSegments(t,i,r,!s)},e._drawSegments=function(t,e,i,r){if(e=null==e?this._lineWidth:e,null==(i=i||this._drawColor).a&&(i.a=255),!((e*=.5)<=0)){var s,o,a,c,h={r:0|i.r,g:0|i.g,b:0|i.b,a:0|i.a},l=[],_=t.length;for(s=0;s<_;s++){o=cc.v2(t[(s-1+_)%_]),a=cc.v2(t[s]),c=cc.v2(t[(s+1)%_]);var u=cc.pNormalize(cc.pPerp(cc.pSub(a,o))),d=cc.pNormalize(cc.pPerp(cc.pSub(c,a))),m=cc.pMult(cc.pAdd(u,d),1/(cc.pDot(u,d)+1));l[s]={offset:m,n:d}}var f=3*(3*_-2);this._ensureCapacity(f);var p=cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT,g=this._trianglesArrayBuffer,v=this._buffer,y=r?_:_-1;for(s=0;s<y;s++){var x=(s+1)%_;o=cc.v2(t[s]),a=cc.v2(t[x]);var C=l[s].n,A=l[s].offset,T=l[x].offset,b=cc.pSub(o,cc.pMult(A,e)),w=cc.pSub(a,cc.pMult(T,e)),S=cc.pAdd(o,cc.pMult(A,e)),E=cc.pAdd(a,cc.pMult(T,e));v.push(new cc.V2F_C4B_T2F_Triangle({vertices:b,colors:h,texCoords:n(cc.pNeg(C))},{vertices:w,colors:h,texCoords:n(cc.pNeg(C))},{vertices:E,colors:h,texCoords:n(C)},g,v.length*p)),v.push(new cc.V2F_C4B_T2F_Triangle({vertices:b,colors:h,texCoords:n(cc.pNeg(C))},{vertices:S,colors:h,texCoords:n(C)},{vertices:E,colors:h,texCoords:n(C)},g,v.length*p))}l=null,this._dirty=!0}},e.clear=function(){this._buffer.length=0,this._dirty=!0},t("./CCDrawNodeWebGLRenderCmd"),e._createRenderCmd=function(){return new cc.DrawNode.WebGLRenderCmd(this)})}))}),{"./CCDrawNodeCanvasRenderCmd":242,"./CCDrawNodeWebGLRenderCmd":243}],242:[(function(t,e,i){cc.DrawNode.CanvasRenderCmd=function(t){this._rootCtor(t),this._needDraw=!0,this._buffer=null,this._drawColor=null,this._blendFunc=null};var n=cc.DrawNode.CanvasRenderCmd.prototype=Object.create(_ccsg.Node.CanvasRenderCmd.prototype);n.constructor=cc.DrawNode.CanvasRenderCmd,n.rendering=function(t,e,i){var n=t||cc._renderContext,r=(n.getContext(),this._node._displayedOpacity/255);if(0!==r){n.setTransform(this._worldTransform,e,i),n.setGlobalAlpha(r),this._blendFunc&&this._blendFunc.src===cc.macro.SRC_ALPHA&&this._blendFunc.dst===cc.macro.ONE&&n.setCompositeOperation("lighter");for(var s=this._buffer,o=0,a=s.length;o<a;o++){var c=s[o];switch(c.type){case cc.DrawNode.TYPE_DOT:this._drawDot(n,c,e,i);break;case cc.DrawNode.TYPE_SEGMENT:this._drawSegment(n,c,e,i);break;case cc.DrawNode.TYPE_POLY:this._drawPoly(n,c,e,i)}}}},n._drawDot=function(t,e,i,n){var r=e.fillColor,s=e.verts[0],o=e.lineWidth,a=t.getContext();t.setFillStyle("rgba("+(0|r.r)+","+(0|r.g)+","+(0|r.b)+","+r.a/255+")"),a.beginPath(),a.arc(s.x,-s.y,o,0,2*Math.PI,!1),a.closePath(),a.fill()},n._drawSegment=function(t,e,i,n){var r=e.lineColor,s=e.verts[0],o=e.verts[1],a=e.lineWidth,c=e.lineCap,h=t.getContext();t.setStrokeStyle("rgba("+(0|r.r)+","+(0|r.g)+","+(0|r.b)+","+r.a/255+")"),h.lineWidth=a*i,h.beginPath(),h.lineCap=c,h.moveTo(s.x,-s.y),h.lineTo(o.x,-o.y),h.stroke()},n._drawPoly=function(t,e,i,n){var r=e.verts,s=e.lineCap;if(null!=r){var o=e.fillColor,a=e.lineWidth,c=e.lineColor,h=e.isClosePolygon,l=e.isFill,_=e.isStroke,u=t.getContext(),d=r[0];u.lineCap=s,o&&t.setFillStyle("rgba("+(0|o.r)+","+(0|o.g)+","+(0|o.b)+","+o.a/255+")"),a&&(u.lineWidth=a*i),c&&t.setStrokeStyle("rgba("+(0|c.r)+","+(0|c.g)+","+(0|c.b)+","+c.a/255+")"),u.beginPath(),u.moveTo(d.x,-d.y);for(var m=1,f=r.length;m<f;m++)u.lineTo(r[m].x,-r[m].y);h&&u.closePath(),l&&u.fill(),_&&u.stroke()}}}),{}],243:[(function(t,e,i){cc.DrawNode.WebGLRenderCmd=function(t){this._rootCtor(t),this._needDraw=!0,this._matrix=new cc.math.Matrix4,this._matrix.identity()},cc.DrawNode.WebGLRenderCmd.prototype=Object.create(_ccsg.Node.WebGLRenderCmd.prototype),cc.DrawNode.WebGLRenderCmd.prototype.constructor=cc.DrawNode.WebGLRenderCmd,cc.DrawNode.WebGLRenderCmd.prototype.rendering=function(t){var e=this._node;if(e._buffer.length>0){var i=this._worldTransform,n=this._matrix.mat;n[0]=i.a,n[4]=i.c,n[12]=i.tx,n[1]=i.b,n[5]=i.d,n[13]=i.ty,cc.gl.blendFunc(e._blendFunc.src,e._blendFunc.dst),this._shaderProgram.use(),this._shaderProgram._setUniformForMVPMatrixWithMat4(this._matrix),e._render()}}}),{}],244:[(function(t,e,i){t("./cocos2d/core"),t("./cocos2d/animation"),t("./cocos2d/particle/CCParticleSystem"),t("./cocos2d/tilemap/CCTiledMap"),t("./cocos2d/motion-streak/CCMotionStreak"),t("./cocos2d/core/components/CCStudioComponent"),t("./extensions/ccpool/CCNodePool"),t("./extensions/ccpool/CCPool"),t("./cocos2d/actions"),t("./external/chipmunk/chipmunk"),t("./extensions/spine"),t("./extensions/dragonbones"),t("./cocos2d/deprecated")}),{"./cocos2d/actions":11,"./cocos2d/animation":19,"./cocos2d/core":104,"./cocos2d/core/components/CCStudioComponent":1,"./cocos2d/deprecated":221,"./cocos2d/motion-streak/CCMotionStreak":1,"./cocos2d/particle/CCParticleAsset":1,"./cocos2d/particle/CCParticleSystem":1,"./cocos2d/tilemap/CCTiledMap":1,"./cocos2d/tilemap/CCTiledMapAsset":1,"./extensions/ccpool/CCNodePool":245,"./extensions/ccpool/CCPool":246,"./extensions/dragonbones":1,"./extensions/spine":1,"./external/chipmunk/chipmunk":1}],245:[(function(t,e,i){cc.NodePool=function(t){this.poolHandlerComp=t,this._pool=[]},cc.NodePool.prototype={constructor:cc.NodePool,size:function(){return this._pool.length},clear:function(){for(var t=this._pool.length,e=0;e<t;++e)this._pool[e].destroy();this._pool.length=0},put:function(t){if(t&&-1===this._pool.indexOf(t)){t.removeFromParent(!1);var e=this.poolHandlerComp?t.getComponent(this.poolHandlerComp):null;e&&e.unuse&&e.unuse(),this._pool.push(t)}},get:function(){var t=this._pool.length-1;if(t<0)return null;var e=this._pool[t];this._pool.length=t;var i=this.poolHandlerComp?e.getComponent(this.poolHandlerComp):null;return i&&i.reuse&&i.reuse.apply(i,arguments),e}},e.exports=cc.NodePool}),{}],246:[(function(t,e,i){var n=[];cc.pool={_pool:{},_releaseCB:function(){this.release()},_autoRelease:function(t){var e=void 0!==t._running&&!t._running;cc.director.getScheduler().schedule(this._releaseCB,t,0,0,0,e)},putInPool:function(t){var e=cc.js._getClassId(t.constructor);e&&(this._pool[e]||(this._pool[e]=[]),t.unuse&&t.unuse(),this._pool[e].push(t))},hasObject:function(t){var e=cc.js._getClassId(t),i=this._pool[e];return!(!i||0===i.length)},removeObject:function(t){var e=cc.js._getClassId(t.constructor);if(e){var i=this._pool[e];if(i)for(var n=0;n<i.length;n++)t===i[n]&&i.splice(n,1)}},getFromPool:function(t){if(this.hasObject(t)){var e=cc.js._getClassId(t),i=this._pool[e];n.length=arguments.length-1;for(var r=0;r<n.length;r++)n[r]=arguments[r+1];var s=i.pop();return s.reuse&&s.reuse.apply(s,n),n.length=0,s}},drainAllPools:function(){this._pool={}}}}),{}],247:[(function(t,e,i){(function(){"use strict";function t(t){t||console.log("Assertion failed! Pls debug.")}function i(t,e,i){this.major=t,this.minor=e,this.revision=i}function n(t){return isFinite(t)&&!isNaN(t)}function r(t,e){void 0!==t?(this.x=t,this.y=e):this.x=this.y=0}function s(t,e,i){void 0!==t&&(this.x=t,this.y=e,this.z=i)}function o(t,e){this.ex=t?t.Clone():new r,this.ey=e?e.Clone():new r}function a(t,e,i){this.ex=t?t.Clone():new s,this.ey=e?e.Clone():new s,this.ez=i?i.Clone():new s}function c(t,e){void 0!==e?(this.s=t,this.c=e):void 0!==t&&this.Set(t)}function h(t,e){this.p=new r,this.q=new c,t&&(this.p.Assign(t),this.q.Assign(e))}function l(){this.localCenter=new r,this.c0=new r,this.c=new r}function _(t,e){return t.x*e.x+t.y*e.y}function u(t,e){return t.x*e.y-t.y*e.x}function d(t,e){return new r(e*t.y,-e*t.x)}function m(t,e){return new r(-t*e.y,t*e.x)}function f(t,e){return new r(t.ex.x*e.x+t.ey.x*e.y,t.ex.y*e.x+t.ey.y*e.y)}function p(t,e){return r.Subtract(t,e).Length()}function g(t,e){var i=r.Subtract(t,e);return _(i,i)}function v(t,e){return t.x*e.x+t.y*e.y+t.z*e.z}function y(t,e){return new s(t.y*e.z-t.z*e.y,t.z*e.x-t.x*e.z,t.x*e.y-t.y*e.x)}function x(t,e){return s.Add(s.Add(s.Multiply(e.x,t.ex),s.Multiply(e.y,t.ey)),s.Multiply(e.z,t.ez))}function C(t,e){return new r(t.ex.x*e.x+t.ey.x*e.y,t.ex.y*e.x+t.ey.y*e.y)}function A(t,e){var i=new c;return i.s=t.s*e.c+t.c*e.s,i.c=t.c*e.c-t.s*e.s,i}function T(t,e){var i=new c;return i.s=t.c*e.s-t.s*e.c,i.c=t.c*e.c+t.s*e.s,i}function b(t,e){return new r(t.c*e.x-t.s*e.y,t.s*e.x+t.c*e.y)}function w(t,e){return new r(t.c*e.x+t.s*e.y,-t.s*e.x+t.c*e.y)}function S(t,e){return new r(t.q.c*e.x-t.q.s*e.y+t.p.x,t.q.s*e.x+t.q.c*e.y+t.p.y)}function E(t,e){var i=e.x-t.p.x,n=e.y-t.p.y;return new r(t.q.c*i+t.q.s*n,-t.q.s*i+t.q.c*n)}function I(t,e){var i=new h;i.q=T(t.q,e.q);var n=e.p.x-t.p.x,r=e.p.y-t.p.y;return i.p.x=t.q.c*n+t.q.s*r,i.p.y=-t.q.s*n+t.q.c*r,i}function R(t){return new r(ri(t.x),ri(t.y))}function P(t,e){return new r(si(t.x,e.x),si(t.y,e.y))}function B(t,e){return new r(oi(t.x,e.x),oi(t.y,e.y))}function L(t,e,i){return oi(e,si(t,i))}function O(t,e,i){this.r=t||0,this.g=e||0,this.b=i||0}function D(){}function N(){this.Reset()}function M(){this.mass=0,this.center=new r,this.I=0}function F(){this.m_type=0,this.m_radius=0}function z(){this.parent.call(this),this.m_type=F.e_circle,this.m_radius=0,this.m_p=new r,Object.seal(this)}function G(){this.parent.call(this),this.m_type=F.e_edge,this.m_radius=qe,this.m_vertex0=new r,this.m_vertex1=new r,this.m_vertex2=new r,this.m_vertex3=new r,this.m_hasVertex0=!1,this.m_hasVertex3=!1,Object.seal(this)}function V(){this.parent.call(this),this.m_type=F.e_chain,this.m_radius=qe,this.m_prevVertex=new r,this.m_nextVertex=new r,this.m_hasPrevVertex=!1,this.m_hasNextVertex=!1,this.Clear(),Object.seal(this)}function k(){this.parent.call(this),this.m_type=F.e_polygon,this.m_radius=qe,this.m_count=0,this.m_centroid=new r,this.m_vertices=new Array(We),this.m_normals=new Array(We),Object.seal(this)}function W(){this.proxyIdA=0,this.proxyIdB=0}function U(t,e){return t.proxyIdA==e.proxyIdA?t.proxyIdB-e.proxyIdB:t.proxyIdA-e.proxyIdA}function j(){this.m_tree=new Ct,this.m_queryProxyId=0,this.m_proxyCount=0,this.m_pairCount=0,this.m_pairBuffer=[],this.m_moveCount=0,this.m_moveBuffer=[]}function q(){this.m_vertices=null,this.m_count=0,this.m_radius=0}function Y(){this.metric=0,this.count=0,this.indexA=[0,0,0],this.indexB=[0,0,0]}function X(){this.proxyA=new q,this.proxyB=new q,this.transformA=new h,this.transformB=new h,this.useRadii=!1}function H(){this.pointA=new r,this.pointB=new r,this.distance=0,this.iterations=0}function J(){this.wA=new r,this.wB=new r,this.w=new r,this.a=0,this.indexA=0,this.indexB=0}function Z(){this.m_v=[new J,new J,new J],this.m_count=0}function Q(e,i,n){++Q.b2_gjkCalls;var r=n.proxyA,s=n.proxyB,o=n.transformA,a=n.transformB;ai.ReadCache(i,r,o,s,a);for(var c=ai.m_v,h=[0,0,0],l=[0,0,0],_=0,u=ze,d=u,m=0;m<20;){_=ai.m_count;for(var f=0;f<_;++f)h[f]=c[f].indexA,l[f]=c[f].indexB;switch(ai.m_count){case 1:break;case 2:ai.Solve2();break;case 3:ai.Solve3();break;default:t(!1)}if(3==ai.m_count)break;if(ai.GetClosestPoint(hi),d=hi.LengthSquared(),u=d,ai.GetSearchDirection(hi),hi.LengthSquared()<Ge*Ge)break;var g=c[ai.m_count];g.indexA=r.GetSupport(o.q.c*-hi.x+o.q.s*-hi.y,-o.q.s*-hi.x+o.q.c*-hi.y);var v=r.GetVertex(g.indexA);g.wA.x=o.q.c*v.x-o.q.s*v.y+o.p.x,g.wA.y=o.q.s*v.x+o.q.c*v.y+o.p.y,g.indexB=s.GetSupport(a.q.c*hi.x+a.q.s*hi.y,-a.q.s*hi.x+a.q.c*hi.y);var y=s.GetVertex(g.indexB);g.wB.x=a.q.c*y.x-a.q.s*y.y+a.p.x,g.wB.y=a.q.s*y.x+a.q.c*y.y+a.p.y,g.w.x=g.wB.x-g.wA.x,g.w.y=g.wB.y-g.wA.y,++m,++Q.b2_gjkIters;var x=!1;for(f=0;f<_;++f)if(g.indexA==h[f]&&g.indexB==l[f]){x=!0;break}if(x)break;++ai.m_count}if(Q.b2_gjkMaxIters=oi(Q.b2_gjkMaxIters,m),ai.GetWitnessPoints(e.pointA,e.pointB),e.distance=p(e.pointA,e.pointB),e.iterations=m,ai.WriteCache(i),n.useRadii){var C=r.m_radius,A=s.m_radius;if(e.distance>C+A&&e.distance>Ge)e.distance-=C+A,ci.x=e.pointB.x-e.pointA.x,ci.y=e.pointB.y-e.pointA.y,ci.Normalize(),e.pointA.x+=C*ci.x,e.pointA.y+=C*ci.y,e.pointB.x-=A*ci.x,e.pointB.y-=A*ci.y;else{var T=.5*(e.pointA.x+e.pointB.x),b=.5*(e.pointA.y+e.pointB.y);e.pointA.x=T,e.pointA.y=b,e.pointB.x=T,e.pointB.y=b,e.distance=0}}}function K(){}function $(){this.localPoint=new r,this.normalImpulse=0,this.tangentImpulse=0,this.id=new K}function tt(){this.points=new Array(ke),this.localNormal=new r,this.localPoint=new r,this.type=0,this.pointCount=0}function et(){this.normal=new r,this.points=new Array(ke),this.separations=new Array(ke)}function it(){this.v=new r,this.id=new K}function nt(){this.p1=new r,this.p2=new r,this.maxFraction=0}function rt(){this.normal=new r,this.fraction=0}function st(){this.lowerBound=new r,this.upperBound=new r}function ot(t,e,i,n,r){t.pointCount=0;var s=S(i,e.m_p),o=S(r,n.m_p),a=o.x-s.x,c=o.y-s.y,h=a*a+c*c,l=e.m_radius+n.m_radius;h>l*l||(t.type=tt.e_circles,t.localPoint.x=e.m_p.x,t.localPoint.y=e.m_p.y,t.localNormal.x=t.localNormal.y=0,t.pointCount=1,t.points[0]=new $,t.points[0].localPoint.x=n.m_p.x,t.points[0].localPoint.y=n.m_p.y,t.points[0].id.Reset())}function at(t,e,i,n,r){t.pointCount=0;for(var s=E(i,S(r,n.m_p)),o=0,a=-ze,c=e.m_radius+n.m_radius,h=e.m_count,l=e.m_vertices,_=e.m_normals,u=0;u<h;++u){var d=_[u].x*(s.x-l[u].x)+_[u].y*(s.y-l[u].y);if(d>c)return;d>a&&(a=d,o=u)}var m=o,f=m+1<h?m+1:0,p=l[m],v=l[f];if(a<Ge)return t.pointCount=1,t.type=tt.e_faceA,t.localNormal.x=_[o].x,t.localNormal.y=_[o].y,t.localPoint.x=.5*(p.x+v.x),t.localPoint.y=.5*(p.y+v.y),t.points[0]=new $,t.points[0].localPoint.x=n.m_p.x,t.points[0].localPoint.y=n.m_p.y,void t.points[0].id.Reset();var y=(s.x-p.x)*(v.x-p.x)+(s.y-p.y)*(v.y-p.y),x=(s.x-v.x)*(p.x-v.x)+(s.y-v.y)*(p.y-v.y);if(y<=0){if(g(s,p)>c*c)return;t.pointCount=1,t.type=tt.e_faceA,t.localNormal.x=s.x-p.x,t.localNormal.y=s.y-p.y,t.localNormal.Normalize(),t.localPoint.x=p.x,t.localPoint.y=p.y,t.points[0]=new $,t.points[0].localPoint.x=n.m_p.x,t.points[0].localPoint.y=n.m_p.y,t.points[0].id.Reset()}else if(x<=0){if(g(s,v)>c*c)return;t.pointCount=1,t.type=tt.e_faceA,t.localNormal.x=s.x-v.x,t.localNormal.y=s.y-v.y,t.localNormal.Normalize(),t.localPoint.x=v.x,t.localPoint.y=v.y,t.points[0]=new $,t.points[0].localPoint.x=n.m_p.x,t.points[0].localPoint.y=n.m_p.y,t.points[0].id.Reset()}else{var C=.5*(p.x+v.x),A=.5*(p.y+v.y);if((a=(s.x-C)*_[m].x+(s.y-A)*_[m].y)>c)return;t.pointCount=1,t.type=tt.e_faceA,t.localNormal.x=_[m].x,t.localNormal.y=_[m].y,t.localPoint.x=C,t.localPoint.y=A,t.points[0]=new $,t.points[0].localPoint.x=n.m_p.x,t.points[0].localPoint.y=n.m_p.y,t.points[0].id.Reset()}}function ct(t,e,i,n,r){for(var s=e.m_count,o=n.m_count,a=e.m_normals,c=e.m_vertices,h=n.m_vertices,l=I(r,i),_=0,u=-ze,d=0;d<s;++d){for(var m=l.q.c*a[d].x-l.q.s*a[d].y,f=l.q.s*a[d].x+l.q.c*a[d].y,p=l.q.c*c[d].x-l.q.s*c[d].y+l.p.x,g=l.q.s*c[d].x+l.q.c*c[d].y+l.p.y,v=ze,y=0;y<o;++y){var x=m*(h[y].x-p)+f*(h[y].y-g);x<v&&(v=x)}v>u&&(u=v,_=d)}return t[0]=_,u}function ht(e,i,n,r,s,o){var a=i.m_normals,c=s.m_count,h=s.m_vertices,l=s.m_normals;t(0<=r&&r<i.m_count);for(var _=n.q.c*a[r].x-n.q.s*a[r].y,u=n.q.s*a[r].x+n.q.c*a[r].y,d=o.q.c*_+o.q.s*u,m=-o.q.s*_+o.q.c*u,f=0,p=ze,g=0;g<c;++g){var v=d*l[g].x+m*l[g].y;v<p&&(p=v,f=g)}var y=f,x=y+1<c?y+1:0;e[0].v.x=o.q.c*h[y].x-o.q.s*h[y].y+o.p.x,e[0].v.y=o.q.s*h[y].x+o.q.c*h[y].y+o.p.y,e[0].id.indexA=r,e[0].id.indexB=y,e[0].id.typeA=K.e_face,e[0].id.typeB=K.e_vertex,e[1].v.x=o.q.c*h[x].x-o.q.s*h[x].y+o.p.x,e[1].v.y=o.q.s*h[x].x+o.q.c*h[x].y+o.p.y,e[1].id.indexA=r,e[1].id.indexB=x,e[1].id.typeA=K.e_face,e[1].id.typeB=K.e_vertex}function lt(t,e,i,n,r){t.pointCount=0;var s=e.m_radius+n.m_radius,o=[0],a=ct(o,e,i,n,r);if(!(a>s)){var c=[0],h=ct(c,n,r,e,i);if(!(h>s)){var l,_,u,d,m=0,f=0;h>a+.1*Ue?(l=n,_=e,u=r,d=i,m=c[0],t.type=tt.e_faceB,f=1):(l=e,_=n,u=i,d=r,m=o[0],t.type=tt.e_faceA,f=0),ht(lt._local_incidentEdges,l,u,m,_,d);var p=l.m_count,g=l.m_vertices,v=m,y=m+1<p?m+1:0,x=g[v],C=g[y];lt._localTangent.x=C.x-x.x,lt._localTangent.y=C.y-x.y,lt._localTangent.Normalize();var A=1*lt._localTangent.y,T=-1*lt._localTangent.x,b=.5*(x.x+C.x),w=.5*(x.y+C.y),I=u.q.c*lt._localTangent.x-u.q.s*lt._localTangent.y,R=u.q.s*lt._localTangent.x+u.q.c*lt._localTangent.y,P=1*R,B=-1*I;x=S(u,x),C=S(u,C);var L=P*x.x+B*x.y,O=-(I*x.x+R*x.y)+s,D=I*C.x+R*C.y+s,N=new Array(2),M=new Array(2);if(!(gt(N,lt._local_incidentEdges,-I,-R,O,v)<2||gt(M,N,I,R,D,y)<2)){t.localNormal.x=A,t.localNormal.y=T,t.localPoint.x=b,t.localPoint.y=w;for(var F=0,z=0;z<ke;++z){if(P*M[z].v.x+B*M[z].v.y-L<=s){var G=t.points[F]=new $;if(G.localPoint.Assign(E(d,M[z].v)),G.id.Assign(M[z].id),f){var V=new K;V.Assign(G.id),G.id.indexA=V.indexB,G.id.indexB=V.indexA,G.id.typeA=V.typeB,G.id.typeB=V.typeA}++F}}t.pointCount=F}}}}function _t(e,i,n,r,s){e.pointCount=0;var o=E(n,S(s,r.m_p)),a=i.m_vertex1,c=i.m_vertex2,h=c.x-a.x,l=c.y-a.y,_=h*(c.x-o.x)+l*(c.y-o.y),u=h*(o.x-a.x)+l*(o.y-a.y),d=i.m_radius+r.m_radius,m=new K;if(m.indexB=0,m.typeB=K.e_vertex,u<=0){var f=a;if((w=o.x-f.x)*w+(I=o.y-f.y)*I>d*d)return;if(i.m_hasVertex0){var p=i.m_vertex0,g=a,v=g.x-p.x,y=g.y-p.y;if(v*(g.x-o.x)+y*(g.y-o.y)>0)return}return m.indexA=0,m.typeA=K.e_vertex,e.pointCount=1,e.type=tt.e_circles,e.localNormal.x=e.localNormal.y=0,e.localPoint.x=f.x,e.localPoint.y=f.y,e.points[0]=new $,e.points[0].id.Assign(m),e.points[0].localPoint.x=r.m_p.x,void(e.points[0].localPoint.y=r.m_p.y)}if(_<=0){f=c;if((w=o.x-f.x)*w+(I=o.y-f.y)*I>d*d)return;if(i.m_hasVertex3){var x=i.m_vertex3,C=c,A=x.x-C.x,T=x.y-C.y;if(A*(o.x-C.x)+T*(o.y-C.y)>0)return}return m.indexA=1,m.typeA=K.e_vertex,e.pointCount=1,e.type=tt.e_circles,e.localNormal.x=e.localNormal.y=0,e.localPoint.x=f.x,e.localPoint.y=f.y,e.points[0]=new $,e.points[0].id.Assign(m),e.points[0].localPoint.x=r.m_p.x,void(e.points[0].localPoint.y=r.m_p.y)}var b=h*h+l*l;t(b>0);var w,I,R=1/b*(_*a.x+u*c.x),P=1/b*(_*a.y+u*c.y);if(!((w=o.x-R)*w+(I=o.y-P)*I>d*d)){var B=-l,L=h;B*(o.x-a.x)+L*(o.y-a.y)<0&&(B=-B,L=-L),m.indexA=0,m.typeA=K.e_face,e.pointCount=1,e.type=tt.e_faceA,e.localNormal.x=B,e.localNormal.y=L,e.localNormal.Normalize(),e.localPoint.x=a.x,e.localPoint.y=a.y,e.points[0]=new $,e.points[0].id.Assign(m),e.points[0].localPoint.x=r.m_p.x,e.points[0].localPoint.y=r.m_p.y}}function ut(){this.type=0,this.index=0,this.separation=0}function dt(){this.vertices=new Array(We),this.normals=new Array(We),this.count=0}function mt(){this.i1=0,this.i2=0,this.v1=new r,this.v2=new r,this.normal=new r,this.sideNormal1=new r,this.sideOffset1=0,this.sideNormal2=new r,this.sideOffset2=0}function ft(){this.m_polygonB=new dt,this.m_xf=new h,this.m_centroidB=new r,this.m_v0=new r,this.m_v1=new r,this.m_v2=new r,this.m_v3=new r,this.m_normal0=new r,this.m_normal1=new r,this.m_normal2=new r,this.m_normal=new r,this.m_type1=0,this.m_type2=0,this.m_lowerLimit=new r,this.m_upperLimit=new r,this.m_radius=0,this.m_front=!1}function pt(t,e,i,n,r){pt.collider.Collide(t,e,i,n,r)}function gt(t,e,i,n,r,s){var o=0,a=i*e[0].v.x+n*e[0].v.y-r,c=i*e[1].v.x+n*e[1].v.y-r;if(a<=0&&(t[o++]=e[0]),c<=0&&(t[o++]=e[1]),a*c<0){var h=a/(a-c);t[o]=new it,t[o].v.x=e[0].v.x+h*(e[1].v.x-e[0].v.x),t[o].v.y=e[0].v.y+h*(e[1].v.y-e[0].v.y),t[o].id.indexA=s,t[o].id.indexB=e[0].id.indexB,t[o].id.typeA=K.e_vertex,t[o].id.typeB=K.e_face,++o}return o}function vt(t,e,i,n,r,s){return vt.input.proxyA.Set(t,e),vt.input.proxyB.Set(i,n),vt.input.transformA=r,vt.input.transformB=s,vt.input.useRadii=!0,vt.cache.count=0,Q(vt.output,vt.cache,vt.input),vt.output.distance<10*Ge}function yt(t,e){return!(e.lowerBound.x-t.upperBound.x>0||e.lowerBound.y-t.upperBound.y>0||t.lowerBound.x-e.upperBound.x>0||t.lowerBound.y-e.upperBound.y>0)}function xt(){this.aabb=new st,this.userData=null,this.parent=0,this.child1=this.child2=this.height=0}function Ct(){this.m_root=li,this.m_nodeCapacity=16,this.m_nodeCount=0,this.m_nodes=new Array(this.m_nodeCapacity);for(var t=0;t<this.m_nodeCapacity-1;++t)this.m_nodes[t]=new xt,this.m_nodes[t].parent=t+1,this.m_nodes[t].height=-1;this.m_nodes[this.m_nodeCapacity-1]=new xt,this.m_nodes[this.m_nodeCapacity-1].parent=li,this.m_nodes[this.m_nodeCapacity-1].height=-1,this.m_freeList=0,this.m_path=0,this.m_insertionCount=0}function At(){this.proxyA=new q,this.proxyB=new q,this.sweepA=new l,this.sweepB=new l,this.tMax=0}function Tt(){this.state=0,this.t=0}function bt(){this.m_proxyA=null,this.m_proxyB=null,this.m_sweepA=null,this.m_sweepB=null,this.m_type=0,this.m_localPoint=new r,this.m_axis=new r}function wt(e,i){di.start(),++wt.b2_toiCalls,e.state=Tt.e_unknown,e.t=i.tMax;var n=i.proxyA,r=i.proxyB;wt._temp_sweepA.Assign(i.sweepA),wt._temp_sweepB.Assign(i.sweepB),wt._temp_sweepA.Normalize(),wt._temp_sweepB.Normalize();var s=i.tMax,o=n.m_radius+r.m_radius,a=oi(Ue,o-3*Ue),c=.25*Ue;t(a>c);var h=0,l=0,_=new Y;_.count=0;var u=new X;for(u.proxyA.Assign(i.proxyA),u.proxyB.Assign(i.proxyB),u.useRadii=!1;;){wt._temp_sweepA.GetTransform(u.transformA,h),wt._temp_sweepB.GetTransform(u.transformB,h);var d=new H;if(Q(d,_,u),d.distance<=0){e.state=Tt.e_overlapped,e.t=0;break}if(d.distance<a+c){e.state=Tt.e_touching,e.t=h;break}var m=new bt;m.Initialize(_,n,wt._temp_sweepA,r,wt._temp_sweepB,h);for(var f=!1,p=s,g=0;;){var v=[],y=m.FindMinSeparation(v,p);if(y>a+c){e.state=Tt.e_separated,e.t=s,f=!0;break}if(y>a-c){h=p;break}var x=m.Evaluate(v[0],v[1],h);if(x<a-c){e.state=Tt.e_failed,e.t=h,f=!0;break}if(x<=a+c){e.state=Tt.e_touching,e.t=h,f=!0;break}for(var C=0,A=h,T=p;;){var b;b=1&C?A+(a-x)*(T-A)/(y-x):.5*(A+T),++C,++wt.b2_toiRootIters;var w=m.Evaluate(v[0],v[1],b);if(ri(w-a)<c){p=b;break}if(w>a?(A=b,x=w):(T=b,y=w),50==C)break}if(wt.b2_toiMaxRootIters=oi(wt.b2_toiMaxRootIters,C),++g==We)break}if(++l,++wt.b2_toiIters,f)break;if(20==l){e.state=Tt.e_failed,e.t=h;break}}wt.b2_toiMaxIters=oi(wt.b2_toiMaxIters,l),di.stop(),wt.b2_toiMaxTime=oi(wt.b2_toiMaxTime,di.elapsedTime),wt.b2_toiTime+=di.elapsedTime}function St(){this.type=Et.b2_staticBody,this.position=new r(0,0),this.angle=0,this.linearVelocity=new r(0,0),this.angularVelocity=0,this.linearDamping=0,this.angularDamping=0,this.allowSleep=!0,this.awake=!0,this.fixedRotation=!1,this.bullet=!1,this.active=!0,this.userData=null,this.gravityScale=1,Object.seal(this)}function Et(e,i){t(e.position.IsValid()),t(e.linearVelocity.IsValid()),t(n(e.angle)),t(n(e.angularVelocity)),t(n(e.angularDamping)&&e.angularDamping>=0),t(n(e.linearDamping)&&e.linearDamping>=0),this.m_islandIndex=0,this.m_flags=0,e.bullet&&(this.m_flags|=Et.e_bulletFlag),e.fixedRotation&&(this.m_flags|=Et.e_fixedRotationFlag),e.allowSleep&&(this.m_flags|=Et.e_autoSleepFlag),e.awake&&(this.m_flags|=Et.e_awakeFlag),e.active&&(this.m_flags|=Et.e_activeFlag),this.m_world=i,this.m_xf=new h,this.m_xf.p.Assign(e.position),this.m_xf.q.Set(e.angle),this.m_sweep=new l,this.m_sweep.localCenter.SetZero(),this.m_sweep.c0.Assign(this.m_xf.p),this.m_sweep.c.Assign(this.m_xf.p),this.m_sweep.a0=e.angle,this.m_sweep.a=e.angle,this.m_sweep.alpha0=0,this.m_jointList=null,this.m_contactList=null,this.m_prev=null,this.m_next=null,this.m_linearVelocity=e.linearVelocity.Clone(),this.m_angularVelocity=e.angularVelocity,this.m_linearDamping=e.linearDamping,this.m_angularDamping=e.angularDamping,this.m_gravityScale=e.gravityScale,this.m_force=new r,this.m_torque=0,this.m_sleepTime=0,this.m_type=e.type,this.m_type==Et.b2_dynamicBody?(this.m_mass=1,this.m_invMass=1):(this.m_mass=0,this.m_invMass=0),this.m_I=0,this.m_invI=0,this.m_userData=e.userData,this.m_fixtureList=null,this.m_fixtureCount=0}function It(){this.categoryBits=1,this.maskBits=65535,this.groupIndex=0}function Rt(){this.shape=null,this.userData=null,this.friction=.2,this.restitution=0,this.density=0,this.isSensor=!1,this.filter=new It,Object.seal(this)}function Pt(){this.aabb=new st,this.fixture=null,this.childIndex=0,this.proxyId=0}function Bt(){this.m_userData=null,this.m_body=null,this.m_next=null,this.m_proxies=null,this.m_proxyCount=0,this.m_shape=null,this.m_density=0,this.m_filter=new It,this.m_isSensor=!1,this.m_friction=0,this.m_restitution=0}function Lt(){}function Ot(){}function Dt(){this.normalImpulses=new Array(ke),this.tangentImpulses=new Array(ke),this.count=0}function Nt(){}function Mt(){}function Ft(){}function zt(){this.dt=0,this.inv_dt=0,this.dtRatio=0,this.velocityIterations=0,this.positionIterations=0,this.warmStarting=!1}function Gt(){this.c=new r,this.a=0}function Vt(){this.v=new r,this.w=0}function kt(){this.step=new zt,this.positions=null,this.velocities=null}function Wt(t){this.m_contactManager=new ne,this.m_destructionListener=null,this.g_debugDraw=null,this.m_bodyList=null,this.m_jointList=null,this.m_bodyCount=0,this.m_jointCount=0,this.m_warmStarting=!0,this.m_continuousPhysics=!0,this.m_subStepping=!1,this.m_stepComplete=!0,this.m_allowSleep=!0,this.m_gravity=t,this.m_flags=Wt.e_clearForces,this.m_inv_dt0=0,this.p_step=new zt,this.p_island=new le}function Ut(){this.broadPhase=null,this.callback=null}function jt(){this.broadPhase=null,this.callback=null}function qt(t,e){return ii(t*e)}function Yt(t,e){return t>e?t:e}function Xt(){this.fcn=null,this.primary=!1}function Ht(){this.other=null,this.contact=null,this.prev=null,this.next=null}function Jt(){this.m_nodeA=new Ht,this.m_nodeB=new Ht,this.m_manifold=new tt}function Zt(){this.parent.call(this)}function Qt(){this.parent.call(this)}function Kt(){this.parent.call(this)}function $t(){this.parent.call(this)}function te(){this.parent.call(this)}function ee(){this.parent.call(this)}function ie(){this.parent.call(this)}function ne(){this.m_broadPhase=new j,this.m_contactList=null,this.m_contactCount=0,this.m_contactFilter=xi,this.m_contactListener=Ci}function re(){this.rA=new r,this.rB=new r,this.normalImpulse=0,this.tangentImpulse=0,this.normalMass=0,this.tangentMass=0,this.velocityBias=0}function se(){this.localPoints=new Array(ke),this.localNormal=new r,this.localPoint=new r,this.indexA=0,this.indexB=0,this.invMassA=0,this.invMassB=0,this.localCenterA=new r,this.localCenterB=new r,this.invIA=0,this.invIB=0,this.type=0,this.radiusA=0,this.radiusB=0,this.pointCount=0}function oe(){this.points=new Array(ke);for(var t=0;t<this.points.length;++t)this.points[t]=new re;this.normal=new r,this.normalMass=new o,this.K=new o,this.indexA=0,this.indexB=0,this.invMassA=0,this.invMassB=0,this.invIA=0,this.invIB=0,this.friction=0,this.restitution=0,this.tangentSpeed=0,this.pointCount=0,this.contactIndex=0}function ae(){this.normal=new r,this.point=new r,this.separation=0}function ce(){this.step=new zt,this.contacts=null,this.count=0,this.positions=null,this.velocities=null}function he(){this.m_positionConstraints=[],this.m_velocityConstraints=[]}function le(){this.m_bodies=[],this.m_contacts=[],this.m_joints=[],this.m_velocities=[],this.m_positions=[]}function _e(){this.other=null,this.joint=null,this.prev=null,this.next=null}function ue(){this.type=de.e_unknownJoint,this.userData=null,this.bodyA=null,this.bodyB=null,this.collideConnected=!1}function de(e){t(e.bodyA!=e.bodyB),this.m_type=e.type,this.m_prev=null,this.m_next=null,this.m_bodyA=e.bodyA,this.m_bodyB=e.bodyB,this.m_index=0,this.m_collideConnected=e.collideConnected,this.m_islandFlag=!1,this.m_userData=e.userData,this.m_edgeA=new _e,this.m_edgeA.joint=null,this.m_edgeA.other=null,this.m_edgeA.prev=null,this.m_edgeA.next=null,this.m_edgeB=new _e,this.m_edgeB.joint=null,this.m_edgeB.other=null,this.m_edgeB.prev=null,this.m_edgeB.next=null}function me(){this.parent.call(this),this.type=de.e_revoluteJoint,this.localAnchorA=new r,this.localAnchorB=new r,this.referenceAngle=0,this.lowerAngle=0,this.upperAngle=0,this.maxMotorTorque=0,this.motorSpeed=0,this.enableLimit=!1,this.enableMotor=!1,Object.seal(this)}function fe(t){this.parent.call(this,t),this.m_localAnchorA=t.localAnchorA.Clone(),this.m_localAnchorB=t.localAnchorB.Clone(),this.m_referenceAngle=t.referenceAngle,this.m_impulse=new s,this.m_motorImpulse=0,this.m_lowerAngle=t.lowerAngle,this.m_upperAngle=t.upperAngle,this.m_maxMotorTorque=t.maxMotorTorque,this.m_motorSpeed=t.motorSpeed,this.m_enableLimit=t.enableLimit,this.m_enableMotor=t.enableMotor,this.m_limitState=de.e_inactiveLimit,this.m_indexA=0,this.m_indexB=0,this.m_rA=new r,this.m_rB=new r,this.m_localCenterA=new r,this.m_localCenterB=new r,this.m_invMassA=0,this.m_invMassB=0,this.m_invIA=0,this.m_invIB=0,this.m_mass=new a,this.m_motorMass=0}function pe(){this.parent.call(this),this.type=de.e_mouseJoint,this.target=new r(0,0),this.maxForce=0,this.frequencyHz=5,this.dampingRatio=.7,Object.seal(this)}function ge(e){this.parent.call(this,e),t(e.target.IsValid()),t(n(e.maxForce)&&e.maxForce>=0),t(n(e.frequencyHz)&&e.frequencyHz>=0),t(n(e.dampingRatio)&&e.dampingRatio>=0),this.m_targetA=e.target.Clone(),this.m_localAnchorB=E(this.m_bodyB.GetTransform(),this.m_targetA),this.m_maxForce=e.maxForce,this.m_impulse=new r,this.m_frequencyHz=e.frequencyHz,this.m_dampingRatio=e.dampingRatio,this.m_beta=0,this.m_gamma=0,this.m_indexA=0,this.m_indexB=0,this.m_rB=new r,this.m_localCenterB=new r,this.m_invMassB=0,this.m_invIB=0,this.m_mass=new o,this.m_C=new r}function ve(){this.parent.call(this),this.type=de.e_distanceJoint,this.localAnchorA=new r(0,0),this.localAnchorB=new r(0,0),this.length=1,this.frequencyHz=0,this.dampingRatio=0,Object.seal(this)}function ye(t){this.parent.call(this,t),this.m_localAnchorA=t.localAnchorA.Clone(),this.m_localAnchorB=t.localAnchorB.Clone(),this.m_length=t.length,this.m_frequencyHz=t.frequencyHz,this.m_dampingRatio=t.dampingRatio,this.m_impulse=0,this.m_gamma=0,this.m_bias=0,this.m_indexA=0,this.m_indexB=0,this.m_u=new r,this.m_rA=new r,this.m_rB=new r,this.m_localCenterA=new r,this.m_localCenterB=new r,this.m_invMassA=0,this.m_invMassB=0,this.m_invIA=0,this.m_invIB=0,this.m_mass=0}function xe(){this.parent.call(this),this.type=de.e_prismaticJoint,this.localAnchorA=new r,this.localAnchorB=new r,this.localAxisA=new r(1,0),this.referenceAngle=0,this.enableLimit=!1,this.lowerTranslation=0,this.upperTranslation=0,this.enableMotor=!1,this.maxMotorForce=0,this.motorSpeed=0,Object.seal(this)}function Ce(t){this.parent.call(this,t),this.m_localAnchorA=t.localAnchorA.Clone(),this.m_localAnchorB=t.localAnchorB.Clone(),this.m_localXAxisA=t.localAxisA.Clone(),this.m_localXAxisA.Normalize(),this.m_localYAxisA=m(1,this.m_localXAxisA),this.m_referenceAngle=t.referenceAngle,this.m_impulse=new s,this.m_motorMass=0,this.m_motorImpulse=0,this.m_lowerTranslation=t.lowerTranslation,this.m_upperTranslation=t.upperTranslation,this.m_maxMotorForce=t.maxMotorForce,this.m_motorSpeed=t.motorSpeed,this.m_enableLimit=t.enableLimit,this.m_enableMotor=t.enableMotor,this.m_limitState=de.e_inactiveLimit,this.m_axis=new r,this.m_perp=new r,this.m_indexA=0,this.m_indexB=0,this.m_localCenterA=new r,this.m_localCenterB=new r,this.m_invMassA=0,this.m_invMassB=0,this.m_invIA=0,this.m_invIB=0,this.m_s1=0,this.m_s2=0,this.m_a1=0,this.m_a2=0,this.m_K=new a,this.m_motorMass=0}function Ae(){this.parent.call(this),this.type=de.e_frictionJoint,this.localAnchorA=new r,this.localAnchorB=new r,this.maxForce=0,this.maxTorque=0,Object.seal(this)}function Te(t){this.parent.call(this,t),this.m_localAnchorA=t.localAnchorA.Clone(),this.m_localAnchorB=t.localAnchorB.Clone(),this.m_linearImpulse=new r,this.m_angularImpulse=0,this.m_maxForce=t.maxForce,this.m_maxTorque=t.maxTorque,this.m_indexA=0,this.m_indexB=0,this.m_rA=new r,this.m_rB=new r,this.m_localCenterA=new r,this.m_localCenterB=new r,this.m_invMassA=0,this.m_invMassB=0,this.m_invIA=0,this.m_invIB=0,this.m_linearMass=new o,this.m_angularMass=0}function be(){this.parent.call(this),this.type=de.e_weldJoint,this.localAnchorA=new r(0,0),this.localAnchorB=new r(0,0),this.referenceAngle=0,this.frequencyHz=0,this.dampingRatio=0,Object.seal(this)}function we(t){this.parent.call(this,t),this.m_bias=0,this.m_gamma=0,this.m_indexA=0,this.m_indexB=0,this.m_rA=new r,this.m_rB=new r,this.m_localCenterA=new r,this.m_localCenterB=new r,this.m_invMassA=0,this.m_invMassB=0,this.m_invIA=0,this.m_invIB=0,this.m_mass=new a,this.m_localAnchorA=t.localAnchorA.Clone(),this.m_localAnchorB=t.localAnchorB.Clone(),this.m_referenceAngle=t.referenceAngle,this.m_frequencyHz=t.frequencyHz,this.m_dampingRatio=t.dampingRatio,this.m_impulse=new s}function Se(){this.parent.call(this),this.type=de.e_wheelJoint,this.localAnchorA=new r,this.localAnchorB=new r,this.localAxisA=new r(1,0),this.enableMotor=!1,this.maxMotorTorque=0,this.motorSpeed=0,this.frequencyHz=2,this.dampingRatio=.7,Object.seal(this)}function Ee(t){this.parent.call(this,t),this.m_indexA=0,this.m_indexB=0,this.m_localCenterA=new r,this.m_localCenterB=new r,this.m_invMassA=0,this.m_invMassB=0,this.m_invIA=0,this.m_invIB=0,this.m_localAnchorA=t.localAnchorA.Clone(),this.m_localAnchorB=t.localAnchorB.Clone(),this.m_localXAxisA=t.localAxisA.Clone(),this.m_localYAxisA=m(1,this.m_localXAxisA),this.m_mass=0,this.m_impulse=0,this.m_motorMass=0,this.m_motorImpulse=0,this.m_springMass=0,this.m_springImpulse=0,this.m_maxMotorTorque=t.maxMotorTorque,this.m_motorSpeed=t.motorSpeed,this.m_enableMotor=t.enableMotor,this.m_frequencyHz=t.frequencyHz,this.m_dampingRatio=t.dampingRatio,this.m_bias=0,this.m_gamma=0,this.m_ax=new r,this.m_ay=new r,this.m_sAx=this.m_sBx=0,this.m_sAy=this.m_sBy=0}function Ie(){this.parent.call(this),this.type=de.e_gearJoint,this.joint1=null,this.joint2=null,this.ratio=1,Object.seal(this)}function Re(e){this.parent.call(this,e),this.m_joint1=e.joint1,this.m_joint2=e.joint2,this.m_typeA=this.m_joint1.GetType(),this.m_typeB=this.m_joint2.GetType(),t(this.m_typeA==de.e_revoluteJoint||this.m_typeA==de.e_prismaticJoint),t(this.m_typeB==de.e_revoluteJoint||this.m_typeB==de.e_prismaticJoint);var i,n;this.m_bodyC=this.m_joint1.GetBodyA(),this.m_bodyA=this.m_joint1.GetBodyB();var s=this.m_bodyA.m_xf,o=this.m_bodyA.m_sweep.a,a=this.m_bodyC.m_xf,c=this.m_bodyC.m_sweep.a;if(this.m_localAnchorA=new r,this.m_localAnchorB=new r,this.m_localAnchorC=new r,this.m_localAnchorD=new r,this.m_localAxisC=new r,this.m_localAxisD=new r,this.m_typeA==de.e_revoluteJoint){var h=e.joint1;this.m_localAnchorC.Assign(h.m_localAnchorA),this.m_localAnchorA.Assign(h.m_localAnchorB),this.m_referenceAngleA=h.m_referenceAngle,this.m_localAxisC.SetZero(),i=o-c-this.m_referenceAngleA}else{var l=e.joint1;this.m_localAnchorC.Assign(l.m_localAnchorA),this.m_localAnchorA.Assign(l.m_localAnchorB),this.m_referenceAngleA=l.m_referenceAngle,this.m_localAxisC.Assign(l.m_localXAxisA);var u=this.m_localAnchorC,d=w(a.q,r.Add(b(s.q,this.m_localAnchorA),r.Subtract(s.p,a.p)));i=_(r.Subtract(d,u),this.m_localAxisC)}this.m_bodyD=this.m_joint2.GetBodyA(),this.m_bodyB=this.m_joint2.GetBodyB();var m=this.m_bodyB.m_xf,f=this.m_bodyB.m_sweep.a,p=this.m_bodyD.m_xf,g=this.m_bodyD.m_sweep.a;if(this.m_typeB==de.e_revoluteJoint){h=e.joint2;this.m_localAnchorD.Assign(h.m_localAnchorA),this.m_localAnchorB.Assign(h.m_localAnchorB),this.m_referenceAngleB=h.m_referenceAngle,this.m_localAxisD.SetZero(),n=f-g-this.m_referenceAngleB}else{l=e.joint2;this.m_localAnchorD.Assign(l.m_localAnchorA),this.m_localAnchorB.Assign(l.m_localAnchorB),this.m_referenceAngleB=l.m_referenceAngle,this.m_localAxisD.Assign(l.m_localXAxisA);var v=this.m_localAnchorD,y=w(p.q,r.Add(b(m.q,this.m_localAnchorB),r.Subtract(m.p,p.p)));n=_(r.Subtract(y,v),this.m_localAxisD)}this.m_ratio=e.ratio,this.m_constant=i+this.m_ratio*n,this.m_impulse=0,this.m_indexA=this.m_indexB=this.m_indexC=this.m_indexD=0,this.m_lcA=new r,this.m_lcB=new r,this.m_lcC=new r,this.m_lcD=new r,this.m_mA=this.m_mB=this.m_mC=this.m_mD=0,this.m_iA=this.m_iB=this.m_iC=this.m_iD=0,this.m_JvAC=new r,this.m_JvBD=new r,this.m_JwA=this.m_JwB=this.m_JwC=this.m_JwD=0,this.m_mass=0}function Pe(){this.parent.call(this),this.type=de.e_motorJoint,this.linearOffset=new r,this.angularOffset=0,this.maxForce=1,this.maxTorque=1,this.correctionFactor=.3,Object.seal(this)}function Be(t){this.parent.call(this,t),this.m_linearOffset=t.linearOffset.Clone(),this.m_angularOffset=t.angularOffset,this.m_linearImpulse=new r,this.m_angularImpulse=0,this.m_maxForce=t.maxForce,this.m_maxTorque=t.maxTorque,this.m_correctionFactor=t.correctionFactor,this.m_indexA=0,this.m_indexB=0,this.m_rA=new r,this.m_rB=new r,this.m_localCenterA=new r,this.m_localCenterB=new r,this.m_linearError=new r,this.m_angularError=0,this.m_invMassA=0,this.m_invMassB=0,this.m_invIA=0,this.m_invIB=0,this.m_linearMass=new o,this.m_angularMass=0}function Le(){this.parent.call(this),this.type=de.e_pulleyJoint,this.groundAnchorA=new r(-1,1),this.groundAnchorB=new r(1,1),this.localAnchorA=new r(-1,0),this.localAnchorB=new r(1,0),this.lengthA=0,this.lengthB=0,this.ratio=1,this.collideConnected=!0,Object.seal(this)}function Oe(e){this.parent.call(this,e),this.m_indexA=0,this.m_indexB=0,this.m_uA=new r,this.m_uB=new r,this.m_rA=new r,this.m_rB=new r,this.m_localCenterA=new r,this.m_localCenterB=new r,this.m_invMassA=0,this.m_invMassB=0,this.m_invIA=0,this.m_invIB=0,this.m_mass=0,this.m_groundAnchorA=e.groundAnchorA.Clone(),this.m_groundAnchorB=e.groundAnchorB.Clone(),this.m_localAnchorA=e.localAnchorA.Clone(),this.m_localAnchorB=e.localAnchorB.Clone(),this.m_lengthA=e.lengthA,this.m_lengthB=e.lengthB,t(0!=e.ratio),this.m_ratio=e.ratio,this.m_constant=e.lengthA+this.m_ratio*e.lengthB,this.m_impulse=0}function De(){this.parent.call(this),this.type=de.e_ropeJoint,this.localAnchorA=new r(-1,0),this.localAnchorB=new r(1,0),this.maxLength=0,Object.seal(this)}function Ne(t){this.parent.call(this,t),this.m_localAnchorA=t.localAnchorA.Clone(),this.m_localAnchorB=t.localAnchorB.Clone(),this.m_maxLength=t.maxLength,this.m_mass=0,this.m_impulse=0,this.m_state=de.e_inactiveLimit,this.m_length=0,this.m_indexA=0,this.m_indexB=0,this.m_u=new r,this.m_rA=new r,this.m_rB=new r,this.m_localCenterA=new r,this.m_localCenterB=new r,this.m_invMassA=0,this.m_invMassB=0,this.m_invIA=0,this.m_invIB=0}function Me(){this.m_count=0,this.m_ps=null,this.m_p0s=null,this.m_vs=null,this.m_ims=null,this.m_Ls=null,this.m_as=null,this.m_damping=0,this.m_gravity=new r,this.m_k2=1,this.m_k3=.1}Function.prototype._extend=function(t){this.prototype.parent=t;for(var e in t.prototype)this.prototype[e]||(this.prototype[e]=t.prototype[e])},Function.prototype._implement=function(t){return this._extend(t)};var Fe=(function(){function t(t,e){this.name=t,this.parent=e,this.children={},this.startTime=0,this.elapsedTime=0,this.totalTime=0,this.running=!1,this.childrenCount=0}function e(t,i){if(t.name===i.parent)return t;for(var n in t.children){var r;if(r=e(t.children[n],i))return r}return null}"undefined"==typeof performance&&(window.performance={now:function(){return+new Date}}),t.prototype={start:function(){this.startTime=performance.now(),this.running=!0},stop:function(t){if(this.running){this.running=!1,this.elapsedTime+=performance.now()-this.startTime,t&&this.start();for(var e in this.children)this.children[e].stop()}},reset:function(t){t||(this.running=!0,this.totalTime+=this.elapsedTime,this.start()),this.elapsedTime=0;for(var e in this.children)this.children[e].reset(!0)}};var i=[],n=new t("root");return{create:function(e,n){if(!i)throw new Error("late profile creation not allowed");var r=new t(e,n||"root");return i.push(r),r},destroy:function(t){t.childrenCount--,delete t.children[t.name]},init:function(){for(;i.length;){var t=i.pop();(t.parentNode=e(n,t))?(t.parentNode.children[t.name]=t,t.parentNode.childrenCount++):i.unshift(t)}i=null},reset:function(){n.reset(!0)},profileRoot:n}})(),ze=Number.MAX_VALUE,Ge=2.220446049250313e-16,Ve=Math.PI,ke=2,We=8,Ue=.005,je=2/180*Ve,qe=2*Ue,Ye=8/180*Ve,Xe=.5*Ve,He=Xe*Xe,Je=2/180*Ve;i.prototype={toString:function(){return this.major+"."+this.minor+"."+this.revision}};var Ze=new i(2,3,1),Qe=Math.sqrt,Ke=Math.atan2,$e=Math.sin,ti=Math.cos,ei=Math.floor,ii=(Math.ceil,Qe),ni=Ke;r.prototype={Clone:function(){return new r(this.x,this.y)},SetZero:function(){return this.x=0,this.y=0,this},Set:function(t,e){return this.x=t,this.y=e,this},Assign:function(t){return this.x=t.x,this.y=t.y,this},Negate:function(){var t=new r;return t.Set(-this.x,-this.y),t},get_i:function(t){switch(t){case 0:return this.x;case 1:return this.y}},set_i:function(t,e){switch(t){case 0:return this.x=e;case 1:return this.y=e}},Add:function(t){return this.x+=t.x,this.y+=t.y,this},Subtract:function(t){return this.x-=t.x,this.y-=t.y,this},Multiply:function(t){return this.x*=t,this.y*=t,this},Length:function(){return ii(this.x*this.x+this.y*this.y)},LengthSquared:function(){return this.x*this.x+this.y*this.y},Normalize:function(){var t=this.Length();if(t<Ge)return 0;var e=1/t;return this.x*=e,this.y*=e,t},IsValid:function(){return n(this.x)&&n(this.y)},Skew:function(){return new r(-this.y,this.x)},_serialize:function(t){var e=t||[];return e[0]=this.x,e[1]=this.y,e},_deserialize:function(t){this.x=t[0],this.y=t[1]}},r.Add=function(t,e){return new r(t.x+e.x,t.y+e.y)},r.Subtract=function(t,e){return new r(t.x-e.x,t.y-e.y)},r.Equals=function(t,e){return t.x==e.x&&t.y==e.y},r.Multiply=function(t,e){return new r(t*e.x,t*e.y)},r.Negate=function(t){return new r(-t.x,-t.y)},s.prototype={Clone:function(){return new s(this.x,this.y,this.z)},SetZero:function(){this.x=0,this.y=0,this.z=0},Set:function(t,e,i){this.x=t,this.y=e,this.z=i},Negate:function(){var t=new s;return t.Set(-this.x,-this.y,-this.z),t},Add:function(t){this.x+=t.x,this.y+=t.y,this.z+=t.z},Subtract:function(t){this.x-=t.x,this.y-=t.y,this.z-=t.z},Multiply:function(t){this.x*=t,this.y*=t,this.z*=t},Invert:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},x:0,y:0,z:0},s.Multiply=function(t,e){return new s(t*e.x,t*e.y,t*e.z)},s.Add=function(t,e){return new s(t.x+e.x,t.y+e.y,t.z+e.z)},s.Subtract=function(t,e){return new s(t.x-e.x,t.y-e.y,t.z-e.z)},o.prototype={Set:function(t,e){this.ex.Assign(t),this.ey.Assign(e)},Assign:function(t){this.ex.Assign(t.ex),this.ey.Assign(t.ey)},SetIdentity:function(){this.ex.x=1,this.ey.x=0,this.ex.y=0,this.ey.y=1},SetZero:function(){this.ex.x=0,this.ey.x=0,this.ex.y=0,this.ey.y=0},GetInverse:function(){var t=this.ex.x,e=this.ey.x,i=this.ex.y,n=this.ey.y,r=new o,s=t*n-e*i;return 0!=s&&(s=1/s),r.ex.x=s*n,r.ey.x=-s*e,r.ex.y=-s*i,r.ey.y=s*t,r},Solve:function(t){var e=this.ex.x,i=this.ey.x,n=this.ex.y,s=this.ey.y,o=e*s-i*n;0!=o&&(o=1/o);var a=new r;return a.x=o*(s*t.x-i*t.y),a.y=o*(e*t.y-n*t.x),a}},o.Add=function(t,e){return new o(r.Add(t.ex,e.ex),r.Add(t.ey,e.ey))},a.prototype={SetZero:function(){this.ex.SetZero(),this.ey.SetZero(),this.ez.SetZero()},Solve33:function(t){var e=v(this.ex,y(this.ey,this.ez));0!=e&&(e=1/e);var i=new s;return i.x=e*v(t,y(this.ey,this.ez)),i.y=e*v(this.ex,y(t,this.ez)),i.z=e*v(this.ex,y(this.ey,t)),i},Solve22:function(t){var e=this.ex.x,i=this.ey.x,n=this.ex.y,s=this.ey.y,o=e*s-i*n;0!=o&&(o=1/o);var a=new r;return a.x=o*(s*t.x-i*t.y),a.y=o*(e*t.y-n*t.x),a},GetInverse22:function(t){var e=this.ex.x,i=this.ey.x,n=this.ex.y,r=this.ey.y,s=e*r-i*n;0!=s&&(s=1/s),t.ex.x=s*r,t.ey.x=-s*i,t.ex.z=0,t.ex.y=-s*n,t.ey.y=s*e,t.ey.z=0,t.ez.x=0,t.ez.y=0,t.ez.z=0},GetSymInverse33:function(t){var e=v(this.ex,y(this.ey,this.ez));0!=e&&(e=1/e);var i=this.ex.x,n=this.ey.x,r=this.ez.x,s=this.ey.y,o=this.ez.y,a=this.ez.z;t.ex.x=e*(s*a-o*o),t.ex.y=e*(r*o-n*a),t.ex.z=e*(n*o-r*s),t.ey.x=t.ex.y,t.ey.y=e*(i*a-r*r),t.ey.z=e*(r*n-i*o),t.ez.x=t.ex.z,t.ez.y=t.ey.z,t.ez.z=e*(i*s-n*n)}},c.prototype={Clone:function(){return new c(this.s,this.c)},Assign:function(t){this.s=t.s,this.c=t.c},Set:function(t){this.s=$e(t),this.c=ti(t)},SetIdentity:function(){this.s=0,this.c=1},GetAngle:function(){return ni(this.s,this.c)},GetXAxis:function(){return new r(this.c,this.s)},GetYAxis:function(){return new r(-this.s,this.c)},s:0,c:1},h.prototype={Clone:function(){return new h(this.p,this.q)},Assign:function(t){this.p.Assign(t.p),this.q.Assign(t.q)},SetIdentity:function(){this.p.SetZero(),this.q.SetIdentity()},Set:function(t,e){this.p.Assign(t),this.q.Set(e)}},l.prototype={Assign:function(t){this.localCenter.Assign(t.localCenter),this.c0.Assign(t.c0),this.c.Assign(t.c),this.a=t.a,this.a0=t.a0,this.alpha0=t.alpha0},Clone:function(){var t=new l;return t.localCenter.Assign(this.localCenter),t.c0.Assign(this.c0),t.c.Assign(this.c),t.a=this.a,t.a0=this.a0,t.alpha0=this.alpha0,t},GetTransform:function(t,e){t.p.x=(1-e)*this.c0.x+e*this.c.x,t.p.y=(1-e)*this.c0.y+e*this.c.y;var i=(1-e)*this.a0+e*this.a;t.q.Set(i),t.p.x-=t.q.c*this.localCenter.x-t.q.s*this.localCenter.y,t.p.y-=t.q.s*this.localCenter.x+t.q.c*this.localCenter.y},Advance:function(e){t(this.alpha0<1);var i=(e-this.alpha0)/(1-this.alpha0);this.c0.Add(r.Multiply(i,r.Subtract(this.c,this.c0))),this.a0+=i*(this.a-this.a0),this.alpha0=e},Normalize:function(){var t=2*Ve,e=t*ei(this.a0/t);this.a0-=e,this.a-=e},a0:0,a:0,alpha0:0};var ri=Math.abs,si=Math.min,oi=Math.max;O.prototype={Set:function(t,e,i){this.r=t,this.g=e,this.b=i}},D.prototype={ClearDraw:function(){},SetFlags:function(t){this.m_drawFlags=t},GetFlags:function(){return this.m_drawFlags},AppendFlags:function(t){this.m_drawFlags|=t},ClearFlags:function(t){this.m_drawFlags&=~t},ToggleFlags:function(t){this.m_drawFlags^=t},DrawPolygon:function(t,e,i){},DrawSolidPolygon:function(t,e,i){},DrawCircle:function(t,e,i){},DrawSolidCircle:function(t,e,i,n){},DrawSegment:function(t,e,i){},DrawTransform:function(t){},m_drawFlags:0},D.e_shapeBit=1,D.e_jointBit=2,D.e_aabbBit=4,D.e_centerOfMassBit=8,D.e_contactPoints=16,D.e_contactNormals=32,D.e_contactImpulses=64,D.e_frictionImpulses=128,D.e_statistics=256,D.e_profile=512,D.e_pairBit=1024,"undefined"==typeof performance&&(window.performance={now:function(){return+new Date}}),N.prototype={Reset:function(){this.m_start=performance.now()},GetMilliseconds:function(){return performance.now()-this.m_start}},F.prototype={Clone:function(){},GetType:function(){return this.m_type},GetChildCount:function(){},TestPoint:function(t,e){},RayCast:function(t,e,i,n){},ComputeAABB:function(t,e,i){},ComputeMass:function(t,e){},_serialize:function(t){var e=t||{};return e.m_type=this.m_type,e.m_radius=this.m_radius,e},_deserialize:function(t){this.m_radius=t.m_radius}},F.e_circle=0,F.e_edge=1,F.e_polygon=2,F.e_chain=3,F.e_typeCount=4,z.prototype={Clone:function(){var t=new z;return t.m_radius=this.m_radius,t.m_p=this.m_p.Clone(),t},GetChildCount:function(){return 1},TestPoint:function(t,e){var i=r.Add(t.p,b(t.q,this.m_p)),n=r.Subtract(e,i);return _(n,n)<=this.m_radius*this.m_radius},RayCast:function(t,e,i,n){var s=r.Add(i.p,b(i.q,this.m_p)),o=r.Subtract(e.p1,s),a=_(o,o)-this.m_radius*this.m_radius,c=r.Subtract(e.p2,e.p1),h=_(o,c),l=_(c,c),u=h*h-l*a;if(u<0||l<Ge)return!1;var d=-(h+ii(u));return 0<=d&&d<=e.maxFraction*l&&(d/=l,t.fraction=d,t.normal=r.Add(o,r.Multiply(d,c)),t.normal.Normalize(),!0)},ComputeAABB:function(t,e,i){var n=e.p.x+(e.q.c*this.m_p.x-e.q.s*this.m_p.y),r=e.p.y+(e.q.s*this.m_p.x+e.q.c*this.m_p.y);t.lowerBound.x=n-this.m_radius,t.lowerBound.y=r-this.m_radius,t.upperBound.x=n+this.m_radius,t.upperBound.y=r+this.m_radius},ComputeMass:function(t,e){t.mass=e*Ve*this.m_radius*this.m_radius,t.center=this.m_p,t.I=t.mass*(.5*this.m_radius*this.m_radius+_(this.m_p,this.m_p))},GetSupport:function(t){return 0},GetSupportVertex:function(t){return this.m_p},GetVertexCount:function(){return 1},GetVertex:function(e){return t(0==e),this.m_p},_serialize:function(t){var e=t||{};return this.parent.prototype._serialize.call(this,e),e.m_p=this.m_p._serialize(),e},_deserialize:function(t){this.parent.prototype._deserialize.call(this,t),this.m_p._deserialize(t.m_p)}},z._extend(F),G.prototype={Set:function(t,e){this.m_vertex1.Assign(t),this.m_vertex2.Assign(e),this.m_hasVertex0=!1,this.m_hasVertex3=!1},Clone:function(){var t=new G;return t.m_vertex0=this.m_vertex0.Clone(),t.m_vertex1=this.m_vertex1.Clone(),t.m_vertex2=this.m_vertex2.Clone(),t.m_vertex3=this.m_vertex3.Clone(),t.m_hasVertex0=this.m_hasVertex0,t.m_hasVertex3=this.m_hasVertex3,t},GetChildCount:function(){return 1},TestPoint:function(t,e){return!1},RayCast:function(t,e,i,n){var s=w(i.q,r.Subtract(e.p1,i.p)),o=w(i.q,r.Subtract(e.p2,i.p)),a=r.Subtract(o,s),c=this.m_vertex1,h=this.m_vertex2,l=r.Subtract(h,c),u=new r(l.y,-l.x);u.Normalize();var d=_(u,r.Subtract(c,s)),m=_(u,a);if(0==m)return!1;var f=d/m;if(f<0||e.maxFraction<f)return!1;var p=r.Add(s,r.Multiply(f,a)),g=r.Subtract(h,c),v=_(g,g);if(0==v)return!1;var y=_(r.Subtract(p,c),g)/v;return!(y<0||1<y)&&(t.fraction=f,t.normal=d>0?b(i.q,u).Negate():b(i.q,u),!0)},ComputeAABB:function(t,e,i){var n=e.q.c*this.m_vertex1.x-e.q.s*this.m_vertex1.y+e.p.x,r=e.q.s*this.m_vertex1.x+e.q.c*this.m_vertex1.y+e.p.y,s=e.q.c*this.m_vertex2.x-e.q.s*this.m_vertex2.y+e.p.x,o=e.q.s*this.m_vertex2.x+e.q.c*this.m_vertex2.y+e.p.y,a=si(n,s),c=si(r,o),h=oi(n,s),l=oi(r,o);t.lowerBound.x=a-this.m_radius,t.lowerBound.y=c-this.m_radius,t.upperBound.x=h+this.m_radius,t.upperBound.y=l+this.m_radius},ComputeMass:function(t,e){t.mass=0,t.center=r.Multiply(.5,r.Add(this.m_vertex1,this.m_vertex2)),t.I=0},_serialize:function(t){var e=t||{};return this.parent.prototype._serialize.call(this,e),e.m_vertex1=this.m_vertex1._serialize(),e.m_vertex2=this.m_vertex2._serialize(),e.m_hasVertex0=this.m_hasVertex0,this.m_hasVertex0&&(e.m_vertex0=this.m_vertex0._serialize()),e.m_hasVertex3=this.m_hasVertex3,this.m_hasVertex3&&(e.m_vertex3=this.m_vertex3._serialize()),e},_deserialize:function(t){this.parent.prototype._deserialize.call(this,t),this.m_vertex1._deserialize(t.m_vertex1),this.m_vertex2._deserialize(t.m_vertex2),this.m_hasVertex0=t.m_hasVertex0,this.m_hasVertex0&&this.m_vertex0._deserialize(t.m_vertex0),this.m_hasVertex3=t.m_hasVertex3,this.m_hasVertex3&&this.m_vertex3._deserialize(t.m_vertex3)}},G._extend(F),V._tempEdge=new G,V.prototype={Clear:function(){this.m_vertices=null,this.m_count=0},CreateLoop:function(e,i){t(null==this.m_vertices&&0==this.m_count),t(i>=3);for(var n=1;n<i;++n)t(g(e[n-1],e[n])>Ue*Ue);this.m_count=i+1,this.m_vertices=new Array(this.m_count);for(n=0;n<i;++n)this.m_vertices[n]=e[n].Clone();this.m_vertices[i]=this.m_vertices[0].Clone(),this.m_prevVertex.Assign(this.m_vertices[this.m_count-2]),this.m_nextVertex.Assign(this.m_vertices[1]),this.m_hasPrevVertex=!0,this.m_hasNextVertex=!0},CreateChain:function(e,i){t(null==this.m_vertices&&0==this.m_count),t(i>=2);for(var n=1;n<i;++n){t(g(e[n-1],e[n])>Ue*Ue)}this.m_count=i,this.m_vertices=new Array(i);for(n=0;n<i;++n)this.m_vertices[n]=e[n].Clone();this.m_hasPrevVertex=!1,this.m_hasNextVertex=!1,this.m_prevVertex.SetZero(),this.m_nextVertex.SetZero()},SetPrevVertex:function(t){this.m_prevVertex.Assign(t),this.m_hasPrevVertex=!0},SetNextVertex:function(t){this.m_nextVertex.Assign(t),this.m_hasNextVertex=!0},Clone:function(){var t=new V;t.m_count=this.m_count,t.m_vertices=new Array(this.m_count);for(var e=0;e<this.m_count;++e)t.m_vertices[e]=this.m_vertices[e].Clone();return t.m_prevVertex=this.m_prevVertex.Clone(),t.m_nextVertex=this.m_nextVertex.Clone(),t.m_hasPrevVertex=this.m_hasPrevVertex,t.m_hasNextVertex=this.m_hasNextVertex,t},GetChildCount:function(){return this.m_count-1},GetChildEdge:function(e,i){t(0<=i&&i<this.m_count-1),e.m_type=F.e_edge,e.m_radius=this.m_radius,e.m_vertex1=this.m_vertices[i+0],e.m_vertex2=this.m_vertices[i+1],i>0?(e.m_vertex0=this.m_vertices[i-1],e.m_hasVertex0=!0):(e.m_vertex0=this.m_prevVertex,e.m_hasVertex0=this.m_hasPrevVertex),i<this.m_count-2?(e.m_vertex3=this.m_vertices[i+2],e.m_hasVertex3=!0):(e.m_vertex3=this.m_nextVertex,e.m_hasVertex3=this.m_hasNextVertex)},TestPoint:function(t,e){return!1},RayCast:function(e,i,n,r){t(r<this.m_count);var s=r,o=r+1;return o==this.m_count&&(o=0),V._tempEdge.m_vertex1=this.m_vertices[s].Clone(),V._tempEdge.m_vertex2=this.m_vertices[o].Clone(),V._tempEdge.RayCast(e,i,n,0)},ComputeAABB:function(e,i,n){t(n<this.m_count);var r=n,s=n+1;s==this.m_count&&(s=0);var o=i.q.c*this.m_vertices[r].x-i.q.s*this.m_vertices[r].y+i.p.x,a=i.q.s*this.m_vertices[r].x+i.q.c*this.m_vertices[r].y+i.p.y,c=i.q.c*this.m_vertices[s].x-i.q.s*this.m_vertices[s].y+i.p.x,h=i.q.s*this.m_vertices[s].x+i.q.c*this.m_vertices[s].y+i.p.y;e.lowerBound.x=si(o,c),e.lowerBound.y=si(a,h),e.upperBound.x=oi(o,c),e.upperBound.y=oi(a,h)},ComputeMass:function(t,e){t.mass=0,t.center.SetZero(),t.I=0},_serialize:function(t){var e=t||{};this.parent.prototype._serialize.call(this,e),e.m_count=this.m_count,e.m_vertices=[];for(var i=0;i<this.m_count;++i)e.m_vertices.push(this.m_vertices[i]._serialize());return e.m_hasPrevVertex=this.m_hasPrevVertex,this.m_hasPrevVertex&&(e.m_prevVertex=this.m_prevVertex._serialize()),e.m_hasNextVertex=this.m_hasNextVertex,this.m_hasNextVertex&&(e.m_nextVertex=this.m_nextVertex._serialize()),e},_deserialize:function(t){this.parent.prototype._deserialize.call(this,t),this.m_count=t.m_count,this.m_vertices=[];for(var e=0;e<this.m_count;++e)this.m_vertices[e]=new r,this.m_vertices[e]._deserialize(t.m_vertices[e]);this.m_hasPrevVertex=t.m_hasPrevVertex,this.m_hasPrevVertex&&this.m_prevVertex._deserialize(t.m_prevVertex),this.m_hasNextVertex=t.m_hasNextVertex,this.m_hasNextVertex&&this.m_nextVertex._deserialize(t.m_nextVertex)}},V._extend(F),k.prototype={Clone:function(){var t=new k;t.m_count=this.m_count,t.m_centroid=this.m_centroid.Clone();for(var e=0;e<this.m_count;++e)t.m_vertices[e]=this.m_vertices[e].Clone(),t.m_normals[e]=this.m_normals[e].Clone();return t},GetChildCount:function(){return 1},Set:function(e,i){if(t(3<=i&&i<=We),i<3)this.SetAsBox(1,1);else{for(var n=si(i,We),s=new Array(We),o=0,a=0;a<n;++a){for(var c=e[a],h=!0,l=0;l<o;++l)if(g(c,s[l])<.5*Ue){h=!1;break}h&&(s[o++]=c.Clone())}if((n=o)<3)return t(!1),void this.SetAsBox(1,1);var _=0,m=s[0].x;for(a=1;a<n;++a){var f=s[a].x;(f>m||f==m&&s[a].y<s[_].y)&&(_=a,m=f)}for(var p=new Array(We),v=0,y=_;;){p[v]=y;var x=0;for(l=1;l<n;++l)if(x!=y){var C=r.Subtract(s[x],s[p[v]]),A=u(C,c=r.Subtract(s[l],s[p[v]]));A<0&&(x=l),0==A&&c.LengthSquared()>C.LengthSquared()&&(x=l)}else x=l;if(++v,y=x,x==_)break}if(v<3)return t(!1),void this.SetAsBox(1,1);for(this.m_count=v,a=0;a<v;++a)this.m_vertices[a]=s[p[a]].Clone();for(a=0;a<v;++a){var T=a,b=a+1<v?a+1:0,w=r.Subtract(this.m_vertices[b],this.m_vertices[T]);t(w.LengthSquared()>Ge*Ge),this.m_normals[a]=d(w,1).Clone(),this.m_normals[a].Normalize()}this.m_centroid=k.ComputeCentroid(this.m_vertices,v)}},SetAsBox:function(t,e,i,n){if(this.m_count=4,this.m_vertices[0]=new r(-t,-e),this.m_vertices[1]=new r(t,-e),this.m_vertices[2]=new r(t,e),this.m_vertices[3]=new r(-t,e),this.m_normals[0]=new r(0,-1),this.m_normals[1]=new r(1,0),this.m_normals[2]=new r(0,1),this.m_normals[3]=new r(-1,0),i){this.m_centroid.Assign(i);var s=new h;s.p=i,s.q.Set(n);for(var o=0;o<this.m_count;++o)this.m_vertices[o].Assign(S(s,this.m_vertices[o])),this.m_normals[o].Assign(b(s.q,this.m_normals[o]))}},TestPoint:function(t,e){for(var i=w(t.q,r.Subtract(e,t.p)),n=0;n<this.m_count;++n){if(_(this.m_normals[n],r.Subtract(i,this.m_vertices[n]))>0)return!1}return!0},RayCast:function(e,i,n,s){for(var o=w(n.q,r.Subtract(i.p1,n.p)),a=w(n.q,r.Subtract(i.p2,n.p)),c=r.Subtract(a,o),h=0,l=i.maxFraction,u=-1,d=0;d<this.m_count;++d){var m=_(this.m_normals[d],r.Subtract(this.m_vertices[d],o)),f=_(this.m_normals[d],c);if(0==f){if(m<0)return!1}else f<0&&m<h*f?(h=m/f,u=d):f>0&&m<l*f&&(l=m/f);if(l<h)return!1}return t(0<=h&&h<=i.maxFraction),u>=0&&(e.fraction=h,e.normal=b(n.q,this.m_normals[u]),!0)},ComputeAABB:function(t,e,i){for(var n=e.q.c*this.m_vertices[0].x-e.q.s*this.m_vertices[0].y+e.p.x,r=e.q.s*this.m_vertices[0].x+e.q.c*this.m_vertices[0].y+e.p.y,s=n,o=r,a=1;a<this.m_count;++a){var c=e.q.c*this.m_vertices[a].x-e.q.s*this.m_vertices[a].y+e.p.x,h=e.q.s*this.m_vertices[a].x+e.q.c*this.m_vertices[a].y+e.p.y;n=si(n,c),r=si(r,h),s=oi(s,c),o=oi(o,h)}t.lowerBound.x=n-this.m_radius,t.lowerBound.y=r-this.m_radius,t.upperBound.x=s+this.m_radius,t.upperBound.y=o+this.m_radius},ComputeMass:function(e,i){t(this.m_count>=3);for(var n=new r(0,0),s=0,o=0,a=new r(0,0),c=0;c<this.m_count;++c)a.Add(this.m_vertices[c]);a.Multiply(1/this.m_count);for(c=0;c<this.m_count;++c){var h=r.Subtract(this.m_vertices[c],a),l=c+1<this.m_count?r.Subtract(this.m_vertices[c+1],a):r.Subtract(this.m_vertices[0],a),d=u(h,l),m=.5*d;s+=m,n.Add(r.Multiply(m*(1/3),r.Add(h,l)));var f=h.x,p=h.y,g=l.x,v=l.y;o+=1/3*.25*d*(f*f+g*f+g*g+(p*p+v*p+v*v))}e.mass=i*s,t(s>Ge),n.Multiply(1/s),e.center=r.Add(n,a),e.I=i*o,e.I+=e.mass*(_(e.center,e.center)-_(n,n))},GetVertexCount:function(){return this.m_count},GetVertex:function(e){return t(0<=e&&e<this.m_count),this.m_vertices[e]},Validate:function(){for(var t=0;t<this.m_count;++t)for(var e=t,i=t<this.m_count-1?e+1:0,n=this.m_vertices[e],s=r.Subtract(this.m_vertices[i],n),o=0;o<this.m_count;++o)if(o!=e&&o!=i){if(u(s,r.Subtract(this.m_vertices[o],n))<0)return!1}return!0},_serialize:function(t){var e=t||{};this.parent.prototype._serialize.call(this,e),e.m_count=this.m_count,e.m_centroid=this.m_centroid._serialize(),e.m_vertices=[],e.m_normals=[];for(var i=0;i<this.m_count;++i)e.m_vertices.push(this.m_vertices[i]._serialize()),e.m_normals.push(this.m_normals[i]._serialize());return e},_deserialize:function(t){this.parent.prototype._deserialize.call(this,t),this.m_count=t.m_count,this.m_centroid._deserialize(t.m_centroid),this.m_vertices=[],this.m_normals=[];for(var e=0;e<this.m_count;++e)this.m_vertices[e]=new r,this.m_vertices[e]._deserialize(t.m_vertices[e]),this.m_normals[e]=new r,this.m_normals[e]._deserialize(t.m_normals[e])}},k.ComputeCentroid=function(e,i){t(i>=3);for(var n=new r,s=0,o=new r(0,0),a=0;a<i;++a){var c=o,h=e[a],l=a+1<i?e[a+1]:e[0],_=.5*u(r.Subtract(h,c),r.Subtract(l,c));s+=_,n.Add(r.Multiply(_,r.Multiply(1/3,r.Add(r.Add(c,h),l))))}return t(s>Ge),n.Multiply(1/s),n},k._extend(F),j.prototype={CreateProxy:function(t,e){var i=this.m_tree.CreateProxy(t,e);return++this.m_proxyCount,this.BufferMove(i),i},DestroyProxy:function(t){this.UnBufferMove(t),--this.m_proxyCount,this.m_tree.DestroyProxy(t)},MoveProxy:function(t,e,i){this.m_tree.MoveProxy(t,e,i)&&this.BufferMove(t)},TouchProxy:function(t){this.BufferMove(t)},GetFatAABB:function(t){return this.m_tree.GetFatAABB(t)},GetUserData:function(t){return this.m_tree.GetUserData(t)},TestOverlap:function(t,e){return yt(this.m_tree.GetFatAABB(t),this.m_tree.GetFatAABB(e))},GetProxyCount:function(){return this.m_proxyCount},UpdatePairs:function(t){this.m_pairCount=0,this.m_pairBuffer.length=0;for(var e=0;e<this.m_moveCount;++e)if(this.m_queryProxyId=this.m_moveBuffer[e],this.m_queryProxyId!=j.e_nullProxy){var i=this.m_tree.GetFatAABB(this.m_queryProxyId);this.m_tree.Query(this,i)}this.m_moveCount=0,this.m_pairBuffer.sort(U);for(e=0;e<this.m_pairCount;){var n=this.m_pairBuffer[e],r=this.m_tree.GetUserData(n.proxyIdA),s=this.m_tree.GetUserData(n.proxyIdB);for(t.AddPair(r,s),++e;e<this.m_pairCount;){var o=this.m_pairBuffer[e];if(o.proxyIdA!=n.proxyIdA||o.proxyIdB!=n.proxyIdB)break;++e}}},Query:function(t,e){this.m_tree.Query(t,e)},RayCast:function(t,e){this.m_tree.RayCast(t,e)},GetTreeHeight:function(){return this.m_tree.GetHeight()},GetTreeBalance:function(){return this.m_tree.GetMaxBalance()},GetTreeQuality:function(){return this.m_tree.GetAreaRatio()},ShiftOrigin:function(t){this.m_tree.ShiftOrigin(t)},BufferMove:function(t){this.m_moveBuffer[this.m_moveCount]=t,++this.m_moveCount},UnBufferMove:function(t){for(var e=0;e<this.m_moveCount;++e)this.m_moveBuffer[e]==t&&(this.m_moveBuffer[e]=j.e_nullProxy)},QueryCallback:function(t){return t==this.m_queryProxyId||(this.m_pairBuffer[this.m_pairCount]=new W,this.m_pairBuffer[this.m_pairCount].proxyIdA=si(t,this.m_queryProxyId),this.m_pairBuffer[this.m_pairCount].proxyIdB=oi(t,this.m_queryProxyId),++this.m_pairCount,!0)}},j.e_nullProxy=-1,q.prototype={Assign:function(t){this.m_vertices=t.m_vertices,this.m_count=t.m_count,this.m_radius=t.m_radius},Set:function(e,i){switch(e.GetType()){case F.e_circle:var n=e;this.m_vertices=[n.m_p],this.m_count=1,this.m_radius=n.m_radius;break;case F.e_polygon:var r=e;this.m_vertices=r.m_vertices,this.m_count=r.m_count,this.m_radius=r.m_radius;break;case F.e_chain:var s=e;t(0<=i&&i<s.m_count),this.m_vertices=[s.m_vertices[i]],i+1<s.m_count?this.m_vertices[1]=s.m_vertices[i+1]:this.m_vertices[1]=s.m_vertices[0],this.m_count=2,this.m_radius=s.m_radius;break;case F.e_edge:var o=e;this.m_vertices=[o.m_vertex1,o.m_vertex2],this.m_count=2,this.m_radius=o.m_radius;break;default:t(!1)}},GetSupport:function(t,e){for(var i=0,n=this.m_vertices[0].x*t+this.m_vertices[0].y*e,r=1;r<this.m_count;++r){var s=this.m_vertices[r].x*t+this.m_vertices[r].y*e;s>n&&(i=r,n=s)}return i},GetSupportVertex:function(t,e){return this.m_vertices[this.GetSupport(t,e)]},GetVertexCount:function(){return this.m_count},GetVertex:function(e){return t(0<=e&&e<this.m_count),this.m_vertices[e]}},J.prototype={Assign:function(t){this.wA.x=t.wA.x,this.wA.y=t.wA.y,this.wB.x=t.wB.x,this.wB.y=t.wB.y,this.w.x=t.w.x,this.w.y=t.w.y,this.a=t.a,this.indexA=t.indexA,this.indexB=t.indexB}},Z.prototype={ReadCache:function(e,i,n,r,s){t(e.count<=3),this.m_count=e.count;for(var o=this.m_v,a=0;a<this.m_count;++a){(u=o[a]).indexA=e.indexA[a],u.indexB=e.indexB[a];var c=i.GetVertex(u.indexA),h=r.GetVertex(u.indexB);u.wA.x=n.q.c*c.x-n.q.s*c.y+n.p.x,u.wA.y=n.q.s*c.x+n.q.c*c.y+n.p.y,u.wB.x=s.q.c*h.x-s.q.s*h.y+s.p.x,u.wB.y=s.q.s*h.x+s.q.c*h.y+s.p.y,u.w.x=u.wB.x-u.wA.x,u.w.y=u.wB.y-u.wA.y,u.a=0}if(this.m_count>1){var l=e.metric,_=this.GetMetric();(_<.5*l||2*l<_||_<Ge)&&(this.m_count=0)}if(0==this.m_count){var u;(u=o[0]).indexA=0,u.indexB=0;c=i.GetVertex(0),h=r.GetVertex(0);u.wA.x=n.q.c*c.x-n.q.s*c.y+n.p.x,u.wA.y=n.q.s*c.x+n.q.c*c.y+n.p.y,u.wB.x=s.q.c*h.x-s.q.s*h.y+s.p.x,u.wB.y=s.q.s*h.x+s.q.c*h.y+s.p.y,u.w.x=u.wB.x-u.wA.x,u.w.y=u.wB.y-u.wA.y,u.a=1,this.m_count=1}},WriteCache:function(t){t.metric=this.GetMetric(),t.count=this.m_count;for(var e=this.m_v,i=0;i<this.m_count;++i)t.indexA[i]=e[i].indexA,t.indexB[i]=e[i].indexB},GetSearchDirection:function(e){switch(this.m_count){case 1:e.x=-this.m_v[0].w.x,e.y=-this.m_v[0].w.y;break;case 2:var i=this.m_v[1].w.x-this.m_v[0].w.x,n=this.m_v[1].w.y-this.m_v[0].w.y;i*-this.m_v[0].w.y-n*-this.m_v[0].w.x>0?(e.x=-1*n,e.y=1*i):(e.x=1*n,e.y=-1*i);break;default:t(!1),e.x=e.y=0}},GetClosestPoint:function(e){switch(this.m_count){case 1:e.x=this.m_v[0].w.x,e.y=this.m_v[0].w.y;break;case 2:e.x=this.m_v[0].a*this.m_v[0].w.x+this.m_v[1].a*this.m_v[1].w.x,e.y=this.m_v[0].a*this.m_v[0].w.y+this.m_v[1].a*this.m_v[1].w.y;break;case 3:e.x=e.y=0;break;default:t(!1),e.x=e.y=0}},GetWitnessPoints:function(e,i){switch(this.m_count){case 1:e.x=this.m_v[0].wA.x,e.y=this.m_v[0].wA.y,i.x=this.m_v[0].wB.x,i.y=this.m_v[0].wB.y;break;case 2:e.x=this.m_v[0].a*this.m_v[0].wA.x+this.m_v[1].a*this.m_v[1].wA.x,e.y=this.m_v[0].a*this.m_v[0].wA.y+this.m_v[1].a*this.m_v[1].wA.y,i.x=this.m_v[0].a*this.m_v[0].wB.x+this.m_v[1].a*this.m_v[1].wB.x,i.y=this.m_v[0].a*this.m_v[0].wB.y+this.m_v[1].a*this.m_v[1].wB.y;break;case 3:e.x=this.m_v[0].a*this.m_v[0].wA.x+this.m_v[1].a*this.m_v[1].wA.x+this.m_v[2].a*this.m_v[2].wA.x,e.y=this.m_v[0].a*this.m_v[0].wA.y+this.m_v[1].a*this.m_v[1].wA.y+this.m_v[2].a*this.m_v[2].wA.y,i.x=e.x,i.y=e.y;break;default:t(!1)}},GetMetric:function(){switch(this.m_count){case 1:return 0;case 2:return p(this.m_v[0].w,this.m_v[1].w);case 3:return(this.m_v[1].w.x-this.m_v[0].w.x)*(this.m_v[2].w.y-this.m_v[0].w.y)-(this.m_v[1].w.y-this.m_v[0].w.y)*(this.m_v[2].w.x-this.m_v[0].w.x);default:return t(!1),0}},Solve2:function(){var t=this.m_v[0].w,e=this.m_v[1].w,i=e.x-t.x,n=e.y-t.y,r=-(t.x*i+t.y*n);if(r<=0)return this.m_v[0].a=1,void(this.m_count=1);var s=e.x*i+e.y*n;if(s<=0)return this.m_v[1].a=1,this.m_count=1,void this.m_v[0].Assign(this.m_v[1]);var o=1/(s+r);this.m_v[0].a=s*o,this.m_v[1].a=r*o,this.m_count=2},Solve3:function(){var t=this.m_v[0].w,e=this.m_v[1].w,i=this.m_v[2].w,n=e.x-t.x,r=e.y-t.y,s=t.x*n+t.y*r,o=e.x*n+e.y*r,a=-s,c=i.x-t.x,h=i.y-t.y,l=t.x*c+t.y*h,_=i.x*c+i.y*h,u=-l,d=i.x-e.x,m=i.y-e.y,f=e.x*d+e.y*m,p=i.x*d+i.y*m,g=-f,v=n*h-r*c,y=v*(e.x*i.y-e.y*i.x),x=v*(i.x*t.y-i.y*t.x),C=v*(t.x*e.y-t.y*e.x);if(a<=0&&u<=0)return this.m_v[0].a=1,void(this.m_count=1);if(o>0&&a>0&&C<=0){var A=1/(o+a);return this.m_v[0].a=o*A,this.m_v[1].a=a*A,void(this.m_count=2)}if(_>0&&u>0&&x<=0){var T=1/(_+u);return this.m_v[0].a=_*T,this.m_v[2].a=u*T,this.m_count=2,void this.m_v[1].Assign(this.m_v[2])}if(o<=0&&g<=0)return this.m_v[1].a=1,this.m_count=1,void this.m_v[0].Assign(this.m_v[1]);if(_<=0&&p<=0)return this.m_v[2].a=1,this.m_count=1,void this.m_v[0].Assign(this.m_v[2]);if(p>0&&g>0&&y<=0){var b=1/(p+g);return this.m_v[1].a=p*b,this.m_v[2].a=g*b,this.m_count=2,void this.m_v[0].Assign(this.m_v[2])}var w=1/(y+x+C);this.m_v[0].a=y*w,this.m_v[1].a=x*w,this.m_v[2].a=C*w,this.m_count=3}};var ai=new Z,ci=new r,hi=new r;Q.b2_gjkCalls=0,Q.b2_gjkIters=0,Q.b2_gjkMaxIters=0;K.prototype={indexA:0,indexB:0,typeA:0,typeB:0,Reset:function(){this.indexA=this.indexB=this.typeA=this.typeB=0},Get:function(){return this.indexA|this.indexB<<8|this.typeA<<16|this.typeB<<24},Assign:function(t){this.indexA=t.indexA,this.indexB=t.indexB,this.typeA=t.typeA,this.typeB=t.typeB}},K.e_vertex=0,K.e_face=1,$.prototype={Clone:function(){var t=new $;return t.localPoint.x=this.localPoint.x,t.localPoint.y=this.localPoint.y,t.normalImpulse=this.normalImpulse,t.tangentImpulse=this.tangentImpulse,t.id.Assign(this.id),t}},tt.prototype={Clone:function(){var t=new tt;t.pointCount=this.pointCount,t.type=this.type,t.localPoint.x=this.localPoint.x,t.localPoint.y=this.localPoint.y,t.localNormal.x=this.localNormal.x,t.localNormal.y=this.localNormal.y;for(var e=0;e<this.pointCount;++e)t.points[e]=this.points[e].Clone();return t},Assign:function(t){this.pointCount=t.pointCount,this.type=t.type,this.localPoint.x=t.localPoint.x,this.localPoint.y=t.localPoint.y,this.localNormal.x=t.localNormal.x,this.localNormal.y=t.localNormal.y;for(var e=0;e<this.pointCount;++e)this.points[e]=t.points[e].Clone()}},tt.e_circles=0,tt.e_faceA=1,tt.e_faceB=2,tt.b2_nullState=0,tt.b2_addState=1,tt.b2_persistState=2,tt.b2_removeState=3,et.prototype={Initialize:function(t,e,i,n,s){if(0!=t.pointCount)switch(t.type){case tt.e_circles:this.normal.x=1,this.normal.y=0;var o=e.q.c*t.localPoint.x-e.q.s*t.localPoint.y+e.p.x,a=e.q.s*t.localPoint.x+e.q.c*t.localPoint.y+e.p.y,c=n.q.c*t.points[0].localPoint.x-n.q.s*t.points[0].localPoint.y+n.p.x,h=n.q.s*t.points[0].localPoint.x+n.q.c*t.points[0].localPoint.y+n.p.y,l=o-c,_=a-h;l*l+_*_>Ge*Ge&&(this.normal.x=c-o,this.normal.y=h-a,this.normal.Normalize());var u=o+i*this.normal.x,d=a+i*this.normal.y,m=c-s*this.normal.x,f=h-s*this.normal.y;this.points[0]=new r(.5*(u+m),.5*(d+f)),this.separations[0]=(m-u)*this.normal.x+(f-d)*this.normal.y;break;case tt.e_faceA:this.normal.x=e.q.c*t.localNormal.x-e.q.s*t.localNormal.y,this.normal.y=e.q.s*t.localNormal.x+e.q.c*t.localNormal.y;for(var p=e.q.c*t.localPoint.x-e.q.s*t.localPoint.y+e.p.x,g=e.q.s*t.localPoint.x+e.q.c*t.localPoint.y+e.p.y,v=0;v<t.pointCount;++v){var y=n.q.c*t.points[v].localPoint.x-n.q.s*t.points[v].localPoint.y+n.p.x,x=n.q.s*t.points[v].localPoint.x+n.q.c*t.points[v].localPoint.y+n.p.y;u=y+(i-(C=(y-p)*this.normal.x+(x-g)*this.normal.y))*this.normal.x,d=x+(i-C)*this.normal.y,m=y-s*this.normal.x,f=x-s*this.normal.y;this.points[v]=new r(.5*(u+m),.5*(d+f)),this.separations[v]=(m-u)*this.normal.x+(f-d)*this.normal.y}break;case tt.e_faceB:this.normal.x=n.q.c*t.localNormal.x-n.q.s*t.localNormal.y,this.normal.y=n.q.s*t.localNormal.x+n.q.c*t.localNormal.y;for(p=n.q.c*t.localPoint.x-n.q.s*t.localPoint.y+n.p.x,g=n.q.s*t.localPoint.x+n.q.c*t.localPoint.y+n.p.y,v=0;v<t.pointCount;++v){var C;y=e.q.c*t.points[v].localPoint.x-e.q.s*t.points[v].localPoint.y+e.p.x,x=e.q.s*t.points[v].localPoint.x+e.q.c*t.points[v].localPoint.y+e.p.y,m=y+(s-(C=(y-p)*this.normal.x+(x-g)*this.normal.y))*this.normal.x,f=x+(s-C)*this.normal.y,u=y-i*this.normal.x,d=x-i*this.normal.y;this.points[v]=new r(.5*(u+m),.5*(d+f)),this.separations[v]=(u-m)*this.normal.x+(d-f)*this.normal.y}this.normal.x=-this.normal.x,this.normal.y=-this.normal.y}}},st.prototype={Assign:function(t){this.lowerBound.x=t.lowerBound.x,this.lowerBound.y=t.lowerBound.y,this.upperBound.x=t.upperBound.x,this.upperBound.y=t.upperBound.y},Clone:function(){var t=new st;return t.lowerBound.x=this.lowerBound.x,t.lowerBound.y=this.lowerBound.y,t.upperBound.x=this.upperBound.x,t.upperBound.y=this.upperBound.y,t},IsValid:function(){return this.upperBound.x-this.lowerBound.x>=0&&this.upperBound.y-this.lowerBound.y>=0&&this.lowerBound.IsValid()&&this.upperBound.IsValid()},GetCenter:function(){return new r(.5*(this.lowerBound.x+this.upperBound.x),.5*(this.lowerBound.y+this.upperBound.y))},GetExtents:function(){return new r(.5*(this.upperBound.x-this.lowerBound.x),.5*(this.upperBound.y-this.lowerBound.y))},GetPerimeter:function(){return 2*(this.upperBound.x-this.lowerBound.x+(this.upperBound.y-this.lowerBound.y))},Combine:function(t,e){e?(this.lowerBound.x=si(t.lowerBound.x,e.lowerBound.x),this.lowerBound.y=si(t.lowerBound.y,e.lowerBound.y),this.upperBound.x=oi(t.upperBound.x,e.upperBound.x),this.upperBound.y=oi(t.upperBound.y,e.upperBound.y)):(this.lowerBound.x=si(this.lowerBound.x,t.lowerBound.x),this.lowerBound.y=si(this.lowerBound.y,t.lowerBound.y),this.upperBound.x=oi(this.upperBound.x,t.upperBound.x),this.upperBound.y=oi(this.upperBound.y,t.upperBound.y))},Contains:function(t){return this.lowerBound.x<=t.lowerBound.x&&this.lowerBound.y<=t.lowerBound.y&&t.upperBound.x<=this.upperBound.x&&t.upperBound.y<=this.upperBound.y},RayCast:function(t,e){for(var i=-ze,n=ze,s=e.p1,o=r.Subtract(e.p2,e.p1),a=R(o),c=new r,h=0;h<2;++h)if(a.get_i(h)<Ge){if(s.get_i(h)<this.lowerBound.get_i(h)||this.upperBound.get_i(h)<s.get_i(h))return!1}else{var l=1/o.get_i(h),_=(this.lowerBound.get_i(h)-s.get_i(h))*l,u=(this.upperBound.get_i(h)-s.get_i(h))*l,d=-1;if(_>u){var m=u;u=_,_=m,d=1}if(_>i&&(c.x=c.y=0,c.set_i(h,d),i=_),n=si(n,u),i>n)return!1}return!(i<0||e.maxFraction<i)&&(t.fraction=i,t.normal.x=c.x,t.normal.y=c.y,!0)}},lt._localTangent=new r,lt._local_incidentEdges=[new it,new it],ut.e_unknown=0,ut.e_edgeA=1,ut.e_edgeB=2,ft._temp_edge=new r,ft._temp_edge0=new r,ft._temp_edge2=new r,ft.prototype={Collide:function(t,e,i,n,r){this.m_xf.Assign(I(i,r)),this.m_centroidB.x=this.m_xf.q.c*n.m_centroid.x-this.m_xf.q.s*n.m_centroid.y+this.m_xf.p.x,this.m_centroidB.y=this.m_xf.q.s*n.m_centroid.x+this.m_xf.q.c*n.m_centroid.y+this.m_xf.p.y,this.m_v0.x=e.m_vertex0.x,this.m_v0.y=e.m_vertex0.y,this.m_v1.x=e.m_vertex1.x,this.m_v1.y=e.m_vertex1.y,this.m_v2.x=e.m_vertex2.x,this.m_v2.y=e.m_vertex2.y,this.m_v3.x=e.m_vertex3.x,this.m_v3.y=e.m_vertex3.y;var s=e.m_hasVertex0,o=e.m_hasVertex3;ft._temp_edge.x=this.m_v2.x-this.m_v1.x,ft._temp_edge.y=this.m_v2.y-this.m_v1.y,ft._temp_edge.Normalize(),this.m_normal1.x=ft._temp_edge.y,this.m_normal1.y=-ft._temp_edge.x;var a=this.m_normal1.x*(this.m_centroidB.x-this.m_v1.x)+this.m_normal1.y*(this.m_centroidB.y-this.m_v1.y),c=0,h=0,l=!1,_=!1;s&&(ft._temp_edge0.x=this.m_v1.x-this.m_v0.x,ft._temp_edge0.y=this.m_v1.y-this.m_v0.y,ft._temp_edge0.Normalize(),this.m_normal0.x=ft._temp_edge0.y,this.m_normal0.y=-ft._temp_edge0.x,l=ft._temp_edge0.x*ft._temp_edge.y-ft._temp_edge0.y*ft._temp_edge.x>=0,c=this.m_normal0.x*(this.m_centroidB.x-this.m_v0.x)+this.m_normal0.y*(this.m_centroidB.y-this.m_v0.y)),o&&(ft._temp_edge2.x=this.m_v3.x-this.m_v2.x,ft._temp_edge2.y=this.m_v3.y-this.m_v2.y,ft._temp_edge2.Normalize(),this.m_normal2.x=ft._temp_edge2.y,this.m_normal2.y=-ft._temp_edge2.x,_=ft._temp_edge.x*ft._temp_edge2.y-ft._temp_edge.y*ft._temp_edge2.x>0,h=this.m_normal2.x*(this.m_centroidB.x-this.m_v2.x)+this.m_normal2.y*(this.m_centroidB.y-this.m_v2.y)),s&&o?l&&_?(this.m_front=c>=0||a>=0||h>=0,this.m_front?(this.m_normal.x=this.m_normal1.x,this.m_normal.y=this.m_normal1.y,this.m_lowerLimit.x=this.m_normal0.x,this.m_lowerLimit.y=this.m_normal0.y,this.m_upperLimit.x=this.m_normal2.x,this.m_upperLimit.y=this.m_normal2.y):(this.m_normal.x=-this.m_normal1.x,this.m_normal.y=-this.m_normal1.y,this.m_lowerLimit.x=-this.m_normal1.x,this.m_lowerLimit.y=-this.m_normal1.y,this.m_upperLimit.x=-this.m_normal1.x,this.m_upperLimit.y=-this.m_normal1.y)):l?(this.m_front=c>=0||a>=0&&h>=0,this.m_front?(this.m_normal.x=this.m_normal1.x,this.m_normal.y=this.m_normal1.y,this.m_lowerLimit.x=this.m_normal0.x,this.m_lowerLimit.y=this.m_normal0.y,this.m_upperLimit.x=this.m_normal1.x,this.m_upperLimit.y=this.m_normal1.y):(this.m_normal.x=-this.m_normal1.x,this.m_normal.y=-this.m_normal1.y,this.m_lowerLimit.x=-this.m_normal2.x,this.m_lowerLimit.y=-this.m_normal2.y,this.m_upperLimit.x=-this.m_normal1.x,this.m_upperLimit.y=-this.m_normal1.y)):_?(this.m_front=h>=0||c>=0&&a>=0,this.m_front?(this.m_normal.x=this.m_normal1.x,this.m_normal.y=this.m_normal1.y,this.m_lowerLimit.x=this.m_normal1.x,this.m_lowerLimit.y=this.m_normal1.y,this.m_upperLimit.x=this.m_normal2.x,this.m_upperLimit.y=this.m_normal2.y):(this.m_normal.x=-this.m_normal1.x,this.m_normal.y=-this.m_normal1.y,this.m_lowerLimit.x=-this.m_normal1.x,this.m_lowerLimit.y=-this.m_normal1.y,this.m_upperLimit.x=-this.m_normal0.x,this.m_upperLimit.y=-this.m_normal0.y)):(this.m_front=c>=0&&a>=0&&h>=0,this.m_front?(this.m_normal.x=this.m_normal1.x,this.m_normal.y=this.m_normal1.y,this.m_lowerLimit.x=this.m_normal1.x,this.m_lowerLimit.y=this.m_normal1.y,this.m_upperLimit.x=this.m_normal1.x,this.m_upperLimit.y=this.m_normal1.y):(this.m_normal.x=-this.m_normal1.x,this.m_normal.y=-this.m_normal1.y,this.m_lowerLimit.x=-this.m_normal2.x,this.m_lowerLimit.y=-this.m_normal2.y,this.m_upperLimit.x=-this.m_normal0.x,this.m_upperLimit.y=-this.m_normal0.y)):s?l?(this.m_front=c>=0||a>=0,this.m_front?(this.m_normal.x=this.m_normal1.x,this.m_normal.y=this.m_normal1.y,this.m_lowerLimit.x=this.m_normal0.x,this.m_lowerLimit.y=this.m_normal0.y,this.m_upperLimit.x=-this.m_normal1.x,this.m_upperLimit.y=-this.m_normal1.y):(this.m_normal.x=-this.m_normal1.x,this.m_normal.y=-this.m_normal1.y,this.m_lowerLimit.x=this.m_normal1.x,this.m_lowerLimit.y=this.m_normal1.y,this.m_upperLimit.x=-this.m_normal1.x,this.m_upperLimit.y=-this.m_normal1.y)):(this.m_front=c>=0&&a>=0,this.m_front?(this.m_normal.x=this.m_normal1.x,this.m_normal.y=this.m_normal1.y,this.m_lowerLimit.x=this.m_normal1.x,this.m_lowerLimit.y=this.m_normal1.y,this.m_upperLimit.x=-this.m_normal1.x,this.m_upperLimit.y=-this.m_normal1.y):(this.m_normal.x=-this.m_normal1.x,this.m_normal.y=-this.m_normal1.y,this.m_lowerLimit.x=this.m_normal1.x,this.m_lowerLimit.y=this.m_normal1.y,this.m_upperLimit.x=-this.m_normal0.x,this.m_upperLimit.y=-this.m_normal0.y)):o?_?(this.m_front=a>=0||h>=0,this.m_front?(this.m_normal.x=this.m_normal1.x,this.m_normal.y=this.m_normal1.y,this.m_lowerLimit.x=-this.m_normal1.x,this.m_lowerLimit.y=-this.m_normal1.y,this.m_upperLimit.x=this.m_normal2.x,this.m_upperLimit.y=this.m_normal2.y):(this.m_normal.x=-this.m_normal1.x,this.m_normal.y=-this.m_normal1.y,this.m_lowerLimit.x=-this.m_normal1.x,this.m_lowerLimit.y=-this.m_normal1.y,this.m_upperLimit.x=this.m_normal1.x,this.m_upperLimit.y=this.m_normal1.y)):(this.m_front=a>=0&&h>=0,this.m_front?(this.m_normal.x=this.m_normal1.x,this.m_normal.y=this.m_normal1.y,this.m_lowerLimit.x=-this.m_normal1.x,this.m_lowerLimit.y=-this.m_normal1.y,this.m_upperLimit.x=this.m_normal1.x,this.m_upperLimit.y=this.m_normal1.y):(this.m_normal.x=-this.m_normal1.x,this.m_normal.y=-this.m_normal1.y,this.m_lowerLimit.x=-this.m_normal2.x,this.m_lowerLimit.y=-this.m_normal2.y,this.m_upperLimit.x=this.m_normal1.x,this.m_upperLimit.y=this.m_normal1.y)):(this.m_front=a>=0,this.m_front?(this.m_normal.x=this.m_normal1.x,this.m_normal.y=this.m_normal1.y,this.m_lowerLimit.x=-this.m_normal1.x,this.m_lowerLimit.y=-this.m_normal1.y,this.m_upperLimit.x=-this.m_normal1.x,this.m_upperLimit.y=-this.m_normal1.y):(this.m_normal.x=-this.m_normal1.x,this.m_normal.y=-this.m_normal1.y,this.m_lowerLimit.x=this.m_normal1.x,this.m_lowerLimit.y=this.m_normal1.y,this.m_upperLimit.x=this.m_normal1.x,this.m_upperLimit.y=this.m_normal1.y)),this.m_polygonB.count=n.m_count;for(var u=0;u<n.m_count;++u)this.m_polygonB.vertices[u]=S(this.m_xf,n.m_vertices[u]),this.m_polygonB.normals[u]=b(this.m_xf.q,n.m_normals[u]);this.m_radius=2*qe,t.pointCount=0;var d=this.ComputeEdgeSeparation();if(d.type!=ut.e_unknown&&!(d.separation>this.m_radius)){var m=this.ComputePolygonSeparation();if(!(m.type!=ut.e_unknown&&m.separation>this.m_radius)){var f=new ut;f=m.type==ut.e_unknown?d:m.separation>.98*d.separation+.001?m:d;var p=new Array(2),g=new mt;if(f.type==ut.e_edgeA){t.type=tt.e_faceA;var v=0,y=this.m_normal.x*this.m_polygonB.normals[0].x+this.m_normal.y*this.m_polygonB.normals[0].y;for(u=1;u<this.m_polygonB.count;++u){var x=this.m_normal.x*this.m_polygonB.normals[u].x+this.m_normal.y*this.m_polygonB.normals[u].y;x<y&&(y=x,v=u)}var C=v,A=C+1<this.m_polygonB.count?C+1:0;p[0]=new it,p[0].v.x=this.m_polygonB.vertices[C].x,p[0].v.y=this.m_polygonB.vertices[C].y,p[0].id.indexA=0,p[0].id.indexB=C,p[0].id.typeA=K.e_face,p[0].id.typeB=K.e_vertex,p[1]=new it,p[1].v.x=this.m_polygonB.vertices[A].x,p[1].v.y=this.m_polygonB.vertices[A].y,p[1].id.indexA=0,p[1].id.indexB=A,p[1].id.typeA=K.e_face,p[1].id.typeB=K.e_vertex,this.m_front?(g.i1=0,g.i2=1,g.v1.x=this.m_v1.x,g.v1.y=this.m_v1.y,g.v2.x=this.m_v2.x,g.v2.y=this.m_v2.y,g.normal.x=this.m_normal1.x,g.normal.y=this.m_normal1.y):(g.i1=1,g.i2=0,g.v1.x=this.m_v2.x,g.v1.y=this.m_v2.y,g.v2.x=this.m_v1.x,g.v2.y=this.m_v1.y,g.normal.x=-this.m_normal1.x,g.normal.y=-this.m_normal1.y)}else t.type=tt.e_faceB,p[0]=new it,p[0].v=this.m_v1,p[0].id.indexA=0,p[0].id.indexB=f.index,p[0].id.typeA=K.e_vertex,p[0].id.typeB=K.e_face,p[1]=new it,p[1].v=this.m_v2,p[1].id.indexA=0,p[1].id.indexB=f.index,p[1].id.typeA=K.e_vertex,p[1].id.typeB=K.e_face,g.i1=f.index,g.i2=g.i1+1<this.m_polygonB.count?g.i1+1:0,g.v1.x=this.m_polygonB.vertices[g.i1].x,g.v1.y=this.m_polygonB.vertices[g.i1].y,g.v2.x=this.m_polygonB.vertices[g.i2].x,g.v2.y=this.m_polygonB.vertices[g.i2].y,g.normal.x=this.m_polygonB.normals[g.i1].x,g.normal.y=this.m_polygonB.normals[g.i1].y;g.sideNormal1.x=g.normal.y,g.sideNormal1.y=-g.normal.x,g.sideNormal2.x=-g.sideNormal1.x,g.sideNormal2.y=-g.sideNormal1.y,g.sideOffset1=g.sideNormal1.x*g.v1.x+g.sideNormal1.y*g.v1.y,g.sideOffset2=g.sideNormal2.x*g.v2.x+g.sideNormal2.y*g.v2.y;var T=new Array(2),w=new Array(2);if(!(gt(T,p,g.sideNormal1.x,g.sideNormal1.y,g.sideOffset1,g.i1)<ke||gt(w,T,g.sideNormal2.x,g.sideNormal2.y,g.sideOffset2,g.i2)<ke)){f.type==ut.e_edgeA?(t.localNormal.x=g.normal.x,t.localNormal.y=g.normal.y,t.localPoint.x=g.v1.x,t.localPoint.y=g.v1.y):(t.localNormal.x=n.m_normals[g.i1].x,t.localNormal.y=n.m_normals[g.i1].y,t.localPoint.x=n.m_vertices[g.i1].x,t.localPoint.y=n.m_vertices[g.i1].y);var R=0;for(u=0;u<ke;++u){if(g.normal.x*(w[u].v.x-g.v1.x)+g.normal.y*(w[u].v.y-g.v1.y)<=this.m_radius){var P=t.points[R]=new $;f.type==ut.e_edgeA?(P.localPoint.Assign(E(this.m_xf,w[u].v)),P.id.Assign(w[u].id)):(P.localPoint.x=w[u].v.x,P.localPoint.y=w[u].v.y,P.id.typeA=w[u].id.typeB,P.id.typeB=w[u].id.typeA,P.id.indexA=w[u].id.indexB,P.id.indexB=w[u].id.indexA),++R}}t.pointCount=R}}}},ComputeEdgeSeparation:function(){var t=new ut;t.type=ut.e_edgeA,t.index=this.m_front?0:1,t.separation=Number.MAX_VALUE;for(var e=0;e<this.m_polygonB.count;++e){var i=this.m_normal.x*(this.m_polygonB.vertices[e].x-this.m_v1.x)+this.m_normal.y*(this.m_polygonB.vertices[e].y-this.m_v1.y);i<t.separation&&(t.separation=i)}return t},ComputePolygonSeparation:function(){var t=new ut;t.type=ut.e_unknown,t.index=-1,t.separation=-Number.MAX_VALUE;for(var e=-this.m_normal.y,i=this.m_normal.x,n=0;n<this.m_polygonB.count;++n){var r=-this.m_polygonB.normals[n].x,s=-this.m_polygonB.normals[n].y,o=r*(this.m_polygonB.vertices[n].x-this.m_v1.x)+s*(this.m_polygonB.vertices[n].y-this.m_v1.y),a=r*(this.m_polygonB.vertices[n].x-this.m_v2.x)+s*(this.m_polygonB.vertices[n].y-this.m_v2.y),c=si(o,a);if(c>this.m_radius)return t.type=ut.e_edgeB,t.index=n,t.separation=c,t;if(r*e+s*i>=0){if((r-this.m_upperLimit.x)*this.m_normal.x+(s-this.m_upperLimit.y)*this.m_normal.y<-je)continue}else if((r-this.m_lowerLimit.x)*this.m_normal.x+(s-this.m_lowerLimit.y)*this.m_normal.y<-je)continue;c>t.separation&&(t.type=ut.e_edgeB,t.index=n,t.separation=c)}return t}},ft.e_isolated=0,ft.e_concave=1,ft.e_convex=2,pt.collider=new ft,vt.input=new X,vt.cache=new Y,vt.output=new H;var li=-1;xt.prototype={IsLeaf:function(){return this.child1==li}},Ct.aabbExtensionFattener=new r(.1,.1),Ct.prototype={CreateProxy:function(t,e){var i=this.AllocateNode();return this.m_nodes[i].aabb.lowerBound.Assign(r.Subtract(t.lowerBound,Ct.aabbExtensionFattener)),this.m_nodes[i].aabb.upperBound.Assign(r.Add(t.upperBound,Ct.aabbExtensionFattener)),this.m_nodes[i].userData=e,this.m_nodes[i].height=0,this.InsertLeaf(i),i},DestroyProxy:function(e){t(0<=e&&e<this.m_nodeCapacity),t(this.m_nodes[e].IsLeaf()),this.RemoveLeaf(e),this.FreeNode(e)},MoveProxy:function(e,i,n){if(t(0<=e&&e<this.m_nodeCapacity),t(this.m_nodes[e].IsLeaf()),this.m_nodes[e].aabb.Contains(i))return!1;this.RemoveLeaf(e),this.m_nodes[e].aabb.Assign(i),this.m_nodes[e].aabb.lowerBound.Subtract(Ct.aabbExtensionFattener),this.m_nodes[e].aabb.upperBound.Add(Ct.aabbExtensionFattener);var s=r.Multiply(2,n);return s.x<0?this.m_nodes[e].aabb.lowerBound.x+=s.x:this.m_nodes[e].aabb.upperBound.x+=s.x,s.y<0?this.m_nodes[e].aabb.lowerBound.y+=s.y:this.m_nodes[e].aabb.upperBound.y+=s.y,this.InsertLeaf(e),!0},GetUserData:function(e){return t(0<=e&&e<this.m_nodeCapacity),this.m_nodes[e].userData},GetFatAABB:function(e){return t(0<=e&&e<this.m_nodeCapacity),this.m_nodes[e].aabb},Query:function(t,e){var i=[];for(i.push(this.m_root);i.length>0;){var n=i.pop();if(n!=li){var r=this.m_nodes[n];if(yt(r.aabb,e))if(r.IsLeaf()){if(0==t.QueryCallback(n))return}else i.push(r.child1),i.push(r.child2)}}},RayCast:function(e,i){var n=i.p1,s=i.p2,o=r.Subtract(s,n);t(o.LengthSquared()>0),o.Normalize();var a=m(1,o),c=R(a),h=i.maxFraction,l=new st,u=r.Add(n,r.Multiply(h,r.Subtract(s,n)));l.lowerBound.Assign(P(n,u)),l.upperBound.Assign(B(n,u));var d=[];for(d.push(this.m_root);d.length>0;){var f=d.pop();if(f!=li){var p=this.m_nodes[f];if(0!=yt(p.aabb,l)){var g=p.aabb.GetCenter(),v=p.aabb.GetExtents();if(!(ri(_(a,r.Subtract(n,g)))-_(c,v)>0))if(p.IsLeaf()){var y=new nt;y.p1.Assign(i.p1),y.p2.Assign(i.p2),y.maxFraction=h;var x=e.RayCastCallback(y,f);if(0==x)return;if(x>0){u=r.Add(n,r.Multiply(h=x,r.Subtract(s,n)));l.lowerBound.Assign(P(n,u)),l.upperBound.Assign(B(n,u))}}else d.push(p.child1),d.push(p.child2)}}}},Validate:function(){this.ValidateStructure(this.m_root),this.ValidateMetrics(this.m_root);for(var e=0,i=this.m_freeList;i!=li;)t(0<=i&&i<this.m_nodeCapacity),i=this.m_nodes[i].parent,++e;t(this.GetHeight()==this.ComputeHeight()),t(this.m_nodeCount+e==this.m_nodeCapacity)},GetHeight:function(){return this.m_root==li?0:this.m_nodes[this.m_root].height},GetMaxBalance:function(){for(var e=0,i=0;i<this.m_nodeCapacity;++i){var n=this.m_nodes[i];if(!(n.height<=1)){t(0==n.IsLeaf());var r=n.child1,s=n.child2,o=ri(this.m_nodes[s].height-this.m_nodes[r].height);e=oi(e,o)}}return e},GetAreaRatio:function(){if(this.m_root==li)return 0;for(var t=this.m_nodes[this.m_root].aabb.GetPerimeter(),e=0,i=0;i<this.m_nodeCapacity;++i){var n=this.m_nodes[i];n.height<0||(e+=n.aabb.GetPerimeter())}return e/t},RebuildBottomUp:function(){for(var t=new Array(this.m_nodeCount),e=0,i=0;i<this.m_nodeCapacity;++i)this.m_nodes[i].height<0||(this.m_nodes[i].IsLeaf()?(this.m_nodes[i].parent=li,t[e]=i,++e):this.FreeNode(i));for(;e>1;){var n=ze,r=-1,s=-1;for(i=0;i<e;++i)for(var o=this.m_nodes[t[i]].aabb,a=i+1;a<e;++a){var c=this.m_nodes[t[a]].aabb,h=new st;h.Combine(o,c);var l=h.GetPerimeter();l<n&&(r=i,s=a,n=l)}var _=t[r],u=t[s],d=this.m_nodes[_],m=this.m_nodes[u],f=this.AllocateNode(),p=this.m_nodes[f];p.child1=_,p.child2=u,p.height=1+oi(d.height,m.height),p.aabb.Combine(d.aabb,m.aabb),p.parent=li,d.parent=f,m.parent=f,t[s]=t[e-1],t[r]=f,--e}this.m_root=t[0],this.Validate()},ShiftOrigin:function(t){for(var e=0;e<this.m_nodeCapacity;++e)this.m_nodes[e].aabb.lowerBound.Subtract(t),this.m_nodes[e].aabb.upperBound.Subtract(t)},AllocateNode:function(){if(this.m_freeList==li){t(this.m_nodeCount==this.m_nodeCapacity);var e=this.m_nodes;this.m_nodeCapacity*=2,this.m_nodes=e.concat(new Array(this.m_nodeCapacity-this.m_nodeCount));for(var i=this.m_nodeCount;i<this.m_nodeCapacity-1;++i)this.m_nodes[i]=new xt,this.m_nodes[i].parent=i+1,this.m_nodes[i].height=-1;this.m_nodes[this.m_nodeCapacity-1]=new xt,this.m_nodes[this.m_nodeCapacity-1].parent=li,this.m_nodes[this.m_nodeCapacity-1].height=-1,this.m_freeList=this.m_nodeCount}var n=this.m_freeList;return this.m_freeList=this.m_nodes[n].parent,this.m_nodes[n].parent=li,this.m_nodes[n].child1=li,this.m_nodes[n].child2=li,this.m_nodes[n].height=0,this.m_nodes[n].userData=null,++this.m_nodeCount,n},FreeNode:function(e){t(0<=e&&e<this.m_nodeCapacity),t(0<this.m_nodeCount),this.m_nodes[e].parent=this.m_freeList,this.m_nodes[e].height=-1,this.m_freeList=e,--this.m_nodeCount},InsertLeaf:function(e){if(++this.m_insertionCount,this.m_root==li)return this.m_root=e,void(this.m_nodes[this.m_root].parent=li);for(var i=this.m_nodes[e].aabb,n=this.m_root;0==this.m_nodes[n].IsLeaf();){var r=this.m_nodes[n].child1,s=this.m_nodes[n].child2,o=this.m_nodes[n].aabb.GetPerimeter(),a=new st;a.Combine(this.m_nodes[n].aabb,i);var c,h,l=a.GetPerimeter(),_=2*l,u=2*(l-o);if(this.m_nodes[r].IsLeaf())(h=new st).Combine(i,this.m_nodes[r].aabb),c=h.GetPerimeter()+u;else{(h=new st).Combine(i,this.m_nodes[r].aabb);var d=this.m_nodes[r].aabb.GetPerimeter();c=h.GetPerimeter()-d+u}var m;if(this.m_nodes[s].IsLeaf())(h=new st).Combine(i,this.m_nodes[s].aabb),m=h.GetPerimeter()+u;else{(h=new st).Combine(i,this.m_nodes[s].aabb);d=this.m_nodes[s].aabb.GetPerimeter();m=h.GetPerimeter()-d+u}if(_<c&&_<m)break;n=c<m?r:s}var f=n,p=this.m_nodes[f].parent,g=this.AllocateNode();for(this.m_nodes[g].parent=p,this.m_nodes[g].userData=null,this.m_nodes[g].aabb.Combine(i,this.m_nodes[f].aabb),this.m_nodes[g].height=this.m_nodes[f].height+1,p!=li?(this.m_nodes[p].child1==f?this.m_nodes[p].child1=g:this.m_nodes[p].child2=g,this.m_nodes[g].child1=f,this.m_nodes[g].child2=e,this.m_nodes[f].parent=g,this.m_nodes[e].parent=g):(this.m_nodes[g].child1=f,this.m_nodes[g].child2=e,this.m_nodes[f].parent=g,this.m_nodes[e].parent=g,this.m_root=g),n=this.m_nodes[e].parent;n!=li;){n=this.Balance(n);r=this.m_nodes[n].child1,s=this.m_nodes[n].child2;t(r!=li),t(s!=li),this.m_nodes[n].height=1+oi(this.m_nodes[r].height,this.m_nodes[s].height),this.m_nodes[n].aabb.Combine(this.m_nodes[r].aabb,this.m_nodes[s].aabb),n=this.m_nodes[n].parent}},RemoveLeaf:function(t){if(t!=this.m_root){var e,i=this.m_nodes[t].parent,n=this.m_nodes[i].parent;if(e=this.m_nodes[i].child1==t?this.m_nodes[i].child2:this.m_nodes[i].child1,n!=li){this.m_nodes[n].child1==i?this.m_nodes[n].child1=e:this.m_nodes[n].child2=e,this.m_nodes[e].parent=n,this.FreeNode(i);for(var r=n;r!=li;){r=this.Balance(r);var s=this.m_nodes[r].child1,o=this.m_nodes[r].child2;this.m_nodes[r].aabb.Combine(this.m_nodes[s].aabb,this.m_nodes[o].aabb),this.m_nodes[r].height=1+oi(this.m_nodes[s].height,this.m_nodes[o].height),r=this.m_nodes[r].parent}}else this.m_root=e,this.m_nodes[e].parent=li,this.FreeNode(i)}else this.m_root=li},Balance:function(e){t(e!=li);var i=this.m_nodes[e];if(i.IsLeaf()||i.height<2)return e;var n=i.child1,r=i.child2;t(0<=n&&n<this.m_nodeCapacity),t(0<=r&&r<this.m_nodeCapacity);var s=this.m_nodes[n],o=this.m_nodes[r],a=o.height-s.height;if(a>1){var c=o.child1,h=o.child2,l=this.m_nodes[c],_=this.m_nodes[h];return t(0<=c&&c<this.m_nodeCapacity),t(0<=h&&h<this.m_nodeCapacity),o.child1=e,o.parent=i.parent,i.parent=r,o.parent!=li?this.m_nodes[o.parent].child1==e?this.m_nodes[o.parent].child1=r:(t(this.m_nodes[o.parent].child2==e),this.m_nodes[o.parent].child2=r):this.m_root=r,l.height>_.height?(o.child2=c,i.child2=h,_.parent=e,i.aabb.Combine(s.aabb,_.aabb),o.aabb.Combine(i.aabb,l.aabb),i.height=1+oi(s.height,_.height),o.height=1+oi(i.height,l.height)):(o.child2=h,i.child2=c,l.parent=e,i.aabb.Combine(s.aabb,l.aabb),o.aabb.Combine(i.aabb,_.aabb),i.height=1+oi(s.height,l.height),o.height=1+oi(i.height,_.height)),r}if(a<-1){var u=s.child1,d=s.child2,m=this.m_nodes[u],f=this.m_nodes[d];return t(0<=u&&u<this.m_nodeCapacity),t(0<=d&&d<this.m_nodeCapacity),s.child1=e,s.parent=i.parent,i.parent=n,s.parent!=li?this.m_nodes[s.parent].child1==e?this.m_nodes[s.parent].child1=n:(t(this.m_nodes[s.parent].child2==e),this.m_nodes[s.parent].child2=n):this.m_root=n,m.height>f.height?(s.child2=u,i.child1=d,f.parent=e,i.aabb.Combine(o.aabb,f.aabb),s.aabb.Combine(i.aabb,m.aabb),i.height=1+oi(o.height,f.height),s.height=1+oi(i.height,m.height)):(s.child2=d,i.child1=u,m.parent=e,i.aabb.Combine(o.aabb,m.aabb),s.aabb.Combine(i.aabb,f.aabb),i.height=1+oi(o.height,m.height),s.height=1+oi(i.height,f.height)),n}return e},ComputeHeight:function(e){void 0===e&&(e=this.m_root),t(0<=e&&e<this.m_nodeCapacity);var i=this.m_nodes[e];if(i.IsLeaf())return 0;var n=this.ComputeHeight(i.child1),r=this.ComputeHeight(i.child2);return 1+oi(n,r)},ValidateStructure:function(e){if(e!=li){e==this.m_root&&t(this.m_nodes[e].parent==li);var i=this.m_nodes[e],n=i.child1,r=i.child2;if(i.IsLeaf())return t(n==li),t(r==li),void t(0==i.height);t(0<=n&&n<this.m_nodeCapacity),t(0<=r&&r<this.m_nodeCapacity),t(this.m_nodes[n].parent==e),t(this.m_nodes[r].parent==e),this.ValidateStructure(n),this.ValidateStructure(r)}},ValidateMetrics:function(e){if(e!=li){var i=this.m_nodes[e],n=i.child1,s=i.child2;if(i.IsLeaf())return t(n==li),t(s==li),void t(0==i.height);t(0<=n&&n<this.m_nodeCapacity),t(0<=s&&s<this.m_nodeCapacity);var o,a=this.m_nodes[n].height,c=this.m_nodes[s].height;o=1+oi(a,c),t(i.height==o);var h=new st;h.Combine(this.m_nodes[n].aabb,this.m_nodes[s].aabb),t(r.Equals(h.lowerBound,i.aabb.lowerBound)),t(r.Equals(h.upperBound,i.aabb.upperBound)),this.ValidateMetrics(n),this.ValidateMetrics(s)}}},Tt.e_unknown=0,Tt.e_failed=1,Tt.e_overlapped=2,Tt.e_touching=3,Tt.e_separated=4;var _i=new h,ui=new h;bt.prototype={Initialize:function(e,i,n,r,s,o){this.m_proxyA=i,this.m_proxyB=r;var a=e.count;if(t(0<a&&a<3),this.m_sweepA=n,this.m_sweepB=s,this.m_sweepA.GetTransform(_i,o),this.m_sweepB.GetTransform(ui,o),1==a){this.m_type=bt.e_points;var c=this.m_proxyA.GetVertex(e.indexA[0]),h=this.m_proxyB.GetVertex(e.indexB[0]),l=_i.q.c*c.x-_i.q.s*c.y+_i.p.x,_=_i.q.s*c.x+_i.q.c*c.y+_i.p.y,u=ui.q.c*h.x-ui.q.s*h.y+ui.p.x,d=ui.q.s*h.x+ui.q.c*h.y+ui.p.y;this.m_axis.x=u-l,this.m_axis.y=d-_;return x=this.m_axis.Normalize()}if(e.indexA[0]==e.indexA[1]){this.m_type=bt.e_faceB;var m=r.GetVertex(e.indexB[0]),f=r.GetVertex(e.indexB[1]);this.m_axis.x=1*(f.y-m.y),this.m_axis.y=-1*(f.x-m.x),this.m_axis.Normalize();var p=ui.q.c*this.m_axis.x-ui.q.s*this.m_axis.y,g=ui.q.s*this.m_axis.x+ui.q.c*this.m_axis.y;this.m_localPoint.x=.5*(m.x+f.x),this.m_localPoint.y=.5*(m.y+f.y);u=ui.q.c*this.m_localPoint.x-ui.q.s*this.m_localPoint.y+ui.p.x,d=ui.q.s*this.m_localPoint.x+ui.q.c*this.m_localPoint.y+ui.p.y,c=i.GetVertex(e.indexA[0]);return(x=((l=_i.q.c*c.x-_i.q.s*c.y+_i.p.x)-u)*p+((_=_i.q.s*c.x+_i.q.c*c.y+_i.p.y)-d)*g)<0&&(this.m_axis.x=-this.m_axis.x,this.m_axis.y=-this.m_axis.y,x=-x),x}this.m_type=bt.e_faceA;var v=this.m_proxyA.GetVertex(e.indexA[0]),y=this.m_proxyA.GetVertex(e.indexA[1]);this.m_axis.x=1*(y.y-v.y),this.m_axis.y=-1*(y.x-v.x),this.m_axis.Normalize();p=_i.q.c*this.m_axis.x-_i.q.s*this.m_axis.y,g=_i.q.s*this.m_axis.x+_i.q.c*this.m_axis.y;this.m_localPoint.x=.5*(v.x+y.x),this.m_localPoint.y=.5*(v.y+y.y);var x;l=_i.q.c*this.m_localPoint.x-_i.q.s*this.m_localPoint.y+_i.p.x,_=_i.q.s*this.m_localPoint.x+_i.q.c*this.m_localPoint.y+_i.p.y,h=this.m_proxyB.GetVertex(e.indexB[0]);return(x=((u=ui.q.c*h.x-ui.q.s*h.y+ui.p.x)-l)*p+((d=ui.q.s*h.x+ui.q.c*h.y+ui.p.y)-_)*g)<0&&(this.m_axis.x=-this.m_axis.x,this.m_axis.y=-this.m_axis.y,x=-x),x},FindMinSeparation:function(e,i){switch(this.m_sweepA.GetTransform(_i,i),this.m_sweepB.GetTransform(ui,i),this.m_type){case bt.e_points:var n=_i.q.c*this.m_axis.x+_i.q.s*this.m_axis.y,r=-_i.q.s*this.m_axis.x+_i.q.c*this.m_axis.y,s=ui.q.c*-this.m_axis.x+ui.q.s*-this.m_axis.y,o=-ui.q.s*-this.m_axis.x+ui.q.c*-this.m_axis.y;e[0]=this.m_proxyA.GetSupport(n,r),e[1]=this.m_proxyB.GetSupport(s,o);var a=this.m_proxyA.GetVertex(e[0]),c=this.m_proxyB.GetVertex(e[1]),h=_i.q.c*a.x-_i.q.s*a.y+_i.p.x,l=_i.q.s*a.x+_i.q.c*a.y+_i.p.y,_=ui.q.c*c.x-ui.q.s*c.y+ui.p.x,u=ui.q.s*c.x+ui.q.c*c.y+ui.p.y;return(_-h)*this.m_axis.x+(u-l)*this.m_axis.y;case bt.e_faceA:var d=_i.q.c*this.m_axis.x-_i.q.s*this.m_axis.y,m=_i.q.s*this.m_axis.x+_i.q.c*this.m_axis.y;h=_i.q.c*this.m_localPoint.x-_i.q.s*this.m_localPoint.y+_i.p.x,l=_i.q.s*this.m_localPoint.x+_i.q.c*this.m_localPoint.y+_i.p.y,s=ui.q.c*-d+ui.q.s*-m,o=-ui.q.s*-d+ui.q.c*-m;e[0]=-1,e[1]=this.m_proxyB.GetSupport(s,o);c=this.m_proxyB.GetVertex(e[1]);return((_=ui.q.c*c.x-ui.q.s*c.y+ui.p.x)-h)*d+((u=ui.q.s*c.x+ui.q.c*c.y+ui.p.y)-l)*m;case bt.e_faceB:d=ui.q.c*this.m_axis.x-ui.q.s*this.m_axis.y,m=ui.q.s*this.m_axis.x+ui.q.c*this.m_axis.y,_=ui.q.c*this.m_localPoint.x-ui.q.s*this.m_localPoint.y+ui.p.x,u=ui.q.s*this.m_localPoint.x+ui.q.c*this.m_localPoint.y+ui.p.y,n=_i.q.c*-d+_i.q.s*-m,o=-_i.q.s*-d+_i.q.c*-m;e[1]=-1,e[0]=this.m_proxyA.GetSupport(n,o);a=this.m_proxyA.GetVertex(e[0]);return((h=_i.q.c*a.x-_i.q.s*a.y+_i.p.x)-_)*d+((l=_i.q.s*a.x+_i.q.c*a.y+_i.p.y)-u)*m;default:return t(!1),e[0]=-1,e[1]=-1,0}},Evaluate:function(e,i,n){switch(this.m_sweepA.GetTransform(_i,n),this.m_sweepB.GetTransform(ui,n),this.m_type){case bt.e_points:var r=this.m_proxyA.GetVertex(e),s=this.m_proxyB.GetVertex(i),o=_i.q.c*r.x-_i.q.s*r.y+_i.p.x,a=_i.q.s*r.x+_i.q.c*r.y+_i.p.y,c=ui.q.c*s.x-ui.q.s*s.y+ui.p.x,h=ui.q.s*s.x+ui.q.c*s.y+ui.p.y;return(c-o)*this.m_axis.x+(h-a)*this.m_axis.y;case bt.e_faceA:var l=_i.q.c*this.m_axis.x-_i.q.s*this.m_axis.y,_=_i.q.s*this.m_axis.x+_i.q.c*this.m_axis.y;o=_i.q.c*this.m_localPoint.x-_i.q.s*this.m_localPoint.y+_i.p.x,a=_i.q.s*this.m_localPoint.x+_i.q.c*this.m_localPoint.y+_i.p.y,s=this.m_proxyB.GetVertex(i);return((c=ui.q.c*s.x-ui.q.s*s.y+ui.p.x)-o)*l+((h=ui.q.s*s.x+ui.q.c*s.y+ui.p.y)-a)*_;case bt.e_faceB:l=ui.q.c*this.m_axis.x-ui.q.s*this.m_axis.y,_=ui.q.s*this.m_axis.x+ui.q.c*this.m_axis.y,c=ui.q.c*this.m_localPoint.x-ui.q.s*this.m_localPoint.y+ui.p.x,h=ui.q.s*this.m_localPoint.x+ui.q.c*this.m_localPoint.y+ui.p.y,r=this.m_proxyA.GetVertex(e);return((o=_i.q.c*r.x-_i.q.s*r.y+_i.p.x)-c)*l+((a=_i.q.s*r.x+_i.q.c*r.y+_i.p.y)-h)*_;default:return t(!1),0}}},bt.e_points=0,bt.e_faceA=1,bt.e_faceB=2;var di=Fe.create("toi","solveTOI");wt._temp_sweepA=new l,wt._temp_sweepB=new l,wt.b2_toiTime=0,wt.b2_toiMaxTime=0,wt.b2_toiCalls=0,wt.b2_toiIters=0,wt.b2_toiMaxIters=0,wt.b2_toiRootIters=0,wt.b2_toiMaxRootIters=0,St.prototype={_deserialize:function(t){this.type=t.type,this.position._deserialize(t.position),this.angle=t.angle,this.linearVelocity._deserialize(t.linearVelocity),this.angularVelocity=t.angularVelocity,this.linearDamping=t.linearDamping,this.angularDamping=t.angularDamping,this.allowSleep=t.allowSleep,this.awake=t.awake,this.fixedRotation=t.fixedRotation,this.bullet=t.bullet,this.active=t.active,this.gravityScale=t.gravityScale}},Et.b2_staticBody=0,Et.b2_kinematicBody=1,Et.b2_dynamicBody=2,Et.e_islandFlag=1,Et.e_awakeFlag=2,Et.e_autoSleepFlag=4,Et.e_bulletFlag=8,Et.e_fixedRotationFlag=16,Et.e_activeFlag=32,Et.e_toiFlag=64,Et.m_local_oldCenter=new r,Et.m_local_xf1=new h,Et.prototype={CreateFixture:function(e,i){if(void 0!==i){var n=new Rt;return n.shape=e,n.density=i,this.CreateFixture(n)}if(t(0==this.m_world.IsLocked()),1==this.m_world.IsLocked())return null;var r=new Bt;if(r.Create(this,e),this.m_flags&Et.e_activeFlag){var s=this.m_world.m_contactManager.m_broadPhase;r.CreateProxies(s,this.m_xf)}return r.m_next=this.m_fixtureList,this.m_fixtureList=r,++this.m_fixtureCount,r.m_body=this,r.m_density>0&&this.ResetMassData(),this.m_world.m_flags|=Wt.e_newFixture,r},DestroyFixture:function(e){if(t(0==this.m_world.IsLocked()),1!=this.m_world.IsLocked()){t(e.m_body==this),t(this.m_fixtureCount>0);for(var i=this.m_fixtureList,n=!1;null!=i;){if(i==e){this.m_fixtureList=i=e.m_next,n=!0;break}i=i.m_next}t(n);for(var r=this.m_contactList;r;){var s=r.contact;r=r.next;var o=s.GetFixtureA(),a=s.GetFixtureB();e!=o&&e!=a||this.m_world.m_contactManager.Destroy(s)}if(this.m_flags&Et.e_activeFlag){var c=this.m_world.m_contactManager.m_broadPhase;e.DestroyProxies(c)}e.Destroy(),e.m_body=null,e.m_next=null,--this.m_fixtureCount,this.ResetMassData()}},SetTransform:function(e,i){if(t(0==this.m_world.IsLocked()),1!=this.m_world.IsLocked()){this.m_xf.q.Set(i),this.m_xf.p.Assign(e),this.m_sweep.c.Assign(S(this.m_xf,this.m_sweep.localCenter)),this.m_sweep.a=i,this.m_sweep.c0.Assign(this.m_sweep.c),this.m_sweep.a0=i;for(var n=this.m_world.m_contactManager.m_broadPhase,r=this.m_fixtureList;r;r=r.m_next)r.Synchronize(n,this.m_xf,this.m_xf)}},GetTransform:function(){return this.m_xf},GetPosition:function(){return this.m_xf.p},GetAngle:function(){return this.m_sweep.a},GetWorldCenter:function(){return this.m_sweep.c},GetLocalCenter:function(){return this.m_sweep.localCenter},SetLinearVelocity:function(t){this.m_type!=Et.b2_staticBody&&(_(t,t)>0&&this.SetAwake(!0),this.m_linearVelocity=t)},GetLinearVelocity:function(){return this.m_linearVelocity},SetAngularVelocity:function(t){this.m_type!=Et.b2_staticBody&&(t*t>0&&this.SetAwake(!0),this.m_angularVelocity=t)},GetAngularVelocity:function(){return this.m_angularVelocity},ApplyForce:function(t,e,i){this.m_type==Et.b2_dynamicBody&&(i&&0==(this.m_flags&Et.e_awakeFlag)&&this.SetAwake(!0),this.m_flags&Et.e_awakeFlag&&(this.m_force.Add(t),this.m_torque+=u(r.Subtract(e,this.m_sweep.c),t)))},ApplyForceToCenter:function(t,e){this.m_type==Et.b2_dynamicBody&&(e&&0==(this.m_flags&Et.e_awakeFlag)&&this.SetAwake(!0),this.m_flags&Et.e_awakeFlag&&this.m_force.Add(t))},ApplyTorque:function(t,e){this.m_type==Et.b2_dynamicBody&&(e&&0==(this.m_flags&Et.e_awakeFlag)&&this.SetAwake(!0),this.m_flags&Et.e_awakeFlag&&(this.m_torque+=t))},ApplyLinearImpulse:function(t,e,i){this.m_type==Et.b2_dynamicBody&&(i&&0==(this.m_flags&Et.e_awakeFlag)&&this.SetAwake(!0),this.m_flags&Et.e_awakeFlag&&(this.m_linearVelocity.Add(r.Multiply(this.m_invMass,t)),this.m_angularVelocity+=this.m_invI*u(r.Subtract(e,this.m_sweep.c),t)))},ApplyAngularImpulse:function(t,e){this.m_type==Et.b2_dynamicBody&&(e&&0==(this.m_flags&Et.e_awakeFlag)&&this.SetAwake(!0),this.m_flags&Et.e_awakeFlag&&(this.m_angularVelocity+=this.m_invI*t))},GetMass:function(){return this.m_mass},GetInertia:function(){return this.m_I+this.m_mass*_(this.m_sweep.localCenter,this.m_sweep.localCenter)},GetMassData:function(t){t.mass=this.m_mass,t.I=this.m_I+this.m_mass*_(this.m_sweep.localCenter,this.m_sweep.localCenter),t.center=this.m_sweep.localCenter},SetMassData:function(e){t(0==this.m_world.IsLocked()),1!=this.m_world.IsLocked()&&this.m_type==Et.b2_dynamicBody&&(this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_mass=e.mass,this.m_mass<=0&&(this.m_mass=1),this.m_invMass=1/this.m_mass,e.I>0&&0==(this.m_flags&Et.e_fixedRotationFlag)&&(this.m_I=e.I-this.m_mass*_(e.center,e.center),t(this.m_I>0),this.m_invI=1/this.m_I),Et.m_local_oldCenter.Assign(this.m_sweep.c),this.m_sweep.localCenter.Assign(e.center),this.m_sweep.c0.Assign(S(this.m_xf,this.m_sweep.localCenter)),this.m_sweep.c.Assign(this.m_sweep.c0),this.m_linearVelocity.Add(m(this.m_angularVelocity,r.Subtract(this.m_sweep.c,Et.m_local_oldCenter))))},ResetMassData:function(){if(this.m_mass=0,this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_sweep.localCenter.SetZero(),this.m_type==Et.b2_staticBody||this.m_type==Et.b2_kinematicBody)return this.m_sweep.c0.Assign(this.m_xf.p),this.m_sweep.c.Assign(this.m_xf.p),void(this.m_sweep.a0=this.m_sweep.a);t(this.m_type==Et.b2_dynamicBody);for(var e=new r(0,0),i=this.m_fixtureList;i;i=i.m_next)if(0!=i.m_density){var n=new M;i.GetMassData(n),this.m_mass+=n.mass,e.Add(r.Multiply(n.mass,n.center)),this.m_I+=n.I}this.m_mass>0?(this.m_invMass=1/this.m_mass,e.Multiply(this.m_invMass)):(this.m_mass=1,this.m_invMass=1),this.m_I>0&&0==(this.m_flags&Et.e_fixedRotationFlag)?(this.m_I-=this.m_mass*_(e,e),t(this.m_I>0),this.m_invI=1/this.m_I):(this.m_I=0,this.m_invI=0),Et.m_local_oldCenter.Assign(this.m_sweep.c),this.m_sweep.localCenter.Assign(e),this.m_sweep.c0.Assign(S(this.m_xf,this.m_sweep.localCenter)),this.m_sweep.c.Assign(this.m_sweep.c0),this.m_linearVelocity.Add(m(this.m_angularVelocity,r.Subtract(this.m_sweep.c,Et.m_local_oldCenter)))},GetWorldPoint:function(t){return S(this.m_xf,t)},GetWorldVector:function(t){return b(this.m_xf.q,t)},GetLocalPoint:function(t){return E(this.m_xf,t)},GetLocalVector:function(t){return w(this.m_xf.q,t)},GetLinearVelocityFromWorldPoint:function(t){return r.Add(this.m_linearVelocity,m(this.m_angularVelocity,r.Subtract(t,this.m_sweep.c)))},GetLinearVelocityFromLocalPoint:function(t){return this.GetLinearVelocityFromWorldPoint(this.GetWorldPoint(t))},GetLinearDamping:function(){return this.m_linearDamping},SetLinearDamping:function(t){this.m_linearDamping=t},GetAngularDamping:function(){return this.m_angularDamping},SetAngularDamping:function(t){this.m_angularDamping=t},GetGravityScale:function(){return this.m_gravityScale},SetGravityScale:function(t){this.m_gravityScale=t},SetType:function(e){if(t(0==this.m_world.IsLocked()),1!=this.m_world.IsLocked()&&this.m_type!=e){this.m_type=e,this.ResetMassData(),this.m_type==Et.b2_staticBody&&(this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_sweep.a0=this.m_sweep.a,this.m_sweep.c0.Assign(this.m_sweep.c),this.SynchronizeFixtures()),this.SetAwake(!0),this.m_force.SetZero(),this.m_torque=0;for(var i=this.m_contactList;i;){var n=i;i=i.next,this.m_world.m_contactManager.Destroy(n.contact)}this.m_contactList=null;for(var r=this.m_world.m_contactManager.m_broadPhase,s=this.m_fixtureList;s;s=s.m_next)for(var o=s.m_proxyCount,a=0;a<o;++a)r.TouchProxy(s.m_proxies[a].proxyId)}},GetType:function(){return this.m_type},SetBullet:function(t){t?this.m_flags|=Et.e_bulletFlag:this.m_flags&=~Et.e_bulletFlag},IsBullet:function(){return(this.m_flags&Et.e_bulletFlag)==Et.e_bulletFlag},SetSleepingAllowed:function(t){t?this.m_flags|=Et.e_autoSleepFlag:(this.m_flags&=~Et.e_autoSleepFlag,this.SetAwake(!0))},IsSleepingAllowed:function(){return(this.m_flags&Et.e_autoSleepFlag)==Et.e_autoSleepFlag},SetAwake:function(t){t?0==(this.m_flags&Et.e_awakeFlag)&&(this.m_flags|=Et.e_awakeFlag,this.m_sleepTime=0):(this.m_flags&=~Et.e_awakeFlag,this.m_sleepTime=0,this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_force.SetZero(),this.m_torque=0)},IsAwake:function(){return(this.m_flags&Et.e_awakeFlag)==Et.e_awakeFlag},SetActive:function(e){if(t(0==this.m_world.IsLocked()),e!=this.IsActive())if(e){this.m_flags|=Et.e_activeFlag;for(var i=this.m_world.m_contactManager.m_broadPhase,n=this.m_fixtureList;n;n=n.m_next)n.CreateProxies(i,this.m_xf)}else{this.m_flags&=~Et.e_activeFlag;for(i=this.m_world.m_contactManager.m_broadPhase,n=this.m_fixtureList;n;n=n.m_next)n.DestroyProxies(i);for(var r=this.m_contactList;r;){var s=r;r=r.next,this.m_world.m_contactManager.Destroy(s.contact)}this.m_contactList=null}},IsActive:function(){return(this.m_flags&Et.e_activeFlag)==Et.e_activeFlag},SetFixedRotation:function(t){(this.m_flags&Et.e_fixedRotationFlag)==Et.e_fixedRotationFlag!=t&&(t?this.m_flags|=Et.e_fixedRotationFlag:this.m_flags&=~Et.e_fixedRotationFlag,this.m_angularVelocity=0,this.ResetMassData())},IsFixedRotation:function(){return(this.m_flags&Et.e_fixedRotationFlag)==Et.e_fixedRotationFlag},GetFixtureList:function(){return this.m_fixtureList},GetJointList:function(){return this.m_jointList},GetContactList:function(){return this.m_contactList},GetNext:function(){return this.m_next},GetUserData:function(){return this.m_userData},SetUserData:function(t){this.m_userData=t},GetWorld:function(){return this.m_world},SynchronizeFixtures:function(){Et.m_local_xf1.q.Set(this.m_sweep.a0),Et.m_local_xf1.p.Assign(r.Subtract(this.m_sweep.c0,b(Et.m_local_xf1.q,this.m_sweep.localCenter)));for(var t=this.m_world.m_contactManager.m_broadPhase,e=this.m_fixtureList;e;e=e.m_next)e.Synchronize(t,Et.m_local_xf1,this.m_xf)},SynchronizeTransform:function(){this.m_xf.q.Set(this.m_sweep.a),this.m_xf.p.Assign(r.Subtract(this.m_sweep.c,b(this.m_xf.q,this.m_sweep.localCenter)))},ShouldCollide:function(t){if(this.m_type!=Et.b2_dynamicBody&&t.m_type!=Et.b2_dynamicBody)return!1;for(var e=this.m_jointList;e;e=e.next)if(e.other==t&&0==e.joint.m_collideConnected)return!1;return!0},Advance:function(t){this.m_sweep.Advance(t),this.m_sweep.c.Assign(this.m_sweep.c0),this.m_sweep.a=this.m_sweep.a0,this.m_xf.q.Set(this.m_sweep.a),this.m_xf.p.Assign(r.Subtract(this.m_sweep.c,b(this.m_xf.q,this.m_sweep.localCenter)))},_serialize:function(t){var e=t||{};return e.fixtures=null,e.type=this.m_type,e.position=this.GetPosition()._serialize(),e.angle=this.GetAngle(),e.linearVelocity=this.GetLinearVelocity()._serialize(),e.angularVelocity=this.GetAngularVelocity(),e.linearDamping=this.GetLinearDamping(),e.angularDamping=this.GetAngularDamping(),e.allowSleep=this.IsSleepingAllowed(),e.awake=this.IsAwake(),e.fixedRotation=this.IsFixedRotation(),e.bullet=this.IsBullet(),e.active=this.IsActive(),e.gravityScale=this.GetGravityScale(),e}},It.prototype={Clone:function(){var t=new It;return t.categoryBits=this.categoryBits,t.maskBits=this.maskBits,t.groupIndex=this.groupIndex,t},Assign:function(t){this.categoryBits=t.categoryBits,this.maskBits=t.maskBits,this.groupIndex=t.groupIndex},_serialize:function(t){var e=t||{};return e.categoryBits=this.categoryBits,e.maskBits=this.maskBits,e.groupIndex=this.groupIndex,e},_deserialize:function(t){this.categoryBits=t.categoryBits,this.maskBits=t.maskBits,this.groupIndex=t.groupIndex}},Rt.prototype={_deserialize:function(t){this.friction=t.friction,this.restitution=t.restitution,this.density=t.density,this.isSensor=t.isSensor,this.filter._deserialize(t.filter)}},Bt.prototype={GetType:function(){return this.m_shape.GetType()},GetShape:function(){return this.m_shape},SetSensor:function(t){t!=this.m_isSensor&&(this.m_body.SetAwake(!0),this.m_isSensor=t)},IsSensor:function(){return this.m_isSensor},SetFilterData:function(t){this.m_filter=t,this.Refilter()},GetFilterData:function(){return this.m_filter},Refilter:function(){if(null!=this.m_body){for(var t=this.m_body.GetContactList();t;){var e=t.contact,i=e.GetFixtureA(),n=e.GetFixtureB();i!=this&&n!=this||e.FlagForFiltering(),t=t.next}var r=this.m_body.GetWorld();if(null!=r)for(var s=r.m_contactManager.m_broadPhase,o=0;o<this.m_proxyCount;++o)s.TouchProxy(this.m_proxies[o].proxyId)}},GetBody:function(){return this.m_body},GetNext:function(){return this.m_next},GetUserData:function(){return this.m_userData},SetUserData:function(t){this.m_userData=t},TestPoint:function(t){return this.m_shape.TestPoint(this.m_body.GetTransform(),t)},RayCast:function(t,e,i){return this.m_shape.RayCast(t,e,this.m_body.GetTransform(),i)},GetMassData:function(t){this.m_shape.ComputeMass(t,this.m_density)},SetDensity:function(e){t(n(e)&&e>=0),this.m_density=e},GetDensity:function(){return this.m_density},GetFriction:function(){return this.m_friction},SetFriction:function(t){this.m_friction=t},GetRestitution:function(){return this.m_restitution},SetRestitution:function(t){this.m_restitution=t},GetAABB:function(e){return t(0<=e&&e<this.m_proxyCount),this.m_proxies[e].aabb},Create:function(t,e){this.m_userData=e.userData,this.m_friction=e.friction,this.m_restitution=e.restitution,this.m_body=t,this.m_next=null,this.m_filter.Assign(e.filter),this.m_isSensor=e.isSensor,this.m_shape=e.shape.Clone();var i=this.m_shape.GetChildCount();this.m_proxies=new Array(i);for(var n=0;n<i;++n)this.m_proxies[n]=new Pt,this.m_proxies[n].fixture=null,this.m_proxies[n].proxyId=j.e_nullProxy;this.m_proxyCount=0,this.m_density=e.density},Destroy:function(){t(0==this.m_proxyCount),this.m_proxies=null,this.m_shape=null},CreateProxies:function(e,i){t(0==this.m_proxyCount),this.m_proxyCount=this.m_shape.GetChildCount();for(var n=0;n<this.m_proxyCount;++n){var r=this.m_proxies[n];this.m_shape.ComputeAABB(r.aabb,i,n),r.proxyId=e.CreateProxy(r.aabb,r),r.fixture=this,r.childIndex=n}},DestroyProxies:function(t){for(var e=0;e<this.m_proxyCount;++e){var i=this.m_proxies[e];t.DestroyProxy(i.proxyId),i.proxyId=j.e_nullProxy}this.m_proxyCount=0},Synchronize:function(t,e,i){if(0!=this.m_proxyCount)for(var n=0;n<this.m_proxyCount;++n){var s=this.m_proxies[n],o=new st,a=new st;this.m_shape.ComputeAABB(o,e,s.childIndex),this.m_shape.ComputeAABB(a,i,s.childIndex),s.aabb.Combine(o,a);var c=r.Subtract(i.p,e.p);t.MoveProxy(s.proxyId,s.aabb,c)}},_serialize:function(t){var e=t||{};return e.shape=null,e.friction=this.m_friction,e.restitution=this.m_restitution,e.density=this.m_density,e.isSensor=this.m_isSensor,e.filter=this.m_filter._serialize(),e}},Lt.prototype={SayGoodbyeJoint:function(t){},SayGoodbyeFixture:function(t){}},Ot.prototype={ShouldCollide:function(t,e){var i=t.GetFilterData(),n=e.GetFilterData();if(i.groupIndex==n.groupIndex&&0!=i.groupIndex)return i.groupIndex>0;return 0!=(i.maskBits&n.categoryBits)&&0!=(i.categoryBits&n.maskBits)}},Nt.prototype={BeginContact:function(t){},EndContact:function(t){},PreSolve:function(t,e){},PostSolve:function(t,e){}},Mt.prototype={ReportFixture:function(t){return!1}},Ft.prototype={ReportFixture:function(t,e,i,n){}};var mi=Fe.create("step"),fi=Fe.create("collide","step"),pi=Fe.create("solve","step"),gi=Fe.create("solveTOI","step"),vi=Fe.create("broadphase","step");Ut.prototype={QueryCallback:function(t){var e=this.broadPhase.GetUserData(t);return this.callback.ReportFixture(e.fixture)}},jt.prototype={RayCastCallback:function(t,e){var i=this.broadPhase.GetUserData(e),n=i.fixture,s=i.childIndex,o=new rt;if(n.RayCast(o,t,s)){var a=o.fraction,c=r.Add(r.Multiply(1-a,t.p1),r.Multiply(a,t.p2));return this.callback.ReportFixture(n,c,o.normal,a)}return t.maxFraction}},Wt.m_local_sweep_backupA=new l,Wt.m_local_sweep_backupB=new l,Wt.m_local_sweep_backupC=new l,Wt.prototype={Destroy:function(){for(var t=this.m_bodyList;t;){for(var e=t.m_next,i=t.m_fixtureList;i;){var n=i.m_next;i.m_proxyCount=0,i.Destroy(),i=n}t=e}},SetDestructionListener:function(t){this.m_destructionListener=t},SetContactFilter:function(t){this.m_contactManager.m_contactFilter=t},SetContactListener:function(t){this.m_contactManager.m_contactListener=t},SetDebugDraw:function(t){this.g_debugDraw=t},CreateBody:function(e){if(t(0==this.IsLocked()),this.IsLocked())return null;var i=new Et(e,this);return i.m_prev=null,i.m_next=this.m_bodyList,this.m_bodyList&&(this.m_bodyList.m_prev=i),this.m_bodyList=i,++this.m_bodyCount,i},DestroyBody:function(e){if(t(this.m_bodyCount>0),t(0==this.IsLocked()),!this.IsLocked()){for(var i=e.m_jointList;i;){var n=i;i=i.next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeJoint(n.joint),this.DestroyJoint(n.joint),e.m_jointList=i}e.m_jointList=null;for(var r=e.m_contactList;r;){var s=r;r=r.next,this.m_contactManager.Destroy(s.contact)}e.m_contactList=null;for(var o=e.m_fixtureList;o;){var a=o;o=o.m_next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeFixture(a),a.DestroyProxies(this.m_contactManager.m_broadPhase),a.Destroy(),e.m_fixtureList=o,e.m_fixtureCount-=1}e.m_fixtureList=null,e.m_fixtureCount=0,e.m_prev&&(e.m_prev.m_next=e.m_next),e.m_next&&(e.m_next.m_prev=e.m_prev),e==this.m_bodyList&&(this.m_bodyList=e.m_next),e.m_destroyed=!0,--this.m_bodyCount}},CreateJoint:function(e){if(t(0==this.IsLocked()),this.IsLocked())return null;var i=de.Create(e);i.m_prev=null,i.m_next=this.m_jointList,this.m_jointList&&(this.m_jointList.m_prev=i),this.m_jointList=i,++this.m_jointCount,i.m_edgeA.joint=i,i.m_edgeA.other=i.m_bodyB,i.m_edgeA.prev=null,i.m_edgeA.next=i.m_bodyA.m_jointList,i.m_bodyA.m_jointList&&(i.m_bodyA.m_jointList.prev=i.m_edgeA),i.m_bodyA.m_jointList=i.m_edgeA,i.m_edgeB.joint=i,i.m_edgeB.other=i.m_bodyA,i.m_edgeB.prev=null,i.m_edgeB.next=i.m_bodyB.m_jointList,i.m_bodyB.m_jointList&&(i.m_bodyB.m_jointList.prev=i.m_edgeB),i.m_bodyB.m_jointList=i.m_edgeB;var n=e.bodyA,r=e.bodyB;if(0==e.collideConnected)for(var s=r.GetContactList();s;)s.other==n&&s.contact.FlagForFiltering(),s=s.next;return i},DestroyJoint:function(e){if(t(0==this.IsLocked()),!this.IsLocked()){var i=e.m_collideConnected;e.m_prev&&(e.m_prev.m_next=e.m_next),e.m_next&&(e.m_next.m_prev=e.m_prev),e==this.m_jointList&&(this.m_jointList=e.m_next);var n=e.m_bodyA,r=e.m_bodyB;if(n.SetAwake(!0),r.SetAwake(!0),e.m_edgeA.prev&&(e.m_edgeA.prev.next=e.m_edgeA.next),e.m_edgeA.next&&(e.m_edgeA.next.prev=e.m_edgeA.prev),e.m_edgeA==n.m_jointList&&(n.m_jointList=e.m_edgeA.next),e.m_edgeA.prev=null,e.m_edgeA.next=null,e.m_edgeB.prev&&(e.m_edgeB.prev.next=e.m_edgeB.next),e.m_edgeB.next&&(e.m_edgeB.next.prev=e.m_edgeB.prev),e.m_edgeB==r.m_jointList&&(r.m_jointList=e.m_edgeB.next),e.m_edgeB.prev=null,e.m_edgeB.next=null,de.Destroy(e),t(this.m_jointCount>0),--this.m_jointCount,0==i)for(var s=r.GetContactList();s;)s.other==n&&s.contact.FlagForFiltering(),s=s.next}},Step:function(t,e,i){mi.start(),this.m_flags&Wt.e_newFixture&&(this.m_contactManager.FindNewContacts(),this.m_flags&=~Wt.e_newFixture),this.m_flags|=Wt.e_locked,this.p_step.dt=t,this.p_step.velocityIterations=e,this.p_step.positionIterations=i,this.p_step.inv_dt=t>0?1/t:0,this.p_step.dtRatio=this.m_inv_dt0*t,this.p_step.warmStarting=this.m_warmStarting,fi.start(),this.m_contactManager.Collide(),fi.stop(),this.m_stepComplete&&this.p_step.dt>0&&(pi.start(),this.Solve(this.p_step),pi.stop()),this.m_continuousPhysics&&this.p_step.dt>0&&(gi.start(),this.SolveTOI(this.p_step),gi.stop()),this.p_step.dt>0&&(this.m_inv_dt0=this.p_step.inv_dt),this.m_flags&Wt.e_clearForces&&this.ClearForces(),this.m_flags&=~Wt.e_locked,mi.stop()},ClearForces:function(){for(var t=this.m_bodyList;t;t=t.GetNext())t.m_force.x=t.m_force.y=0,t.m_torque=0},DrawDebugData:function(){if(null!=this.g_debugDraw){this.g_debugDraw.ClearDraw();var t=this.g_debugDraw.GetFlags();if(t&D.e_shapeBit)for(var e=this.m_bodyList;e;e=e.GetNext())for(var i=e.GetTransform(),n=e.GetFixtureList();n;n=n.GetNext())0==e.IsActive()?this.DrawShape(n,i,new O(.5,.5,.3)):e.GetType()==Et.b2_staticBody?this.DrawShape(n,i,new O(.5,.9,.5)):e.GetType()==Et.b2_kinematicBody?this.DrawShape(n,i,new O(.5,.5,.9)):0==e.IsAwake()?this.DrawShape(n,i,new O(.6,.6,.6)):this.DrawShape(n,i,new O(.9,.7,.7));if(t&D.e_jointBit)for(var s=this.m_jointList;s;s=s.GetNext())this.DrawJoint(s);if(t&D.e_pairBit)for(var o=new O(.3,.9,.9),a=this.m_contactManager.m_contactList;a;a=a.GetNext()){var c=a.GetFixtureA(),h=a.GetFixtureB(),l=c.GetAABB(a.GetChildIndexA()).GetCenter(),_=h.GetAABB(a.GetChildIndexB()).GetCenter();this.g_debugDraw.DrawSegment(l,_,o)}if(t&D.e_aabbBit){o=new O(.9,.3,.9);var u=new O(.3,.3,.9),d=this.m_contactManager.m_broadPhase;for(e=this.m_bodyList;e;e=e.GetNext())if(0!=e.IsActive())for(n=e.GetFixtureList();n;n=n.GetNext())for(var m=0;m<n.m_proxyCount;++m){var f=n.m_proxies[m],p=d.GetFatAABB(f.proxyId);(v=[])[0]=new r(p.lowerBound.x,p.lowerBound.y),v[1]=new r(p.upperBound.x,p.lowerBound.y),v[2]=new r(p.upperBound.x,p.upperBound.y),v[3]=new r(p.lowerBound.x,p.upperBound.y),this.g_debugDraw.DrawPolygon(v,4,o);var g=new st;n.GetShape().ComputeAABB(g,e.GetTransform(),0);var v;(v=[])[0]=new r(g.lowerBound.x,g.lowerBound.y),v[1]=new r(g.upperBound.x,g.lowerBound.y),v[2]=new r(g.upperBound.x,g.upperBound.y),v[3]=new r(g.lowerBound.x,g.upperBound.y),this.g_debugDraw.DrawPolygon(v,4,u)}}if(t&D.e_centerOfMassBit)for(e=this.m_bodyList;e;e=e.GetNext()){(i=e.GetTransform().Clone()).p=e.GetWorldCenter(),this.g_debugDraw.DrawTransform(i)}}},QueryAABB:function(t,e){var i=new Ut;i.broadPhase=this.m_contactManager.m_broadPhase,i.callback=t,this.m_contactManager.m_broadPhase.Query(i,e)},RayCast:function(t,e,i){var n=new jt;n.broadPhase=this.m_contactManager.m_broadPhase,n.callback=t;var r=new nt;r.maxFraction=1,r.p1=e,r.p2=i,this.m_contactManager.m_broadPhase.RayCast(n,r)},GetBodyList:function(){return this.m_bodyList},GetJointList:function(){return this.m_jointList},GetContactList:function(){return this.m_contactManager.m_contactList},SetAllowSleeping:function(t){if(t!=this.m_allowSleep&&(this.m_allowSleep=t,0==this.m_allowSleep))for(var e=this.m_bodyList;e;e=e.m_next)e.SetAwake(!0)},GetAllowSleeping:function(){return this.m_allowSleep},SetWarmStarting:function(t){this.m_warmStarting=t},GetWarmStarting:function(){return this.m_warmStarting},SetContinuousPhysics:function(t){this.m_continuousPhysics=t},GetContinuousPhysics:function(){return this.m_continuousPhysics},SetSubStepping:function(t){this.m_subStepping=t},GetSubStepping:function(){return this.m_subStepping},GetProxyCount:function(){return this.m_contactManager.m_broadPhase.GetProxyCount()},GetBodyCount:function(){return this.m_bodyCount},GetJointCount:function(){return this.m_jointCount},GetContactCount:function(){return this.m_contactManager.m_contactCount},GetTreeHeight:function(){return this.m_contactManager.m_broadPhase.GetTreeHeight()},GetTreeBalance:function(){return this.m_contactManager.m_broadPhase.GetTreeBalance()},GetTreeQuality:function(){return this.m_contactManager.m_broadPhase.GetTreeQuality()},SetGravity:function(t){this.m_gravity=t},GetGravity:function(){return this.m_gravity},IsLocked:function(){return(this.m_flags&Wt.e_locked)==Wt.e_locked},SetAutoClearForces:function(t){t?this.m_flags|=Wt.e_clearForces:this.m_flags&=~Wt.e_clearForces},GetAutoClearForces:function(){return(this.m_flags&Wt.e_clearForces)==Wt.e_clearForces},ShiftOrigin:function(e){if(t(0==(this.m_flags&Wt.e_locked)),(this.m_flags&Wt.e_locked)!=Wt.e_locked){for(var i=this.m_bodyList;i;i=i.m_next)i.m_xf.p.Subtract(e),i.m_sweep.c0.Subtract(e),i.m_sweep.c.Subtract(e);for(var n=this.m_jointList;n;n=n.m_next)n.ShiftOrigin(e);this.m_contactManager.m_broadPhase.ShiftOrigin(e)}},GetContactManager:function(){return this.m_contactManager},Solve:function(e){this.p_island.Initialize(this.m_bodyCount,this.m_contactManager.m_contactCount,this.m_jointCount,this.m_contactManager.m_contactListener);for(var i=this.m_bodyList;i;i=i.m_next)i.m_flags&=~Et.e_islandFlag;for(var n=this.m_contactManager.m_contactList;n;n=n.m_next)n.m_flags&=~Jt.e_islandFlag;for(var r=this.m_jointList;r;r=r.m_next)r.m_islandFlag=!1;for(var s=this.m_bodyCount,o=new Array(s),a=this.m_bodyList;a;a=a.m_next)if(!(a.m_flags&Et.e_islandFlag)&&0!=a.IsAwake()&&0!=a.IsActive()&&a.GetType()!=Et.b2_staticBody){this.p_island.Clear();var c=0;for(o[c++]=a,a.m_flags|=Et.e_islandFlag;c>0;){if(t(1==(i=o[--c]).IsActive()),this.p_island.AddBody(i),i.SetAwake(!0),i.GetType()!=Et.b2_staticBody){for(var h=i.m_contactList;h;h=h.next){var l=h.contact;if(!(l.m_flags&Jt.e_islandFlag)&&(0!=l.IsEnabled()&&0!=l.IsTouching())){var _=l.m_fixtureA.m_isSensor,u=l.m_fixtureB.m_isSensor;if(!_&&!u){this.p_island.AddContact(l),l.m_flags|=Jt.e_islandFlag;(m=h.other).m_flags&Et.e_islandFlag||(t(c<s),o[c++]=m,m.m_flags|=Et.e_islandFlag)}}}for(var d=i.m_jointList;d;d=d.next)if(1!=d.joint.m_islandFlag){var m;0!=(m=d.other).IsActive()&&(this.p_island.AddJoint(d.joint),d.joint.m_islandFlag=!0,m.m_flags&Et.e_islandFlag||(t(c<s),o[c++]=m,m.m_flags|=Et.e_islandFlag))}}}this.p_island.Solve(e,this.m_gravity,this.m_allowSleep);for(var f=0;f<this.p_island.m_bodyCount;++f){(i=this.p_island.m_bodies[f]).GetType()==Et.b2_staticBody&&(i.m_flags&=~Et.e_islandFlag)}}vi.start();for(i=this.m_bodyList;i;i=i.GetNext())0!=(i.m_flags&Et.e_islandFlag)&&i.GetType()!=Et.b2_staticBody&&i.SynchronizeFixtures();this.m_contactManager.FindNewContacts(),vi.stop()},SolveTOI:function(e){if(this.p_island.Initialize(64,32,0,this.m_contactManager.m_contactListener),this.m_stepComplete){for(var i=this.m_bodyList;i;i=i.m_next)i.m_flags&=~Et.e_islandFlag,i.m_sweep.alpha0=0;for(var n=this.m_contactManager.m_contactList;n;n=n.m_next)n.m_flags&=~(Jt.e_toiFlag|Jt.e_islandFlag),n.m_toiCount=0,n.m_toi=1}for(;;){var r=null,s=1;for(n=this.m_contactManager.m_contactList;n;n=n.m_next)if(0!=n.IsEnabled()&&!(n.m_toiCount>8)){var o=1;if(n.m_flags&Jt.e_toiFlag)o=n.m_toi;else{var a=n.GetFixtureA(),c=n.GetFixtureB();if(a.IsSensor()||c.IsSensor())continue;var h=a.GetBody(),l=c.GetBody(),_=h.m_type,u=l.m_type;t(_==Et.b2_dynamicBody||u==Et.b2_dynamicBody);var d=h.IsAwake()&&_!=Et.b2_staticBody,m=l.IsAwake()&&u!=Et.b2_staticBody;if(0==d&&0==m)continue;var f=h.IsBullet()||_!=Et.b2_dynamicBody,p=l.IsBullet()||u!=Et.b2_dynamicBody;if(0==f&&0==p)continue;var g=h.m_sweep.alpha0;h.m_sweep.alpha0<l.m_sweep.alpha0?(g=l.m_sweep.alpha0,h.m_sweep.Advance(g)):l.m_sweep.alpha0<h.m_sweep.alpha0&&(g=h.m_sweep.alpha0,l.m_sweep.Advance(g)),t(g<1);var v=n.GetChildIndexA(),y=n.GetChildIndexB(),x=new At;x.proxyA.Set(a.GetShape(),v),x.proxyB.Set(c.GetShape(),y),x.sweepA.Assign(h.m_sweep),x.sweepB.Assign(l.m_sweep),x.tMax=1;var C=new Tt;wt(C,x);var A=C.t;o=C.state==Tt.e_touching?si(g+(1-g)*A,1):1,n.m_toi=o,n.m_flags|=Jt.e_toiFlag}o<s&&(r=n,s=o)}if(null==r||1-10*Ge<s){this.m_stepComplete=!0;break}a=r.GetFixtureA(),c=r.GetFixtureB(),h=a.GetBody(),l=c.GetBody();if(Wt.m_local_sweep_backupA.Assign(h.m_sweep),Wt.m_local_sweep_backupB.Assign(l.m_sweep),h.Advance(s),l.Advance(s),r.Update(this.m_contactManager.m_contactListener),r.m_flags&=~Jt.e_toiFlag,++r.m_toiCount,0!=r.IsEnabled()&&0!=r.IsTouching()){h.SetAwake(!0),l.SetAwake(!0),this.p_island.Clear(),this.p_island.AddBody(h),this.p_island.AddBody(l),this.p_island.AddContact(r),h.m_flags|=Et.e_islandFlag,l.m_flags|=Et.e_islandFlag,r.m_flags|=Jt.e_islandFlag;for(var T=[h,l],b=0;b<2;++b){if((B=T[b]).m_type==Et.b2_dynamicBody)for(var w=B.m_contactList;w&&this.p_island.m_bodyCount!=this.p_island.m_bodyCapacity&&this.p_island.m_contactCount!=this.p_island.m_contactCapacity;w=w.next){var S=w.contact;if(!(S.m_flags&Jt.e_islandFlag)){var E=w.other;if(E.m_type!=Et.b2_dynamicBody||0!=B.IsBullet()||0!=E.IsBullet()){var I=S.m_fixtureA.m_isSensor,R=S.m_fixtureB.m_isSensor;I||R||(Wt.m_local_sweep_backupC.Assign(E.m_sweep),0==(E.m_flags&Et.e_islandFlag)&&E.Advance(s),S.Update(this.m_contactManager.m_contactListener),0!=S.IsEnabled()&&0!=S.IsTouching()?(S.m_flags|=Jt.e_islandFlag,this.p_island.AddContact(S),E.m_flags&Et.e_islandFlag||(E.m_flags|=Et.e_islandFlag,E.m_type!=Et.b2_staticBody&&E.SetAwake(!0),this.p_island.AddBody(E))):(E.m_sweep.Assign(Wt.m_local_sweep_backupC),E.SynchronizeTransform()))}}}}var P=new zt;P.dt=(1-s)*e.dt,P.inv_dt=1/P.dt,P.dtRatio=1,P.positionIterations=20,P.velocityIterations=e.velocityIterations,P.warmStarting=!1,this.p_island.SolveTOI(P,h.m_islandIndex,l.m_islandIndex);for(b=0;b<this.p_island.m_bodyCount;++b){var B;if((B=this.p_island.m_bodies[b]).m_flags&=~Et.e_islandFlag,B.m_type==Et.b2_dynamicBody){B.SynchronizeFixtures();for(w=B.m_contactList;w;w=w.next)w.contact.m_flags&=~(Jt.e_toiFlag|Jt.e_islandFlag)}}if(this.m_contactManager.FindNewContacts(),this.m_subStepping){this.m_stepComplete=!1;break}}else r.SetEnabled(!1),h.m_sweep.Assign(Wt.m_local_sweep_backupA),l.m_sweep.Assign(Wt.m_local_sweep_backupB),h.SynchronizeTransform(),l.SynchronizeTransform()}},DrawJoint:function(t){var e=t.GetBodyA(),i=t.GetBodyB(),n=e.GetTransform(),r=i.GetTransform(),s=n.p,o=r.p,a=t.GetAnchorA(),c=t.GetAnchorB(),h=new O(.5,.8,.8);switch(t.GetType()){case de.e_distanceJoint:this.g_debugDraw.DrawSegment(a,c,h);break;case de.e_pulleyJoint:var l=t,_=l.GetGroundAnchorA(),u=l.GetGroundAnchorB();this.g_debugDraw.DrawSegment(_,a,h),this.g_debugDraw.DrawSegment(u,c,h),this.g_debugDraw.DrawSegment(_,u,h);break;case de.e_mouseJoint:break;case de.e_motorJoint:this.g_debugDraw.DrawPoint(t.GetLinearOffset(),5,h);default:this.g_debugDraw.DrawSegment(s,a,h),this.g_debugDraw.DrawSegment(a,c,h),this.g_debugDraw.DrawSegment(o,c,h)}},DrawShape:function(e,i,n){switch(e.GetType()){case F.e_circle:var s=e.GetShape(),o=S(i,s.m_p),a=s.m_radius,c=b(i.q,new r(1,0));this.g_debugDraw.DrawSolidCircle(o,a,c,n);break;case F.e_edge:var h=e.GetShape(),l=S(i,h.m_vertex1),_=S(i,h.m_vertex2);this.g_debugDraw.DrawSegment(l,_,n);break;case F.e_chain:for(var u=e.GetShape(),d=u.m_count,m=(l=S(i,(g=u.m_vertices)[0]),1);m<d;++m){_=S(i,g[m]);this.g_debugDraw.DrawSegment(l,_,n),l=_}break;case F.e_polygon:var f=e.GetShape(),p=f.m_count;t(p<=We);var g=new Array(We);for(m=0;m<p;++m)g[m]=S(i,f.m_vertices[m]);this.g_debugDraw.DrawSolidPolygon(g,p,n)}}},Wt.e_newFixture=1,Wt.e_locked=2,Wt.e_clearForces=4,Ht.prototype={Clear:function(){this.other=this.prev=this.next=null}},Jt.m_local_tempManifold=new tt,Jt.prototype={Create:function(t,e,i,n){this.m_toi=0,this.m_flags=Jt.e_enabledFlag,this.m_fixtureA=t||null,this.m_fixtureB=i||null,this.m_indexA=e||0,this.m_indexB=n||0,this.m_manifold.pointCount=0,this.m_prev=null,this.m_next=null,this.m_nodeA.contact=null,this.m_nodeA.prev=null,this.m_nodeA.next=null,this.m_nodeA.other=null,this.m_nodeB.contact=null,this.m_nodeB.prev=null,this.m_nodeB.next=null,this.m_nodeB.other=null,this.m_toiCount=0,t?(this.m_friction=qt(this.m_fixtureA.m_friction,this.m_fixtureB.m_friction),this.m_restitution=Yt(this.m_fixtureA.m_restitution,this.m_fixtureB.m_restitution)):(this.m_friction=0,this.m_restitution=0),this.m_tangentSpeed=0},GetManifold:function(){return this.m_manifold},GetWorldManifold:function(t){var e=this.m_fixtureA.GetBody(),i=this.m_fixtureB.GetBody(),n=this.m_fixtureA.GetShape(),r=this.m_fixtureB.GetShape();t.Initialize(this.m_manifold,e.GetTransform(),n.m_radius,i.GetTransform(),r.m_radius)},IsTouching:function(){return(this.m_flags&Jt.e_touchingFlag)==Jt.e_touchingFlag},SetEnabled:function(t){t?this.m_flags|=Jt.e_enabledFlag:this.m_flags&=~Jt.e_enabledFlag},IsEnabled:function(){return(this.m_flags&Jt.e_enabledFlag)==Jt.e_enabledFlag},GetNext:function(){return this.m_next},GetFixtureA:function(){return this.m_fixtureA},GetChildIndexA:function(){return this.m_indexA},GetFixtureB:function(){return this.m_fixtureB},GetChildIndexB:function(){return this.m_indexB},SetFriction:function(t){this.m_friction=t},GetFriction:function(){return this.m_friction},ResetFriction:function(){this.m_friction=qt(this.m_fixtureA.m_friction,this.m_fixtureB.m_friction)},SetRestitution:function(t){this.m_restitution=t},GetRestitution:function(){return this.m_restitution},ResetRestitution:function(){this.m_restitution=Yt(this.m_fixtureA.m_restitution,this.m_fixtureB.m_restitution)},SetTangentSpeed:function(t){this.m_tangentSpeed=t},GetTangentSpeed:function(){return this.m_tangentSpeed},Evaluate:function(t,e,i){},FlagForFiltering:function(){this.m_flags|=Jt.e_filterFlag},m_oldManifold:null,Update:function(t){Jt.m_local_tempManifold.Assign(this.m_manifold),this.m_flags|=Jt.e_enabledFlag;var e=!1,i=(this.m_flags&Jt.e_touchingFlag)==Jt.e_touchingFlag,n=this.m_fixtureA.IsSensor(),r=this.m_fixtureB.IsSensor(),s=n||r,o=this.m_fixtureA.GetBody(),a=this.m_fixtureB.GetBody(),c=o.GetTransform(),h=a.GetTransform();if(s){var l=this.m_fixtureA.GetShape(),_=this.m_fixtureB.GetShape();e=vt(l,this.m_indexA,_,this.m_indexB,c,h),this.m_manifold.pointCount=0}else{this.Evaluate(this.m_manifold,c,h),e=this.m_manifold.pointCount>0;for(var u=0;u<this.m_manifold.pointCount;++u){var d=this.m_manifold.points[u];d.normalImpulse=0,d.tangentImpulse=0;for(var m=d.id,f=0;f<Jt.m_local_tempManifold.pointCount;++f){var p=Jt.m_local_tempManifold.points[f];if(p.id.Get()==m.Get()){d.normalImpulse=p.normalImpulse,d.tangentImpulse=p.tangentImpulse;break}}}e!=i&&(o.SetAwake(!0),a.SetAwake(!0))}e?this.m_flags|=Jt.e_touchingFlag:this.m_flags&=~Jt.e_touchingFlag,0==i&&1==e&&t&&t.BeginContact(this),1==i&&0==e&&t&&t.EndContact(this),0==s&&e&&t&&t.PreSolve(this,Jt.m_local_tempManifold)}},Jt.e_islandFlag=1,Jt.e_touchingFlag=2,Jt.e_enabledFlag=4,Jt.e_filterFlag=8,Jt.e_bulletHitFlag=16,Jt.e_toiFlag=32,Zt.prototype={Evaluate:function(t,e,i){ot(t,this.m_fixtureA.GetShape(),e,this.m_fixtureB.GetShape(),i)},Create:function(e,i,n,r){this.parent.prototype.Create.call(this,e,0,n,0),t(this.m_fixtureA.GetType()==F.e_circle),t(this.m_fixtureB.GetType()==F.e_circle)}},Zt._extend(Jt);var yi=new G;Qt.prototype={Evaluate:function(t,e,i){this.m_fixtureA.GetShape().GetChildEdge(yi,this.m_indexA),_t(t,yi,e,this.m_fixtureB.GetShape(),i)},Create:function(e,i,n,r){this.parent.prototype.Create.call(this,e,i,n,r),t(this.m_fixtureA.GetType()==F.e_chain),t(this.m_fixtureB.GetType()==F.e_circle)}},Qt._extend(Jt),Kt.prototype={Evaluate:function(t,e,i){this.m_fixtureA.GetShape().GetChildEdge(yi,this.m_indexA),pt(t,yi,e,this.m_fixtureB.GetShape(),i)},Create:function(e,i,n,r){this.parent.prototype.Create.call(this,e,i,n,r),t(this.m_fixtureA.GetType()==F.e_chain),t(this.m_fixtureB.GetType()==F.e_polygon)}},Kt.Create=function(t,e,i,n){return new Kt(t,e,i,n)},Kt._extend(Jt),$t.prototype={Evaluate:function(t,e,i){_t(t,this.m_fixtureA.GetShape(),e,this.m_fixtureB.GetShape(),i)},Create:function(e,i,n,r){this.parent.prototype.Create.call(this,e,0,n,0),t(this.m_fixtureA.GetType()==F.e_edge),t(this.m_fixtureB.GetType()==F.e_circle)}},$t.Create=function(t,e,i,n){return new $t(t,i)},$t._extend(Jt),te.prototype={Evaluate:function(t,e,i){pt(t,this.m_fixtureA.GetShape(),e,this.m_fixtureB.GetShape(),i)},Create:function(e,i,n,r){this.parent.prototype.Create.call(this,e,0,n,0),t(this.m_fixtureA.GetType()==F.e_edge),t(this.m_fixtureB.GetType()==F.e_polygon)}},te.Create=function(t,e,i,n){return new te(t,i)},te._extend(Jt),ee.prototype={Evaluate:function(t,e,i){at(t,this.m_fixtureA.GetShape(),e,this.m_fixtureB.GetShape(),i)},Create:function(e,i,n,r){this.parent.prototype.Create.call(this,e,0,n,0),t(this.m_fixtureA.GetType()==F.e_polygon),t(this.m_fixtureB.GetType()==F.e_circle)}},ee.Create=function(t,e,i,n){return new ee(t,i)},ee._extend(Jt),ie.prototype={Evaluate:function(t,e,i){lt(t,this.m_fixtureA.GetShape(),e,this.m_fixtureB.GetShape(),i)},Create:function(e,i,n,r){this.parent.prototype.Create.call(this,e,0,n,0),t(this.m_fixtureA.GetType()==F.e_polygon),t(this.m_fixtureB.GetType()==F.e_polygon)}},ie.Create=function(t,e,i,n){return new ie(t,i)},ie._extend(Jt),Jt.AddType=function(e,i,n){t(0<=i&&i<F.e_typeCount),t(0<=n&&n<F.e_typeCount),Jt.s_registers[i]||(Jt.s_registers[i]=[]),Jt.s_registers[i][n]=new Xt,Jt.s_registers[i][n].fcn=e,Jt.s_registers[i][n].primary=!0,i!=n&&(Jt.s_registers[n]||(Jt.s_registers[n]=[]),Jt.s_registers[n][i]=new Xt,Jt.s_registers[n][i].fcn=e,Jt.s_registers[n][i].primary=!1),e.garbage=[],e.alloc=2},Jt.InitializeRegisters=function(){Jt.AddType(Zt,F.e_circle,F.e_circle),Jt.AddType(ee,F.e_polygon,F.e_circle),Jt.AddType(ie,F.e_polygon,F.e_polygon),Jt.AddType($t,F.e_edge,F.e_circle),Jt.AddType(te,F.e_edge,F.e_polygon),Jt.AddType(Qt,F.e_chain,F.e_circle),Jt.AddType(Kt,F.e_chain,F.e_polygon)},Jt.RetrieveGarbage=function(t){var e;if(e=t.garbage.pop())return e;for(var i=0;i<t.alloc-1;++i)t.garbage.push(new t);return t.alloc+=32,new t},Jt.Create=function(e,i,n,r){0==Jt.s_initialized&&(Jt.InitializeRegisters(),Jt.s_initialized=!0);var s=e.GetType(),o=n.GetType();t(0<=s&&s<F.e_typeCount),t(0<=o&&o<F.e_typeCount);var a=Jt.s_registers[s]&&Jt.s_registers[s][o]?Jt.s_registers[s][o].fcn:null;if(a){var c=Jt.RetrieveGarbage(a);return Jt.s_registers[s][o].primary?c.Create(e,i,n,r):c.Create(n,r,e,i),c}return null},Jt.Destroy=function(e){t(1==Jt.s_initialized);var i=e.m_fixtureA,n=e.m_fixtureB;e.m_manifold.pointCount>0&&0==i.IsSensor()&&0==n.IsSensor()&&(i.GetBody().SetAwake(!0),n.GetBody().SetAwake(!0));var r=i.GetType(),s=n.GetType();t(0<=r&&s<F.e_typeCount),t(0<=r&&s<F.e_typeCount),e.m_nodeA.Clear(),e.m_nodeB.Clear(),Jt.s_registers[r][s].fcn.garbage.push(e)},Jt.s_registers=[],Jt.s_initialized=!1;var xi=new Ot,Ci=new Nt;ne.prototype={AddPair:function(t,e){var i=t,n=e,r=i.fixture,s=n.fixture,o=i.childIndex,a=n.childIndex,c=r.GetBody(),h=s.GetBody();if(c!=h){for(var l=h.GetContactList();l;){if(l.other==c){var _=l.contact.GetFixtureA(),u=l.contact.GetFixtureB(),d=l.contact.GetChildIndexA(),m=l.contact.GetChildIndexB();if(_==r&&u==s&&d==o&&m==a)return;if(_==s&&u==r&&d==a&&m==o)return}l=l.next}if(0!=h.ShouldCollide(c)&&(!this.m_contactFilter||0!=this.m_contactFilter.ShouldCollide(r,s))){var f=Jt.Create(r,o,s,a);null!=f&&(r=f.GetFixtureA(),s=f.GetFixtureB(),o=f.GetChildIndexA(),a=f.GetChildIndexB(),c=r.GetBody(),h=s.GetBody(),f.m_prev=null,f.m_next=this.m_contactList,null!=this.m_contactList&&(this.m_contactList.m_prev=f),this.m_contactList=f,f.m_nodeA.contact=f,f.m_nodeA.other=h,f.m_nodeA.prev=null,f.m_nodeA.next=c.m_contactList,null!=c.m_contactList&&(c.m_contactList.prev=f.m_nodeA),c.m_contactList=f.m_nodeA,f.m_nodeB.contact=f,f.m_nodeB.other=c,f.m_nodeB.prev=null,f.m_nodeB.next=h.m_contactList,null!=h.m_contactList&&(h.m_contactList.prev=f.m_nodeB),h.m_contactList=f.m_nodeB,0==r.IsSensor()&&0==s.IsSensor()&&(c.SetAwake(!0),h.SetAwake(!0)),++this.m_contactCount)}}},FindNewContacts:function(){this.m_broadPhase.UpdatePairs(this)},Destroy:function(t){var e=t.GetFixtureA(),i=t.GetFixtureB(),n=e.GetBody(),r=i.GetBody();this.m_contactListener&&t.IsTouching()&&this.m_contactListener.EndContact(t),t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t==this.m_contactList&&(this.m_contactList=t.m_next),t.m_nodeA.prev&&(t.m_nodeA.prev.next=t.m_nodeA.next),t.m_nodeA.next&&(t.m_nodeA.next.prev=t.m_nodeA.prev),t.m_nodeA==n.m_contactList&&(n.m_contactList=t.m_nodeA.next),t.m_nodeB.prev&&(t.m_nodeB.prev.next=t.m_nodeB.next),t.m_nodeB.next&&(t.m_nodeB.next.prev=t.m_nodeB.prev),t.m_nodeB==r.m_contactList&&(r.m_contactList=t.m_nodeB.next),Jt.Destroy(t),--this.m_contactCount},Collide:function(){for(var t=this.m_contactList;t;){var e=t.GetFixtureA(),i=t.GetFixtureB(),n=t.GetChildIndexA(),r=t.GetChildIndexB(),s=e.GetBody(),o=i.GetBody();if(t.m_flags&Jt.e_filterFlag){if(0==o.ShouldCollide(s)){t=(_=t).GetNext(),this.Destroy(_);continue}if(this.m_contactFilter&&0==this.m_contactFilter.ShouldCollide(e,i)){t=(_=t).GetNext(),this.Destroy(_);continue}t.m_flags&=~Jt.e_filterFlag}var a=s.IsAwake()&&s.m_type!=Et.b2_staticBody,c=o.IsAwake()&&o.m_type!=Et.b2_staticBody;if(0!=a||0!=c){var h=e.m_proxies[n].proxyId,l=i.m_proxies[r].proxyId;if(0!=this.m_broadPhase.TestOverlap(h,l))t.Update(this.m_contactListener),t=t.GetNext();else{var _;t=(_=t).GetNext(),this.Destroy(_)}}else t=t.GetNext()}}},ae.prototype={Initialize:function(e,i,n,r){switch(t(e.pointCount>0),e.type){case tt.e_circles:var s=i.q.c*e.localPoint.x-i.q.s*e.localPoint.y+i.p.x,o=i.q.s*e.localPoint.x+i.q.c*e.localPoint.y+i.p.y,a=n.q.c*e.localPoints[0].x-n.q.s*e.localPoints[0].y+n.p.x,c=n.q.s*e.localPoints[0].x+n.q.c*e.localPoints[0].y+n.p.y;this.point.x=.5*(s+a),this.point.y=.5*(o+c),this.normal.x=a-s,this.normal.y=c-o;var h=this.normal.x,l=this.normal.y;this.normal.Normalize(),this.separation=h*this.normal.x+l*this.normal.y-e.radiusA-e.radiusB;break;case tt.e_faceA:this.normal.x=i.q.c*e.localNormal.x-i.q.s*e.localNormal.y,this.normal.y=i.q.s*e.localNormal.x+i.q.c*e.localNormal.y;var _=i.q.c*e.localPoint.x-i.q.s*e.localPoint.y+i.p.x,u=i.q.s*e.localPoint.x+i.q.c*e.localPoint.y+i.p.y,d=n.q.c*e.localPoints[r].x-n.q.s*e.localPoints[r].y+n.p.x,m=n.q.s*e.localPoints[r].x+n.q.c*e.localPoints[r].y+n.p.y;this.separation=(d-_)*this.normal.x+(m-u)*this.normal.y-e.radiusA-e.radiusB,this.point.x=d,this.point.y=m;break;case tt.e_faceB:this.normal.x=n.q.c*e.localNormal.x-n.q.s*e.localNormal.y,this.normal.y=n.q.s*e.localNormal.x+n.q.c*e.localNormal.y;_=n.q.c*e.localPoint.x-n.q.s*e.localPoint.y+n.p.x,u=n.q.s*e.localPoint.x+n.q.c*e.localPoint.y+n.p.y,d=i.q.c*e.localPoints[r].x-i.q.s*e.localPoints[r].y+i.p.x,m=i.q.s*e.localPoints[r].x+i.q.c*e.localPoints[r].y+i.p.y;this.separation=(d-_)*this.normal.x+(m-u)*this.normal.y-e.radiusA-e.radiusB,this.point.x=d,this.point.y=m,this.normal.x=-this.normal.x,this.normal.y=-this.normal.y}}},he.cs_xfA=new h,he.cs_xfB=new h,he.temp_solver_manifold=new ae,he.prototype={Init:function(e){this.m_step=e.step,this.m_count=e.count,this.m_positionConstraints.length=this.m_count,this.m_velocityConstraints.length=this.m_count,this.m_positions=e.positions,this.m_velocities=e.velocities,this.m_contacts=e.contacts;for(var i=0;i<this.m_count;++i){var n=this.m_contacts[i],r=n.m_fixtureA,s=n.m_fixtureB,o=r.GetShape(),a=s.GetShape(),c=o.m_radius,h=a.m_radius,l=r.GetBody(),_=s.GetBody(),u=n.GetManifold(),d=u.pointCount;t(d>0);var m=this.m_velocityConstraints[i]||new oe;m.friction=n.m_friction,m.restitution=n.m_restitution,m.tangentSpeed=n.m_tangentSpeed,m.indexA=l.m_islandIndex,m.indexB=_.m_islandIndex,m.invMassA=l.m_invMass,m.invMassB=_.m_invMass,m.invIA=l.m_invI,m.invIB=_.m_invI,m.contactIndex=i,m.pointCount=d,m.K.SetZero(),m.normalMass.SetZero(),this.m_velocityConstraints[i]=m;var f=this.m_positionConstraints[i]||new se;f.indexA=l.m_islandIndex,f.indexB=_.m_islandIndex,f.invMassA=l.m_invMass,f.invMassB=_.m_invMass,f.localCenterA.x=l.m_sweep.localCenter.x,f.localCenterA.y=l.m_sweep.localCenter.y,f.localCenterB.x=_.m_sweep.localCenter.x,f.localCenterB.y=_.m_sweep.localCenter.y,f.invIA=l.m_invI,f.invIB=_.m_invI,f.localNormal.x=u.localNormal.x,f.localNormal.y=u.localNormal.y,f.localPoint.x=u.localPoint.x,f.localPoint.y=u.localPoint.y,f.pointCount=d,f.radiusA=c,f.radiusB=h,f.type=u.type,this.m_positionConstraints[i]=f;for(var p=0;p<d;++p){var g=u.points[p],v=m.points[p];this.m_step.warmStarting?(v.normalImpulse=this.m_step.dtRatio*g.normalImpulse,v.tangentImpulse=this.m_step.dtRatio*g.tangentImpulse):(v.normalImpulse=0,v.tangentImpulse=0),v.rA.SetZero(),v.rB.SetZero(),v.normalMass=0,v.tangentMass=0,v.velocityBias=0,f.localPoints[p]=g.localPoint}}},InitializeVelocityConstraints:function(){for(var e=0;e<this.m_count;++e){var i=this.m_velocityConstraints[e],n=this.m_positionConstraints[e],r=n.radiusA,s=n.radiusB,o=this.m_contacts[i.contactIndex].GetManifold(),a=i.indexA,c=i.indexB,h=i.invMassA,l=i.invMassB,_=i.invIA,u=i.invIB,d=n.localCenterA,m=n.localCenterB,f=this.m_positions[a].c,p=this.m_positions[a].a,g=this.m_velocities[a].v,v=this.m_velocities[a].w,y=this.m_positions[c].c,x=this.m_positions[c].a,C=this.m_velocities[c].v,A=this.m_velocities[c].w;t(o.pointCount>0),he.cs_xfA.q.Set(p),he.cs_xfB.q.Set(x),he.cs_xfA.p.x=f.x-(he.cs_xfA.q.c*d.x-he.cs_xfA.q.s*d.y),he.cs_xfA.p.y=f.y-(he.cs_xfA.q.s*d.x+he.cs_xfA.q.c*d.y),he.cs_xfB.p.x=y.x-(he.cs_xfB.q.c*m.x-he.cs_xfB.q.s*m.y),he.cs_xfB.p.y=y.y-(he.cs_xfB.q.s*m.x+he.cs_xfB.q.c*m.y);var T=new et;T.Initialize(o,he.cs_xfA,r,he.cs_xfB,s),i.normal.x=T.normal.x,i.normal.y=T.normal.y;for(var b=i.pointCount,w=0;w<b;++w){var S=i.points[w];S.rA.x=T.points[w].x-f.x,S.rA.y=T.points[w].y-f.y,S.rB.x=T.points[w].x-y.x,S.rB.y=T.points[w].y-y.y;var E=S.rA.x*i.normal.y-S.rA.y*i.normal.x,I=S.rB.x*i.normal.y-S.rB.y*i.normal.x,R=h+l+_*E*E+u*I*I;S.normalMass=R>0?1/R:0;var P=1*i.normal.y,B=-1*i.normal.x,L=S.rA.x*B-S.rA.y*P,O=S.rB.x*B-S.rB.y*P,D=h+l+_*L*L+u*O*O;S.tangentMass=D>0?1/D:0,S.velocityBias=0;var N=i.normal.x*(C.x+-A*S.rB.y-g.x- -v*S.rA.y)+i.normal.y*(C.y+A*S.rB.x-g.y-v*S.rA.x);N<-1&&(S.velocityBias=-i.restitution*N)}if(2==i.pointCount){var M=i.points[0],F=i.points[1],z=M.rA.x*i.normal.y-M.rA.y*i.normal.x,G=M.rB.x*i.normal.y-M.rB.y*i.normal.x,V=F.rA.x*i.normal.y-F.rA.y*i.normal.x,k=F.rB.x*i.normal.y-F.rB.y*i.normal.x,W=h+l+_*z*z+u*G*G,U=h+l+_*V*V+u*k*k,j=h+l+_*z*V+u*G*k;W*W<1e3*(W*U-j*j)?(i.K.ex.x=W,i.K.ex.y=j,i.K.ey.x=j,i.K.ey.y=U,i.normalMass.Assign(i.K.GetInverse())):i.pointCount=1}}},WarmStart:function(){for(var t=0;t<this.m_count;++t){for(var e=this.m_velocityConstraints[t],i=e.indexA,n=e.indexB,r=e.invMassA,s=e.invIA,o=e.invMassB,a=e.invIB,c=e.pointCount,h=this.m_velocities[i].v,l=this.m_velocities[i].w,_=this.m_velocities[n].v,u=this.m_velocities[n].w,d=e.normal,m=1*d.y,f=-1*d.x,p=0;p<c;++p){var g=e.points[p],v=g.normalImpulse*d.x+g.tangentImpulse*m,y=g.normalImpulse*d.y+g.tangentImpulse*f;l-=s*(g.rA.x*y-g.rA.y*v),h.x-=r*v,h.y-=r*y,u+=a*(g.rB.x*y-g.rB.y*v),_.x+=o*v,_.y+=o*y}this.m_velocities[i].w=l,this.m_velocities[n].w=u}},SolveVelocityConstraints:function(){for(var e=0;e<this.m_count;++e){var i=this.m_velocityConstraints[e],n=i.indexA,r=i.indexB,s=i.invMassA,o=i.invIA,a=i.invMassB,c=i.invIB,h=i.pointCount,l=this.m_velocities[n].v,_=this.m_velocities[n].w,u=this.m_velocities[r].v,d=this.m_velocities[r].w,m=i.normal,f=1*m.y,p=-1*m.x,g=i.friction;t(1==h||2==h);for(var v=0;v<h;++v){var y=i.points[v],x=u.x+-d*y.rB.y-l.x- -_*y.rA.y,C=u.y+d*y.rB.x-l.y-_*y.rA.x,A=x*f+C*p-i.tangentSpeed,T=y.tangentMass*-A,b=g*y.normalImpulse;T=(E=L(y.tangentImpulse+T,-b,b))-y.tangentImpulse,y.tangentImpulse=E;var w=T*f,S=T*p;l.x-=s*w,l.y-=s*S,_-=o*(y.rA.x*S-y.rA.y*w),u.x+=a*w,u.y+=a*S,d+=c*(y.rB.x*S-y.rB.y*w)}if(1==i.pointCount){y=i.points[0],x=u.x+-d*y.rB.y-l.x- -_*y.rA.y,C=u.y+d*y.rB.x-l.y-_*y.rA.x;var E,I=x*m.x+C*m.y;T=-y.normalMass*(I-y.velocityBias);T=(E=oi(y.normalImpulse+T,0))-y.normalImpulse,y.normalImpulse=E,w=T*m.x,S=T*m.y,l.x-=s*w,l.y-=s*S,_-=o*(y.rA.x*S-y.rA.y*w),u.x+=a*w,u.y+=a*S,d+=c*(y.rB.x*S-y.rB.y*w)}else{var R=i.points[0],P=i.points[1],B=R.normalImpulse,O=P.normalImpulse;t(B>=0&&O>=0);var D=u.x+-d*R.rB.y-l.x- -_*R.rA.y,N=u.y+d*R.rB.x-l.y-_*R.rA.x,M=u.x+-d*P.rB.y-l.x- -_*P.rA.y,F=u.y+d*P.rB.x-l.y-_*P.rA.x,z=D*m.x+N*m.y,G=M*m.x+F*m.y,V=z-R.velocityBias,k=G-P.velocityBias;for(V-=i.K.ex.x*B+i.K.ey.x*O,k-=i.K.ex.y*B+i.K.ey.y*O;;){var W=-(i.normalMass.ex.x*V+i.normalMass.ey.x*k),U=-(i.normalMass.ex.y*V+i.normalMass.ey.y*k);if(W>=0&&U>=0){var j=W-B,q=U-O,Y=j*m.x,X=j*m.y,H=q*m.x,J=q*m.y;l.x-=s*(Y+H),l.y-=s*(X+J),_-=o*(R.rA.x*X-R.rA.y*Y+(P.rA.x*J-P.rA.y*H)),u.x+=a*(Y+H),u.y+=a*(X+J),d+=c*(R.rB.x*X-R.rB.y*Y+(P.rB.x*J-P.rB.y*H)),R.normalImpulse=W,P.normalImpulse=U;break}if(W=-R.normalMass*V,U=0,z=0,G=i.K.ex.y*W+k,W>=0&&G>=0){q=U-O,Y=(j=W-B)*m.x,X=j*m.y,H=q*m.x,J=q*m.y,l.x-=s*(Y+H),l.y-=s*(X+J),_-=o*(R.rA.x*X-R.rA.y*Y+(P.rA.x*J-P.rA.y*H)),u.x+=a*(Y+H),u.y+=a*(X+J),d+=c*(R.rB.x*X-R.rB.y*Y+(P.rB.x*J-P.rB.y*H)),R.normalImpulse=W,P.normalImpulse=U;break}if(W=0,U=-P.normalMass*k,z=i.K.ey.x*U+V,G=0,U>=0&&z>=0){q=U-O,Y=(j=W-B)*m.x,X=j*m.y,H=q*m.x,J=q*m.y,l.x-=s*(Y+H),l.y-=s*(X+J),_-=o*(R.rA.x*X-R.rA.y*Y+(P.rA.x*J-P.rA.y*H)),u.x+=a*(Y+H),u.y+=a*(X+J),d+=c*(R.rB.x*X-R.rB.y*Y+(P.rB.x*J-P.rB.y*H)),R.normalImpulse=W,P.normalImpulse=U;break}if(W=0,U=0,z=V,G=k,z>=0&&G>=0){q=U-O,Y=(j=W-B)*m.x,X=j*m.y,H=q*m.x,J=q*m.y,l.x-=s*(Y+H),l.y-=s*(X+J),_-=o*(R.rA.x*X-R.rA.y*Y+(P.rA.x*J-P.rA.y*H)),u.x+=a*(Y+H),u.y+=a*(X+J),d+=c*(R.rB.x*X-R.rB.y*Y+(P.rB.x*J-P.rB.y*H)),R.normalImpulse=W,P.normalImpulse=U;break}break}}this.m_velocities[n].w=_,this.m_velocities[r].w=d}},StoreImpulses:function(){for(var t=0;t<this.m_count;++t)for(var e=this.m_velocityConstraints[t],i=this.m_contacts[e.contactIndex].GetManifold(),n=0;n<e.pointCount;++n)i.points[n].normalImpulse=e.points[n].normalImpulse,i.points[n].tangentImpulse=e.points[n].tangentImpulse},SolvePositionConstraints:function(){for(var t=0,e=0;e<this.m_count;++e){for(var i=this.m_positionConstraints[e],n=i.indexA,r=i.indexB,s=i.localCenterA,o=i.invMassA,a=i.invIA,c=i.localCenterB,h=i.invMassB,l=i.invIB,_=i.pointCount,u=this.m_positions[n].c,d=this.m_positions[n].a,m=this.m_positions[r].c,f=this.m_positions[r].a,p=0;p<_;++p){he.cs_xfA.q.Set(d),he.cs_xfB.q.Set(f),he.cs_xfA.p.x=u.x-(he.cs_xfA.q.c*s.x-he.cs_xfA.q.s*s.y),he.cs_xfA.p.y=u.y-(he.cs_xfA.q.s*s.x+he.cs_xfA.q.c*s.y),he.cs_xfB.p.x=m.x-(he.cs_xfB.q.c*c.x-he.cs_xfB.q.s*c.y),he.cs_xfB.p.y=m.y-(he.cs_xfB.q.s*c.x+he.cs_xfB.q.c*c.y),he.temp_solver_manifold.Initialize(i,he.cs_xfA,he.cs_xfB,p);var g=he.temp_solver_manifold.normal,v=he.temp_solver_manifold.point,y=he.temp_solver_manifold.separation,x=v.x-u.x,C=v.y-u.y,A=v.x-m.x,T=v.y-m.y;t=si(t,y);var b=L(.2*(y+Ue),-.2,0),w=x*g.y-C*g.x,S=A*g.y-T*g.x,E=o+h+a*w*w+l*S*S,I=E>0?-b/E:0,R=I*g.x,P=I*g.y;u.x-=o*R,u.y-=o*P,d-=a*(x*P-C*R),m.x+=h*R,m.y+=h*P,f+=l*(A*P-T*R)}this.m_positions[n].a=d,this.m_positions[r].a=f}return t>=-3*Ue},SolveTOIPositionConstraints:function(t,e){for(var i=0,n=0;n<this.m_count;++n){var s=this.m_positionConstraints[n],o=s.indexA,a=s.indexB,c=s.localCenterA,h=s.localCenterB,l=s.pointCount,_=0,d=0;o!=t&&o!=e||(_=s.invMassA,d=s.invIA);var m=0,f=0;a!=t&&a!=e||(m=s.invMassB,f=s.invIB);for(var p=this.m_positions[o].c,g=this.m_positions[o].a,v=this.m_positions[a].c,y=this.m_positions[a].a,x=0;x<l;++x){he.cs_xfA.q.Set(g),he.cs_xfB.q.Set(y),he.cs_xfA.p.Assign(r.Subtract(p,b(he.cs_xfA.q,c))),he.cs_xfB.p.Assign(r.Subtract(v,b(he.cs_xfB.q,h))),he.temp_solver_manifold.Initialize(s,he.cs_xfA,he.cs_xfB,x);var C=he.temp_solver_manifold.normal,A=he.temp_solver_manifold.point,T=he.temp_solver_manifold.separation,w=r.Subtract(A,p),S=r.Subtract(A,v);i=si(i,T);var E=L(.75*(T+Ue),-.2,0),I=u(w,C),R=u(S,C),P=_+m+d*I*I+f*R*R,B=r.Multiply(P>0?-E/P:0,C);p.Subtract(r.Multiply(_,B)),g-=d*u(w,B),v.Add(r.Multiply(m,B)),y+=f*u(S,B)}this.m_positions[o].a=g,this.m_positions[a].a=y}return i>=-1.5*Ue}};var Ai=Fe.create("solve initialization","solve"),Ti=Fe.create("warm starting","solve initialization"),bi=Fe.create("solve velocities","solve"),wi=Fe.create("solve positions","solve");le._solverData=new kt,le._solverDef=new ce,le._solver=new he,le.prototype={Clear:function(){this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0},Initialize:function(t,e,i,n){this.m_listener=n,this.m_bodyCapacity=t,this.m_contactCapacity=e,this.m_jointCapacity=i,this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0,this.m_bodies.length=t,this.m_contacts.length=e,this.m_joints.length=i,this.m_velocities.length=t,this.m_positions.length=t},Solve:function(t,e,i){Ai.start();for(var n=t.dt,r=0;r<this.m_bodyCount;++r){var s=this.m_bodies[r];this.m_positions[r].c.Assign(s.m_sweep.c);var o=s.m_sweep.a;this.m_velocities[r].v.Assign(s.m_linearVelocity);var a=s.m_angularVelocity;s.m_sweep.c0.Assign(s.m_sweep.c),s.m_sweep.a0=s.m_sweep.a,s.m_type==Et.b2_dynamicBody&&(this.m_velocities[r].v.x+=n*(s.m_gravityScale*e.x+s.m_invMass*s.m_force.x),this.m_velocities[r].v.y+=n*(s.m_gravityScale*e.y+s.m_invMass*s.m_force.y),a+=n*s.m_invI*s.m_torque,this.m_velocities[r].v.x*=1/(1+n*s.m_linearDamping),this.m_velocities[r].v.y*=1/(1+n*s.m_linearDamping),a*=1/(1+n*s.m_angularDamping)),this.m_positions[r].a=o,this.m_velocities[r].w=a}le._solverData.step=t,le._solverData.positions=this.m_positions,le._solverData.velocities=this.m_velocities,le._solverDef.step=t,le._solverDef.contacts=this.m_contacts,le._solverDef.count=this.m_contactCount,le._solverDef.positions=this.m_positions,le._solverDef.velocities=this.m_velocities,le._solverDef.allocator=this.m_allocator,le._solver.Init(le._solverDef),le._solver.InitializeVelocityConstraints(),t.warmStarting&&(Ti.start(),le._solver.WarmStart(),Ti.stop());for(r=0;r<this.m_jointCount;++r)this.m_joints[r].InitVelocityConstraints(le._solverData);Ai.stop(),bi.start();for(r=0;r<t.velocityIterations;++r){for(var c=0;c<this.m_jointCount;++c)this.m_joints[c].SolveVelocityConstraints(le._solverData);le._solver.SolveVelocityConstraints()}le._solver.StoreImpulses(),bi.stop(),wi.start();for(r=0;r<this.m_bodyCount;++r){var h=this.m_positions[r].c,l=(o=this.m_positions[r].a,this.m_velocities[r].v),u=(a=this.m_velocities[r].w,n*l.x),d=n*l.y,m=u*u+d*d;if(m>4){var f=2/ii(m);l.x*=f,l.y*=f}var p=n*a;if(p*p>He){a*=f=Xe/ri(p)}h.x+=n*l.x,h.y+=n*l.y,o+=n*a,this.m_positions[r].a=o,this.m_velocities[r].w=a}var g=!1;for(r=0;r<t.positionIterations;++r){var v=le._solver.SolvePositionConstraints(),y=!0;for(c=0;c<this.m_jointCount;++c){var x=this.m_joints[c].SolvePositionConstraints(le._solverData);y=y&&x}if(v&&y){g=!0;break}}for(r=0;r<this.m_bodyCount;++r){var C=this.m_bodies[r];C.m_sweep.c.Assign(this.m_positions[r].c),C.m_sweep.a=this.m_positions[r].a,C.m_linearVelocity.Assign(this.m_velocities[r].v),C.m_angularVelocity=this.m_velocities[r].w,C.SynchronizeTransform()}if(wi.stop(),this.Report(le._solver.m_velocityConstraints),i){var A=ze,T=Je*Je;for(r=0;r<this.m_bodyCount;++r){(s=this.m_bodies[r]).GetType()!=Et.b2_staticBody&&(0==(s.m_flags&Et.e_autoSleepFlag)||s.m_angularVelocity*s.m_angularVelocity>T||_(s.m_linearVelocity,s.m_linearVelocity)>1e-4?(s.m_sleepTime=0,A=0):(s.m_sleepTime+=n,A=si(A,s.m_sleepTime)))}if(A>=.5&&g)for(r=0;r<this.m_bodyCount;++r){(s=this.m_bodies[r]).SetAwake(!1)}}},SolveTOI:function(e,i,n){t(i<this.m_bodyCount),t(n<this.m_bodyCount);for(var s=0;s<this.m_bodyCount;++s){var o=this.m_bodies[s];this.m_positions[s].c.Assign(o.m_sweep.c),this.m_positions[s].a=o.m_sweep.a,this.m_velocities[s].v.Assign(o.m_linearVelocity),this.m_velocities[s].w=o.m_angularVelocity}le._solverDef.contacts=this.m_contacts,le._solverDef.count=this.m_contactCount,le._solverDef.step=e,le._solverDef.positions=this.m_positions,le._solverDef.velocities=this.m_velocities,le._solver.Init(le._solverDef);for(s=0;s<e.positionIterations;++s){if(le._solver.SolveTOIPositionConstraints(i,n))break}this.m_bodies[i].m_sweep.c0.Assign(this.m_positions[i].c),this.m_bodies[i].m_sweep.a0=this.m_positions[i].a,this.m_bodies[n].m_sweep.c0.Assign(this.m_positions[n].c),this.m_bodies[n].m_sweep.a0=this.m_positions[n].a,le._solver.InitializeVelocityConstraints();for(s=0;s<e.velocityIterations;++s)le._solver.SolveVelocityConstraints();var a=e.dt;for(s=0;s<this.m_bodyCount;++s){var c=this.m_positions[s].c,h=this.m_positions[s].a,l=this.m_velocities[s].v,u=this.m_velocities[s].w,d=r.Multiply(a,l);if(_(d,d)>4){var m=2/d.Length();l.Multiply(m)}var f=a*u;if(f*f>He){u*=m=Xe/ri(f)}c.Add(r.Multiply(a,l)),h+=a*u,this.m_positions[s].a=h,this.m_velocities[s].w=u;var p=this.m_bodies[s];p.m_sweep.c.Assign(c),p.m_sweep.a=h,p.m_linearVelocity.Assign(l),p.m_angularVelocity=u,p.SynchronizeTransform()}this.Report(le._solver.m_velocityConstraints)},AddBody:function(e){t(this.m_bodyCount<this.m_bodyCapacity),e.m_islandIndex=this.m_bodyCount,this.m_bodies[this.m_bodyCount]=e,this.m_positions[this.m_bodyCount]||(this.m_positions[this.m_bodyCount]=new Gt,this.m_velocities[this.m_bodyCount]=new Vt),++this.m_bodyCount},AddContact:function(e){t(this.m_contactCount<this.m_contactCapacity),this.m_contacts[this.m_contactCount++]=e},AddJoint:function(e){t(this.m_jointCount<this.m_jointCapacity),this.m_joints[this.m_jointCount++]=e},Report:function(t){if(null!=this.m_listener)for(var e=0;e<this.m_contactCount;++e){var i=this.m_contacts[e],n=t[e],r=new Dt;r.count=n.pointCount;for(var s=0;s<n.pointCount;++s)r.normalImpulses[s]=n.points[s].normalImpulse,r.tangentImpulses[s]=n.points[s].tangentImpulse;this.m_listener.PostSolve(i,r)}}},ue.prototype={_deserialize:function(t,e,i){this.bodyA=e[t.bodyA],this.bodyB=e[t.bodyB],this.collideConnected=t.collideConnected}},de.prototype={GetType:function(){return this.m_type},GetBodyA:function(){return this.m_bodyA},GetBodyB:function(){return this.m_bodyB},GetAnchorA:function(){},GetAnchorB:function(){},GetReactionForce:function(t){},GetReactionTorque:function(t){},GetNext:function(){return this.m_next},GetUserData:function(){return this.m_userData},SetUserData:function(t){this.m_userData=t},IsActive:function(){return this.m_bodyA.IsActive()&&this.m_bodyB.IsActive()},GetCollideConnected:function(){return this.m_collideConnected},ShiftOrigin:function(t){},InitVelocityConstraints:function(t){},SolveVelocityConstraints:function(t){},SolvePositionConstraints:function(t){},_serialize:function(t){var e=t||{};return e.bodyA=null,e.bodyB=null,e.type=this.m_type,e.collideConnected=this.m_collideConnected,e}},de.e_inactiveLimit=0,de.e_atLowerLimit=1,de.e_atUpperLimit=2,de.e_equalLimits=3,de.e_unknownJoint=0,de.e_revoluteJoint=1,de.e_prismaticJoint=2,de.e_distanceJoint=3,de.e_pulleyJoint=4,de.e_mouseJoint=5,de.e_gearJoint=6,de.e_wheelJoint=7,de.e_weldJoint=8,de.e_frictionJoint=9,de.e_ropeJoint=10,de.e_motorJoint=11,de.Create=function(e){var i=null;switch(e.type){case de.e_distanceJoint:i=new ye(e);break;case de.e_mouseJoint:i=new ge(e);break;case de.e_prismaticJoint:i=new Ce(e);break;case de.e_revoluteJoint:i=new fe(e);break;case de.e_pulleyJoint:i=new Oe(e);break;case de.e_gearJoint:i=new Re(e);break;case de.e_wheelJoint:i=new Ee(e);break;case de.e_weldJoint:i=new we(e);break;case de.e_frictionJoint:i=new Te(e);break;case de.e_ropeJoint:i=new Ne(e);break;case de.e_motorJoint:i=new Be(e);break;default:t(!1)}return i},de.Destroy=function(t){},me.prototype={Initialize:function(t,e,i){this.bodyA=t,this.bodyB=e,this.localAnchorA=this.bodyA.GetLocalPoint(i),this.localAnchorB=this.bodyB.GetLocalPoint(i),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()},_deserialize:function(t,e,i){this.parent.prototype._deserialize.call(this,t,e,i),this.localAnchorA._deserialize(t.localAnchorA),this.localAnchorB._deserialize(t.localAnchorB),this.referenceAngle=t.referenceAngle,this.lowerAngle=t.lowerAngle,this.upperAngle=t.upperAngle,this.maxMotorTorque=t.maxMotorTorque,this.motorSpeed=t.motorSpeed,this.enableLimit=t.enableLimit,this.enableMotor=t.enableMotor}},me._extend(ue),fe.prototype={GetAnchorA:function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)},GetAnchorB:function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},GetLocalAnchorA:function(){return this.m_localAnchorA},GetLocalAnchorB:function(){return this.m_localAnchorB},GetReferenceAngle:function(){return this.m_referenceAngle},GetJointAngle:function(){var t=this.m_bodyA;return this.m_bodyB.m_sweep.a-t.m_sweep.a-this.m_referenceAngle},GetJointSpeed:function(){var t=this.m_bodyA;return this.m_bodyB.m_angularVelocity-t.m_angularVelocity},IsLimitEnabled:function(){return this.m_enableLimit},EnableLimit:function(t){t!=this.m_enableLimit&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=t,this.m_impulse.z=0)},GetLowerLimit:function(){return this.m_lowerAngle},GetUpperLimit:function(){return this.m_upperAngle},SetLimits:function(e,i){t(e<=i),e==this.m_lowerAngle&&i==this.m_upperAngle||(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_impulse.z=0,this.m_lowerAngle=e,this.m_upperAngle=i)},IsMotorEnabled:function(){return this.m_enableMotor},EnableMotor:function(t){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=t},SetMotorSpeed:function(t){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=t},GetMotorSpeed:function(){return this.m_motorSpeed},SetMaxMotorTorque:function(t){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorTorque=t},GetMaxMotorTorque:function(){return this.m_maxMotorTorque},GetReactionForce:function(t){var e=new r(this.m_impulse.x,this.m_impulse.y);return r.Multiply(t,e)},GetReactionTorque:function(t){return t*this.m_impulse.z},GetMotorTorque:function(t){return t*this.m_motorImpulse},InitVelocityConstraints:function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=t.positions[this.m_indexA].a,i=t.velocities[this.m_indexA].v.Clone(),n=t.velocities[this.m_indexA].w,s=t.positions[this.m_indexB].a,o=t.velocities[this.m_indexB].v.Clone(),a=t.velocities[this.m_indexB].w,h=new c(e),l=new c(s);this.m_rA=b(h,r.Subtract(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=b(l,r.Subtract(this.m_localAnchorB,this.m_localCenterB));var _=this.m_invMassA,d=this.m_invMassB,m=this.m_invIA,f=this.m_invIB,p=m+f==0;if(this.m_mass.ex.x=_+d+this.m_rA.y*this.m_rA.y*m+this.m_rB.y*this.m_rB.y*f,this.m_mass.ey.x=-this.m_rA.y*this.m_rA.x*m-this.m_rB.y*this.m_rB.x*f,this.m_mass.ez.x=-this.m_rA.y*m-this.m_rB.y*f,this.m_mass.ex.y=this.m_mass.ey.x,this.m_mass.ey.y=_+d+this.m_rA.x*this.m_rA.x*m+this.m_rB.x*this.m_rB.x*f,this.m_mass.ez.y=this.m_rA.x*m+this.m_rB.x*f,this.m_mass.ex.z=this.m_mass.ez.x,this.m_mass.ey.z=this.m_mass.ez.y,this.m_mass.ez.z=m+f,this.m_motorMass=m+f,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass),(0==this.m_enableMotor||p)&&(this.m_motorImpulse=0),this.m_enableLimit&&0==p){var g=s-e-this.m_referenceAngle;ri(this.m_upperAngle-this.m_lowerAngle)<2*je?this.m_limitState=de.e_equalLimits:g<=this.m_lowerAngle?(this.m_limitState!=de.e_atLowerLimit&&(this.m_impulse.z=0),this.m_limitState=de.e_atLowerLimit):g>=this.m_upperAngle?(this.m_limitState!=de.e_atUpperLimit&&(this.m_impulse.z=0),this.m_limitState=de.e_atUpperLimit):(this.m_limitState=de.e_inactiveLimit,this.m_impulse.z=0)}else this.m_limitState=de.e_inactiveLimit;if(t.step.warmStarting){this.m_impulse.Multiply(t.step.dtRatio),this.m_motorImpulse*=t.step.dtRatio;var v=new r(this.m_impulse.x,this.m_impulse.y);i.Subtract(r.Multiply(_,v)),n-=m*(u(this.m_rA,v)+this.m_motorImpulse+this.m_impulse.z),o.Add(r.Multiply(d,v)),a+=f*(u(this.m_rB,v)+this.m_motorImpulse+this.m_impulse.z)}else this.m_impulse.SetZero(),this.m_motorImpulse=0;t.velocities[this.m_indexA].v.Assign(i),t.velocities[this.m_indexA].w=n,t.velocities[this.m_indexB].v.Assign(o),t.velocities[this.m_indexB].w=a},SolveVelocityConstraints:function(t){var e=t.velocities[this.m_indexA].v.Clone(),i=t.velocities[this.m_indexA].w,n=t.velocities[this.m_indexB].v.Clone(),o=t.velocities[this.m_indexB].w,a=this.m_invMassA,c=this.m_invMassB,h=this.m_invIA,l=this.m_invIB,_=h+l==0;if(this.m_enableMotor&&this.m_limitState!=de.e_equalLimits&&0==_){var d=o-i-this.m_motorSpeed,f=-this.m_motorMass*d,p=this.m_motorImpulse,g=t.step.dt*this.m_maxMotorTorque;this.m_motorImpulse=L(this.m_motorImpulse+f,-g,g),i-=h*(f=this.m_motorImpulse-p),o+=l*f}if(this.m_enableLimit&&this.m_limitState!=de.e_inactiveLimit&&0==_){var v=r.Subtract(r.Subtract(r.Add(n,m(o,this.m_rB)),e),m(i,this.m_rA)),y=o-i;d=new s(v.x,v.y,y),f=this.m_mass.Solve33(d).Negate();if(this.m_limitState==de.e_equalLimits)this.m_impulse.Add(f);else if(this.m_limitState==de.e_atLowerLimit){if(this.m_impulse.z+f.z<0){var x=r.Add(v.Negate(),r.Multiply(this.m_impulse.z,new r(this.m_mass.ez.x,this.m_mass.ez.y))),C=this.m_mass.Solve22(x);f.x=C.x,f.y=C.y,f.z=-this.m_impulse.z,this.m_impulse.x+=C.x,this.m_impulse.y+=C.y,this.m_impulse.z=0}else this.m_impulse.Add(f)}else if(this.m_limitState==de.e_atUpperLimit){if(this.m_impulse.z+f.z>0){x=r.Add(v.Negate(),r.Multiply(this.m_impulse.z,new r(this.m_mass.ez.x,this.m_mass.ez.y))),C=this.m_mass.Solve22(x);f.x=C.x,f.y=C.y,f.z=-this.m_impulse.z,this.m_impulse.x+=C.x,this.m_impulse.y+=C.y,this.m_impulse.z=0}else this.m_impulse.Add(f)}var A=new r(f.x,f.y);e.Subtract(r.Multiply(a,A)),i-=h*(u(this.m_rA,A)+f.z),n.Add(r.Multiply(c,A)),o+=l*(u(this.m_rB,A)+f.z)}else{d=r.Subtract(r.Subtract(r.Add(n,m(o,this.m_rB)),e),m(i,this.m_rA)),f=this.m_mass.Solve22(d.Negate());this.m_impulse.x+=f.x,this.m_impulse.y+=f.y,e.Subtract(r.Multiply(a,f)),i-=h*u(this.m_rA,f),n.Add(r.Multiply(c,f)),o+=l*u(this.m_rB,f)}t.velocities[this.m_indexA].v.Assign(e),t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].v.Assign(n),t.velocities[this.m_indexB].w=o},SolvePositionConstraints:function(t){var e=t.positions[this.m_indexA].c.Clone(),i=t.positions[this.m_indexA].a,n=t.positions[this.m_indexB].c.Clone(),s=t.positions[this.m_indexB].a,a=new c(i),h=new c(s),l=0,_=0,d=this.m_invIA+this.m_invIB==0;if(this.m_enableLimit&&this.m_limitState!=de.e_inactiveLimit&&0==d){var m=s-i-this.m_referenceAngle,f=0;if(this.m_limitState==de.e_equalLimits){var p=L(m-this.m_lowerAngle,-Ye,Ye);f=-this.m_motorMass*p,l=ri(p)}else if(this.m_limitState==de.e_atLowerLimit){l=-(p=m-this.m_lowerAngle),p=L(p+je,-Ye,0),f=-this.m_motorMass*p}else if(this.m_limitState==de.e_atUpperLimit){l=p=m-this.m_upperAngle,p=L(p-je,0,Ye),f=-this.m_motorMass*p}i-=this.m_invIA*f,s+=this.m_invIB*f}a.Set(i),h.Set(s);var g=b(a,r.Subtract(this.m_localAnchorA,this.m_localCenterA)),v=b(h,r.Subtract(this.m_localAnchorB,this.m_localCenterB));_=(p=r.Subtract(r.Subtract(r.Add(n,v),e),g)).Length();var y=this.m_invMassA,x=this.m_invMassB,C=this.m_invIA,A=this.m_invIB,T=new o;T.ex.x=y+x+C*g.y*g.y+A*v.y*v.y,T.ex.y=-C*g.x*g.y-A*v.x*v.y,T.ey.x=T.ex.y,T.ey.y=y+x+C*g.x*g.x+A*v.x*v.x;var w=T.Solve(p).Negate();return e.Subtract(r.Multiply(y,w)),i-=C*u(g,w),n.Add(r.Multiply(x,w)),s+=A*u(v,w),t.positions[this.m_indexA].c.Assign(e),t.positions[this.m_indexA].a=i,t.positions[this.m_indexB].c.Assign(n),t.positions[this.m_indexB].a=s,_<=Ue&&l<=je},_serialize:function(t){var e=t||{};return this.parent.prototype._serialize.call(this,e),e.localAnchorA=this.m_localAnchorA._serialize(),e.localAnchorB=this.m_localAnchorB._serialize(),e.referenceAngle=this.m_referenceAngle,e.lowerAngle=this.m_lowerAngle,e.upperAngle=this.m_upperAngle,e.maxMotorTorque=this.m_maxMotorTorque,e.motorSpeed=this.m_motorSpeed,e.enableLimit=this.m_enableLimit,e.enableMotor=this.m_enableMotor,e}},fe._extend(de),pe._extend(ue),ge.prototype={GetAnchorA:function(){return this.m_targetA},GetAnchorB:function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},GetReactionForce:function(t){return r.Multiply(t,this.m_impulse)},GetReactionTorque:function(t){return 0*t},SetTarget:function(t){0==this.m_bodyB.IsAwake()&&this.m_bodyB.SetAwake(!0),this.m_targetA.Assign(t)},GetTarget:function(){return this.m_targetA},SetMaxForce:function(t){this.m_maxForce=t},GetMaxForce:function(){return this.m_maxForce},SetFrequency:function(t){this.m_frequencyHz=t},GetFrequency:function(){return this.m_frequencyHz},SetDampingRatio:function(t){this.m_dampingRatio=t},GetDampingRatio:function(){return this.m_dampingRatio},ShiftOrigin:function(t){this.m_targetA.Subtract(t)},InitVelocityConstraints:function(e){this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterB.Assign(this.m_bodyB.m_sweep.localCenter),this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIB=this.m_bodyB.m_invI;var i=e.positions[this.m_indexB].c.Clone(),n=e.positions[this.m_indexB].a,s=e.velocities[this.m_indexB].v.Clone(),a=e.velocities[this.m_indexB].w,h=new c(n),l=this.m_bodyB.GetMass(),_=2*Ve*this.m_frequencyHz,d=2*l*this.m_dampingRatio*_,m=l*(_*_),f=e.step.dt;t(d+f*m>Ge),this.m_gamma=f*(d+f*m),0!=this.m_gamma&&(this.m_gamma=1/this.m_gamma),this.m_beta=f*m*this.m_gamma,this.m_rB.Assign(b(h,r.Subtract(this.m_localAnchorB,this.m_localCenterB)));var p=new o;p.ex.x=this.m_invMassB+this.m_invIB*this.m_rB.y*this.m_rB.y+this.m_gamma,p.ex.y=-this.m_invIB*this.m_rB.x*this.m_rB.y,p.ey.x=p.ex.y,p.ey.y=this.m_invMassB+this.m_invIB*this.m_rB.x*this.m_rB.x+this.m_gamma,this.m_mass.Assign(p.GetInverse()),this.m_C.Assign(r.Subtract(r.Add(i,this.m_rB),this.m_targetA)),this.m_C.Multiply(this.m_beta),a*=.98,e.step.warmStarting?(this.m_impulse.Multiply(e.step.dtRatio),s.Add(r.Multiply(this.m_invMassB,this.m_impulse)),a+=this.m_invIB*u(this.m_rB,this.m_impulse)):this.m_impulse.SetZero(),e.velocities[this.m_indexB].v.Assign(s),e.velocities[this.m_indexB].w=a},SolveVelocityConstraints:function(t){var e=t.velocities[this.m_indexB].v.Clone(),i=t.velocities[this.m_indexB].w,n=r.Add(e,m(i,this.m_rB)),s=f(this.m_mass,r.Add(r.Add(n,this.m_C),r.Multiply(this.m_gamma,this.m_impulse)).Negate()),o=this.m_impulse.Clone();this.m_impulse.Add(s);var a=t.step.dt*this.m_maxForce;this.m_impulse.LengthSquared()>a*a&&this.m_impulse.Multiply(a/this.m_impulse.Length()),s.Assign(r.Subtract(this.m_impulse,o)),e.Add(r.Multiply(this.m_invMassB,s)),i+=this.m_invIB*u(this.m_rB,s),t.velocities[this.m_indexB].v.Assign(e),t.velocities[this.m_indexB].w=i},SolvePositionConstraints:function(t){return!0}},ge._extend(de),ve.prototype={Initialize:function(t,e,i,n){this.bodyA=t,this.bodyB=e,this.localAnchorA=this.bodyA.GetLocalPoint(i),this.localAnchorB=this.bodyB.GetLocalPoint(n);var s=r.Subtract(n,i);this.length=s.Length()},_deserialize:function(t,e,i){this.parent.prototype._deserialize.call(this,t,e,i),this.localAnchorA._deserialize(t.localAnchorA),this.localAnchorB._deserialize(t.localAnchorB),this.length=t.length,this.frequencyHz=t.frequencyHz,this.dampingRatio=t.dampingRatio}},ve._extend(ue),ye.prototype={GetAnchorA:function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)},GetAnchorB:function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},GetReactionForce:function(t){return r.Multiply(t*this.m_impulse,this.m_u)},GetReactionTorque:function(t){return 0},GetLocalAnchorA:function(){return this.m_localAnchorA},GetLocalAnchorB:function(){return this.m_localAnchorB},SetLength:function(t){this.m_length=t},GetLength:function(){return this.m_length},SetFrequency:function(t){this.m_frequencyHz=t},GetFrequency:function(){return this.m_frequencyHz},SetDampingRatio:function(t){this.m_dampingRatio=t},GetDampingRatio:function(){return this.m_dampingRatio},InitVelocityConstraints:function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Assign(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Assign(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=t.positions[this.m_indexA].c.Clone(),i=t.positions[this.m_indexA].a,n=t.velocities[this.m_indexA].v.Clone(),s=t.velocities[this.m_indexA].w,o=t.positions[this.m_indexB].c.Clone(),a=t.positions[this.m_indexB].a,h=t.velocities[this.m_indexB].v.Clone(),l=t.velocities[this.m_indexB].w,_=new c(i),d=new c(a);this.m_rA=b(_,r.Subtract(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=b(d,r.Subtract(this.m_localAnchorB,this.m_localCenterB)),this.m_u=r.Subtract(r.Subtract(r.Add(o,this.m_rB),e),this.m_rA);var m=this.m_u.Length();m>Ue?this.m_u.Multiply(1/m):this.m_u.Set(0,0);var f=u(this.m_rA,this.m_u),p=u(this.m_rB,this.m_u),g=this.m_invMassA+this.m_invIA*f*f+this.m_invMassB+this.m_invIB*p*p;if(this.m_mass=0!=g?1/g:0,this.m_frequencyHz>0){var v=m-this.m_length,y=2*Ve*this.m_frequencyHz,x=2*this.m_mass*this.m_dampingRatio*y,C=this.m_mass*y*y,A=t.step.dt;this.m_gamma=A*(x+A*C),this.m_gamma=0!=this.m_gamma?1/this.m_gamma:0,this.m_bias=v*A*C*this.m_gamma,g+=this.m_gamma,this.m_mass=0!=g?1/g:0}else this.m_gamma=0,this.m_bias=0;if(t.step.warmStarting){this.m_impulse*=t.step.dtRatio;var T=r.Multiply(this.m_impulse,this.m_u);n.Subtract(r.Multiply(this.m_invMassA,T)),s-=this.m_invIA*u(this.m_rA,T),h.Add(r.Multiply(this.m_invMassB,T)),l+=this.m_invIB*u(this.m_rB,T)}else this.m_impulse=0;t.velocities[this.m_indexA].v.Assign(n),t.velocities[this.m_indexA].w=s,t.velocities[this.m_indexB].v.Assign(h),t.velocities[this.m_indexB].w=l},SolveVelocityConstraints:function(t){var e=t.velocities[this.m_indexA].v.Clone(),i=t.velocities[this.m_indexA].w,n=t.velocities[this.m_indexB].v.Clone(),s=t.velocities[this.m_indexB].w,o=r.Add(e,m(i,this.m_rA)),a=r.Add(n,m(s,this.m_rB)),c=_(this.m_u,r.Subtract(a,o)),h=-this.m_mass*(c+this.m_bias+this.m_gamma*this.m_impulse);this.m_impulse+=h;var l=r.Multiply(h,this.m_u);e.Subtract(r.Multiply(this.m_invMassA,l)),i-=this.m_invIA*u(this.m_rA,l),n.Add(r.Multiply(this.m_invMassB,l)),s+=this.m_invIB*u(this.m_rB,l),t.velocities[this.m_indexA].v.Assign(e),t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].v.Assign(n),t.velocities[this.m_indexB].w=s},SolvePositionConstraints:function(t){if(this.m_frequencyHz>0)return!0;var e=t.positions[this.m_indexA].c.Clone(),i=t.positions[this.m_indexA].a,n=t.positions[this.m_indexB].c.Clone(),s=t.positions[this.m_indexB].a,o=new c(i),a=new c(s),h=b(o,r.Subtract(this.m_localAnchorA,this.m_localCenterA)),l=b(a,r.Subtract(this.m_localAnchorB,this.m_localCenterB)),_=r.Subtract(r.Subtract(r.Add(n,l),e),h),d=_.Normalize()-this.m_length;d=L(d,-.2,.2);var m=-this.m_mass*d,f=r.Multiply(m,_);return e.Subtract(r.Multiply(this.m_invMassA,f)),i-=this.m_invIA*u(h,f),n.Add(r.Multiply(this.m_invMassB,f)),s+=this.m_invIB*u(l,f),t.positions[this.m_indexA].c.Assign(e),t.positions[this.m_indexA].a=i,t.positions[this.m_indexB].c.Assign(n),t.positions[this.m_indexB].a=s,ri(d)<Ue},_serialize:function(t){var e=t||{};return this.parent.prototype._serialize.call(this,e),e.localAnchorA=this.m_localAnchorA._serialize(),e.localAnchorB=this.m_localAnchorB._serialize(),e.length=this.m_length,e.frequencyHz=this.m_frequencyHz,e.dampingRatio=this.m_dampingRatio,e}},ye._extend(de),xe.prototype={Initialize:function(t,e,i,n){this.bodyA=t,this.bodyB=e,this.localAnchorA=this.bodyA.GetLocalPoint(i),this.localAnchorB=this.bodyB.GetLocalPoint(i),this.localAxisA=this.bodyA.GetLocalVector(n),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()},_deserialize:function(t,e,i){this.parent.prototype._deserialize.call(this,t,e,i),this.localAnchorA._deserialize(t.localAnchorA),this.localAnchorB._deserialize(t.localAnchorB),this.localAxisA._deserialize(t.localAxisA),this.referenceAngle=t.referenceAngle,this.enableLimit=t.enableLimit,this.lowerTranslation=t.lowerTranslation,this.upperTranslation=t.upperTranslation,this.enableMotor=t.enableMotor,this.maxMotorForce=t.maxMotorForce,this.motorSpeed=t.motorSpeed}},xe._extend(ue),Ce.prototype={GetAnchorA:function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)},GetAnchorB:function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},GetReactionForce:function(t){return r.Multiply(t,r.Add(r.Multiply(this.m_impulse.x,this.m_perp),r.Multiply(this.m_motorImpulse+this.m_impulse.z,this.m_axis)))},GetReactionTorque:function(t){return t*this.m_impulse.y},GetLocalAnchorA:function(){return this.m_localAnchorA},GetLocalAnchorB:function(){return this.m_localAnchorB},GetLocalAxisA:function(){return this.m_localXAxisA},GetReferenceAngle:function(){return this.m_referenceAngle},GetJointTranslation:function(){var t=this.m_bodyA.GetWorldPoint(this.m_localAnchorA),e=this.m_bodyB.GetWorldPoint(this.m_localAnchorB);return _(r.Subtract(e,t),this.m_bodyA.GetWorldVector(this.m_localXAxisA))},GetJointSpeed:function(){var t=this.m_bodyA,e=this.m_bodyB,i=b(t.m_xf.q,r.Subtract(this.m_localAnchorA,t.m_sweep.localCenter)),n=b(e.m_xf.q,r.Subtract(this.m_localAnchorB,e.m_sweep.localCenter)),s=r.Add(t.m_sweep.c,i),o=r.Add(e.m_sweep.c,n),a=r.Subtract(o,s),c=b(t.m_xf.q,this.m_localXAxisA),h=t.m_linearVelocity,l=e.m_linearVelocity,u=t.m_angularVelocity,d=e.m_angularVelocity;return _(a,m(u,c))+_(c,r.Subtract(r.Subtract(r.Add(l,m(d,n)),h),m(u,i)))},IsLimitEnabled:function(){return this.m_enableLimit},EnableLimit:function(t){t!=this.m_enableLimit&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=t,this.m_impulse.z=0)},GetLowerLimit:function(){return this.m_lowerTranslation},GetUpperLimit:function(){return this.m_upperTranslation},SetLimits:function(e,i){t(e<=i),e==this.m_lowerTranslation&&i==this.m_upperTranslation||(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_lowerTranslation=e,this.m_upperTranslation=i,this.m_impulse.z=0)},IsMotorEnabled:function(){return this.m_enableMotor},EnableMotor:function(t){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=t},SetMotorSpeed:function(t){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=t},GetMotorSpeed:function(){return this.m_motorSpeed},SetMaxMotorForce:function(t){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorForce=t},GetMaxMotorForce:function(){return this.m_maxMotorForce},GetMotorForce:function(t){return t*this.m_motorImpulse},InitVelocityConstraints:function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=t.positions[this.m_indexA].c.Clone(),i=t.positions[this.m_indexA].a,n=t.velocities[this.m_indexA].v.Clone(),s=t.velocities[this.m_indexA].w,o=t.positions[this.m_indexB].c.Clone(),a=t.positions[this.m_indexB].a,h=t.velocities[this.m_indexB].v.Clone(),l=t.velocities[this.m_indexB].w,d=new c(i),m=new c(a),f=b(d,r.Subtract(this.m_localAnchorA,this.m_localCenterA)),p=b(m,r.Subtract(this.m_localAnchorB,this.m_localCenterB)),g=r.Add(r.Subtract(o,e),r.Subtract(p,f)),v=this.m_invMassA,y=this.m_invMassB,x=this.m_invIA,C=this.m_invIB;this.m_axis=b(d,this.m_localXAxisA),this.m_a1=u(r.Add(g,f),this.m_axis),this.m_a2=u(p,this.m_axis),this.m_motorMass=v+y+x*this.m_a1*this.m_a1+C*this.m_a2*this.m_a2,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass),this.m_perp=b(d,this.m_localYAxisA),this.m_s1=u(r.Add(g,f),this.m_perp),this.m_s2=u(p,this.m_perp);var A=v+y+x*this.m_s1*this.m_s1+C*this.m_s2*this.m_s2,T=x*this.m_s1+C*this.m_s2,w=x*this.m_s1*this.m_a1+C*this.m_s2*this.m_a2,S=x+C;0==S&&(S=1);var E=x*this.m_a1+C*this.m_a2,I=v+y+x*this.m_a1*this.m_a1+C*this.m_a2*this.m_a2;if(this.m_K.ex.Set(A,T,w),this.m_K.ey.Set(T,S,E),this.m_K.ez.Set(w,E,I),this.m_enableLimit){var R=_(this.m_axis,g);ri(this.m_upperTranslation-this.m_lowerTranslation)<2*Ue?this.m_limitState=de.e_equalLimits:R<=this.m_lowerTranslation?this.m_limitState!=de.e_atLowerLimit&&(this.m_limitState=de.e_atLowerLimit,this.m_impulse.z=0):R>=this.m_upperTranslation?this.m_limitState!=de.e_atUpperLimit&&(this.m_limitState=de.e_atUpperLimit,this.m_impulse.z=0):(this.m_limitState=de.e_inactiveLimit,this.m_impulse.z=0)}else this.m_limitState=de.e_inactiveLimit,this.m_impulse.z=0;if(0==this.m_enableMotor&&(this.m_motorImpulse=0),t.step.warmStarting){this.m_impulse.Multiply(t.step.dtRatio),this.m_motorImpulse*=t.step.dtRatio;var P=r.Add(r.Multiply(this.m_impulse.x,this.m_perp),r.Multiply(this.m_motorImpulse+this.m_impulse.z,this.m_axis)),B=this.m_impulse.x*this.m_s1+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a1,L=this.m_impulse.x*this.m_s2+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a2;n.Subtract(r.Multiply(v,P)),s-=x*B,h.Add(r.Multiply(y,P)),l+=C*L}else this.m_impulse.SetZero(),this.m_motorImpulse=0;t.velocities[this.m_indexA].v.Assign(n),t.velocities[this.m_indexA].w=s,t.velocities[this.m_indexB].v.Assign(h),t.velocities[this.m_indexB].w=l},SolveVelocityConstraints:function(t){var e=t.velocities[this.m_indexA].v.Clone(),i=t.velocities[this.m_indexA].w,n=t.velocities[this.m_indexB].v.Clone(),o=t.velocities[this.m_indexB].w,a=this.m_invMassA,c=this.m_invMassB,h=this.m_invIA,l=this.m_invIB;if(this.m_enableMotor&&this.m_limitState!=de.e_equalLimits){var u=_(this.m_axis,r.Subtract(n,e))+this.m_a2*o-this.m_a1*i,d=this.m_motorMass*(this.m_motorSpeed-u),m=this.m_motorImpulse,f=t.step.dt*this.m_maxMotorForce;this.m_motorImpulse=L(this.m_motorImpulse+d,-f,f),d=this.m_motorImpulse-m;var p=r.Multiply(d,this.m_axis),g=d*this.m_a1,v=d*this.m_a2;e.Subtract(r.Multiply(a,p)),i-=h*g,n.Add(r.Multiply(c,p)),o+=l*v}var y=new r;if(y.x=_(this.m_perp,r.Subtract(n,e))+this.m_s2*o-this.m_s1*i,y.y=o-i,this.m_enableLimit&&this.m_limitState!=de.e_inactiveLimit){var x;x=_(this.m_axis,r.Subtract(n,e))+this.m_a2*o-this.m_a1*i;u=new s(y.x,y.y,x);var C=this.m_impulse.Clone(),A=this.m_K.Solve33(u.Negate());this.m_impulse.Add(A),this.m_limitState==de.e_atLowerLimit?this.m_impulse.z=oi(this.m_impulse.z,0):this.m_limitState==de.e_atUpperLimit&&(this.m_impulse.z=si(this.m_impulse.z,0));var T=r.Subtract(y.Negate(),r.Multiply(this.m_impulse.z-C.z,new r(this.m_K.ez.x,this.m_K.ez.y))),b=r.Add(this.m_K.Solve22(T),new r(C.x,C.y));this.m_impulse.x=b.x,this.m_impulse.y=b.y,A=s.Subtract(this.m_impulse,C);p=r.Add(r.Multiply(A.x,this.m_perp),r.Multiply(A.z,this.m_axis)),g=A.x*this.m_s1+A.y+A.z*this.m_a1,v=A.x*this.m_s2+A.y+A.z*this.m_a2;e.Subtract(r.Multiply(a,p)),i-=h*g,n.Add(r.Multiply(c,p)),o+=l*v}else{A=this.m_K.Solve22(y.Negate());this.m_impulse.x+=A.x,this.m_impulse.y+=A.y;p=r.Multiply(A.x,this.m_perp),g=A.x*this.m_s1+A.y,v=A.x*this.m_s2+A.y;e.Subtract(r.Multiply(a,p)),i-=h*g,n.Add(r.Multiply(c,p)),o+=l*v}t.velocities[this.m_indexA].v.Assign(e),t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].v.Assign(n),t.velocities[this.m_indexB].w=o},SolvePositionConstraints:function(t){var e=t.positions[this.m_indexA].c.Clone(),i=t.positions[this.m_indexA].a,n=t.positions[this.m_indexB].c.Clone(),h=t.positions[this.m_indexB].a,l=new c(i),d=new c(h),m=this.m_invMassA,f=this.m_invMassB,p=this.m_invIA,g=this.m_invIB,v=b(l,r.Subtract(this.m_localAnchorA,this.m_localCenterA)),y=b(d,r.Subtract(this.m_localAnchorB,this.m_localCenterB)),x=r.Subtract(r.Subtract(r.Add(n,y),e),v),C=b(l,this.m_localXAxisA),A=u(r.Add(x,v),C),T=u(y,C),w=b(l,this.m_localYAxisA),S=u(r.Add(x,v),w),E=u(y,w),I=new s,R=new r;R.x=_(w,x),R.y=h-i-this.m_referenceAngle;var P=ri(R.x),B=ri(R.y),O=!1,D=0;if(this.m_enableLimit){var N=_(C,x);ri(this.m_upperTranslation-this.m_lowerTranslation)<2*Ue?(D=L(N,-.2,.2),P=oi(P,ri(N)),O=!0):N<=this.m_lowerTranslation?(D=L(N-this.m_lowerTranslation+Ue,-.2,0),P=oi(P,this.m_lowerTranslation-N),O=!0):N>=this.m_upperTranslation&&(D=L(N-this.m_upperTranslation-Ue,0,.2),P=oi(P,N-this.m_upperTranslation),O=!0)}if(O){var M=m+f+p*S*S+g*E*E,F=p*S+g*E,z=p*S*A+g*E*T;0==(W=p+g)&&(W=1);var G=p*A+g*T,V=m+f+p*A*A+g*T*T;(U=new a).ex.Set(M,F,z),U.ey.Set(F,W,G),U.ez.Set(z,G,V);var k=new s;k.x=R.x,k.y=R.y,k.z=D,I=U.Solve33(k.Negate())}else{var W;M=m+f+p*S*S+g*E*E,F=p*S+g*E;0==(W=p+g)&&(W=1);var U;(U=new o).ex.Set(M,F),U.ey.Set(F,W);var j=U.Solve(R.Negate());I.x=j.x,I.y=j.y,I.z=0}var q=r.Add(r.Multiply(I.x,w),r.Multiply(I.z,C)),Y=I.x*S+I.y+I.z*A,X=I.x*E+I.y+I.z*T;return e.Subtract(r.Multiply(m,q)),i-=p*Y,n.Add(r.Multiply(f,q)),h+=g*X,t.positions[this.m_indexA].c.Assign(e),t.positions[this.m_indexA].a=i,t.positions[this.m_indexB].c.Assign(n),t.positions[this.m_indexB].a=h,P<=Ue&&B<=je},_serialize:function(t){var e=t||{};return this.parent.prototype._serialize.call(this,e),e.localAnchorA=this.m_localAnchorA._serialize(),e.localAnchorB=this.m_localAnchorB._serialize(),e.localAxisA=this.m_localXAxisA._serialize(),e.referenceAngle=this.m_referenceAngle,e.enableLimit=this.m_enableLimit,e.lowerTranslation=this.m_lowerTranslation,e.upperTranslation=this.m_upperTranslation,e.enableMotor=this.m_enableMotor,e.maxMotorForce=this.m_maxMotorForce,e.motorSpeed=this.m_motorSpeed,e}},Ce._extend(de),Ae.prototype={Initialize:function(t,e,i){this.bodyA=t,this.bodyB=e,this.localAnchorA.Assign(this.bodyA.GetLocalPoint(i)),this.localAnchorB.Assign(this.bodyB.GetLocalPoint(i))},_deserialize:function(t,e,i){this.parent.prototype._deserialize.call(this,t,e,i),this.localAnchorA._deserialize(t.localAnchorA),this.localAnchorB._deserialize(t.localAnchorB),this.maxForce=t.maxForce,this.maxTorque=t.maxTorque}},Ae._extend(ue),Te.prototype={GetAnchorA:function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)},GetAnchorB:function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},GetReactionForce:function(t){return r.Multiply(t,this.m_linearImpulse)},GetReactionTorque:function(t){return t*this.m_angularImpulse},GetLocalAnchorA:function(){return this.m_localAnchorA},GetLocalAnchorB:function(){return this.m_localAnchorB},SetMaxForce:function(e){t(n(e)&&e>=0),this.m_maxForce=e},GetMaxForce:function(){return this.m_maxForce},SetMaxTorque:function(e){t(n(e)&&e>=0),this.m_maxTorque=e},GetMaxTorque:function(){return this.m_maxTorque},InitVelocityConstraints:function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Assign(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Assign(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=t.positions[this.m_indexA].a,i=t.velocities[this.m_indexA].v.Clone(),n=t.velocities[this.m_indexA].w,s=t.positions[this.m_indexB].a,a=t.velocities[this.m_indexB].v.Clone(),h=t.velocities[this.m_indexB].w,l=new c(e),_=new c(s);this.m_rA=b(l,r.Subtract(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=b(_,r.Subtract(this.m_localAnchorB,this.m_localCenterB));var d=this.m_invMassA,m=this.m_invMassB,f=this.m_invIA,p=this.m_invIB,g=new o;if(g.ex.x=d+m+f*this.m_rA.y*this.m_rA.y+p*this.m_rB.y*this.m_rB.y,g.ex.y=-f*this.m_rA.x*this.m_rA.y-p*this.m_rB.x*this.m_rB.y,g.ey.x=g.ex.y,g.ey.y=d+m+f*this.m_rA.x*this.m_rA.x+p*this.m_rB.x*this.m_rB.x,this.m_linearMass=g.GetInverse(),this.m_angularMass=f+p,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),t.step.warmStarting){this.m_linearImpulse.Multiply(t.step.dtRatio),this.m_angularImpulse*=t.step.dtRatio;var v=new r(this.m_linearImpulse.x,this.m_linearImpulse.y);i.Subtract(r.Multiply(d,v)),n-=f*(u(this.m_rA,v)+this.m_angularImpulse),a.Add(r.Multiply(m,v)),h+=p*(u(this.m_rB,v)+this.m_angularImpulse)}else this.m_linearImpulse.SetZero(),this.m_angularImpulse=0;t.velocities[this.m_indexA].v.Assign(i),t.velocities[this.m_indexA].w=n,t.velocities[this.m_indexB].v.Assign(a),t.velocities[this.m_indexB].w=h},SolveVelocityConstraints:function(t){var e=t.velocities[this.m_indexA].v.Clone(),i=t.velocities[this.m_indexA].w,n=t.velocities[this.m_indexB].v.Clone(),s=t.velocities[this.m_indexB].w,o=this.m_invMassA,a=this.m_invMassB,c=this.m_invIA,h=this.m_invIB,l=t.step.dt,_=s-i,d=-this.m_angularMass*_,p=this.m_angularImpulse,g=l*this.m_maxTorque;this.m_angularImpulse=L(this.m_angularImpulse+d,-g,g),i-=c*(d=this.m_angularImpulse-p);_=r.Add(n,r.Subtract(m(s+=h*d,this.m_rB),r.Subtract(e,m(i,this.m_rA)))),d=f(this.m_linearMass,_).Negate(),p=this.m_linearImpulse.Clone();this.m_linearImpulse.Add(d);g=l*this.m_maxForce;this.m_linearImpulse.LengthSquared()>g*g&&(this.m_linearImpulse.Normalize(),this.m_linearImpulse.Multiply(g)),d=r.Subtract(this.m_linearImpulse,p),e.Subtract(r.Multiply(o,d)),i-=c*u(this.m_rA,d),n.Add(r.Multiply(a,d)),s+=h*u(this.m_rB,d),t.velocities[this.m_indexA].v.Assign(e),t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].v.Assign(n),t.velocities[this.m_indexB].w=s},SolvePositionConstraints:function(t){return!0},_serialize:function(t){var e=t||{};return this.parent.prototype._serialize.call(this,e),e.localAnchorA=this.m_localAnchorA._serialize(),e.localAnchorB=this.m_localAnchorB._serialize(),e.maxForce=this.m_maxForce,e.maxTorque=this.m_maxTorque,e}},Te._extend(de),be.prototype={Initialize:function(t,e,i){this.bodyA=t,this.bodyB=e,this.localAnchorA.Assign(this.bodyA.GetLocalPoint(i)),this.localAnchorB.Assign(this.bodyB.GetLocalPoint(i)),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()},_deserialize:function(t,e,i){this.parent.prototype._deserialize.call(this,t,e,i),this.localAnchorA._deserialize(t.localAnchorA),this.localAnchorB._deserialize(t.localAnchorB),this.referenceAngle=t.referenceAngle,this.frequencyHz=t.frequencyHz,this.dampingRatio=t.dampingRatio}},be._extend(ue),we.prototype={GetAnchorA:function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)},GetAnchorB:function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},GetReactionForce:function(t){var e=new r(this.m_impulse.x,this.m_impulse.y);return r.Multiply(t,e)},GetReactionTorque:function(t){return t*this.m_impulse.z},GetLocalAnchorA:function(){return this.m_localAnchorA},GetLocalAnchorB:function(){return this.m_localAnchorB},GetReferenceAngle:function(){return this.m_referenceAngle},SetFrequency:function(t){this.m_frequencyHz=t},GetFrequency:function(){return this.m_frequencyHz},SetDampingRatio:function(t){this.m_dampingRatio=t},GetDampingRatio:function(){return this.m_dampingRatio},InitVelocityConstraints:function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Assign(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Assign(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=t.positions[this.m_indexA].a,i=t.velocities[this.m_indexA].v.Clone(),n=t.velocities[this.m_indexA].w,s=t.positions[this.m_indexB].a,o=t.velocities[this.m_indexB].v.Clone(),h=t.velocities[this.m_indexB].w,l=new c(e),_=new c(s);this.m_rA.Assign(b(l,r.Subtract(this.m_localAnchorA,this.m_localCenterA))),this.m_rB.Assign(b(_,r.Subtract(this.m_localAnchorB,this.m_localCenterB)));var d=this.m_invMassA,m=this.m_invMassB,f=this.m_invIA,p=this.m_invIB,g=new a;if(g.ex.x=d+m+this.m_rA.y*this.m_rA.y*f+this.m_rB.y*this.m_rB.y*p,g.ey.x=-this.m_rA.y*this.m_rA.x*f-this.m_rB.y*this.m_rB.x*p,g.ez.x=-this.m_rA.y*f-this.m_rB.y*p,g.ex.y=g.ey.x,g.ey.y=d+m+this.m_rA.x*this.m_rA.x*f+this.m_rB.x*this.m_rB.x*p,g.ez.y=this.m_rA.x*f+this.m_rB.x*p,g.ex.z=g.ez.x,g.ey.z=g.ez.y,g.ez.z=f+p,this.m_frequencyHz>0){g.GetInverse22(this.m_mass);var v=f+p,y=v>0?1/v:0,x=s-e-this.m_referenceAngle,C=2*Ve*this.m_frequencyHz,A=2*y*this.m_dampingRatio*C,T=y*C*C,w=t.step.dt;this.m_gamma=w*(A+w*T),this.m_gamma=0!=this.m_gamma?1/this.m_gamma:0,this.m_bias=x*w*T*this.m_gamma,v+=this.m_gamma,this.m_mass.ez.z=0!=v?1/v:0}else 0==g.ez.z?(g.GetInverse22(this.m_mass),this.m_gamma=0,this.m_bias=0):(g.GetSymInverse33(this.m_mass),this.m_gamma=0,this.m_bias=0);if(t.step.warmStarting){this.m_impulse.Multiply(t.step.dtRatio);var S=new r(this.m_impulse.x,this.m_impulse.y);i.Subtract(r.Multiply(d,S)),n-=f*(u(this.m_rA,S)+this.m_impulse.z),o.Add(r.Multiply(m,S)),h+=p*(u(this.m_rB,S)+this.m_impulse.z)}else this.m_impulse.SetZero();t.velocities[this.m_indexA].v.Assign(i),t.velocities[this.m_indexA].w=n,t.velocities[this.m_indexB].v.Assign(o),t.velocities[this.m_indexB].w=h},SolveVelocityConstraints:function(t){var e=t.velocities[this.m_indexA].v.Clone(),i=t.velocities[this.m_indexA].w,n=t.velocities[this.m_indexB].v.Clone(),o=t.velocities[this.m_indexB].w,a=this.m_invMassA,c=this.m_invMassB,h=this.m_invIA,l=this.m_invIB;if(this.m_frequencyHz>0){var _=o-i,d=-this.m_mass.ez.z*(_+this.m_bias+this.m_gamma*this.m_impulse.z);this.m_impulse.z+=d,i-=h*d;var f=r.Subtract(r.Subtract(r.Add(n,m(o+=l*d,this.m_rB)),e),m(i,this.m_rA)),p=C(this.m_mass,f).Negate();this.m_impulse.x+=p.x,this.m_impulse.y+=p.y;var g=p.Clone();e.Subtract(r.Multiply(a,g)),i-=h*u(this.m_rA,g),n.Add(r.Multiply(c,g)),o+=l*u(this.m_rB,g)}else{_=o-i;var v=new s((f=r.Subtract(r.Subtract(r.Add(n,m(o,this.m_rB)),e),m(i,this.m_rA))).x,f.y,_),y=x(this.m_mass,v).Negate();this.m_impulse.Add(y);g=new r(y.x,y.y);e.Subtract(r.Multiply(a,g)),i-=h*(u(this.m_rA,g)+y.z),n.Add(r.Multiply(c,g)),o+=l*(u(this.m_rB,g)+y.z)}t.velocities[this.m_indexA].v.Assign(e),t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].v.Assign(n),t.velocities[this.m_indexB].w=o},SolvePositionConstraints:function(t){var e,i,n=t.positions[this.m_indexA].c.Clone(),o=t.positions[this.m_indexA].a,h=t.positions[this.m_indexB].c.Clone(),l=t.positions[this.m_indexB].a,_=new c(o),d=new c(l),m=this.m_invMassA,f=this.m_invMassB,p=this.m_invIA,g=this.m_invIB,v=b(_,r.Subtract(this.m_localAnchorA,this.m_localCenterA)),y=b(d,r.Subtract(this.m_localAnchorB,this.m_localCenterB)),x=new a;if(x.ex.x=m+f+v.y*v.y*p+y.y*y.y*g,x.ey.x=-v.y*v.x*p-y.y*y.x*g,x.ez.x=-v.y*p-y.y*g,x.ex.y=x.ey.x,x.ey.y=m+f+v.x*v.x*p+y.x*y.x*g,x.ez.y=v.x*p+y.x*g,x.ex.z=x.ez.x,x.ey.z=x.ez.y,x.ez.z=p+g,this.m_frequencyHz>0){e=(A=r.Subtract(r.Subtract(r.Add(h,y),n),v)).Length(),i=0;var C=x.Solve22(A).Negate();n.Subtract(r.Multiply(m,C)),o-=p*u(v,C),h.Add(r.Multiply(f,C)),l+=g*u(y,C)}else{var A=r.Subtract(r.Subtract(r.Add(h,y),n),v),T=l-o-this.m_referenceAngle;e=A.Length(),i=ri(T);var w,S=new s(A.x,A.y,T);if(x.ez.z>0)w=x.Solve33(S).Invert();else{var E=x.Solve22(A).Invert();w=new s(E.x,E.y,0)}C=new r(w.x,w.y);n.Subtract(r.Multiply(m,C)),o-=p*(u(v,C)+w.z),h.Add(r.Multiply(f,C)),l+=g*(u(y,C)+w.z)}return t.positions[this.m_indexA].c.Assign(n),t.positions[this.m_indexA].a=o,t.positions[this.m_indexB].c.Assign(h),t.positions[this.m_indexB].a=l,e<=Ue&&i<=je},_serialize:function(t){var e=t||{};return this.parent.prototype._serialize.call(this,e),e.localAnchorA=this.m_localAnchorA._serialize(),e.localAnchorB=this.m_localAnchorB._serialize(),e.referenceAngle=this.m_referenceAngle,e.frequencyHz=this.m_frequencyHz,e.dampingRatio=this.m_dampingRatio,e}},we._extend(de),Se.prototype={Initialize:function(t,e,i,n){this.bodyA=t,this.bodyB=e,this.localAnchorA.Assign(this.bodyA.GetLocalPoint(i)),this.localAnchorB.Assign(this.bodyB.GetLocalPoint(i)),this.localAxisA.Assign(this.bodyA.GetLocalVector(n))},_deserialize:function(t,e,i){this.parent.prototype._deserialize.call(this,t,e,i),this.localAnchorA._deserialize(t.localAnchorA),this.localAnchorB._deserialize(t.localAnchorB),this.localAxisA._deserialize(t.localAxisA),this.enableMotor=t.enableMotor,this.maxMotorTorque=t.maxMotorTorque,this.motorSpeed=t.motorSpeed,this.frequencyHz=t.frequencyHz,this.dampingRatio=t.dampingRatio}},Se._extend(ue),Ee.prototype={GetAnchorA:function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)},GetAnchorB:function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},GetReactionForce:function(t){return r.Multiply(t,r.Add(r.Multiply(this.m_impulse,this.m_ay),r.Multiply(this.m_springImpulse,this.m_ax)))},GetReactionTorque:function(t){return t*this.m_motorImpulse},GetLocalAnchorA:function(){return this.m_localAnchorA},GetLocalAnchorB:function(){return this.m_localAnchorB},GetLocalAxisA:function(){return this.m_localXAxisA},GetJointTranslation:function(){var t=this.m_bodyA,e=this.m_bodyB,i=t.GetWorldPoint(this.m_localAnchorA),n=e.GetWorldPoint(this.m_localAnchorB);return _(r.Subtract(n,i),t.GetWorldVector(this.m_localXAxisA))},GetJointSpeed:function(){var t=this.m_bodyA.m_angularVelocity;return this.m_bodyB.m_angularVelocity-t},IsMotorEnabled:function(){return this.m_enableMotor},EnableMotor:function(t){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=t},SetMotorSpeed:function(t){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=t},GetMotorSpeed:function(){return this.m_motorSpeed},SetMaxMotorTorque:function(t){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorTorque=t},GetMaxMotorTorque:function(){return this.m_maxMotorTorque},GetMotorTorque:function(t){return t*this.m_motorImpulse},SetSpringFrequencyHz:function(t){this.m_frequencyHz=t},GetSpringFrequencyHz:function(){return this.m_frequencyHz},SetSpringDampingRatio:function(t){this.m_dampingRatio=t},GetSpringDampingRatio:function(){return this.m_dampingRatio},InitVelocityConstraints:function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Assign(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Assign(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=this.m_invMassA,i=this.m_invMassB,n=this.m_invIA,s=this.m_invIB,o=t.positions[this.m_indexA].c.Clone(),a=t.positions[this.m_indexA].a,h=t.velocities[this.m_indexA].v.Clone(),l=t.velocities[this.m_indexA].w,d=t.positions[this.m_indexB].c.Clone(),m=t.positions[this.m_indexB].a,f=t.velocities[this.m_indexB].v.Clone(),p=t.velocities[this.m_indexB].w,g=new c(a),v=new c(m),y=b(g,r.Subtract(this.m_localAnchorA,this.m_localCenterA)),x=b(v,r.Subtract(this.m_localAnchorB,this.m_localCenterB)),C=r.Subtract(r.Subtract(r.Add(d,x),o),y);if(this.m_ay.Assign(b(g,this.m_localYAxisA)),this.m_sAy=u(r.Add(C,y),this.m_ay),this.m_sBy=u(x,this.m_ay),this.m_mass=e+i+n*this.m_sAy*this.m_sAy+s*this.m_sBy*this.m_sBy,this.m_mass>0&&(this.m_mass=1/this.m_mass),this.m_springMass=0,this.m_bias=0,this.m_gamma=0,this.m_frequencyHz>0){this.m_ax.Assign(b(g,this.m_localXAxisA)),this.m_sAx=u(r.Add(C,y),this.m_ax),this.m_sBx=u(x,this.m_ax);var A=e+i+n*this.m_sAx*this.m_sAx+s*this.m_sBx*this.m_sBx;if(A>0){this.m_springMass=1/A;var T=_(C,this.m_ax),w=2*Ve*this.m_frequencyHz,S=(C=2*this.m_springMass*this.m_dampingRatio*w,this.m_springMass*w*w),E=t.step.dt;this.m_gamma=E*(C+E*S),this.m_gamma>0&&(this.m_gamma=1/this.m_gamma),this.m_bias=T*E*S*this.m_gamma,this.m_springMass=A+this.m_gamma,this.m_springMass>0&&(this.m_springMass=1/this.m_springMass)}}else this.m_springImpulse=0;if(this.m_enableMotor?(this.m_motorMass=n+s,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass)):(this.m_motorMass=0,this.m_motorImpulse=0),t.step.warmStarting){this.m_impulse*=t.step.dtRatio,this.m_springImpulse*=t.step.dtRatio,this.m_motorImpulse*=t.step.dtRatio;var I=r.Add(r.Multiply(this.m_impulse,this.m_ay),r.Multiply(this.m_springImpulse,this.m_ax)),R=this.m_impulse*this.m_sAy+this.m_springImpulse*this.m_sAx+this.m_motorImpulse,P=this.m_impulse*this.m_sBy+this.m_springImpulse*this.m_sBx+this.m_motorImpulse;h.Subtract(r.Multiply(this.m_invMassA,I)),l-=this.m_invIA*R,f.Add(r.Multiply(this.m_invMassB,I)),p+=this.m_invIB*P}else this.m_impulse=0,this.m_springImpulse=0,this.m_motorImpulse=0;t.velocities[this.m_indexA].v.Assign(h),t.velocities[this.m_indexA].w=l,t.velocities[this.m_indexB].v.Assign(f),t.velocities[this.m_indexB].w=p},SolveVelocityConstraints:function(t){var e=this.m_invMassA,i=this.m_invMassB,n=this.m_invIA,s=this.m_invIB,o=t.velocities[this.m_indexA].v.Clone(),a=t.velocities[this.m_indexA].w,c=t.velocities[this.m_indexB].v.Clone(),h=t.velocities[this.m_indexB].w,l=_(this.m_ax,r.Subtract(c,o))+this.m_sBx*h-this.m_sAx*a,u=-this.m_springMass*(l+this.m_bias+this.m_gamma*this.m_springImpulse);this.m_springImpulse+=u;var d=r.Multiply(u,this.m_ax),m=u*this.m_sAx,f=u*this.m_sBx;o.Subtract(r.Multiply(e,d)),a-=n*m,c.Add(r.Multiply(i,d));l=(h+=s*f)-a-this.m_motorSpeed,u=-this.m_motorMass*l;var p=this.m_motorImpulse,g=t.step.dt*this.m_maxMotorTorque;this.m_motorImpulse=L(this.m_motorImpulse+u,-g,g),a-=n*(u=this.m_motorImpulse-p),h+=s*u;l=_(this.m_ay,r.Subtract(c,o))+this.m_sBy*h-this.m_sAy*a,u=-this.m_mass*l;this.m_impulse+=u;d=r.Multiply(u,this.m_ay),m=u*this.m_sAy,f=u*this.m_sBy;o.Subtract(r.Multiply(e,d)),a-=n*m,c.Add(r.Multiply(i,d)),h+=s*f,t.velocities[this.m_indexA].v.Assign(o),t.velocities[this.m_indexA].w=a,t.velocities[this.m_indexB].v.Assign(c),t.velocities[this.m_indexB].w=h},SolvePositionConstraints:function(t){var e,i=t.positions[this.m_indexA].c.Clone(),n=t.positions[this.m_indexA].a,s=t.positions[this.m_indexB].c.Clone(),o=t.positions[this.m_indexB].a,a=new c(n),h=new c(o),l=b(a,r.Subtract(this.m_localAnchorA,this.m_localCenterA)),d=b(h,r.Subtract(this.m_localAnchorB,this.m_localCenterB)),m=r.Add(r.Subtract(s,i),r.Subtract(d,l)),f=b(a,this.m_localYAxisA),p=u(r.Add(m,l),f),g=u(d,f),v=_(m,f),y=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_sAy*this.m_sAy+this.m_invIB*this.m_sBy*this.m_sBy,x=r.Multiply(e=0!=y?-v/y:0,f),C=e*p,A=e*g;return i.Subtract(r.Multiply(this.m_invMassA,x)),n-=this.m_invIA*C,s.Add(r.Multiply(this.m_invMassB,x)),o+=this.m_invIB*A,t.positions[this.m_indexA].c.Assign(i),t.positions[this.m_indexA].a=n,t.positions[this.m_indexB].c.Assign(s),t.positions[this.m_indexB].a=o,ri(v)<=Ue},_serialize:function(t){var e=t||{};return this.parent.prototype._serialize.call(this,e),e.localAnchorA=this.m_localAnchorA._serialize(),e.localAnchorB=this.m_localAnchorB._serialize(),e.localAxisA=this.m_localAxisA._serialize(),e.enableMotor=this.m_enableMotor,e.maxMotorTorque=this.m_maxMotorTorque,e.motorSpeed=this.m_motorSpeed,e.frequencyHz=this.m_frequencyHz,e.dampingRatio=this.m_dampingRatio,e}},Ee._extend(de),Ie.prototype={_deserialize:function(t,e,i){this.parent.prototype._deserialize.call(this,t,e,i),this.joint1=t.joint1,this.joint2=t.joint2,this.ratio=t.ratio}},Ie._extend(ue),Re.prototype={GetAnchorA:function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)},GetAnchorB:function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},GetReactionForce:function(t){var e=r.Multiply(this.m_impulse,this.m_JvAC);return r.Multiply(t,e)},GetReactionTorque:function(t){return t*(this.m_impulse*this.m_JwA)},GetJoint1:function(){return this.m_joint1},GetJoint2:function(){return this.m_joint2},SetRatio:function(e){t(n(e)),this.m_ratio=e},GetRatio:function(){return this.m_ratio},InitVelocityConstraints:function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_indexC=this.m_bodyC.m_islandIndex,this.m_indexD=this.m_bodyD.m_islandIndex,this.m_lcA.Assign(this.m_bodyA.m_sweep.localCenter),this.m_lcB.Assign(this.m_bodyB.m_sweep.localCenter),this.m_lcC.Assign(this.m_bodyC.m_sweep.localCenter),this.m_lcD.Assign(this.m_bodyD.m_sweep.localCenter),this.m_mA=this.m_bodyA.m_invMass,this.m_mB=this.m_bodyB.m_invMass,this.m_mC=this.m_bodyC.m_invMass,this.m_mD=this.m_bodyD.m_invMass,this.m_iA=this.m_bodyA.m_invI,this.m_iB=this.m_bodyB.m_invI,this.m_iC=this.m_bodyC.m_invI,this.m_iD=this.m_bodyD.m_invI;var e=t.positions[this.m_indexA].a,i=t.velocities[this.m_indexA].v.Clone(),n=t.velocities[this.m_indexA].w,s=t.positions[this.m_indexB].a,o=t.velocities[this.m_indexB].v.Clone(),a=t.velocities[this.m_indexB].w,h=t.positions[this.m_indexC].a,l=t.velocities[this.m_indexC].v.Clone(),_=t.velocities[this.m_indexC].w,d=t.positions[this.m_indexD].a,m=t.velocities[this.m_indexD].v.Clone(),f=t.velocities[this.m_indexD].w,p=new c(e),g=new c(s),v=new c(h),y=new c(d);if(this.m_mass=0,this.m_typeA==de.e_revoluteJoint)this.m_JvAC.SetZero(),this.m_JwA=1,this.m_JwC=1,this.m_mass+=this.m_iA+this.m_iC;else{var x=b(v,this.m_localAxisC),C=b(v,r.Subtract(this.m_localAnchorC,this.m_lcC)),A=b(p,r.Subtract(this.m_localAnchorA,this.m_lcA));this.m_JvAC.Assign(x),this.m_JwC=u(C,x),this.m_JwA=u(A,x),this.m_mass+=this.m_mC+this.m_mA+this.m_iC*this.m_JwC*this.m_JwC+this.m_iA*this.m_JwA*this.m_JwA}if(this.m_typeB==de.e_revoluteJoint)this.m_JvBD.SetZero(),this.m_JwB=this.m_ratio,this.m_JwD=this.m_ratio,this.m_mass+=this.m_ratio*this.m_ratio*(this.m_iB+this.m_iD);else{x=b(y,this.m_localAxisD);var T=b(y,r.Subtract(this.m_localAnchorD,this.m_lcD)),w=b(g,r.Subtract(this.m_localAnchorB,this.m_lcB));this.m_JvBD.Assign(r.Multiply(this.m_ratio,x)),this.m_JwD=this.m_ratio*u(T,x),this.m_JwB=this.m_ratio*u(w,x),this.m_mass+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*this.m_JwD*this.m_JwD+this.m_iB*this.m_JwB*this.m_JwB}this.m_mass=this.m_mass>0?1/this.m_mass:0,t.step.warmStarting?(i.Add(r.Multiply(this.m_mA*this.m_impulse,this.m_JvAC)),n+=this.m_iA*this.m_impulse*this.m_JwA,o.Add(r.Multiply(this.m_mB*this.m_impulse,this.m_JvBD)),a+=this.m_iB*this.m_impulse*this.m_JwB,l.Subtract(r.Multiply(this.m_mC*this.m_impulse,this.m_JvAC)),_-=this.m_iC*this.m_impulse*this.m_JwC,m.Subtract(r.Multiply(this.m_mD*this.m_impulse,this.m_JvBD)),f-=this.m_iD*this.m_impulse*this.m_JwD):this.m_impulse=0,t.velocities[this.m_indexA].v.Assign(i),t.velocities[this.m_indexA].w=n,t.velocities[this.m_indexB].v.Assign(o),t.velocities[this.m_indexB].w=a,t.velocities[this.m_indexC].v.Assign(l),t.velocities[this.m_indexC].w=_,t.velocities[this.m_indexD].v.Assign(m),t.velocities[this.m_indexD].w=f},SolveVelocityConstraints:function(t){var e=t.velocities[this.m_indexA].v.Clone(),i=t.velocities[this.m_indexA].w,n=t.velocities[this.m_indexB].v.Clone(),s=t.velocities[this.m_indexB].w,o=t.velocities[this.m_indexC].v.Clone(),a=t.velocities[this.m_indexC].w,c=t.velocities[this.m_indexD].v.Clone(),h=t.velocities[this.m_indexD].w,l=_(this.m_JvAC,r.Subtract(e,o))+_(this.m_JvBD,r.Subtract(n,c));l+=this.m_JwA*i-this.m_JwC*a+(this.m_JwB*s-this.m_JwD*h);var u=-this.m_mass*l;this.m_impulse+=u,e.Add(r.Multiply(this.m_mA*u,this.m_JvAC)),i+=this.m_iA*u*this.m_JwA,n.Add(r.Multiply(this.m_mB*u,this.m_JvBD)),s+=this.m_iB*u*this.m_JwB,o.Subtract(r.Multiply(this.m_mC*u,this.m_JvAC)),a-=this.m_iC*u*this.m_JwC,c.Subtract(r.Multiply(this.m_mD*u,this.m_JvBD)),h-=this.m_iD*u*this.m_JwD,t.velocities[this.m_indexA].v.Assign(e),t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].v.Assign(n),t.velocities[this.m_indexB].w=s,t.velocities[this.m_indexC].v.Assign(o),t.velocities[this.m_indexC].w=a,t.velocities[this.m_indexD].v.Assign(c),t.velocities[this.m_indexD].w=h},SolvePositionConstraints:function(t){var e,i,n,s,o,a,h=t.positions[this.m_indexA].c.Clone(),l=t.positions[this.m_indexA].a,d=t.positions[this.m_indexB].c.Clone(),m=t.positions[this.m_indexB].a,f=t.positions[this.m_indexC].c.Clone(),p=t.positions[this.m_indexC].a,g=t.positions[this.m_indexD].c.Clone(),v=t.positions[this.m_indexD].a,y=new c(l),x=new c(m),C=new c(p),A=new c(v),T=new r,S=new r,E=0;if(this.m_typeA==de.e_revoluteJoint)T.SetZero(),n=1,o=1,E+=this.m_iA+this.m_iC,e=l-p-this.m_referenceAngleA;else{var I=b(C,this.m_localAxisC),R=b(C,r.Subtract(this.m_localAnchorC,this.m_lcC)),P=b(y,r.Subtract(this.m_localAnchorA,this.m_lcA));T.Assign(I),o=u(R,I),n=u(P,I),E+=this.m_mC+this.m_mA+this.m_iC*o*o+this.m_iA*n*n;var B=r.Subtract(this.m_localAnchorC,this.m_lcC),L=w(C,r.Add(P,r.Subtract(h,f)));e=_(r.Subtract(L,B),this.m_localAxisC)}if(this.m_typeB==de.e_revoluteJoint)S.SetZero(),s=this.m_ratio,a=this.m_ratio,E+=this.m_ratio*this.m_ratio*(this.m_iB+this.m_iD),i=m-v-this.m_referenceAngleB;else{I=b(A,this.m_localAxisD);var O=b(A,r.Subtract(this.m_localAnchorD,this.m_lcD)),D=b(x,r.Subtract(this.m_localAnchorB,this.m_lcB));S.Assign(r.Multiply(this.m_ratio,I)),a=this.m_ratio*u(O,I),s=this.m_ratio*u(D,I),E+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*a*a+this.m_iB*s*s;var N=r.Subtract(this.m_localAnchorD,this.m_lcD),M=w(A,r.Add(D,r.Subtract(d,g)));i=_(r.Subtract(M,N),this.m_localAxisD)}var F=e+this.m_ratio*i-this.m_constant,z=0;return E>0&&(z=-F/E),h.Add(r.Multiply(this.m_mA,r.Multiply(z,T))),l+=this.m_iA*z*n,d.Add(r.Multiply(this.m_mB,r.Multiply(z,S))),m+=this.m_iB*z*s,f.Subtract(r.Multiply(this.m_mC,r.Multiply(z,T))),p-=this.m_iC*z*o,g.Subtract(r.Multiply(this.m_mD,r.Multiply(z,S))),v-=this.m_iD*z*a,t.positions[this.m_indexA].c.Assign(h),t.positions[this.m_indexA].a=l,t.positions[this.m_indexB].c.Assign(d),t.positions[this.m_indexB].a=m,t.positions[this.m_indexC].c.Assign(f),t.positions[this.m_indexC].a=p,t.positions[this.m_indexD].c.Assign(g),t.positions[this.m_indexD].a=v,0<Ue},_serialize:function(t){var e=t||{};return this.parent.prototype._serialize.call(this,e),e.joint1=this.m_joint1.__temp_joint_id,e.joint2=this.m_joint2.__temp_joint_id,e.ratio=this.m_ratio,e}},Re._extend(de),Pe.prototype={Initialize:function(t,e){this.bodyA=t,this.bodyB=e;var i=this.bodyB.GetPosition();this.linearOffset.Assign(this.bodyA.GetLocalPoint(i));var n=this.bodyA.GetAngle(),r=this.bodyB.GetAngle();this.angularOffset=r-n},_deserialize:function(t,e,i){this.parent.prototype._deserialize.call(this,t,e,i),this.linearOffset._deserialize(t.linearOffset),this.angularOffset=t.angularOffset,this.maxForce=t.maxForce,this.maxTorque=t.maxTorque,this.correctionFactor=t.correctionFactor}},Pe._extend(ue),Be.prototype={GetAnchorA:function(){return this.m_bodyA.GetPosition()},GetAnchorB:function(){return this.m_bodyB.GetPosition()},GetReactionForce:function(t){return r.Multiply(t,this.m_linearImpulse)},GetReactionTorque:function(t){return t*this.m_angularImpulse},SetLinearOffset:function(t){t.x==this.m_linearOffset.x&&t.y==this.m_linearOffset.y||(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_linearOffset.Assign(t))},GetLinearOffset:function(){return this.m_linearOffset},SetAngularOffset:function(t){t!=this.m_angularOffset&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_angularOffset=t)},GetAngularOffset:function(){return this.m_angularOffset},SetMaxForce:function(e){t(n(e)&&e>=0),this.m_maxForce=e},GetMaxForce:function(){return this.m_maxForce},SetMaxTorque:function(e){t(n(e)&&e>=0),this.m_maxTorque=e},GetMaxTorque:function(){return this.m_maxTorque},SetCorrectionFactor:function(e){t(n(e)&&0<=e&&e<=1),this.m_correctionFactor=e},GetCorrectionFactor:function(){return this.m_correctionFactor},InitVelocityConstraints:function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Assign(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Assign(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=t.positions[this.m_indexA].c.Clone(),i=t.positions[this.m_indexA].a,n=t.velocities[this.m_indexA].v.Clone(),s=t.velocities[this.m_indexA].w,a=t.positions[this.m_indexB].c.Clone(),h=t.positions[this.m_indexB].a,l=t.velocities[this.m_indexB].v.Clone(),_=t.velocities[this.m_indexB].w,d=new c(i),m=new c(h);this.m_rA.Assign(b(d,this.m_localCenterA.Negate())),this.m_rB.Assign(b(m,this.m_localCenterB.Negate()));var f=this.m_invMassA,p=this.m_invMassB,g=this.m_invIA,v=this.m_invIB,y=new o;if(y.ex.x=f+p+g*this.m_rA.y*this.m_rA.y+v*this.m_rB.y*this.m_rB.y,y.ex.y=-g*this.m_rA.x*this.m_rA.y-v*this.m_rB.x*this.m_rB.y,y.ey.x=y.ex.y,y.ey.y=f+p+g*this.m_rA.x*this.m_rA.x+v*this.m_rB.x*this.m_rB.x,this.m_linearMass.Assign(y.GetInverse()),this.m_angularMass=g+v,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),this.m_linearError.x=a.x+this.m_rB.x-e.x-this.m_rA.x-(d.c*this.m_linearOffset.x-d.s*this.m_linearOffset.y),this.m_linearError.y=a.y+this.m_rB.y-e.y-this.m_rA.y-(d.s*this.m_linearOffset.x+d.c*this.m_linearOffset.y),this.m_angularError=h-i-this.m_angularOffset,t.step.warmStarting){this.m_linearImpulse.Multiply(t.step.dtRatio),this.m_angularImpulse*=t.step.dtRatio;var x=new r(this.m_linearImpulse.x,this.m_linearImpulse.y);n.Subtract(r.Multiply(f,x)),s-=g*(u(this.m_rA,x)+this.m_angularImpulse),l.Add(r.Multiply(p,x)),_+=v*(u(this.m_rB,x)+this.m_angularImpulse)}else this.m_linearImpulse.SetZero(),this.m_angularImpulse=0;t.velocities[this.m_indexA].v.Assign(n),t.velocities[this.m_indexA].w=s,t.velocities[this.m_indexB].v.Assign(l),t.velocities[this.m_indexB].w=_},SolveVelocityConstraints:function(t){var e=t.velocities[this.m_indexA].v.Clone(),i=t.velocities[this.m_indexA].w,n=t.velocities[this.m_indexB].v.Clone(),s=t.velocities[this.m_indexB].w,o=this.m_invMassA,a=this.m_invMassB,c=this.m_invIA,h=this.m_invIB,l=t.step.dt,_=t.step.inv_dt,d=s-i+_*this.m_correctionFactor*this.m_angularError,m=-this.m_angularMass*d,p=this.m_angularImpulse,g=l*this.m_maxTorque;this.m_angularImpulse=L(this.m_angularImpulse+m,-g,g),i-=c*(m=this.m_angularImpulse-p),s+=h*m;d=new r(n.x+-s*this.m_rB.x-e.x- -i*this.m_rA.x+_*this.m_correctionFactor*this.m_linearError.x,n.y+s*this.m_rB.y-e.y-i*this.m_rA.y+_*this.m_correctionFactor*this.m_linearError.y),m=f(this.m_linearMass,d).Negate(),p=this.m_linearImpulse.Clone();this.m_linearImpulse.Add(m);g=l*this.m_maxForce;this.m_linearImpulse.LengthSquared()>g*g&&(this.m_linearImpulse.Normalize(),this.m_linearImpulse.Multiply(g)),m.Assign(r.Subtract(this.m_linearImpulse,p)),e.Subtract(r.Multiply(o,m)),i-=c*u(this.m_rA,m),n.Add(r.Multiply(a,m)),s+=h*u(this.m_rB,m),t.velocities[this.m_indexA].v.Assign(e),t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].v.Assign(n),t.velocities[this.m_indexB].w=s},SolvePositionConstraints:function(t){return!0},_serialize:function(t){var e=t||{};return this.parent.prototype._serialize.call(this,e),e.linearOffset=this.m_linearOffset._serialize(),e.angularOffset=this.m_angularOffset,e.maxForce=this.m_maxForce,e.maxTorque=this.m_maxTorque,e.correctionFactor=this.m_correctionFactor,e}},Be._extend(de);Le.prototype={Initialize:function(e,i,n,s,o,a,c){this.bodyA=e,this.bodyB=i,this.groundAnchorA.Assign(n),this.groundAnchorB.Assign(s),this.localAnchorA.Assign(this.bodyA.GetLocalPoint(o)),this.localAnchorB.Assign(this.bodyB.GetLocalPoint(a));var h=r.Subtract(o,n);this.lengthA=h.Length();var l=r.Subtract(a,s);this.lengthB=l.Length(),this.ratio=c,t(this.ratio>Ge)},_deserialize:function(t,e,i){this.parent.prototype._deserialize.call(this,t,e,i),this.groundAnchorA._deserialize(t.groundAnchorA),this.groundAnchorB._deserialize(t.groundAnchorB),this.localAnchorA._deserialize(t.localAnchorA),this.localAnchorB._deserialize(t.localAnchorB),this.lengthA=t.lengthA,this.lengthB=t.lengthB,this.ratio=t.ratio}},Le._extend(ue),Oe.prototype={GetAnchorA:function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)},GetAnchorB:function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},GetReactionForce:function(t){var e=r.Multiply(this.m_impulse,this.m_uB);return r.Multiply(t,e)},GetReactionTorque:function(t){return 0},GetGroundAnchorA:function(){return this.m_groundAnchorA},GetGroundAnchorB:function(){return this.m_groundAnchorB},GetLengthA:function(){return this.m_lengthA},GetLengthB:function(){return this.m_lengthB},GetRatio:function(){return this.m_ratio},GetCurrentLengthA:function(){var t=this.m_bodyA.GetWorldPoint(this.m_localAnchorA),e=this.m_groundAnchorA;return r.Subtract(t,e).Length()},GetCurrentLengthB:function(){var t=this.m_bodyB.GetWorldPoint(this.m_localAnchorB),e=this.m_groundAnchorB;return r.Subtract(t,e).Length()},ShiftOrigin:function(t){this.m_groundAnchorA.Subtract(t),this.m_groundAnchorB.Subtract(t)},InitVelocityConstraints:function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Assign(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Assign(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=t.positions[this.m_indexA].c.Clone(),i=t.positions[this.m_indexA].a,n=t.velocities[this.m_indexA].v.Clone(),s=t.velocities[this.m_indexA].w,o=t.positions[this.m_indexB].c.Clone(),a=t.positions[this.m_indexB].a,h=t.velocities[this.m_indexB].v.Clone(),l=t.velocities[this.m_indexB].w,_=new c(i),d=new c(a);this.m_rA.Assign(b(_,r.Subtract(this.m_localAnchorA,this.m_localCenterA))),this.m_rB.Assign(b(d,r.Subtract(this.m_localAnchorB,this.m_localCenterB))),this.m_uA.Assign(r.Add(e,r.Subtract(this.m_rA,this.m_groundAnchorA))),this.m_uB.Assign(r.Add(o,r.Subtract(this.m_rB,this.m_groundAnchorB)));var m=this.m_uA.Length(),f=this.m_uB.Length();m>10*Ue?this.m_uA.Multiply(1/m):this.m_uA.SetZero(),f>10*Ue?this.m_uB.Multiply(1/f):this.m_uB.SetZero();var p=u(this.m_rA,this.m_uA),g=u(this.m_rB,this.m_uB),v=this.m_invMassA+this.m_invIA*p*p,y=this.m_invMassB+this.m_invIB*g*g;if(this.m_mass=v+this.m_ratio*this.m_ratio*y,this.m_mass>0&&(this.m_mass=1/this.m_mass),t.step.warmStarting){this.m_impulse*=t.step.dtRatio;var x=r.Multiply(-this.m_impulse,this.m_uA),C=r.Multiply(-this.m_ratio*this.m_impulse,this.m_uB);n.Add(r.Multiply(this.m_invMassA,x)),s+=this.m_invIA*u(this.m_rA,x),h.Add(r.Multiply(this.m_invMassB,C)),l+=this.m_invIB*u(this.m_rB,C)}else this.m_impulse=0;t.velocities[this.m_indexA].v.Assign(n),t.velocities[this.m_indexA].w=s,t.velocities[this.m_indexB].v.Assign(h),t.velocities[this.m_indexB].w=l},SolveVelocityConstraints:function(t){var e=t.velocities[this.m_indexA].v.Clone(),i=t.velocities[this.m_indexA].w,n=t.velocities[this.m_indexB].v.Clone(),s=t.velocities[this.m_indexB].w,o=r.Add(e,m(i,this.m_rA)),a=r.Add(n,m(s,this.m_rB)),c=-_(this.m_uA,o)-this.m_ratio*_(this.m_uB,a),h=-this.m_mass*c;this.m_impulse+=h;var l=r.Multiply(-h,this.m_uA),d=r.Multiply(-this.m_ratio,r.Multiply(h,this.m_uB));e.Add(r.Multiply(this.m_invMassA,l)),i+=this.m_invIA*u(this.m_rA,l),n.Add(r.Multiply(this.m_invMassB,d)),s+=this.m_invIB*u(this.m_rB,d),t.velocities[this.m_indexA].v.Assign(e),t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].v.Assign(n),t.velocities[this.m_indexB].w=s},SolvePositionConstraints:function(t){var e=t.positions[this.m_indexA].c.Clone(),i=t.positions[this.m_indexA].a,n=t.positions[this.m_indexB].c.Clone(),s=t.positions[this.m_indexB].a,o=new c(i),a=new c(s),h=b(o,r.Subtract(this.m_localAnchorA,this.m_localCenterA)),l=b(a,r.Subtract(this.m_localAnchorB,this.m_localCenterB)),_=r.Add(e,r.Subtract(h,this.m_groundAnchorA)),d=r.Add(n,r.Subtract(l,this.m_groundAnchorB)),m=_.Length(),f=d.Length();m>10*Ue?_.Multiply(1/m):_.SetZero(),f>10*Ue?d.Multiply(1/f):d.SetZero();var p=u(h,_),g=u(l,d),v=this.m_invMassA+this.m_invIA*p*p,y=this.m_invMassB+this.m_invIB*g*g,x=v+this.m_ratio*this.m_ratio*y;x>0&&(x=1/x);var C=this.m_constant-m-this.m_ratio*f,A=ri(C),T=-x*C,w=r.Multiply(-T,_),S=r.Multiply(-this.m_ratio,r.Multiply(T,d));return e.Add(r.Multiply(this.m_invMassA,w)),i+=this.m_invIA*u(h,w),n.Add(r.Multiply(this.m_invMassB,S)),s+=this.m_invIB*u(l,S),t.positions[this.m_indexA].c.Assign(e),t.positions[this.m_indexA].a=i,t.positions[this.m_indexB].c.Assign(n),t.positions[this.m_indexB].a=s,A<Ue},_serialize:function(t){var e=t||{};return this.parent.prototype._serialize.call(this,e),e.groundAnchorA=this.m_groundAnchorA._serialize(),e.groundAnchorB=this.m_groundAnchorB._serialize(),e.localAnchorA=this.m_localAnchorA._serialize(),e.localAnchorB=this.m_localAnchorB._serialize(),e.lengthA=this.m_lengthA,e.lengthB=this.m_lengthB,e.ratio=this.m_ratio,e}},Oe._extend(de),De.prototype={_deserialize:function(t,e,i){this.parent.prototype._deserialize.call(this,t,e,i),this.localAnchorA._deserialize(t.localAnchorA),this.localAnchorB._deserialize(t.localAnchorB),this.maxLength=t.maxLength}},De._extend(ue),Ne.prototype={GetAnchorA:function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)},GetAnchorB:function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},GetReactionForce:function(t){return r.Multiply(t*this.m_impulse,this.m_u)},GetReactionTorque:function(t){return 0},GetLocalAnchorA:function(){return this.m_localAnchorA},GetLocalAnchorB:function(){return this.m_localAnchorB},SetMaxLength:function(t){this.m_maxLength=t},GetMaxLength:function(){return this.m_maxLength},GetLimitState:function(){return this.m_state},InitVelocityConstraints:function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Assign(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Assign(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=t.positions[this.m_indexA].c.Clone(),i=t.positions[this.m_indexA].a,n=t.velocities[this.m_indexA].v.Clone(),s=t.velocities[this.m_indexA].w,o=t.positions[this.m_indexB].c.Clone(),a=t.positions[this.m_indexB].a,h=t.velocities[this.m_indexB].v.Clone(),l=t.velocities[this.m_indexB].w,_=new c(i),d=new c(a);this.m_rA.Assign(b(_,r.Subtract(this.m_localAnchorA,this.m_localCenterA))),this.m_rB.Assign(b(d,r.Subtract(this.m_localAnchorB,this.m_localCenterB))),this.m_u.Assign(r.Subtract(r.Subtract(r.Add(o,this.m_rB),e),this.m_rA)),this.m_length=this.m_u.Length();var m=this.m_length-this.m_maxLength;if(this.m_state=m>0?de.e_atUpperLimit:de.e_inactiveLimit,!(this.m_length>Ue))return this.m_u.SetZero(),this.m_mass=0,void(this.m_impulse=0);this.m_u.Multiply(1/this.m_length);var f=u(this.m_rA,this.m_u),p=u(this.m_rB,this.m_u),g=this.m_invMassA+this.m_invIA*f*f+this.m_invMassB+this.m_invIB*p*p;if(this.m_mass=0!=g?1/g:0,t.step.warmStarting){this.m_impulse*=t.step.dtRatio;var v=r.Multiply(this.m_impulse,this.m_u);n.Subtract(r.Multiply(this.m_invMassA,v)),s-=this.m_invIA*u(this.m_rA,v),h.Add(r.Multiply(this.m_invMassB,v)),l+=this.m_invIB*u(this.m_rB,v)}else this.m_impulse=0;t.velocities[this.m_indexA].v.Assign(n),t.velocities[this.m_indexA].w=s,t.velocities[this.m_indexB].v.Assign(h),t.velocities[this.m_indexB].w=l},SolveVelocityConstraints:function(t){var e=t.velocities[this.m_indexA].v.Clone(),i=t.velocities[this.m_indexA].w,n=t.velocities[this.m_indexB].v.Clone(),s=t.velocities[this.m_indexB].w,o=r.Add(e,m(i,this.m_rA)),a=r.Add(n,m(s,this.m_rB)),c=this.m_length-this.m_maxLength,h=_(this.m_u,r.Subtract(a,o));c<0&&(h+=t.step.inv_dt*c);var l=-this.m_mass*h,d=this.m_impulse;this.m_impulse=si(0,this.m_impulse+l),l=this.m_impulse-d;var f=r.Multiply(l,this.m_u);e.Subtract(r.Multiply(this.m_invMassA,f)),i-=this.m_invIA*u(this.m_rA,f),n.Add(r.Multiply(this.m_invMassB,f)),s+=this.m_invIB*u(this.m_rB,f),t.velocities[this.m_indexA].v.Assign(e),t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].v.Assign(n),t.velocities[this.m_indexB].w=s},SolvePositionConstraints:function(t){var e=t.positions[this.m_indexA].c.Clone(),i=t.positions[this.m_indexA].a,n=t.positions[this.m_indexB].c.Clone(),s=t.positions[this.m_indexB].a,o=new c(i),a=new c(s),h=b(o,r.Subtract(this.m_localAnchorA,this.m_localCenterA)),l=b(a,r.Subtract(this.m_localAnchorB,this.m_localCenterB)),_=r.Subtract(r.Subtract(r.Add(n,l),e),h),d=_.Normalize(),m=d-this.m_maxLength;m=L(m,0,.2);var f=-this.m_mass*m,p=r.Multiply(f,_);return e.Subtract(r.Multiply(this.m_invMassA,p)),i-=this.m_invIA*u(h,p),n.Add(r.Multiply(this.m_invMassB,p)),s+=this.m_invIB*u(l,p),t.positions[this.m_indexA].c.Assign(e),t.positions[this.m_indexA].a=i,t.positions[this.m_indexB].c.Assign(n),t.positions[this.m_indexB].a=s,d-this.m_maxLength<Ue},_serialize:function(t){var e=t||{};return this.parent.prototype._serialize.call(this,e),e.localAnchorA=this.m_localAnchorA._serialize(),e.localAnchorB=this.m_localAnchorB._serialize(),e.maxLength=this.m_maxLength,e}},Ne._extend(de);var Si=Math.exp;Me.prototype={Initialize:function(e){t(e.count>=3),this.m_count=e.count,this.m_ps=new Array(this.m_count),this.m_p0s=new Array(this.m_count),this.m_vs=new Array(this.m_count),this.m_ims=new Array(this.m_count);for(var i=0;i<this.m_count;++i){this.m_ps[i]=e.vertices[i].Clone(),this.m_p0s[i]=e.vertices[i].Clone(),this.m_vs[i]=new r;var n=e.masses[i];this.m_ims[i]=n>0?1/n:0}var s=this.m_count-1,o=this.m_count-2;this.m_Ls=new Array(s),this.m_as=new Array(o);for(i=0;i<s;++i){var a=this.m_ps[i],c=this.m_ps[i+1];this.m_Ls[i]=p(a,c)}for(i=0;i<o;++i){a=this.m_ps[i],c=this.m_ps[i+1];var h=this.m_ps[i+2],l=r.Subtract(c,a),d=r.Subtract(h,c),m=u(l,d),f=_(l,d);this.m_as[i]=ni(m,f)}this.m_gravity=e.gravity.Clone(),this.m_damping=e.damping,this.m_k2=e.k2,this.m_k3=e.k3},Step:function(t,e){if(0!=t){for(var i=Si(-t*this.m_damping),n=0;n<this.m_count;++n)this.m_p0s[n].Assign(this.m_ps[n]),this.m_ims[n]>0&&this.m_vs[n].Add(r.Multiply(t,this.m_gravity)),this.m_vs[n].Multiply(i),this.m_ps[n].Add(r.Multiply(t,this.m_vs[n]));for(n=0;n<e;++n)this.SolveC2(),this.SolveC3(),this.SolveC2();var s=1/t;for(n=0;n<this.m_count;++n)this.m_vs[n]=r.Multiply(s,r.Subtract(this.m_ps[n],this.m_p0s[n]))}},GetVertexCount:function(){return this.m_count},GetVertices:function(){return this.m_ps},Draw:function(t){for(var e=new O(.4,.5,.7),i=0;i<this.m_count-1;++i)t.DrawSegment(this.m_ps[i],this.m_ps[i+1],e)},SetAngle:function(t){for(var e=this.m_count-2,i=0;i<e;++i)this.m_as[i]=t},SolveC2:function(){for(var t=this.m_count-1,e=0;e<t;++e){var i=this.m_ps[e],n=this.m_ps[e+1],s=r.Subtract(n,i),o=s.Normalize(),a=this.m_ims[e],c=this.m_ims[e+1];if(a+c!=0){var h=a/(a+c),l=c/(a+c);i.Subtract(r.Multiply(this.m_k2*h*(this.m_Ls[e]-o),s)),n.Add(r.Multiply(this.m_k2*l*(this.m_Ls[e]-o),s))}}},SolveC3:function(){for(var t=this.m_count-2,e=0;e<t;++e){var i=this.m_ps[e],n=this.m_ps[e+1],s=this.m_ps[e+2],o=this.m_ims[e],a=this.m_ims[e+1],c=this.m_ims[e+2],h=r.Subtract(n,i),l=r.Subtract(s,n),d=h.LengthSquared(),m=l.LengthSquared();if(d*m!=0){var f=u(h,l),p=_(h,l),g=ni(f,p),v=r.Multiply(-1/d,h.Skew()),y=r.Multiply(1/m,l.Skew()),x=r.Negate(v),C=r.Subtract(v,y),A=y,T=o*_(x,x)+a*_(C,C)+c*_(A,A);if(0!=T){T=1/T;for(var b=g-this.m_as[e];b>Ve;)b=(g-=2*Ve)-this.m_as[e];for(;b<-Ve;)b=(g+=2*Ve)-this.m_as[e];var w=-this.m_k3*T*b;i.Add(r.Multiply(o*w,x)),n.Add(r.Multiply(a*w,C)),s.Add(r.Multiply(c*w,A))}}}}};var Ei={serialize:function(t){var e,i,n,r,s,o=[];for(n=t.GetBodyList();n;n=n.GetNext())for(r=n.GetFixtureList();r;r=r.GetNext())s=r.GetShape(),r.__temp_shape_id=o.length,o.push(s._serialize());var a=[];for(n=t.GetBodyList();n;n=n.GetNext())for(n.__temp_fixture_ids=[],r=n.GetFixtureList();r;r=r.GetNext())(i=r._serialize()).shape=r.__temp_shape_id,delete r.__temp_shape_id,n.__temp_fixture_ids.push(a.length),a.push(i);var c=[];for(n=t.GetBodyList();n;n=n.GetNext()){for((i=n._serialize()).fixtures=[],e=0;e<n.__temp_fixture_ids.length;++e)i.fixtures.push(n.__temp_fixture_ids[e]);delete n.__temp_fixture_ids,n.__temp_body_id=c.length,c.push(i)}var h,l=[];for(h=t.GetJointList(),e=0;h;h=h.GetNext(),++e)h.__temp_joint_id=e;for(h=t.GetJointList();h;h=h.GetNext())h.GetType()!==de.e_mouseJoint&&((i=h._serialize()).bodyA=h.GetBodyA().__temp_body_id,i.bodyB=h.GetBodyB().__temp_body_id,l.push(i));for(h=t.GetJointList();h;h=h.GetNext())delete h.__temp_joint_id;for(n=t.GetBodyList();n;n=n.GetNext())delete n.__temp_body_id;return{shapes:o,fixtures:a,bodies:c,joints:l}},deserialize:function(t,e,i){var n=JSON.parse(t);if(i){for(var r=e.GetBodyList();r;){var s=r.GetNext();e.DestroyBody(r),r=s}for(var o=e.GetJointList();o;){s=o.GetNext();e.DestroyJoint(o),o=s}}for(var a=[],c=0;c<n.shapes.length;++c){var h,l=n.shapes[c];switch(l.m_type){case F.e_circle:h=new z;break;case F.e_edge:h=new G;break;case F.e_chain:h=new V;break;case F.e_polygon:h=new k}h._deserialize(l),a.push(h)}var _=[];for(c=0;c<n.fixtures.length;++c){var u=n.fixtures[c],d=new Rt;d._deserialize(u),d.shape=a[u.shape],_.push(d)}var m=[];for(c=0;c<n.bodies.length;++c){var f=n.bodies[c],p=new St;p._deserialize(f);for(var g=e.CreateBody(p),v=0;v<f.fixtures.length;++v)g.CreateFixture(_[f.fixtures[v]]);m.push(g)}var y=[],x=[];for(c=0;c<n.joints.length;++c){var C,A=n.joints[c];switch(A.type){case de.e_revoluteJoint:C=new me;break;case de.e_prismaticJoint:C=new xe;break;case de.e_distanceJoint:C=new ve;break;case de.e_pulleyJoint:C=new Le;break;case de.e_gearJoint:C=new Ie;break;case de.e_wheelJoint:C=new Se;break;case de.e_weldJoint:C=new be;break;case de.e_frictionJoint:C=new Ae;break;case de.e_ropeJoint:C=new De;break;case de.e_motorJoint:C=new Pe;break;default:throw new Error("unknown joint")}if(C._deserialize(A,m),A.type===de.e_gearJoint)x.push([C,y.length]),y.push(null);else{var T=e.CreateJoint(C);y.push(T)}}for(c=0;c<x.length;++c)x[c][0].joint1=y[x[c][0].joint1],x[c][0].joint2=y[x[c][0].joint2],T=e.CreateJoint(x[c][0]),y[x[c][1]]=T}},Ii=(function(){function t(t){return new r(t?t.x||0:0,t?t.y||0:0)}function e(t){for(var e=new Array(t.x.length),i=0;i<e.length;++i)e[i]=new r(t.x[i],t.y[i]);return e}function i(e,i){var n,r=e.name;if(void 0!==e.int)n=e.int;else if(void 0!==e.float)n=e.float;else if(void 0!==e.string)n=e.string;else if(void 0!==e.bool)n=e.bool;else{if(void 0===e.vec2)throw new Error("unknown property type");n=t(e.vec2)}if(i.hasOwnProperty(r))throw new Error("custom property possibly overwriting an existing one");i[r]=n}function n(n,r){var s=new Rt;s.density=n.density||0,s.filter.categoryBits=void 0===n["filter-categoryBits"]?1:n["filter-categoryBits"],s.filter.maskBits=void 0===n["filter-maskBits"]?65535:n["filter-maskBits"],s.filter.groupIndex=void 0===n["filter-groupIndex"]?0:n["filter-groupIndex"],s.friction=n.friction||0,s.restitution=n.restitution||0,s.isSensor=n.sensor||0;var o;if(void 0!==n.circle)(o=new z).m_p=t(n.circle.center),o.m_radius=n.circle.radius||0;else if(void 0!==n.polygon){var a=e(n.polygon.vertices);(o=new k).Set(a,a.length)}else{if(void 0===n.chain)throw new Error("unknown shape type");a=e(n.chain.vertices);(o=new V).m_count=a.length,o.m_vertices=a,(o.m_hasNextVertex=n.chain.hasNextVertex)&&(o.m_nextVertex=t(n.chain.nextVertex)),(o.m_hasPrevVertex=n.chain.hasPrevVertex)&&(o.m_prevVertex=t(n.chain.prevVertex))}s.shape=o;var c=r.CreateFixture(s);if(c.name=n.name,n.customProperties)for(var h=0;h<n.customProperties.length;++h)i(n,c)}function s(e,r){var s=new St;s.type=e.type||Et.b2_staticBody,s.angle=e.angle||0,s.angularDamping=e.angularDamping||0,s.angularVelocity=e.angularVelocity||0,s.awake=e.awake||!1,s.bullet=e.bullet||!1,s.fixedRotation=e.fixedRotation||!1,s.linearDamping=e.linearDamping||!1,s.linearVelocity=t(e.linearVelocity),s.gravityScale=void 0!==e.gravityScale?e.gravityScale:1;var o=new M;o.mass=e["massData-mass"]||0,o.center=t(e["massData-center"]),o.I=e["massData-I"]||0,s.position=t(e.position);var a=r.CreateBody(s);if(a.name=e.name,a.SetMassData(o),e.fixture)for(var c=0;c<e.fixture.length;++c)n(e.fixture[c],a);if(e.customProperties)for(c=0;c<e.customProperties.length;++c)i(e,a);return a}function o(e,n,r){if(!a[e.type])throw new Error("unknown joint type");var s=new a[e.type];switch(s.type){case de.e_revoluteJoint:s.localAnchorA=t(e.anchorA),s.localAnchorB=t(e.anchorB),s.enableLimit=e.enableLimit||!1,s.enableMotor=e.enableMotor||!1,s.lowerAngle=e.lowerLimit||0,s.maxMotorTorque=e.maxMotorTorque||0,s.motorSpeed=e.motorSpeed||0,s.referenceAngle=e.refAngle||0,s.upperAngle=e.upperLimit||0;break;case de.e_distanceJoint:s.localAnchorA=t(e.anchorA),s.localAnchorB=t(e.anchorB),s.dampingRatio=e.dampingRatio||0,s.frequencyHz=e.frequency||0,s.length=e.length||0;break;case de.e_prismaticJoint:s.localAnchorA=t(e.anchorA),s.localAnchorB=t(e.anchorB),s.enableLimit=e.enableLimit||!1,s.enableMotor=e.enableMotor||!1,s.localAxisA=t(e.localAxisA),s.lowerTranslation=e.lowerLimit||0,s.maxMotorForce=e.maxMotorForce||0,s.motorSpeed=e.motorSpeed||0,s.referenceAngle=e.refAngle||0,s.upperTranslation=e.upperLimit||0;break;case de.e_wheelJoint:s.localAnchorA=t(e.anchorA),s.localAnchorB=t(e.anchorB),s.enableMotor=e.enableMotor||!1,s.localAxisA=t(e.localAxisA),s.maxMotorTorque=e.maxMotorTorque||0,s.motorSpeed=e.motorSpeed||0,s.dampingRatio=e.springDampingRatio||0,s.frequencyHz=e.springFrequency||0;break;case de.e_ropeJoint:s.localAnchorA=t(e.anchorA),s.localAnchorB=t(e.anchorB),s.maxLength=e.maxLength||0;break;case de.e_motorJoint:s.linearOffset=t(e.anchorA),s.angularOffset=e.refAngle||0,s.maxForce=e.maxForce||0,s.maxTorque=e.maxTorque||0,s.correctionFactor=e.correctionFactor||0;break;case de.e_weldJoint:s.localAnchorA=t(e.anchorA),s.localAnchorB=t(e.anchorB),s.referenceAngle=e.refAngle||0,s.dampingRatio=e.dampingRatio||0,s.frequencyHz=e.frequencyHz||0;break;case de.e_frictionJoint:s.localAnchorA=t(e.anchorA),s.localAnchorB=t(e.anchorB),s.maxForce=e.maxForce||0,s.maxTorque=e.maxTorque||0;break;default:throw new Error("wat?")}s.bodyA=r[e.bodyA||0],s.bodyB=r[e.bodyB||0],s.collideConnected=e.collideConnected||!1;var o=n.CreateJoint(s);if(o.name=e.name,e.customProperties)for(var c=0;c<e.customProperties.length;++c)i(e,o);return o}var a={revolute:me,distance:ve,prismatic:xe,wheel:Se,rope:De,motor:Pe,weld:be,friction:Ae};return{parseWorld:function(e,i){var n=new function(){this.world=null,this.positionIterations=0,this.velocityIterations=0,this.stepsPerSecond=0,this.fixtures={},this.bodies={},this.joints={},Object.seal(this)};n.world=i=i||new Wt(new r(0,0)),n.positionIterations=e.positionIterations||0,n.velocityIterations=e.velocityIterations||0,n.stepsPerSecond=e.stepsPerSecond||0,e.gravity&&i.SetGravity(t(e.gravity)),i.SetAllowSleeping(e.allowSleep||!1),i.SetAutoClearForces(e.autoClearForces||!1),i.SetWarmStarting(e.warmStarting||!1),i.SetContinuousPhysics(e.continuousPhysics||!1),i.SetSubStepping(e.subStepping||!1);var a=[],c=e.body;if(c)for(var h=0;h<c.length;++h){var l=s(c[h],i);a.push(l);for(var _=l.GetFixtureList();_;_=_.GetNext())n.fixtures[_.name]||(n.fixtures[_.name]=[]),n.fixtures[_.name].push(_);n.bodies[l.name]||(n.bodies[l.name]=[]),n.bodies[l.name].push(l)}var u=[],d=e.joint;if(d)for(h=0;h<d.length;++h){var m=o(d[h],i,a);u.push(m),n.joints[m.name]||(n.joints[m.name]=[]),n.joints[m.name].push(m)}return n}}})(),Ri=[{trimmed:"version",name:"b2_version",def:Ze},{trimmed:"Vec2",name:"b2Vec2",def:r},{trimmed:"Vec3",name:"b2Vec3",def:s},{trimmed:"Mat22",name:"b2Mat22",def:o},{trimmed:"Mat33",name:"b2Mat33",def:a},{trimmed:"Rot",name:"b2Rot",def:c},{trimmed:"Transform",name:"b2Transform",def:h},{trimmed:"Sweep",name:"b2Sweep",def:l},{trimmed:"Dot_v2_v2",name:"b2Dot_v2_v2",def:_},{trimmed:"Cross_v2_v2",name:"b2Cross_v2_v2",def:u},{trimmed:"Cross_v2_f",name:"b2Cross_v2_f",def:d},{trimmed:"Cross_f_v2",name:"b2Cross_f_v2",def:m},{trimmed:"Mul_m22_v2",name:"b2Mul_m22_v2",def:f},{trimmed:"MulT_m22_v2",name:"b2MulT_m22_v2",def:function(t,e){return new r(_(e,t.ex),_(e,t.ey))}},{trimmed:"Distance",name:"b2Distance",def:p},{trimmed:"DistanceSquared",name:"b2DistanceSquared",def:g},{trimmed:"Dot_v3_v3",name:"b2Dot_v3_v3",def:v},{trimmed:"Cross_v3_v3",name:"b2Cross_v3_v3",def:y},{trimmed:"Mul_m22_m22",name:"b2Mul_m22_m22",def:function(t,e){return new o(f(t,e.ex),f(t,e.ey))}},{trimmed:"MulT_m22_m22",name:"b2MulT_m22_m22",def:function(t,e){return new o(new r(_(t.ex,e.ex),_(t.ey,e.ex)),new r(_(t.ex,e.ey),_(t.ey,e.ey)))}},{trimmed:"Mul_m33_v3",name:"b2Mul_m33_v3",def:x},{trimmed:"Mul22_m33_v2",name:"b2Mul22_m33_v2",def:C},{trimmed:"Mul_r_r",name:"b2Mul_r_r",def:A},{trimmed:"MulT_r_r",name:"b2MulT_r_r",def:T},{trimmed:"Mul_r_v2",name:"b2Mul_r_v2",def:b},{trimmed:"MulT_r_v2",name:"b2MulT_r_v2",def:w},{trimmed:"Mul_t_v2",name:"b2Mul_t_v2",def:S},{trimmed:"Min_v2",name:"b2Min_v2",def:P},{trimmed:"Max_v2",name:"b2Max_v2",def:B},{trimmed:"Clamp",name:"b2Clamp",def:L},{trimmed:"MulT_t_v2",name:"b2MulT_t_v2",def:E},{trimmed:"Mul_t_t",name:"b2Mul_t_t",def:function(t,e){var i=new h;return i.q=A(t.q,e.q),i.p=r.Add(b(t.q,e.p),t.p),i}},{trimmed:"MulT_t_t",name:"b2MulT_t_t",def:I},{trimmed:"Clamp_v2",name:"b2Clamp_v2",def:function(t,e,i){return B(e,P(t,i))}},{trimmed:"NextPowerOfTwo",name:"b2NextPowerOfTwo",def:function(t){return t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,1+(t|=t>>16)}},{trimmed:"Abs_v2",name:"b2Abs_v2",def:R},{trimmed:"Abs_m22",name:"b2Abs_m22",def:function(t){return new o(R(t.ex),R(t.ey))}},{trimmed:"IsPowerOfTwo",name:"b2IsPowerOfTwo",def:function(t){return t>0&&0==(t&t-1)}},{trimmed:"RandomFloat",name:"b2RandomFloat",def:function(t,e){var i=Math.random();return i=void 0!==t?(e-t)*i+t:2*i-1}},{trimmed:"Timer",name:"b2Timer",def:N},{trimmed:"Color",name:"b2Color",def:O},{trimmed:"Draw",name:"b2Draw",def:D},{trimmed:"ContactID",name:"b2ContactID",def:K},{trimmed:"ManifoldPoint",name:"b2ManifoldPoint",def:$},{trimmed:"Manifold",name:"b2Manifold",def:tt},{trimmed:"WorldManifold",name:"b2WorldManifold",def:et},{trimmed:"GetPointStates",name:"b2GetPointStates",def:function(t,e,i,n){for(var r=0;r<ke;++r)t[r]=tt.b2_nullState,e[r]=tt.b2_nullState;for(r=0;r<i.pointCount;++r){var s=i.points[r].id;t[r]=tt.b2_removeState;for(var o=0;o<n.pointCount;++o)if(n.points[o].id.Get()==s.Get()){t[r]=tt.b2_persistState;break}}for(r=0;r<n.pointCount;++r)for(s=n.points[r].id,e[r]=tt.b2_addState,o=0;o<i.pointCount;++o)if(i.points[o].id.Get()==s.Get()){e[r]=tt.b2_persistState;break}}},{trimmed:"ClipVertex",name:"b2ClipVertex",def:it},{trimmed:"RayCastInput",name:"b2RayCastInput",def:nt},{trimmed:"RayCastOutput",name:"b2RayCastOutput",def:rt},{trimmed:"AABB",name:"b2AABB",def:st},{trimmed:"CollideCircles",name:"b2CollideCircles",def:ot},{trimmed:"CollidePolygonAndCircle",name:"b2CollidePolygonAndCircle",def:at},{trimmed:"FindMaxSeparation",name:"b2FindMaxSeparation",def:ct},{trimmed:"FindIncidentEdge",name:"b2FindIncidentEdge",def:ht},{trimmed:"CollidePolygons",name:"b2CollidePolygons",def:lt},{trimmed:"CollideEdgeAndCircle",name:"b2CollideEdgeAndCircle",def:_t},{trimmed:"EPAxis",name:"b2EPAxis",def:ut},{trimmed:"TempPolygon",name:"b2TempPolygon",def:dt},{trimmed:"ReferenceFace",name:"b2ReferenceFace",def:mt},{trimmed:"EPCollider",name:"b2EPCollider",def:ft},{trimmed:"CollideEdgeAndPolygon",name:"b2CollideEdgeAndPolygon",def:pt},{trimmed:"ClipSegmentToLine",name:"b2ClipSegmentToLine",def:gt},{trimmed:"TestShapeOverlap",name:"b2TestShapeOverlap",def:vt},{trimmed:"TestOverlap",name:"b2TestOverlap",def:yt},{trimmed:"Shape",name:"b2Shape",def:F},{trimmed:"CircleShape",name:"b2CircleShape",def:z},{trimmed:"EdgeShape",name:"b2EdgeShape",def:G},{trimmed:"ChainShape",name:"b2ChainShape",def:V},{trimmed:"PolygonShape",name:"b2PolygonShape",def:k},{trimmed:"Pair",name:"b2Pair",def:W},{trimmed:"PairLessThan",name:"b2PairLessThan",def:U},{trimmed:"BroadPhase",name:"b2BroadPhase",def:j},{trimmed:"DistanceProxy",name:"b2DistanceProxy",def:q},{trimmed:"SimplexCache",name:"b2SimplexCache",def:Y},{trimmed:"DistanceInput",name:"b2DistanceInput",def:X},{trimmed:"DistanceOutput",name:"b2DistanceOutput",def:H},{trimmed:"SimplexVertex",name:"b2SimplexVertex",def:J},{trimmed:"Simplex",name:"b2Simplex",def:Z},{trimmed:"DistanceFunc",name:"b2DistanceFunc",def:Q},{trimmed:"TreeNode",name:"b2TreeNode",def:xt},{trimmed:"DynamicTree",name:"b2DynamicTree",def:Ct},{trimmed:"TOIInput",name:"b2TOIInput",def:At},{trimmed:"TOIOutput",name:"b2TOIOutput",def:Tt},{trimmed:"SeparationFunction",name:"b2SeparationFunction",def:bt},{trimmed:"TimeOfImpact",name:"b2TimeOfImpact",def:wt},{trimmed:"BodyDef",name:"b2BodyDef",def:St},{trimmed:"Body",name:"b2Body",def:Et},{trimmed:"Filter",name:"b2Filter",def:It},{trimmed:"FixtureDef",name:"b2FixtureDef",def:Rt},{trimmed:"Fixture",name:"b2Fixture",def:Bt},{trimmed:"DestructionListener",name:"b2DestructionListener",def:Lt},{trimmed:"ContactFilter",name:"b2ContactFilter",def:Ot},{trimmed:"ContactImpulse",name:"b2ContactImpulse",def:Dt},{trimmed:"ContactListener",name:"b2ContactListener",def:Nt},{trimmed:"QueryCallback",name:"b2QueryCallback",def:Mt},{trimmed:"RayCastCallback",name:"b2RayCastCallback",def:Ft},{trimmed:"TimeStep",name:"b2TimeStep",def:zt},{trimmed:"Position",name:"b2Position",def:Gt},{trimmed:"Velocity",name:"b2Velocity",def:Vt},{trimmed:"SolverData",name:"b2SolverData",def:kt},{trimmed:"World",name:"b2World",def:Wt},{trimmed:"MixFriction",name:"b2MixFriction",def:qt},{trimmed:"MixRestitution",name:"b2MixRestitution",def:Yt},{trimmed:"ContactRegister",name:"b2ContactRegister",def:Xt},{trimmed:"ContactEdge",name:"b2ContactEdge",def:Ht},{trimmed:"Contact",name:"b2Contact",def:Jt},{trimmed:"CircleContact",name:"b2CircleContact",def:Zt},{trimmed:"PolygonContact",name:"b2PolygonContact",def:ie},{trimmed:"ChainAndCircleContact",name:"b2ChainAndCircleContact",def:Qt},{trimmed:"ChainAndPolygonContact",name:"b2ChainAndPolygonContact",def:Kt},{trimmed:"EdgeAndCircleContact",name:"b2EdgeAndCircleContact",def:$t},{trimmed:"EdgeAndPolygonContact",name:"b2EdgeAndPolygonContact",def:te},{trimmed:"PolygonAndCircleContact",name:"b2PolygonAndCircleContact",def:ee},{trimmed:"defaultFilter",name:"b2_defaultFilter",def:xi},{trimmed:"defaultListener",name:"b2_defaultListener",def:Ci},{trimmed:"ContactManager",name:"b2ContactManager",def:ne},{trimmed:"VelocityConstraintPoint",name:"b2VelocityConstraintPoint",def:re},{trimmed:"ContactPositionConstraint",name:"b2ContactPositionConstraint",def:se},{trimmed:"ContactVelocityConstraint",name:"b2ContactVelocityConstraint",def:oe},{trimmed:"PositionSolverManifold",name:"b2PositionSolverManifold",def:ae},{trimmed:"ContactSolverDef",name:"b2ContactSolverDef",def:ce},{trimmed:"ContactSolver",name:"b2ContactSolver",def:he},{trimmed:"Island",name:"b2Island",def:le},{trimmed:"Jacobian",name:"b2Jacobian",def:function(){this.linear=new r,this.angularA=0,this.angularB=0}},{trimmed:"JointEdge",name:"b2JointEdge",def:_e},{trimmed:"JointDef",name:"b2JointDef",def:ue},{trimmed:"Joint",name:"b2Joint",def:de},{trimmed:"RevoluteJointDef",name:"b2RevoluteJointDef",def:me},{trimmed:"RevoluteJoint",name:"b2RevoluteJoint",def:fe},{trimmed:"MouseJointDef",name:"b2MouseJointDef",def:pe},{trimmed:"MouseJoint",name:"b2MouseJoint",def:ge},{trimmed:"DistanceJointDef",name:"b2DistanceJointDef",def:ve},{trimmed:"DistanceJoint",name:"b2DistanceJoint",def:ye},{trimmed:"PrismaticJointDef",name:"b2PrismaticJointDef",def:xe},{trimmed:"PrismaticJoint",name:"b2PrismaticJoint",def:Ce},{trimmed:"FrictionJointDef",name:"b2FrictionJointDef",def:Ae},{trimmed:"FrictionJoint",name:"b2FrictionJoint",def:Te},{trimmed:"WeldJointDef",name:"b2WeldJointDef",def:be},{trimmed:"WeldJoint",name:"b2WeldJoint",def:we},{trimmed:"WheelJointDef",name:"b2WheelJointDef",def:Se},{trimmed:"WheelJoint",name:"b2WheelJoint",def:Ee},{trimmed:"GearJointDef",name:"b2GearJointDef",def:Ie},{trimmed:"GearJoint",name:"b2GearJoint",def:Re},{trimmed:"MotorJointDef",name:"b2MotorJointDef",def:Pe},{trimmed:"MotorJoint",name:"b2MotorJoint",def:Be},{trimmed:"PulleyJointDef",name:"b2PulleyJointDef",def:Le},{trimmed:"PulleyJoint",name:"b2PulleyJoint",def:Oe},{trimmed:"RopeJointDef",name:"b2RopeJointDef",def:De},{trimmed:"RopeJoint",name:"b2RopeJoint",def:Ne},{trimmed:"RopeDef",name:"b2RopeDef",def:function(){this.vertices=null,this.count=0,this.masses=null,this.gravity=new r,this.damping=.1,this.k2=.9,this.k3=.1}},{trimmed:"Rope",name:"b2Rope",def:Me},{trimmed:"maxManifoldPoints",name:"b2_maxManifoldPoints",def:ke},{trimmed:"maxPolygonVertices",name:"b2_maxPolygonVertices",def:We},{trimmed:"aabbExtension",name:"b2_aabbExtension",def:.1},{trimmed:"aabbMultiplier",name:"b2_aabbMultiplier",def:2},{trimmed:"linearSlop",name:"b2_linearSlop",def:Ue},{trimmed:"angularSlop",name:"b2_angularSlop",def:je},{trimmed:"polygonRadius",name:"b2_polygonRadius",def:qe},{trimmed:"maxSubSteps",name:"b2_maxSubSteps",def:8},{trimmed:"maxTOIContacts",name:"b2_maxTOIContacts",def:32},{trimmed:"velocityThreshold",name:"b2_velocityThreshold",def:1},{trimmed:"maxLinearCorrection",name:"b2_maxLinearCorrection",def:.2},{trimmed:"maxAngularCorrection",name:"b2_maxAngularCorrection",def:Ye},{trimmed:"maxTranslation",name:"b2_maxTranslation",def:2},{trimmed:"maxTranslationSquared",name:"b2_maxTranslationSquared",def:4},{trimmed:"maxRotation",name:"b2_maxRotation",def:Xe},{trimmed:"maxRotationSquared",name:"b2_maxRotationSquared",def:He},{trimmed:"baumgarte",name:"b2_baumgarte",def:.2},{trimmed:"toiBaugarte",name:"b2_toiBaugarte",def:.75},{trimmed:"timeToSleep",name:"b2_timeToSleep",def:.5},{trimmed:"linearSleepTolerance",name:"b2_linearSleepTolerance",def:.01},{trimmed:"angularSleepTolerance",name:"b2_angularSleepTolerance",def:Je},{trimmed:"epsilon",name:"b2_epsilon",def:Ge},{trimmed:"JsonSerializer",name:"b2JsonSerializer",def:Ei},{trimmed:"RUBELoader",name:"b2RUBELoader",def:Ii},{trimmed:"Profiler",name:"b2Profiler",def:Fe}];if("undefined"!=typeof b2_compatibility&&"undefined"!=typeof window)for(var Pi=0;Pi<Ri.length;++Pi)window[Ri[Pi].name]=Ri[Pi].def;else{var Bi={};for(Pi=0;Pi<Ri.length;++Pi)Bi[Ri[Pi].trimmed]=Ri[Pi].def;void 0!==e?e.exports=Bi:window.b2=Bi}})()}),{}],248:[(function(t,e,i){e.exports=(function(){"use strict";var t=Math.round(window.devicePixelRatio||1),e=function(t,e){this._color=e||"#666",this._canvas=document.createElement("canvas"),this._ctx=this._canvas.getContext("2d"),this._canvas.className="pstats-canvas",t.appendChild(this._canvas)};e.prototype.init=function(e,i){var n=e*t,r=i*t;this._canvas.width=n,this._canvas.height=r,this._canvas.style.width=e+"px",this._canvas.style.height=i+"px",this._ctx.globalAlpha=1,this._ctx.fillStyle="#444",this._ctx.fillRect(0,0,n,r)};var i=Math.round(window.devicePixelRatio||1),n=(function(t){function e(e,i){t.call(this,e,i),this._current=0,this._max=0}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.draw=function(t,e){var n=this._canvas.width,r=this._canvas.height;this._current+=.1*(t-this._current),this._max*=.99,this._current>this._max&&(this._max=this._current);var s=Math.round((1-this._current/this._max)*r);this._ctx.globalAlpha=1,this._ctx.drawImage(this._canvas,i,0,n-i,r,0,0,n-i,r),e?(this._ctx.fillStyle="#444",this._ctx.fillRect(n-i,0,i,r),this._ctx.fillStyle="#b70000",this._ctx.fillRect(n-i,s,i,r-s),this._ctx.globalAlpha=.5,this._ctx.fillStyle="#fff",this._ctx.fillRect(n-i,s,i,i)):(this._ctx.fillStyle="#444",this._ctx.fillRect(n-i,0,i,r),this._ctx.fillStyle=this._color,this._ctx.fillRect(n-i,s,i,r-s),this._ctx.globalAlpha=.5,this._ctx.fillStyle="#fff",this._ctx.fillRect(n-i,s,i,i))},e})(e),r=Math.round(window.devicePixelRatio||1),s=(function(t){function e(e,i){t.call(this,e,i),this._threshold=0,this._canvas2=document.createElement("canvas"),this._ctx2=this._canvas2.getContext("2d")}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.init=function(e,i){t.prototype.init.call(this,e,i);var n=e*r,s=i*r;this._canvas2.width=n,this._canvas2.height=s,this._canvas2.style.width=e+"px",this._canvas2.style.height=i+"px",this._ctx2.globalAlpha=1,this._ctx2.fillStyle="#444",this._ctx2.fillRect(0,0,n,s)},e.prototype.draw=function(t,e){var i=this._canvas.width,n=this._canvas.height;if(this._ctx.globalAlpha=1,this._ctx2.globalAlpha=1,t>this._threshold){var s=n*((t-t%n)/n+1),o=this._threshold;this._threshold=s;var a=o/s;this._ctx2.drawImage(this._canvas,0,0),this._ctx.fillStyle="#444",this._ctx.fillRect(0,0,i,n),this._ctx.drawImage(this._canvas2,r,0,i-r,n,0,Math.round((1-a)*n),i-r,n)}else this._ctx.drawImage(this._canvas,r,0,i-r,n,0,0,i-r,n);var c=Math.round(n*(1-t/this._threshold));e?(this._ctx.fillStyle="#444",this._ctx.fillRect(i-r,0,r,n),this._ctx.fillStyle="#b70000",this._ctx.fillRect(i-r,c,r,n-c),this._ctx.globalAlpha=.5,this._ctx.fillStyle="#fff",this._ctx.fillRect(i-r,c,r,r)):(this._ctx.fillStyle="#444",this._ctx.fillRect(i-r,0,r,n),this._ctx.fillStyle=this._color,this._ctx.fillRect(i-r,c,r,n-c),this._ctx.globalAlpha=.5,this._ctx.fillStyle="#fff",this._ctx.fillRect(i-r,c,r,r))},e})(e),o=Math.round(window.devicePixelRatio||1),a=(function(t){function e(e,i,n,r){t.call(this,e,i),this._min=n,this._max=r}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.draw=function(t,e){var i=this._canvas.width,n=this._canvas.height,r=(t-this._min)/(this._max-this._min),s=Math.round((1-r)*n);this._ctx.globalAlpha=1,this._ctx.drawImage(this._canvas,o,0,i-o,n,0,0,i-o,n),e?(this._ctx.fillStyle="#444",this._ctx.fillRect(i-o,0,o,n),this._ctx.fillStyle="#b70000",this._ctx.fillRect(i-o,s,o,n-s),this._ctx.globalAlpha=.5,this._ctx.fillStyle="#fff",this._ctx.fillRect(i-o,s,o,o)):(this._ctx.fillStyle="#444",this._ctx.fillRect(i-o,0,o,n),this._ctx.fillStyle=this._color,this._ctx.fillRect(i-o,s,o,n-s),this._ctx.globalAlpha=.5,this._ctx.fillStyle="#fff",this._ctx.fillRect(i-o,s,o,o))},e})(e),c=Math.round(window.devicePixelRatio||1),h=function(t,e){this._colors=e,this._canvas=document.createElement("canvas"),this._ctx=this._canvas.getContext("2d"),this._canvas.className="pstats-canvas",t.appendChild(this._canvas)};h.prototype.init=function(t,e,i){var n=t*c,r=e*c;this._canvas.width=n,this._canvas.height=r*i,this._canvas.style.width=t+"px",this._canvas.style.height=e*i+"px",this._ctx.globalAlpha=1,this._ctx.fillStyle="#444",this._ctx.fillRect(0,0,n,r*i)},h.prototype.draw=function(t){var e=this._canvas.width,i=this._canvas.height;this._ctx.globalAlpha=1,this._ctx.drawImage(this._canvas,c,0,e-c,i,0,0,e-c,i);for(var n=0,r=0;r<t.length;++r){var s=t[r]*i;this._ctx.fillStyle=this._colors[r],this._ctx.fillRect(e-c,n,c,s),n+=s}};var l=function(t,e){this._id=t,this._opts=e||{},this._value=0,this._total=0,this._averageValue=0,this._accumValue=0,this._accumSamples=0,this._accumStart=window.performance.now()},_={value:{}};l.prototype._average=function(t){if(this._opts.average){this._accumValue+=t,++this._accumSamples;var e=performance.now();e-this._accumStart>=this._opts.average&&(this._averageValue=this._accumValue/this._accumSamples,this._accumValue=0,this._accumStart=e,this._accumSamples=0)}},_.value.get=function(){return this._value},_.value.set=function(t){this._value=t},l.prototype.sample=function(){this._average(this._value)},l.prototype.human=function(){var t=this._opts.average?this._averageValue:this._value;return Math.round(100*t)/100},l.prototype.alarm=function(){return this._opts.below&&this._value<this._opts.below||this._opts.over&&this._value>this._opts.over},Object.defineProperties(l.prototype,_);var u=(function(t){function e(e,i){t.call(this,e,i),this._time=window.performance.now()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.start=function(){this._time=window.performance.now()},e.prototype.end=function(){this._value=window.performance.now()-this._time,this._average(this._value)},e.prototype.tick=function(){this.end(),this.start()},e.prototype.frame=function(){var t=window.performance.now(),e=t-this._time;this._total++;e>(this._opts.average||1e3)&&(this._value=1e3*this._total/e,this._total=0,this._time=t,this._average(this._value))},e})(l),d=Math.log(1024),m=["Bytes","KB","MB","GB","TB"],f=(function(t){function e(e,i,n){t.call(this,i,n),this._stats=e,this._start=0,0===n.extension.indexOf("memory.")&&(this._field=n.extension.substring(7))}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.snapshot=function(){this._value=this._stats[this._field]},e.prototype.start=function(){this._start=this._stats[this._field]},e.prototype.end=function(){this._value=this._stats[this._field]-this._start},e.prototype.human=function(){return (function(t){var e=Math.floor(Math.log(t)/d);return 0===t?"n/a":Math.round(100*t/Math.pow(1024,e))/100+" "+m[e]})(t.prototype.human.call(this))},e})(l),p=function(){0===window.performance.memory.totalJSHeapSize&&console.warn("totalJSHeapSize === 0, performance.memory is only available in Chrome."),this._used=0,this._total=0,this._lastUsed=0},g={alarm:{},used:{},total:{}};p.prototype.tick=function(){this._lastUsed=this._used,this._used=window.performance.memory.usedJSHeapSize,this._total=window.performance.memory.totalJSHeapSize},g.alarm.get=function(){return this._used-this._lastUsed<0},g.used.get=function(){return window.performance.memory.usedJSHeapSize},g.total.get=function(){return this._total},p.prototype.counter=function(t,e){return new f(this,t,e)},Object.defineProperties(p.prototype,g);var v={memory:p},y=document.createElement("style");y.type="text/css",y.textContent="\n  .pstats {\n    position: fixed;\n    z-index: 9999;\n\n    padding: 5px;\n    width: 250px;\n    right: 5px;\n    bottom: 5px;\n\n    font-size: 10px;\n    font-family: 'Roboto Condensed', tahoma, sans-serif;\n    overflow: hidden;\n    user-select: none;\n    cursor: default;\n\n    background: #222;\n    border-radius: 3px;\n  }\n\n  .pstats-container {\n    display: block;\n    position: relative;\n    color: #888;\n    white-space: nowrap;\n  }\n\n  .pstats-item {\n    position: absolute;\n    width: 250px;\n    height: 12px;\n    left: 0px;\n  }\n\n  .pstats-label {\n    position: absolute;\n    width: 150px;\n    height: 12px;\n    text-align: left;\n    transition: background 0.3s;\n  }\n\n  .pstats-label.alarm {\n    color: #ccc;\n    background: #800;\n\n    transition: background 0s;\n  }\n\n  .pstats-counter-id {\n    position: absolute;\n    width: 90px;\n    left: 0px;\n  }\n\n  .pstats-counter-value {\n    position: absolute;\n    width: 60px;\n    left: 90px;\n    text-align: right;\n  }\n\n  .pstats-canvas {\n    display: block;\n    position: absolute;\n    right: 0px;\n    top: 1px;\n  }\n\n  .pstats-fraction {\n    position: absolute;\n    width: 250px;\n    left: 0px;\n  }\n\n  .pstats-legend {\n    position: absolute;\n    width: 150px;\n\n    text-align: right;\n  }\n\n  .pstats-legend > span {\n    position: absolute;\n    right: 0px;\n  }\n",document.head.appendChild(y);var x=function(t,e){if(e=e||{},this._showGraph=void 0===e.showGraph||e._showGraph,this._values=e.values||{},this._fractions=e.fractions||[],this._id2counter={},this._id2item={},this._name2extStats={},e.css){var i=document.createElement("style");i.type="text/css",i.textContent=e.css,document.head.appendChild(i)}if(e.extensions)for(var r=0;r<e.extensions.length;++r){var o=e.extensions[r],c=v[o];c?this._name2extStats[o]=new c:console.warn("Can not find extensions "+o+", please register your extension via pstats.register().")}this._root=document.createElement("div"),this._root.className="pstats";var l=document.createElement("div");l.className="pstats-container",this._root.appendChild(l);var _=0;for(var u in this._values){var d=this._values[u],m=document.createElement("div");m.className="pstats-item";var f=document.createElement("div");f.className="pstats-label";var p=document.createElement("span");p.className="pstats-counter-id",p.textContent=d.desc||u;var g=document.createElement("div");g.className="pstats-counter-value";var y=document.createTextNode("");y.nodeValue="0",f.appendChild(p),f.appendChild(g),g.appendChild(y),m.appendChild(f);var x=void 0;this._showGraph&&(x=void 0!==d.min||void 0!==d.max?new a(m,d.color,d.min||0,d.max||9999):d.threshold?new s(m,d.color):new n(m,d.color)).init(95,10),this._id2item[u]={label:f,valueText:y,graph:x},m.style.top=_+"px",l.appendChild(m),_+=12}if(this._showGraph&&e.fractions)for(var C=0;C<e.fractions.length;++C){var A=e.fractions[C],T=A.steps,b=10*T.length+2;A.colors=A.colors||["#850700","#c74900","#fcb300","#284280","#4c7c0c"];var w=document.createElement("div");w.className="pstats-fraction";var S=document.createElement("div");S.className="pstats-legend",S.style.height=b+"px";for(var E=0;E<T.length;++E){var I=document.createElement("span");I.textContent=T[E],I.style.color=A.colors[E],I.style.top=10*E+"px",S.appendChild(I)}w.appendChild(S),w.style.height=b+"px",w.style.top=_+"px";var R=new h(w,A.colors);R.init(95,10,T.length),A.graph=R,A.values=new Array(T.length),l.appendChild(w),_+=10*T.length+2}l.style.height=_+"px",this._root.style.height=_+"px",this._showGraph||(this._root.style.width="150px"),t.appendChild(this._root)};x.prototype.item=function(t){if(!t)return null;var e=this._id2counter[t];if(e)return e;var i=this._values[t];if(!i)return null;if(i.extension){var n=i.extension.indexOf("."),r=i.extension.substring(0,n),s=this._name2extStats[r];if(!s)return console.error("extension "+r+" not found, make sure you have register and enable it."),null;e=s.counter(t,i)}else e=new u(t,i);return this._id2counter[t]=e,e},x.prototype.tick=function(){for(var t in this._name2extStats){this._name2extStats[t].tick()}for(var e in this._values){var i=this._id2counter[e];if(i){i.sample();var n=i.alarm(),r=i.human(),s=this._id2item[e];s.label.classList.toggle("alarm",n>0),s.valueText.nodeValue=r,this._showGraph&&s.graph.draw(i.value,n)}}if(this._showGraph)for(var o=0;o<this._fractions.length;++o){var a=this._fractions[o],c=this._id2counter[a.base];if(c){for(var h=a.steps,l=0;l<h.length;++l){var _=h[l],u=this._id2counter[_];u&&(a.values[l]=u.value/c.value)}a.graph.draw(a.values)}}},(function(){if(void 0===window.performance&&(window.performance={}),!window.performance.now){var t=Date.now();performance.timing&&performance.timing.navigationStart&&(t=performance.timing.navigationStart),window.performance.now=function(){return Date.now()-t}}window.performance.mark||(window.performance.mark=function(){}),window.performance.measure||(window.performance.measure=function(){}),window.performance.memory||(window.performance.memory={usedJSHeapSize:0,totalJSHeapSize:0})})();return{new:function(t,e){var i=new x(t,e);return function(t){return t?i.item(t):i}},register:function(t,e){v[t]=e}}})()}),{}],249:[(function(t,e,i){function n(t,e){void 0===s[t]&&(s[t]=e)}function r(t){return"object"==typeof s[t]}var s="undefined"==typeof window?global:window;n("CC_TEST",r("tap")||r("QUnit")),n("CC_EDITOR",r("Editor")&&r("process")&&"electron"in process.versions),n("CC_PREVIEW",!0),n("CC_DEV",!0),n("CC_DEBUG",!0),n("CC_JSB",r("jsb")),n("CC_BUILD",!1),n("CC_WECHATGAME",!1),n("CC_QQPLAY",!1),n("CC_SUPPORT_JIT",!1),cc={},_ccsg={},_cc={},t("./CCDebugger"),cc._initDebugSetting(cc.DebugMode.INFO),t("./polyfill/string"),t("./polyfill/misc"),t("./polyfill/array"),t("./polyfill/typescript"),t("./cocos2d/kazmath"),t("./cocos2d/core/predefine"),ccs={},cp={},t("./cocos2d/shaders"),t("./CCBoot"),t("./cocos2d"),t("./extends"),e.exports=cc}),{"./CCBoot":2,"./CCDebugger":3,"./DebugInfos":4,"./cocos2d":222,"./cocos2d/core/predefine":182,"./cocos2d/kazmath":226,"./cocos2d/shaders":240,"./extends":244,"./package.json":void 0,"./polyfill/array":250,"./polyfill/misc":251,"./polyfill/string":252,"./polyfill/typescript":253}],250:[(function(t,e,i){Array.isArray||(Array.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)})}),{}],251:[(function(t,e,i){if(Math.sign||(Math.sign=function(t){return 0==(t=+t)||isNaN(t)?t:t>0?1:-1}),Number.isInteger||(Number.isInteger=function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t}),!console.time){var n=window.performance||Date,r=Object.create(null);console.time=function(t){r[t]=n.now()},console.timeEnd=function(t){var e=r[t],i=n.now()-e;console.log(t+": "+i+"ms")}}}),{}],252:[(function(t,e,i){String.prototype.startsWith||(String.prototype.startsWith=function(t,e){return e=e||0,this.lastIndexOf(t,e)===e}),String.prototype.endsWith||(String.prototype.endsWith=function(t,e){(void 0===e||e>this.length)&&(e=this.length),e-=t.length;var i=this.indexOf(t,e);return-1!==i&&i===e})}),{}],253:[(function(t,e,i){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};window.__extends=function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},window.__assign=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++){e=arguments[i];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},window.__rest=function(t,e){var i={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(i[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(t);r<n.length;r++)e.indexOf(n[r])<0&&(i[n[r]]=t[n[r]])}return i},window.__decorate=function(t,e,i,n){var r,s=arguments.length,o=s<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,n);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(o=(s<3?r(o):s>3?r(e,i,o):r(e,i))||o);return s>3&&o&&Object.defineProperty(e,i,o),o},window.__param=function(t,e){return function(i,n){e(i,n,t)}},window.__metadata=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},window.__awaiter=function(t,e,i,n){return new(i||(i=Promise))(function(r,s){function o(t){try{c(n.next(t))}catch(t){s(t)}}function a(t){try{c(n.throw(t))}catch(t){s(t)}}function c(t){t.done?r(t.value):new i(function(e){e(t.value)}).then(o,a)}c((n=n.apply(t,e||[])).next())})},window.__generator=function(t,e){function i(i){return function(o){return (function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(s=r[2&i[0]?"return":i[0]?"throw":"next"])&&!(s=s.call(r,i[1])).done)return s;switch(r=0,s&&(i=[0,s.value]),i[0]){case 0:case 1:s=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(s=a.trys,!(s=s.length>0&&s[s.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){a.label=i[1];break}if(6===i[0]&&a.label<s[1]){a.label=s[1],s=i;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(i);break}s[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],r=0}finally{n=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}})([i,o])}}var n,r,s,o,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return o={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o},window.__exportStar=function(t,e){for(var i in t)e.hasOwnProperty(i)||(e[i]=t[i])},window.__values=function(t){var e="function"==typeof Symbol&&t[Symbol.iterator],i=0;return e?e.call(t):{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}}},window.__read=function(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var n,r,s=i.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(n=s.next()).done;)o.push(n.value)}catch(t){r={error:t}}finally{try{n&&!n.done&&(i=s.return)&&i.call(s)}finally{if(r)throw r.error}}return o},window.__spread=function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(__read(arguments[e]));return t},window.__await=function(t){return this instanceof __await?(this.v=t,this):new __await(t)},window.__asyncGenerator=function(t,e,i){function n(t){h[t]&&(c[t]=function(e){return new Promise(function(i,n){l.push([t,e,i,n])>1||r(t,e)})})}function r(t,e){try{(function(t){t.value instanceof __await?Promise.resolve(t.value.v).then(s,o):a(l[0][2],t)})(h[t](e))}catch(t){a(l[0][3],t)}}function s(t){r("next",t)}function o(t){r("throw",t)}function a(t,e){t(e),l.shift(),l.length&&r(l[0][0],l[0][1])}if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var c,h=i.apply(t,e||[]),l=[];return c={},n("next"),n("throw"),n("return"),c[Symbol.asyncIterator]=function(){return this},c},window.__asyncDelegator=function(t){function e(e,r){t[e]&&(i[e]=function(i){return(n=!n)?{value:__await(t[e](i)),done:"return"===e}:r?r(i):i})}var i,n;return i={},e("next"),e("throw",(function(t){throw t})),e("return"),i[Symbol.iterator]=function(){return this},i},window.__asyncValues=function(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator];return e?e.call(t):"function"==typeof __values?__values(t):t[Symbol.iterator]()}}),{}]},{},[249]);
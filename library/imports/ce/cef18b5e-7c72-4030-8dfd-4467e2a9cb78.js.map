{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\scripts\\objects/assets\\scripts\\objects\\BirdObject.js"],"names":["cc","Class","extends","Component","properties","valid","accel","blood_max","blood","armor","fragmentPrefab","default","type","Prefab","crashAudio","url","AudioClip","boomAudio","springAudio","emitRadiusMax","emitRadiusMin","emitVelocityMax","duration","init","imageId","ready","setGravity","setScreenRectangle","crashFlag","skillFlag","spriteImage","readyEmit","spring","setVelocity","emitStartPosition","node","parent","active","ropeJoint","getComponent","RopeJoint","maxLength","rigidbody","RigidBody","connectedBody","setPosition","action","moveTo","graphicsSpring","addComponent","Graphics","position","Vec2","ropeLeftLocation","x","y","ropeRightLocation","_drawRope","on","_touchmoveEvent","bind","once","_emitEvent","event","eventPos","getLocation","parentPos","parentSize","getContentSize","rec","delta","touch","getDelta","minStep","isOutOfBorder","_onStopAudio","_onPlayAudio","getPosition","stopPropagation","location_delta","_locationTransform","off","destroy","emit","graphicsOrbit","clear","_skillBind","_skillEvent","onSkill","_skillClear","_onDeath","setFragment","setContentSize","scheduleOnce","bg","graphics","locationWorldBird","locationWorldEmit","location","sub","locationLeft","locationRight","strokeColor","Color","BLACK","lineWidth","lineTo","stroke","_drawCircle","locationWorldParent","size","width","height","add","color","YELLOW","orbitRadius","radius","Math","floor","circle","fill","rigid","gravityScale","fixedRotation","hypot","speed","speed_x","speed_y","screen","setRigidActive","setRestitution","restitution","PhysicsCollider","vel_x","vel_y","linearVelocity","gravity","num","random","i","fragmentNode","instantiate","locationParent","addChild","fragment","fragmentType","velocityMax","onPostSolve","contact","thisCollider","otherCollider","linearDamping","angle","PI","rotation","effect","sprite","Sprite","onAttack","currentAudio","audioEngine","play","stop","update","dt"],"mappings":"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","file":"BirdObject.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\scripts\\objects","sourcesContent":["import {getEffect} from '../utils/common';\r\nimport {getWorldLocation} from '../utils/common';\r\nimport {spriteUpdate} from '../utils/common';\r\nimport {isOutOfBorder} from '../utils/common';\r\nimport {changeRectangle} from '../utils/common';\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        //有效属性\r\n        valid : true,\r\n        //水平加速度（一般为负数）\r\n        accel : 0,  \r\n        // 满血血量\r\n        blood_max : 0,\r\n        // 当前血量\r\n        blood : 0,\r\n        // 护甲\r\n        armor : 0,\r\n        // 碎片prefab \r\n        fragmentPrefab : {\r\n            default : null,\r\n            type : cc.Prefab\r\n        },\r\n        // 碰撞音效\r\n        crashAudio: {\r\n            url: cc.AudioClip,\r\n            default: null\r\n        },\r\n        // 爆炸音效\r\n        boomAudio: {\r\n            url: cc.AudioClip,\r\n            default: null\r\n        },\r\n        // 弹弓音效\r\n        springAudio : {\r\n            url: cc.AudioClip,\r\n            default: null\r\n        },\r\n        //发射时弹弓的最大半径\r\n        emitRadiusMax : 0,\r\n        //发射时弹弓的最小半径\r\n        emitRadiusMin : 0,\r\n        // 发射的最大速度\r\n        emitVelocityMax : 0,\r\n        // 存活时间 /s\r\n        duration : 0,\r\n    },\r\n\r\n    // 相同属性初始化\r\n    init : function(type){\r\n        // 当前图片id\r\n        this.imageId = 0;\r\n        // 初始化是否准备好发射，0 -> 没轮到自己， 1 -> 准备好发射, -1 -> 已经发射\r\n        this.ready = 0;\r\n        // 初始化重力\r\n        this.setGravity(1);\r\n        // 初始化屏幕rec\r\n        this.setScreenRectangle();\r\n        // 冲撞flag：第一次冲撞即为true\r\n        this.crashFlag = false;\r\n        // 技能flag: 未释放技能为true\r\n        this.skillFlag = true;\r\n        // 图片路径\r\n        this.spriteImage = 'resources/textures/birds/';\r\n        // 图片id\r\n        this.imageId = 0;        \r\n\r\n        // 类型\r\n        this.type = type;\r\n    },\r\n\r\n    // 此时表明准备好发射了\r\n    readyEmit : function(spring){\r\n        this.ready = 1;\r\n        // 初始化鸟的速度\r\n        this.setVelocity(0, 0);\r\n        // 重力为0，此时需要在弹弓上\r\n        this.setGravity(0);\r\n        // 初始化拉伸坐标（世界坐标）\r\n        this.emitStartPosition = getWorldLocation(this.node.parent);\r\n        // 初始化弹弓\r\n        this.spring = spring;\r\n        this.spring.active = true;\r\n        // 绳子关节\r\n        let ropeJoint = this.spring.getComponent(cc.RopeJoint);\r\n        ropeJoint.maxLength = this.emitRadiusMax;\r\n        // 绳子关节绑定鸟\r\n        let rigidbody = this.node.getComponent(cc.RigidBody);\r\n        ropeJoint.connectedBody = rigidbody;\r\n        \r\n        // 初始化鸟的位置 动画移动到弹弓上\r\n        this.node.setPosition(0, 0);\r\n        let duration = 1;\r\n        let action = cc.moveTo(duration, 0, 0);\r\n        // this.node.runAction(action);\r\n            \r\n        /* 初始化绳子 */\r\n        // 画笔\r\n        this.graphicsSpring = this.spring.addComponent(cc.Graphics);\r\n        // 画绳子\r\n        // 左右绳子，在弹弓上的固定坐标\r\n\r\n        let position = new cc.Vec2(0, 0);//  this.node.getPosition();\r\n        this.ropeLeftLocation = new cc.Vec2(position.x - 12, position.y - 2);\r\n        this.ropeRightLocation = new cc.Vec2(position.x + 8, position.y);\r\n\r\n\r\n        this._drawRope(this.graphicsSpring);\r\n        // ready = 1\r\n        // 触摸跟随事件 有些鬼畜\r\n        this.node.parent.on('touchmove', this._touchmoveEvent.bind(this));//, this);\r\n        //增加触摸释放事件\r\n        this.node.parent.once('touchend', this._emitEvent.bind(this));//, this);\r\n        this.node.parent.once('touchcancel', this._emitEvent.bind(this));//, this);\r\n\r\n    },\r\n\r\n    //触摸事件\r\n    _touchmoveEvent: function(event){\r\n        if(this.ready === 1){\r\n            let eventPos = event.getLocation();\r\n            let parent = this.node.parent;\r\n            let parentPos = getWorldLocation(parent);\r\n            let parentSize = parent.getContentSize();\r\n            let rec = changeRectangle(parentPos, parentSize);\r\n            const delta = event.touch.getDelta();\r\n            let minStep = 20;\r\n            if(!isOutOfBorder(eventPos, ...rec) && delta.x < minStep && delta.y < minStep){\r\n                // 弹弓音效\r\n                this._onStopAudio();\r\n                this._onPlayAudio('spring');\r\n                let position = this.node.getPosition();\r\n                position.x += delta.x;\r\n                position.y += delta.y;\r\n                this.node.setPosition(position);\r\n            }\r\n            // 阻止事件冒泡\r\n            event.stopPropagation();\r\n        }\r\n    },\r\n\r\n    //发射事件\r\n    _emitEvent : function(event){\r\n        if(this.ready !== 1){\r\n            return;\r\n        }\r\n        let location_delta = this._locationTransform(this.emitStartPosition);//this._locationTransform(this.node.parent.convertToWorldSpaceAR(this.emitStartPosition));\r\n        // 已经发射\r\n        this.ready = -1;\r\n        // 无法触摸，发射\r\n        this.node.parent.off('touchmove', this._touchmoveEvent.bind(this));//, this);\r\n        // 不受弹弓限制\r\n        if(this.spring.getComponent(cc.RopeJoint)){\r\n            this.spring.getComponent(cc.RopeJoint).destroy();\r\n        }\r\n        this.spring.active = false;            \r\n        // 发射\r\n        this.emit(location_delta, this);\r\n        // 发射轨迹 画笔\r\n        this.graphicsOrbit = this.node.parent.getComponent(cc.Graphics);\r\n        if(!this.graphicsOrbit){\r\n            this.graphicsOrbit = this.node.parent.addComponent(cc.Graphics);\r\n        }\r\n        else{\r\n            this.graphicsOrbit.clear();\r\n        }\r\n        // 增加技能事件绑定 \r\n        this._skillBind();\r\n        // 阻止事件冒泡\r\n        event.stopPropagation();\r\n    },\r\n\r\n    //技能事件\r\n    _skillEvent : function(event){\r\n        if(this.skillFlag){\r\n            // 触发技能\r\n            this.onSkill(event);\r\n            // 清除技能标记\r\n            this._skillClear();\r\n        }\r\n    },\r\n\r\n    //死亡事件\r\n    _onDeath : function(){\r\n        if(this.node){\r\n            // 血量为0\r\n            this.blood = 0;\r\n            // 动画效果\r\n            this.setFragment();\r\n            // 清除技能\r\n            this._skillClear();\r\n            // 先缩小到0\r\n            this.node.setContentSize(0, 0);\r\n            //播放音效\r\n            this._onPlayAudio('crash');\r\n            // 延时销毁本体\r\n            this.scheduleOnce(function(){\r\n                this.node.destroy()\r\n            }, this.duration / 3);\r\n        }\r\n    },\r\n\r\n    //技能绑定\r\n    _skillBind : function(){\r\n        let bg = this.node.parent.parent;\r\n        if(bg){\r\n            bg.once('touchstart', this._skillEvent.bind(this));\r\n        }\r\n    },\r\n\r\n    //技能清除\r\n    _skillClear : function(){\r\n        this.skillFlag = false;\r\n    },\r\n\r\n    //画绳子\r\n    _drawRope : function(graphics){\r\n        graphics.clear();\r\n        let locationWorldBird = getWorldLocation(this.node.getComponent(cc.RigidBody).node);\r\n        let locationWorldEmit = getWorldLocation(this.spring);\r\n        // 鸟的相对坐标\r\n        let location = locationWorldBird.sub(locationWorldEmit);\r\n        let locationLeft = new cc.Vec2(location.x - 10, location.y);\r\n        let locationRight = new cc.Vec2(location.x + 10, location.y);\r\n        graphics.strokeColor = cc.Color.BLACK;//填充\r\n\r\n        graphics.lineWidth = 2;\r\n        graphics.moveTo(this.ropeLeftLocation.x ,this.ropeLeftLocation.y);\r\n        graphics.lineTo(locationLeft.x, locationLeft.y);\r\n        graphics.stroke();\r\n\r\n        graphics.lineWidth = 2;\r\n        graphics.moveTo(this.ropeRightLocation.x, this.ropeRightLocation.y);\r\n        graphics.lineTo(locationRight.x, locationRight.y);\r\n        graphics.stroke();  \r\n    },\r\n\r\n    //画圆点\r\n    _drawCircle : function(graphics){\r\n        let locationWorldBird = getWorldLocation(this.node.getComponent(cc.RigidBody).node);\r\n        let locationWorldParent = getWorldLocation(this.node.parent);\r\n        // 鸟的相对坐标\r\n        let delta = locationWorldBird.sub(locationWorldParent);\r\n        let size = this.node.parent.getContentSize();\r\n        let location = new cc.Vec2(size.width / 2, size.height / 2);\r\n        location = location.add(delta);\r\n        let color = cc.Color.YELLOW;\r\n        graphics.strokeColor = color;//填充\r\n        \r\n        // 轨迹的点图 半径渐变\r\n        if(!this.orbitRadius){\r\n            this.orbitRadius = 0;\r\n        }\r\n        this.orbitRadius = (this.orbitRadius) % 16 + 1;\r\n        let radius = this.orbitRadius / 4;\r\n        if(radius === Math.floor(radius)){\r\n            graphics.circle(location.x, location.y, radius);\r\n            graphics.fill();\r\n            graphics.stroke();\r\n        }\r\n    },\r\n\r\n    // 坐标系转换 : location（世界坐标）相对于鸟的坐标\r\n    _locationTransform(location){\r\n        let x = location.x;\r\n        let y = location.y;\r\n        return location.sub(getWorldLocation(this.node));//location.sub(this.node.parent.convertToWorldSpaceAR(this.node));\r\n    },\r\n\r\n    emit : function (location_delta){\r\n        // 修改值： 重力，刚体旋转性\r\n        // 获取刚体\r\n        let rigid = this.node.getComponent(cc.RigidBody);\r\n        rigid.gravityScale = 1;\r\n        rigid.fixedRotation = false;\r\n        //速度\r\n        let radius = Math.hypot(location_delta.x, location_delta.y);\r\n        let speed = radius * this.emitVelocityMax / this.emitRadiusMax;\r\n        let speed_x = location_delta.x * speed / radius;\r\n        let speed_y = location_delta.y * speed / radius;\r\n        this.setVelocity(speed_x, speed_y);\r\n    },\r\n\r\n    // 设置屏幕rec\r\n    setScreenRectangle : function(){\r\n        let bg = this.node.parent.parent;\r\n        let size = bg.getContentSize();\r\n        let position = getWorldLocation(bg);\r\n        // minX maxX minY maxY\r\n        this.screen = changeRectangle(position, size);\r\n    },\r\n\r\n    // 设置刚体是否可碰撞\r\n    setRigidActive : function(active){\r\n        this.node.getComponent(cc.RigidBody).active = active;\r\n    },\r\n\r\n    // 设置刚体弹性\r\n    setRestitution : function(restitution){\r\n        this.node.getComponent(cc.PhysicsCollider).restitution = restitution;\r\n    },\r\n\r\n    // 设置刚体速度\r\n    setVelocity : function(vel_x, vel_y){\r\n        let rigid = this.node.getComponent(cc.RigidBody);\r\n        rigid.linearVelocity = new cc.Vec2(vel_x, vel_y);\r\n    },\r\n\r\n    // 设置刚体重力\r\n    setGravity : function(gravity){\r\n        let rigid = this.node.getComponent(cc.RigidBody);\r\n        rigid.gravityScale = gravity;\r\n    },\r\n\r\n    // 设置碎片\r\n    setFragment : function(){\r\n        if(!this.fragmentPrefab){\r\n            return;\r\n        }\r\n        let location = getWorldLocation(this.node);\r\n        let num = Math.floor(Math.random() * 4) + 3;\r\n\r\n        for(let i = 0; i < num; ++i){\r\n            let imageId = Math.floor(3 * Math.random());\r\n            if(imageId >= 3){\r\n                imageId = 2;\r\n            }\r\n            // 碎屑node\r\n            let fragmentNode = cc.instantiate(this.fragmentPrefab);\r\n            let parent = this.node.parent;\r\n            let locationParent = getWorldLocation(parent);\r\n            // 相对位置\r\n            let delta = location.sub(locationParent);\r\n            // 随机x,y\r\n            let x = delta.x + this.node.getContentSize().width * (Math.random() - 0.5);\r\n            let y = delta.y + this.node.getContentSize().height * (Math.random() - 0.5);\r\n            parent.addChild(fragmentNode);\r\n            fragmentNode.setPosition(x, y);\r\n            // 碎屑\r\n            let fragment = fragmentNode.getComponent(this.fragmentType);\r\n            let vel_x = fragment.velocityMax * (Math.random() - 0.5);\r\n            let vel_y = fragment.velocityMax * (Math.random() - 0.5);\r\n            fragment.setVelocity(vel_x, vel_y);\r\n            fragment.init(imageId);\r\n        }\r\n    },\r\n\r\n    // 每次处理完碰撞体接触逻辑时被调用，\r\n    // 1.刚体减速更快\r\n    onPostSolve: function (contact, thisCollider, otherCollider) {\r\n        let rigidbody = this.node.getComponent(cc.RigidBody);\r\n        rigidbody.linearDamping = this.accel;\r\n\r\n        /* 碰撞对鸟的影响 */\r\n        // 发射后第一次碰撞后duration时间后释放技能死亡\r\n        if(!this.crashFlag && this.ready === -1){\r\n            this.crashFlag = true;\r\n            this.scheduleOnce(function(){\r\n                // 释放技能\r\n                this._skillEvent();\r\n                // 死亡\r\n                this._onDeath();\r\n            }, this.duration);\r\n        }\r\n        // 鸟的角度\r\n        let angle = 180/Math.PI * this.node.rotation;\r\n        // 伤害\r\n        let effect = getEffect(thisCollider, otherCollider, angle);\r\n        if(effect === 0){\r\n            return;\r\n        }\r\n        // 切换图片\r\n        let sprite = this.node.getComponent(cc.Sprite);\r\n        // 受伤\r\n        this.onAttack(effect);\r\n        // 是否死亡\r\n        if(!this.blood){\r\n            return;\r\n        }\r\n        else if(this.blood > 0 && this.blood <= this.blood_max / 3 && this.imageId !== 2){\r\n            //播放音效\r\n            this._onPlayAudio('crash');\r\n            // 掉羽毛\r\n            this.setFragment();\r\n            this.imageId = 2;\r\n            spriteUpdate(sprite, this.spriteImage + this.type + \"_\" + this.imageId + \".png\");\r\n        }\r\n        else if(this.blood > this.blood_max / 3 && this.blood <= this.blood_max / 3 * 2 && this.imageId !== 1){\r\n            //播放音效\r\n            this._onPlayAudio('crash');\r\n            // 掉羽毛\r\n            this.setFragment();\r\n            this.imageId = 1;\r\n            spriteUpdate(sprite, this.spriteImage + this.type + \"_\" + this.imageId + \".png\");\r\n        }\r\n\r\n    },\r\n\r\n    // 受到攻击\r\n    onAttack : function(effect){\r\n        if(this.blood <= 0){\r\n            return;\r\n        }\r\n        this.blood -= effect / this.armor;\r\n        if(this.blood <= 0){\r\n            this.blood = 0;\r\n            if(this.skillFlag){\r\n                this._skillEvent();\r\n            }\r\n            this._onDeath();\r\n        }\r\n    },\r\n\r\n    // 播放音效\r\n    _onPlayAudio : function(type){\r\n        if(type === 'crash' && this.crashAudio){\r\n            this.currentAudio = cc.audioEngine.play(this.crashAudio, false, 1);\r\n        }\r\n        else if(type === 'boom' && this.boomAudio){\r\n            this.currentAudio = cc.audioEngine.play(this.boomAudio, false, 0.5);\r\n        }\r\n        else if(type === 'spring' && this.spring){\r\n            this.currentAudio = cc.audioEngine.play(this.springAudio, false, 1);\r\n        }\r\n    },\r\n\r\n    // 停止音效\r\n    _onStopAudio : function(){\r\n        cc.audioEngine.stop(this.currentAudio);\r\n    },\r\n\r\n    update : function(dt) {\r\n        // 画弹弓\r\n        if(this.graphicsSpring){\r\n            if(this.ready === 1 && this.spring && this.spring.active){\r\n                this._drawRope(this.graphicsSpring);\r\n            }\r\n            else{\r\n                this.graphicsSpring.clear();\r\n            }\r\n        }\r\n        // 画轨迹\r\n        if(this.graphicsOrbit){\r\n            // 处在已经发射状态 且 未碰撞过\r\n            if(this.ready === -1 && !this.crashFlag){\r\n                this._drawCircle(this.graphicsOrbit);\r\n            }\r\n        }\r\n        // 判断是否出界\r\n        if(this.ready === -1 && this.blood){\r\n            let location = getWorldLocation(this.node);\r\n            let delta = 5;\r\n            let screen = this.screen;\r\n            if(isOutOfBorder(location, screen[0] + delta, screen[1] - delta, screen[2] + delta, screen[3] - delta)){\r\n                this._onDeath();\r\n            }\r\n        }\r\n    },\r\n});\r\n"]}
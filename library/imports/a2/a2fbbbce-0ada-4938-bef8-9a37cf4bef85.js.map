{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\scripts\\objects/assets\\scripts\\objects\\BirdBoom.js"],"names":["BirdObject","require","cc","Class","extends","properties","onLoad","init","boomRadius","boomVelocityMax","emitVelocityMax","boomEffectMax","blood_max","fragmentType","onSkill","event","location","node","tools","_getAllTools","forEach","minDis","_getlMinDistance_Tool","tool","scale","eff","subTool","_getToolSubclass","onAttack","blood","toolLocation","delta","sub","mas","getComponent","RigidBody","getMass","vel","vel_x","x","vel_y","y","setVelocity","setContentSize","setGravity","_playAnimation","_onDeath","_onPlayAudio","animationComp","Animation","play","canvas","branches","filter","branch","object","_name","indexOf","name","center","circleCollider","PhysicsCircleCollider","radius","dis","rec","getBoundingBoxToWorld","p1","Vec2","p2","width","height","p3","p4","start"],"mappings":"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","file":"BirdBoom.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\scripts\\objects","sourcesContent":["const BirdObject = require(\"BirdObject\")\r\nimport {getAllBranches} from '../utils/common';\r\nimport {getCanvas} from '../utils/common';\r\nimport {getWorldLocation} from '../utils/common';\r\nimport {getMinDistance_P_C} from '../utils/common';\r\nimport {getMinDistance_P_Poly} from '../utils/common';\r\n\r\ncc.Class({\r\n    extends: BirdObject,\r\n    properties: {\r\n    },\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    onLoad : function () {\r\n        this.init('bird_boom');\r\n        // 爆炸范围\r\n        this.boomRadius = 150;\r\n        // 爆炸中心速度\r\n        this.boomVelocityMax = this.emitVelocityMax;\r\n        // 爆炸最大伤害\r\n        this.boomEffectMax = this.blood_max / 1.5;\r\n        //碎屑类型\r\n        this.fragmentType = \"FragmentBird\";\r\n    },\r\n\r\n    // 技能\r\n    onSkill : function(event){\r\n        /* 爆炸鸟技能 */\r\n        // 自己的世界坐标\r\n        let location = getWorldLocation(this.node);\r\n        \r\n        // 获取当前所有存活的tool object\r\n        let tools = this._getAllTools();\r\n        // 爆炸效果\r\n        tools.forEach(tool => {\r\n            // 物体距离爆炸中心最小距离\r\n            let minDis = this._getlMinDistance_Tool(tool, location);\r\n            if(minDis <= this.boomRadius){\r\n                // 比例\r\n                let scale = 1 - minDis / this.boomRadius;\r\n                // 伤害\r\n                let eff = this.boomEffectMax * scale;\r\n                // 分类\r\n                let subTool = this._getToolSubclass(tool);\r\n                // 伤害\r\n                subTool.onAttack(eff, 'bird_boom');\r\n                // 速度\r\n                if(subTool && subTool.blood){\r\n                    let toolLocation = getWorldLocation(tool);\r\n                    let delta = toolLocation.sub(location);\r\n                    let mas = tool.getComponent(cc.RigidBody).getMass();\r\n                    let vel = this.boomVelocityMax * scale / mas;\r\n                    let vel_x = vel * delta.x / minDis;\r\n                    let vel_y = vel * delta.y / minDis;\r\n                    subTool.setVelocity(vel_x, vel_y);\r\n                }\r\n            }\r\n        });\r\n        // 静止\r\n        this.setVelocity(0, 0);\r\n        this.node.setContentSize(0, 0);\r\n        this.setGravity(0);\r\n        // 播放动画\r\n        this._playAnimation();\r\n        this._onDeath();\r\n        //播放爆炸音效\r\n        this._onPlayAudio('boom');\r\n    },\r\n\r\n    // 播放动画\r\n    _playAnimation : function(){\r\n        let animationComp = this.getComponent(cc.Animation);\r\n        animationComp.play();\r\n    },\r\n\r\n    // 得到当前所有的tools\r\n    _getAllTools : function(){\r\n        let canvas = getCanvas(this.node);\r\n        let branches = getAllBranches(canvas);\r\n        return branches.filter(function(branch){\r\n            let object = branch._name;\r\n            if(object.indexOf('tool') !== -1){\r\n                return branch;\r\n            }\r\n        });\r\n    },\r\n\r\n    // 得到tool距离爆炸中心的最小距离\r\n    _getlMinDistance_Tool : function(tool, location){\r\n        let name = tool._name;\r\n        // 圆形\r\n        if(name.indexOf('circle') !== -1){\r\n            let center = getWorldLocation(tool);\r\n            let circleCollider = tool.getComponent(cc.PhysicsCircleCollider);\r\n            let radius = circleCollider.radius;\r\n            let dis = getMinDistance_P_C(location, center, radius);\r\n            return dis;\r\n        }\r\n        // 三角形\r\n        else if(name.indexOf('triangle') !== -1){\r\n            let rec = tool.getBoundingBoxToWorld();\r\n            let p1 = new cc.Vec2(rec.x, rec.y);\r\n            let p2 = new cc.Vec2(rec.x + rec.width / 2, rec.y + rec.height);\r\n            let p3 = new cc.Vec2(rec.x + rec.width, rec.y);\r\n            let dis = getMinDistance_P_Poly(location, p1, p2, p3);\r\n            return dis;\r\n        }\r\n        // 矩形\r\n        else{\r\n            let rec = tool.getBoundingBoxToWorld();\r\n            let p1 = new cc.Vec2(rec.x, rec.y);\r\n            let p2 = new cc.Vec2(rec.x + rec.width, rec.y);\r\n            let p3 = new cc.Vec2(rec.x + rec.width, rec.y + rec.height);\r\n            let p4 = new cc.Vec2(rec.x, rec.y + rec.height);\r\n            let dis = getMinDistance_P_Poly(location, p1, p2, p3, p4);\r\n            return dis;\r\n        }\r\n    },\r\n\r\n    // 得到tool的子类\r\n    _getToolSubclass : function(tool){\r\n        let name = tool._name;\r\n        // 冰块\r\n        if(name.indexOf('ice') !== -1){\r\n            return tool.getComponent('Ice');\r\n        }\r\n        else if(name.indexOf('pig') !== -1){\r\n            return tool.getComponent('Pig');\r\n        }\r\n        else if(name.indexOf('stone') !== -1){\r\n            return tool.getComponent('Stone');\r\n        }\r\n        else if(name.indexOf('wood') !== -1){\r\n            return tool.getComponent('Wood');\r\n        }\r\n        else if(name.indexOf('shelf') !== -1){\r\n            return tool.getComponent('Shelf');\r\n        }\r\n        else{\r\n            return null;\r\n        }\r\n    },\r\n\r\n    start () {\r\n\r\n    },\r\n\r\n    //  update : function(dt) {\r\n    //  },\r\n});\r\n"]}
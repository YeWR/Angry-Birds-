{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\scripts\\utils/assets\\scripts\\utils\\gameController.js"],"names":["cc","Class","extends","Component","properties","size","level","birdPrefab","default","type","Prefab","birdBoomPrefab","birdFlyPrefab","birdSwellPrefab","woodLongPrefab","woodShortPrefab","woodCirclePrefab","stoneLongPrefab","stoneTrianglePrefab","stoneCirclePrefab","icePrefab","pigPrefab","selectorPrefab","menuPrefab","nextPrefab","restartPrefab","victoryAudio","url","AudioClip","failAudio","spring","Node","onLoad","director","getPhysicsManager","enabled","gravity","v2","readyCamera","gameOver","score","curBird","_addResources","start","_controlGame","self","interval","delay","schedule","over","_levelNext","_emitNext","ready","_cameraMoveBind","scheduleOnce","_emitBird","_gameOver","jsonPath","raw","loader","load","err","res","resources","_addPlayerRes","_addScene","_addBirds","_addCamera","JSON","parse","sys","localStorage","getItem","stars","highest_scores","highest_level","number_levels","star","highest_score","length","scoreNode","node","getChildByName","color","scoreLabel","getComponent","Label","string","scoreHighestNode","scoreHighestLabel","levelNode","levelLabel","birds","Array","birdsRes","bg","emitPlace","delta","cur_x","forEach","bird","split","birdComp","newBird","instantiate","push","addChild","setPosition","camera","setStartScreen","_addSelector","state","selector","menu","on","scene","loadScene","restart","birdNum","_birdsEmitNumber","starNum","Math","max","min","starSprite","Sprite","starUrl","_conditionNext","next","addScore","rope","RopeJoint","addComponent","setRigidActive","shift","setRestitution","readyEmit","bindCenter","_allStatic","children","ans","rigidBody","child","RigidBody","velocity","linearVelocity","abs","x","y","name","indexOf","allStatic","duration","starNumPrevious","_onPlayAudio","console","log","_changePlayerRes","setItem","stringify","totalStars","minStars","i","_cameraEvent","bind","event","touch","getDelta","moveCamera","currentAudio","audioEngine","play"],"mappings":"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","file":"gameController.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\scripts\\utils","sourcesContent":["import {spriteUpdate} from '../utils/common';\r\nimport {getAllBranches} from '../utils/common';\r\nimport {scoreAnimation } from '../utils/common';\r\nimport {getAllToolsPosition } from '../utils/common';\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        size: cc.size(0, 0),\r\n        // 关卡\r\n        level : 0,\r\n        // 普通鸟 prefab\r\n        birdPrefab: {\r\n            default : null,\r\n            type : cc.Prefab\r\n        },\r\n        // 爆炸鸟 prefab\r\n        birdBoomPrefab: {\r\n            default : null,\r\n            type : cc.Prefab\r\n        },\r\n        // 飞行鸟 prefab\r\n        birdFlyPrefab : {\r\n            default : null,\r\n            type : cc.Prefab\r\n        },\r\n        // 膨胀鸟 prefab\r\n        birdSwellPrefab : {\r\n            default : null,\r\n            type : cc.Prefab\r\n        },\r\n        // 长木头 prefab\r\n        woodLongPrefab : {\r\n            default : null,\r\n            type : cc.Prefab\r\n        },\r\n        // 短木头 prefab\r\n        woodShortPrefab : {\r\n            default : null,\r\n            type : cc.Prefab\r\n        },\r\n        // 圆木头 prefab\r\n        woodCirclePrefab : {\r\n            default : null,\r\n            type : cc.Prefab\r\n        },\r\n        // 长石头 prefab\r\n        stoneLongPrefab : {\r\n            default : null,\r\n            type : cc.Prefab\r\n        },\r\n        // 三角石头 prefab\r\n        stoneTrianglePrefab : {\r\n            default : null,\r\n            type : cc.Prefab\r\n        },\r\n        // 圆石头 prefab\r\n        stoneCirclePrefab : {\r\n            default : null,\r\n            type : cc.Prefab\r\n        },\r\n        // 冰块 prefab\r\n        icePrefab : {\r\n            default : null,\r\n            type : cc.Prefab\r\n        },\r\n        // 猪 prefab\r\n        pigPrefab : {\r\n            default : null,\r\n            type : cc.Prefab\r\n        },\r\n        // 界面 prefab\r\n        selectorPrefab : {\r\n            default : null,\r\n            type : cc.Prefab\r\n        },\r\n        // 回到菜单prefab\r\n        menuPrefab : {\r\n            default : null,\r\n            type : cc.Prefab\r\n        },\r\n        // next prefab\r\n        nextPrefab : {\r\n            default : null,\r\n            type : cc.Prefab\r\n        },\r\n        // restart prefab\r\n        restartPrefab : {\r\n            default : null,\r\n            type : cc.Prefab\r\n        },\r\n        // 胜利音效\r\n        victoryAudio : {\r\n            url: cc.AudioClip,\r\n            default: null\r\n        },\r\n        // 失败音效\r\n        failAudio : {\r\n            url: cc.AudioClip,\r\n            default: null\r\n        },\r\n        // 弹弓\r\n        spring : {\r\n            default:null,\r\n            type : cc.Node\r\n        },\r\n    },\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    onLoad : function () {\r\n        // 物理引擎\r\n        cc.director.getPhysicsManager().enabled = true;\r\n        // 重力加速度设置\r\n        cc.director.getPhysicsManager().gravity = cc.v2(0, -500);\r\n\r\n        // 相机是否可以跟随\r\n        this.readyCamera = false,\r\n        // 是否本局游戏结束\r\n        this.gameOver = false;\r\n        // 分数\r\n        this.score = 0;\r\n        // 当前正要发射的鸟\r\n        this.curBird = null;\r\n        // 加载资源(异步)\r\n        this._addResources();\r\n\r\n    },\r\n\r\n    start () {\r\n\r\n    },\r\n\r\n    // 主逻辑 控制\r\n    _controlGame : function(self){\r\n        let interval = 8;\r\n        let delay = 0.5;\r\n        self.schedule(function() {\r\n            let over = self._levelNext(self);\r\n            if(!self.gameOver){\r\n                if(self._emitNext(self) && (self.curBird === null || self.curBird.ready === -1)){\r\n                    self._cameraMoveBind();\r\n                    self.scheduleOnce(function(){\r\n                        self.curBird = self._emitBird(self);\r\n                    }, delay) \r\n                }\r\n                if(over !== 0){\r\n                    self._gameOver(over, self);\r\n                }\r\n            }\r\n        }, interval);\r\n    },\r\n\r\n    // 加载资源 注意异步加载\r\n    _addResources : function(){\r\n        let self = this;\r\n        let jsonPath = \"resources/json/level_\" + self.level + \".json\";\r\n        let url = cc.url.raw( jsonPath);\r\n        cc.loader.load( url, function( err, res) {\r\n            // 加载游戏资源\r\n            self.resources = res;\r\n            // 加载玩家资源\r\n            self._addPlayerRes(self);\r\n            // 加载场景资源\r\n            self._addScene(self);\r\n            // 加载鸟\r\n            self._addBirds(self);\r\n            // 加载相机\r\n            self._addCamera(self);\r\n            // 开始游戏\r\n            self._controlGame(self);\r\n            // 加载完毕\r\n            self.ready = true;\r\n\r\n            // let bg = self.node.getChildByName('bg');\r\n            // getAllToolsPosition(bg);\r\n        }); \r\n    },\r\n\r\n    // 加载玩家资源\r\n    _addPlayerRes : function(self){\r\n        // 所有资源\r\n        let resources = JSON.parse(cc.sys.localStorage.getItem('player_resources'));\r\n        // 星星\r\n        let stars = resources.stars;\r\n        // 最高分\r\n        let highest_scores = resources.highest_scores;\r\n        // 最高关卡\r\n        self.highest_level = resources.highest_level;\r\n        // 总关卡\r\n        self.number_levels = resources.number_levels;\r\n        //\r\n        self.stars = stars;\r\n        self.star = 0;\r\n        self.highest_score = 0;\r\n        //\r\n        if(self.level <= stars.length){\r\n            self.star = stars[self.level - 1];\r\n        }\r\n        if(self.level <= highest_scores.length){\r\n            self.highest_score = highest_scores[self.level - 1];\r\n        }\r\n    },\r\n\r\n    // 加载场景\r\n    _addScene : function(self){\r\n        // 加载分数\r\n        let scoreNode = self.node.getChildByName('score');\r\n        scoreNode.color = new cc.color(0, 0, 0, 255);\r\n        let scoreLabel = scoreNode.getComponent(cc.Label);\r\n        scoreLabel.string = \"Score: \" + self.score;\r\n        self.scoreLabel = scoreLabel;\r\n\r\n        // 加载最高分数\r\n        let scoreHighestNode = self.node.getChildByName('score_highest');\r\n        scoreHighestNode.color = new cc.color(255, 0, 0, 255);\r\n        let scoreHighestLabel = scoreHighestNode.getComponent(cc.Label);\r\n        scoreHighestLabel.string = \"Highest Score: \" + self.highest_score;\r\n        \r\n        // 加载当前关卡\r\n        let levelNode = self.node.getChildByName('level');\r\n        levelNode.color = new cc.color(0, 0, 0, 255);\r\n        let levelLabel = levelNode.getComponent(cc.Label);\r\n        levelLabel.string = \"Level: \" + self.level;\r\n    },\r\n\r\n    // 加载所有鸟的资源 self.birds 为Bird 组件\r\n    _addBirds : function(self) {\r\n        // 所有的鸟\r\n        self.birds = new Array();\r\n        // 资源\r\n        let birdsRes = self.resources.birds;\r\n        // 各层父节点\r\n        let bg = self.node.getChildByName('bg');\r\n        // 发射空位\r\n        let emitPlace = bg.getChildByName('emitPlace');\r\n        // 每个鸟之间的距离\r\n        let delta = -40;\r\n        // 初始化每个鸟的位置(由于重力存在，仅需设置x方向)\r\n        let cur_x = 0;\r\n        // 实例化prefab鸟类\r\n        birdsRes.forEach(bird => {\r\n            let type = bird.split('bird')[1];\r\n            let birdComp = 'Bird' + type;\r\n            let newBird;\r\n            if(type === ''){\r\n                newBird = cc.instantiate(self.birdPrefab);\r\n            }\r\n            else if(type === 'Boom'){\r\n                newBird = cc.instantiate(self.birdBoomPrefab);\r\n            }\r\n            else if(type === 'Fly'){\r\n                newBird = cc.instantiate(self.birdFlyPrefab);\r\n            }\r\n            else if(type === 'Swell'){\r\n                newBird = cc.instantiate(self.birdSwellPrefab);\r\n            }\r\n            self.birds.push(newBird.getComponent(birdComp));\r\n            emitPlace.addChild(newBird);\r\n            cur_x += delta;\r\n            newBird.setPosition(cur_x, 0);\r\n        });\r\n    },\r\n\r\n    \r\n    // 加载相机\r\n    _addCamera : function(self){\r\n        let bg = self.node.getChildByName('bg');\r\n        self.camera = bg.getChildByName('camera').getComponent('cameraController');\r\n        self.camera.setStartScreen();\r\n    },\r\n\r\n    // 加载选择器 state 1-> 胜利， -1 -> 失败\r\n    _addSelector : function(state, self){\r\n        // 选择器容器\r\n        let selector = cc.instantiate(self.selectorPrefab);\r\n        self.node.addChild(selector);\r\n        // 回到菜单\r\n        let menu = cc.instantiate(self.menuPrefab);\r\n        selector.addChild(menu);\r\n        // 回到菜单事件\r\n        menu.on(\"touchstart\", function(){\r\n            let scene = \"menu\";\r\n            cc.director.loadScene(scene);\r\n        }, self);\r\n        // 再来一次\r\n        let restart = cc.instantiate(self.restartPrefab);\r\n        selector.addChild(restart);\r\n        // 再来一次事件\r\n        restart.on(\"touchstart\", function(){\r\n            let scene = 'level_' + self.level;\r\n            cc.director.loadScene(scene);\r\n        }, self);      \r\n\r\n        // 分数\r\n        let scoreLabel = selector.getChildByName('scores').getComponent(cc.Label);\r\n        scoreLabel.string = 'Score: ' + self.score;\r\n        // 星星数量为[0,3]\r\n        let birdNum = self._birdsEmitNumber();\r\n        let starNum = Math.max(0, 4 - birdNum);\r\n        starNum = Math.min(3, starNum);\r\n        // 更换星星的图片\r\n        let starSprite = selector.getChildByName('star').getComponent(cc.Sprite);\r\n        let starUrl = 'resources/textures/stars/star_' + starNum + '.png';\r\n        spriteUpdate(starSprite, starUrl);\r\n        if(state === -1 || !self._conditionNext(self)){// 出局 或者 星星数太少\r\n            // 位置\r\n            menu.setPosition(-70, -95);\r\n            restart.setPosition(70, -95);\r\n        }\r\n        else if(state === 1){// 下一局\r\n            // 增加下一关按钮\r\n            let next = cc.instantiate(self.nextPrefab);\r\n            selector.addChild(next);\r\n            // 下一关事件\r\n            next.on(\"touchstart\", function(){\r\n                let level = self.level + 1;\r\n                let scene = \"\";\r\n                if(self.highest_level >= level){\r\n                    scene = 'level_' + level;\r\n                }\r\n                else{\r\n                    scene = 'clearance';\r\n                }\r\n                // 注意关卡最大值\r\n                cc.director.loadScene(scene);\r\n            }, self);\r\n            // 位置\r\n            menu.setPosition(-100, -95);\r\n            restart.setPosition(0, -93);\r\n            next.setPosition(100, -95);\r\n        }\r\n        return selector;\r\n    },\r\n\r\n    // 分数\r\n    addScore : function(score){\r\n        this.score += score;\r\n        this.scoreLabel.string = \"Score: \" + this.score;\r\n    },\r\n\r\n    // 准备发射一只鸟\r\n    _emitBird : function(self){\r\n        // 准备弹弓\r\n        let rope = self.spring.getComponent(cc.RopeJoint);\r\n        if(!rope){\r\n            self.spring.addComponent(cc.RopeJoint);   \r\n        } \r\n        // 其他准备中的鸟设置不可碰撞\r\n        self.birds.forEach(bird => {\r\n            if(bird){\r\n                let ready = bird.ready;\r\n                if(ready === 0){\r\n                    bird.setRigidActive(false);\r\n                }\r\n            }\r\n        });\r\n        // 准备鸟\r\n        let bird = self.birds.shift(); // .getComponent('Bird');\r\n        self.birds.push(bird);\r\n        \r\n        if(bird){\r\n            // 设置可碰撞\r\n            bird.setRigidActive(true);\r\n            // 设置弹性\r\n            bird.setRestitution(0.4);\r\n            // 进入弹弓\r\n            bird.readyEmit(self.spring);\r\n        }\r\n        // 相机\r\n        this.camera.bindCenter(bird);\r\n        return bird;\r\n    },\r\n\r\n    // 判断是否所有刚体的速度是否为'0'，是则返回true，否则返回false\r\n    _allStatic : function(children){\r\n        // 速度的最小值\r\n        let delta = 0.5;\r\n        let ans = true;\r\n        // 是否处于基本静止状态\r\n        children.forEach(child => {\r\n            let rigidBody = child.getComponent(cc.RigidBody);\r\n            if(rigidBody){\r\n                let velocity = rigidBody.linearVelocity;\r\n                if(Math.abs(velocity.x > delta) || Math.abs(velocity.y > delta)){\r\n                    ans = false;\r\n                }\r\n            }\r\n        });\r\n        return ans;\r\n    },\r\n\r\n    // 多少只鸟已经发射\r\n    _birdsEmitNumber : function(){\r\n        let ans = 0;\r\n        this.birds.forEach(bird => {\r\n            if(bird.ready === -1){\r\n                ans += 1;\r\n            }\r\n        });\r\n        return ans;\r\n    },\r\n\r\n    // 判断是否可以发射\r\n    _emitNext : function(self){\r\n        if(self.birds[0].ready === -1){\r\n            return false;\r\n        }\r\n        else{\r\n            // 所有子节点\r\n            // let children = getAllBranches(self.node);\r\n            // return self._allStatic(children);\r\n            return true;\r\n        }\r\n    },\r\n\r\n    // 判断是否可以进行下一局，出局或者继续, 0 -> 继续 ,1 -> 下一局, -1 -> 出局\r\n    _levelNext : function(self){\r\n        let state = 1;\r\n        let children = getAllBranches(self.node);\r\n        children.forEach(child => {\r\n            let name = child.name;\r\n            if(state === 1 && name.indexOf('pig') !== -1){// 还有猪\r\n                state = 0;\r\n            }\r\n        });\r\n        if(state === 0){\r\n            // 已经发射的鸟的数量\r\n            let birdNum = self._birdsEmitNumber();\r\n            let allStatic = self._allStatic(children);\r\n            if(allStatic){\r\n                if(birdNum === self.birds.length){// 没有鸟了，出局\r\n                    state = -1;\r\n                }\r\n            }\r\n        }\r\n        return state;\r\n    },\r\n\r\n    // 结束本局游戏 弹出菜单 1 -> 胜利, -1 -> 本局gg，\r\n    _gameOver : function(state, self){ \r\n        self.gameOver = true;\r\n        // 鸟的分数\r\n        self.birds.forEach(bird => {\r\n            if(bird && bird.ready !== -1){\r\n                let score = 10000;\r\n                let duration = 1;\r\n                scoreAnimation(bird.node, score, duration);\r\n                self.addScore(score);\r\n            }\r\n        });\r\n        // 更改最高分\r\n        self.highest_score = Math.max(self.highest_score, self.score);\r\n        // 更改星星数量\r\n        let starNumPrevious = self.star;\r\n\r\n        // 已经发射的鸟的数量\r\n        let birdNum = self._birdsEmitNumber();\r\n        // 星星数量为[0,3]\r\n        let starNum = Math.max(0, 4 - birdNum);\r\n        starNum = Math.min(3, starNum);\r\n        // 本地存储\r\n        self.star = Math.max(starNumPrevious, starNum);\r\n        let level = self.level + 1;\r\n        // 胜利\r\n        if(state === 1 && self._conditionNext(self)){\r\n            // victory音效\r\n            self._onPlayAudio('victory');\r\n            // 开荒\r\n            if(level > self.highest_level){\r\n                if(self.number_levels >= level){\r\n                    // 更改最高关卡\r\n                    self.highest_level = level;\r\n                }\r\n                // 完结\r\n                else{\r\n                    console.log(\"You are so great! No more levels for you! ~0.0~\");\r\n                }\r\n            }\r\n        }\r\n        else{\r\n            // fail音效\r\n            self._onPlayAudio('fail');\r\n            if(state === -1){\r\n                self.star = Math.max(self.star - 1, 0);\r\n            }\r\n        }\r\n        // 数据更改\r\n        self._changePlayerRes(self);\r\n        // 选择界面\r\n        self._addSelector(state, self);\r\n    },\r\n\r\n    // 更改玩家游戏数据\r\n    _changePlayerRes : function(self){\r\n        // 所有资源\r\n        let resources = JSON.parse(cc.sys.localStorage.getItem('player_resources'));\r\n        // 星星\r\n        resources.stars[self.level - 1] = self.star;\r\n        // 最高分\r\n        resources.highest_scores[self.level - 1] = self.highest_score;\r\n        // 最高关卡\r\n        resources.highest_level = self.highest_level;\r\n        // 存储\r\n        cc.sys.localStorage.setItem('player_resources', JSON.stringify(resources));     \r\n    },\r\n\r\n    _conditionNext : function(self){// 解锁条件\r\n        // 最后一关是否通关\r\n        if(self.level === self.number_levels){\r\n            if(self.star >= 2){\r\n                return true;\r\n            }\r\n            else{\r\n                return false;\r\n            }\r\n        }\r\n        // 解锁最后一关\r\n        else if(self.level === self.number_levels - 1){\r\n            if(self.star && self.star === 3){\r\n                let totalStars = 0;\r\n                let minStars = 3 * (self.level - 1) - 2;\r\n                for(let i = 0; i < self.level - 1; ++i){\r\n                    totalStars += self.stars[i];\r\n                }\r\n                if(totalStars >= minStars){\r\n                    return true;\r\n                }\r\n                else{\r\n                    return false;\r\n                }\r\n            }\r\n            else{\r\n                return false;\r\n            }\r\n        }\r\n        // 解锁后半程关卡\r\n        else if(self.level >= self.number_levels / 2){\r\n            if(self.star && self.star >= 2){\r\n                return true;\r\n            }\r\n            else{\r\n                return false;\r\n            }\r\n        }\r\n        // 解锁前半程关卡 \r\n        else{\r\n            if(self.star && self.star >= 1){\r\n                return true;\r\n            }\r\n            else{\r\n                return false;\r\n            }\r\n        }\r\n    },\r\n\r\n    // 相机移动\r\n    _cameraMoveBind : function(){\r\n        if(!this.readyCamera){\r\n            let bg = this.node.getChildByName('bg');\r\n            bg.on('touchmove', this._cameraEvent.bind(this));\r\n            this.readyCamera = true;\r\n        }\r\n    },\r\n\r\n    // 相机移动事件\r\n    _cameraEvent : function(event){\r\n        const delta = event.touch.getDelta();\r\n        delta.x = - delta.x;\r\n        delta.y = - delta.y;\r\n        this.camera.moveCamera(delta);\r\n    },\r\n\r\n    // 播放音效\r\n    _onPlayAudio : function(type){\r\n        if(type === 'victory' && this.victoryAudio){\r\n            this.currentAudio = cc.audioEngine.play(this.victoryAudio, false, 0.8);\r\n        }\r\n        else if(type === 'fail' && this.failAudio){\r\n            this.currentAudio = cc.audioEngine.play(this.failAudio, false, 0.8);\r\n        }\r\n    },\r\n});\r\n"]}